{"file_contents":{"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\nimport { initializeTokenRefresh } from \"./lib/token-refresh\";\n\n// Initialize persistent login token refresh system\ninitializeTokenRefresh();\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":298},"client/src/components/EmployeeRatesManagement.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { \n  DollarSign, \n  Users, \n  Save,\n  Edit2,\n  Check,\n  X,\n  User,\n  Clock,\n  Calendar,\n  Moon,\n  Sun,\n  Star\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\n\ninterface EmployeeRate {\n  userId: number;\n  weekdayRate: number;\n  weeknightRate: number;\n  saturdayRate: number;\n  sundayRate: number;\n  publicHolidayRate: number;\n}\n\ninterface Employee {\n  id: number;\n  name: string;\n  email: string;\n  companyId: number;\n}\n\ninterface EmployeeRatesManagementProps {\n  companyId: number;\n}\n\nexport function EmployeeRatesManagement({ companyId }: EmployeeRatesManagementProps) {\n  const { toast } = useToast();\n  const [selectedEmployeeId, setSelectedEmployeeId] = useState<string>(\"\");\n  const [editingEmployeeId, setEditingEmployeeId] = useState<number | null>(null);\n  const [editingRates, setEditingRates] = useState<Partial<EmployeeRate>>({});\n\n  // Fetch employees\n  const { data: employees = [], isLoading: employeesLoading } = useQuery<Employee[]>({\n    queryKey: ['/api/companies', companyId, 'employees'],\n  });\n\n  // Fetch employee rates for all employees\n  const { data: allEmployeeRates = [], isLoading: ratesLoading, refetch: refetchRates } = useQuery<EmployeeRate[]>({\n    queryKey: ['/api/companies', companyId, 'employee-rates'],\n    queryFn: async () => {\n      const response = await apiRequest('GET', `/api/companies/${companyId}/employee-rates`);\n      return response.json();\n    },\n    enabled: !!companyId,\n  });\n\n  // Create a map for easy lookup of rates by userId\n  const ratesMap = allEmployeeRates.reduce((acc, rate) => {\n    acc[rate.userId] = rate;\n    return acc;\n  }, {} as Record<number, EmployeeRate>);\n\n  // Update employee rates mutation\n  const updateRatesMutation = useMutation({\n    mutationFn: ({ userId, rates }: { userId: number; rates: Partial<EmployeeRate> }) => \n      apiRequest('PUT', `/api/employee-rates/${userId}`, rates),\n    onSuccess: () => {\n      toast({ title: \"Employee rates updated successfully\" });\n      setEditingEmployeeId(null);\n      setEditingRates({});\n      refetchRates();\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Failed to update rates\", \n        description: error.message || \"An error occurred\",\n        variant: \"destructive\" \n      });\n    }\n  });\n\n  // Create employee rates mutation\n  const createRatesMutation = useMutation({\n    mutationFn: (rates: EmployeeRate) => \n      apiRequest('POST', '/api/employee-rates', rates),\n    onSuccess: () => {\n      toast({ title: \"Employee rates created successfully\" });\n      setEditingEmployeeId(null);\n      setEditingRates({});\n      refetchRates();\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Failed to create rates\", \n        description: error.message || \"An error occurred\",\n        variant: \"destructive\" \n      });\n    }\n  });\n\n  const handleEditClick = (employeeId: number) => {\n    const existingRates = ratesMap[employeeId];\n    setEditingEmployeeId(employeeId);\n    // Convert cents to dollars for display\n    setEditingRates(existingRates ? {\n      weekdayRate: existingRates.weekdayRate / 100,\n      weeknightRate: existingRates.weeknightRate / 100,\n      saturdayRate: existingRates.saturdayRate / 100,\n      sundayRate: existingRates.sundayRate / 100,\n      publicHolidayRate: existingRates.publicHolidayRate / 100\n    } : {\n      weekdayRate: 25,\n      weeknightRate: 30,\n      saturdayRate: 35,\n      sundayRate: 40,\n      publicHolidayRate: 50\n    });\n  };\n\n  const handleSaveClick = (employeeId: number) => {\n    const existingRates = ratesMap[employeeId];\n    // Convert dollars to cents for storage\n    const finalRates = {\n      userId: employeeId,\n      weekdayRate: Math.round((editingRates.weekdayRate || 25) * 100),\n      weeknightRate: Math.round((editingRates.weeknightRate || 30) * 100),\n      saturdayRate: Math.round((editingRates.saturdayRate || 35) * 100),\n      sundayRate: Math.round((editingRates.sundayRate || 40) * 100),\n      publicHolidayRate: Math.round((editingRates.publicHolidayRate || 50) * 100)\n    };\n\n    if (existingRates) {\n      updateRatesMutation.mutate({ userId: employeeId, rates: finalRates });\n    } else {\n      createRatesMutation.mutate(finalRates);\n    }\n  };\n\n  const handleCancelClick = () => {\n    setEditingEmployeeId(null);\n    setEditingRates({});\n  };\n\n  const handleRateChange = (rateType: keyof EmployeeRate, value: string) => {\n    const numValue = parseFloat(value) || 0;\n    setEditingRates(prev => ({\n      ...prev,\n      [rateType]: numValue\n    }));\n  };\n\n  const getRateTypeIcon = (rateType: string) => {\n    switch (rateType) {\n      case 'weekdayRate': return <Clock className=\"h-4 w-4\" />;\n      case 'weeknightRate': return <Moon className=\"h-4 w-4\" />;\n      case 'saturdayRate': return <Calendar className=\"h-4 w-4\" />;\n      case 'sundayRate': return <Sun className=\"h-4 w-4\" />;\n      case 'publicHolidayRate': return <Star className=\"h-4 w-4\" />;\n      default: return <DollarSign className=\"h-4 w-4\" />;\n    }\n  };\n\n  const getRateTypeLabel = (rateType: string) => {\n    switch (rateType) {\n      case 'weekdayRate': return 'Weekday';\n      case 'weeknightRate': return 'Weeknight';\n      case 'saturdayRate': return 'Saturday';\n      case 'sundayRate': return 'Sunday';\n      case 'publicHolidayRate': return 'Public Holiday';\n      default: return rateType;\n    }\n  };\n\n  if (employeesLoading || ratesLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"h-5 w-5\" />\n            Employee Rate Management\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            {[1, 2, 3].map(i => (\n              <Skeleton key={i} className=\"h-20 w-full\" />\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  // Filter to selected employee\n  const selectedEmployee = selectedEmployeeId \n    ? employees.find(emp => emp.id.toString() === selectedEmployeeId)\n    : null;\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Users className=\"h-5 w-5\" />\n          Employee Rate Management\n        </CardTitle>\n        <p className=\"text-sm text-muted-foreground\">\n          Set hourly rates for each employee across different shift types and day categories.\n        </p>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-6\">\n          {/* Employee Selector */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"employee-select\">Select Employee</Label>\n            <Select \n              value={selectedEmployeeId} \n              onValueChange={setSelectedEmployeeId}\n            >\n              <SelectTrigger id=\"employee-select\" data-testid=\"employee-select\">\n                <SelectValue placeholder=\"Select an employee\" />\n              </SelectTrigger>\n              <SelectContent>\n                {employees.map((employee) => (\n                  <SelectItem key={employee.id} value={employee.id.toString()}>\n                    <div className=\"flex items-center gap-2\">\n                      <User className=\"h-4 w-4\" />\n                      {employee.name}\n                    </div>\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* Employee Rates Display */}\n          {!selectedEmployeeId ? (\n            <div className=\"text-center py-12 text-muted-foreground\">\n              <Users className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n              <p>Please select an employee to view and edit their rates.</p>\n            </div>\n          ) : selectedEmployee ? (\n            (() => {\n              const employee = selectedEmployee;\n            const existingRates = ratesMap[employee.id];\n            const isEditing = editingEmployeeId === employee.id;\n            const displayRates = isEditing ? editingRates : existingRates;\n\n            return (\n              <Card key={employee.id} className=\"border-l-4 border-l-blue-500\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"flex items-center justify-center w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900\">\n                        <User className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\n                      </div>\n                      <div>\n                        <h3 className=\"font-semibold\">{employee.name}</h3>\n                        <p className=\"text-sm text-muted-foreground\">{employee.email}</p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      {existingRates ? (\n                        <Badge variant=\"secondary\">Rates Set</Badge>\n                      ) : (\n                        <Badge variant=\"outline\">No Rates</Badge>\n                      )}\n                      {isEditing ? (\n                        <div className=\"flex gap-2\">\n                          <Button \n                            size=\"sm\" \n                            onClick={() => handleSaveClick(employee.id)}\n                            disabled={updateRatesMutation.isPending || createRatesMutation.isPending}\n                            data-testid={`button-save-rates-${employee.id}`}\n                          >\n                            <Check className=\"h-4 w-4\" />\n                          </Button>\n                          <Button \n                            size=\"sm\" \n                            variant=\"outline\" \n                            onClick={handleCancelClick}\n                            data-testid={`button-cancel-rates-${employee.id}`}\n                          >\n                            <X className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      ) : (\n                        <Button \n                          size=\"sm\" \n                          variant=\"outline\" \n                          onClick={() => handleEditClick(employee.id)}\n                          data-testid={`button-edit-rates-${employee.id}`}\n                        >\n                          <Edit2 className=\"h-4 w-4\" />\n                          {existingRates ? 'Edit' : 'Set'} Rates\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\">\n                    {['weekdayRate', 'weeknightRate', 'saturdayRate', 'sundayRate', 'publicHolidayRate'].map(rateType => (\n                      <div key={rateType} className=\"space-y-2\">\n                        <Label className=\"flex items-center gap-2 text-xs font-medium\">\n                          {getRateTypeIcon(rateType)}\n                          {getRateTypeLabel(rateType)}\n                        </Label>\n                        {isEditing ? (\n                          <div className=\"relative\">\n                            <DollarSign className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\n                            <Input\n                              type=\"number\"\n                              step=\"0.50\"\n                              min=\"0\"\n                              value={displayRates?.[rateType as keyof EmployeeRate] || ''}\n                              onChange={(e) => handleRateChange(rateType as keyof EmployeeRate, e.target.value)}\n                              className=\"pl-8\"\n                              placeholder=\"0.00\"\n                              data-testid={`input-${rateType}-${employee.id}`}\n                            />\n                          </div>\n                        ) : (\n                          <div className=\"flex items-center gap-1 text-sm\">\n                            <DollarSign className=\"h-3 w-3 text-muted-foreground\" />\n                            <span className=\"font-medium\" data-testid={`text-${rateType}-${employee.id}`}>\n                              {displayRates?.[rateType as keyof EmployeeRate] \n                                ? ((displayRates[rateType as keyof EmployeeRate] || 0) / 100).toFixed(2)\n                                : '0.00'}\n                            </span>\n                            <span className=\"text-muted-foreground\">/hr</span>\n                          </div>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            );\n            })()\n          ) : null}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":13383},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/pages/reports.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Edit, Trash2, Check, Clock, Filter, Search, Calendar, FileText, BarChart3 } from \"lucide-react\";\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, LabelList } from \"recharts\";\nimport { useShifts, useUpdateShift, useDeleteShift } from \"@/hooks/use-shifts\";\nimport { generateTimeOptions, formatTime, calculateDuration, formatDateRange, getWeekDates } from \"@/lib/time-utils\";\nimport { exportToCSV, exportToPDF } from \"@/lib/export\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Shift } from \"@shared/schema\";\n\nexport default function Reports() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [filterType, setFilterType] = useState(\"all\");\n  const [showEditDialog, setShowEditDialog] = useState(false);\n  const [shiftToEdit, setShiftToEdit] = useState<Shift | null>(null);\n  \n  // Date range filter state\n  const currentWeek = getWeekDates(new Date());\n  const [startDate, setStartDate] = useState(currentWeek.start);\n  const [endDate, setEndDate] = useState(currentWeek.end);\n  \n  const { data: allShifts, isLoading: shiftsLoading } = useShifts();\n  const updateShiftMutation = useUpdateShift();\n  const deleteShiftMutation = useDeleteShift();\n  const { toast } = useToast();\n\n  const timeOptions = generateTimeOptions();\n\n  // Filter shifts by date range, search term, and type\n  const filteredShifts = useMemo(() => {\n    if (!allShifts) return [];\n    \n    return allShifts.filter(shift => {\n      // Date range filter\n      const shiftDate = shift.date;\n      const isInDateRange = shiftDate >= startDate && shiftDate <= endDate;\n      \n      // Search filter\n      const matchesSearch = shift.shiftType.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        shift.date.includes(searchTerm) ||\n        (shift.notes && shift.notes.toLowerCase().includes(searchTerm.toLowerCase()));\n      \n      // Type filter\n      const matchesType = filterType === \"all\" || shift.shiftType === filterType;\n      \n      return isInDateRange && matchesSearch && matchesType;\n    });\n  }, [allShifts, startDate, endDate, searchTerm, filterType]);\n\n  // Calculate total hours for filtered shifts\n  const totalFilteredHours = useMemo(() => {\n    return filteredShifts.reduce((total, shift) => \n      total + calculateDuration(shift.startTime, shift.endTime), 0\n    );\n  }, [filteredShifts]);\n\n  // Prepare chart data for filtered shifts (including all days in range)\n  const chartData = useMemo(() => {\n    // Generate all dates in the selected range\n    const startDateObj = new Date(startDate);\n    const endDateObj = new Date(endDate);\n    const dateRange: Date[] = [];\n    \n    for (let d = new Date(startDateObj); d <= endDateObj; d.setDate(d.getDate() + 1)) {\n      dateRange.push(new Date(d));\n    }\n\n    // Group shifts by date\n    const shiftsByDate = filteredShifts.reduce((acc, shift) => {\n      const date = shift.date;\n      if (!acc[date]) {\n        acc[date] = [];\n      }\n      acc[date].push(shift);\n      return acc;\n    }, {} as Record<string, any[]>);\n\n    // Create chart data for each date in the range (including days with no shifts)\n    return dateRange.map((currentDate) => {\n      const dateString = currentDate.toISOString().split('T')[0];\n      const dayName = currentDate.toLocaleDateString('en-US', { weekday: 'short' });\n      const formattedDate = `${dayName} ${currentDate.getMonth() + 1}/${currentDate.getDate()}`;\n      \n      const shifts = shiftsByDate[dateString] || [];\n      \n      // Calculate total hours and shift type breakdown\n      const totalHours = shifts.reduce((sum, shift) => \n        sum + calculateDuration(shift.startTime, shift.endTime), 0);\n      \n      const shiftTypeHours = {\n        morningHours: 0,\n        eveningHours: 0,\n        nightHours: 0,\n        doubleHours: 0,\n        customHours: 0\n      };\n      \n      shifts.forEach((shift) => {\n        const duration = Number(calculateDuration(shift.startTime, shift.endTime).toFixed(2));\n        switch (shift.shiftType) {\n          case 'morning':\n            shiftTypeHours.morningHours += duration;\n            break;\n          case 'evening':\n            shiftTypeHours.eveningHours += duration;\n            break;\n          case 'night':\n            shiftTypeHours.nightHours += duration;\n            break;\n          case 'double':\n            shiftTypeHours.doubleHours += duration;\n            break;\n          case 'custom':\n            shiftTypeHours.customHours += duration;\n            break;\n        }\n      });\n\n      // Round all shift type hours to 2 decimal places\n      Object.keys(shiftTypeHours).forEach(key => {\n        shiftTypeHours[key as keyof typeof shiftTypeHours] = Number(\n          shiftTypeHours[key as keyof typeof shiftTypeHours].toFixed(2)\n        );\n      });\n\n      return {\n        day: formattedDate,\n        date: dateString,\n        totalHours: Number(totalHours.toFixed(2)),\n        shiftsCount: shifts.length,\n        shifts: shifts,\n        ...shiftTypeHours\n      };\n    });\n  }, [filteredShifts, startDate, endDate]);\n\n  // Handle report generation\n  const handleGenerateReport = (format: 'pdf' | 'csv') => {\n    const options = {\n      format,\n      startDate,\n      endDate,\n      includeDetails: true,\n      includeSummary: true,\n      includeAverages: true,\n      includeMissing: false\n    };\n\n    if (format === 'csv') {\n      exportToCSV(filteredShifts, options);\n    } else {\n      exportToPDF(filteredShifts, options);\n    }\n\n    toast({\n      title: \"Report Generated\",\n      description: `${format.toUpperCase()} report for ${formatDateRange(startDate, endDate)} has been downloaded.`,\n    });\n  };\n\n  // Sort filtered shifts by date (most recent first)\n  const displayShifts = useMemo(() => {\n    return filteredShifts.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\n  }, [filteredShifts]);\n\n  const handleEditShift = (shift: Shift) => {\n    setShiftToEdit(shift);\n    setShowEditDialog(true);\n  };\n\n  const handleUpdateShift = async (shiftData: any) => {\n    if (!shiftToEdit) return;\n\n    try {\n      await updateShiftMutation.mutateAsync({ \n        id: shiftToEdit.id, \n        ...shiftData \n      });\n      \n      toast({\n        title: \"Success\",\n        description: \"Shift updated successfully!\",\n      });\n      \n      setShowEditDialog(false);\n      setShiftToEdit(null);\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update shift. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleDeleteShift = async (shiftId: number) => {\n    try {\n      await deleteShiftMutation.mutateAsync(shiftId);\n      toast({\n        title: \"Success\",\n        description: \"Shift deleted successfully!\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete shift. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const shiftTypeColors = {\n    morning: 'bg-emerald-500',\n    evening: 'bg-amber-500',\n    night: 'bg-indigo-500',\n    double: 'bg-red-500',\n    custom: 'bg-violet-500'\n  };\n\n  const getShiftTypeVariant = (type: string) => {\n    const variants: Record<string, \"default\" | \"secondary\" | \"destructive\" | \"outline\"> = {\n      morning: \"default\",\n      evening: \"secondary\", \n      night: \"outline\",\n      double: \"destructive\",\n      custom: \"secondary\"\n    };\n    return variants[type] || \"outline\";\n  };\n\n  return (\n    <div className=\"p-4 lg:p-8 space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold text-slate-900\">Reports</h1>\n        <p className=\"text-slate-600\">View, edit, and manage your shift history</p>\n      </div>\n\n      {/* Enhanced Search, Filter, and Date Range Controls */}\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"space-y-4\">\n            {/* Date Range Filter */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"start-date\" className=\"text-sm font-medium text-slate-700\">\n                  Start Date\n                </Label>\n                <Input\n                  id=\"start-date\"\n                  type=\"date\"\n                  value={startDate}\n                  onChange={(e) => setStartDate(e.target.value)}\n                  className=\"mt-1\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"end-date\" className=\"text-sm font-medium text-slate-700\">\n                  End Date\n                </Label>\n                <Input\n                  id=\"end-date\"\n                  type=\"date\"\n                  value={endDate}\n                  onChange={(e) => setEndDate(e.target.value)}\n                  className=\"mt-1\"\n                />\n              </div>\n            </div>\n\n            {/* Search and Type Filter */}\n            <div className=\"flex flex-col sm:flex-row gap-4\">\n              <div className=\"flex-1\">\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 h-4 w-4\" />\n                  <Input\n                    placeholder=\"Search shifts by type, date, notes, or time...\"\n                    value={searchTerm}\n                    onChange={(e) => setSearchTerm(e.target.value)}\n                    className=\"pl-10\"\n                  />\n                </div>\n              </div>\n              <div className=\"sm:w-48\">\n                <Select value={filterType} onValueChange={setFilterType}>\n                  <SelectTrigger>\n                    <Filter className=\"h-4 w-4 mr-2\" />\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All Types</SelectItem>\n                    <SelectItem value=\"morning\">Morning</SelectItem>\n                    <SelectItem value=\"evening\">Evening</SelectItem>\n                    <SelectItem value=\"night\">Night</SelectItem>\n                    <SelectItem value=\"double\">Double</SelectItem>\n                    <SelectItem value=\"custom\">Custom</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            {/* Total Hours and Report Generation */}\n            <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 p-4 bg-slate-50 rounded-lg\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"flex items-center gap-2\">\n                  <Clock className=\"h-5 w-5 text-slate-600\" />\n                  <div>\n                    <p className=\"text-sm font-medium text-slate-900\">\n                      Total Hours: {totalFilteredHours.toFixed(2)}\n                    </p>\n                    <p className=\"text-xs text-slate-600\">\n                      {formatDateRange(startDate, endDate)}\n                    </p>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Calendar className=\"h-5 w-5 text-slate-600\" />\n                  <div>\n                    <p className=\"text-sm font-medium text-slate-900\">\n                      {filteredShifts.length} Shifts\n                    </p>\n                    <p className=\"text-xs text-slate-600\">\n                      {chartData.length} Days\n                    </p>\n                  </div>\n                </div>\n              </div>\n              <div className=\"flex gap-2\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => handleGenerateReport('csv')}\n                  disabled={filteredShifts.length === 0}\n                >\n                  <FileText className=\"h-4 w-4 mr-2\" />\n                  CSV Report\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => handleGenerateReport('pdf')}\n                  disabled={filteredShifts.length === 0}\n                >\n                  <FileText className=\"h-4 w-4 mr-2\" />\n                  PDF Report\n                </Button>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Bar Chart for Selected Date Range */}\n      {chartData.length > 0 && (\n        <Card>\n          <CardContent className=\"p-6\">\n            <h3 className=\"text-lg font-semibold text-slate-900 mb-4\">Daily Hours Breakdown</h3>\n            <div className=\"h-64\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <BarChart data={chartData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>\n                  <CartesianGrid strokeDasharray=\"3 3\" />\n                  <XAxis \n                    dataKey=\"day\" \n                    tick={{ fontSize: 12 }}\n                    angle={-45}\n                    textAnchor=\"end\"\n                    height={60}\n                  />\n                  <YAxis \n                    tick={{ fontSize: 12 }}\n                    label={{ value: 'Hours', angle: -90, position: 'insideLeft' }}\n                    domain={[0, 'dataMax + 2']}\n                  />\n                  <Tooltip\n                    content={({ active, payload, label }) => {\n                      if (active && payload && payload.length > 0) {\n                        const data = payload[0].payload;\n                        return (\n                          <div className=\"bg-white p-3 border border-slate-200 rounded-lg shadow-lg\">\n                            <p className=\"font-medium text-slate-900 mb-2\">{label}</p>\n                            {data.shiftsCount > 0 ? (\n                              <div className=\"space-y-1\">\n                                <p className=\"text-sm font-medium text-slate-900\">\n                                  Total: {data.totalHours} hours ({data.shiftsCount} shift{data.shiftsCount > 1 ? 's' : ''})\n                                </p>\n                                <div className=\"space-y-1 mt-2\">\n                                  {data.morningHours > 0 && (\n                                    <div className=\"flex items-center gap-2 text-xs\">\n                                      <div className=\"w-3 h-3 rounded-full bg-emerald-500\"></div>\n                                      <span>Morning: {data.morningHours} hours</span>\n                                    </div>\n                                  )}\n                                  {data.eveningHours > 0 && (\n                                    <div className=\"flex items-center gap-2 text-xs\">\n                                      <div className=\"w-3 h-3 rounded-full bg-amber-500\"></div>\n                                      <span>Evening: {data.eveningHours} hours</span>\n                                    </div>\n                                  )}\n                                  {data.nightHours > 0 && (\n                                    <div className=\"flex items-center gap-2 text-xs\">\n                                      <div className=\"w-3 h-3 rounded-full bg-indigo-500\"></div>\n                                      <span>Night: {data.nightHours} hours</span>\n                                    </div>\n                                  )}\n                                  {data.doubleHours > 0 && (\n                                    <div className=\"flex items-center gap-2 text-xs\">\n                                      <div className=\"w-3 h-3 rounded-full bg-red-500\"></div>\n                                      <span>Double: {data.doubleHours} hours</span>\n                                    </div>\n                                  )}\n                                  {data.customHours > 0 && (\n                                    <div className=\"flex items-center gap-2 text-xs\">\n                                      <div className=\"w-3 h-3 rounded-full bg-violet-500\"></div>\n                                      <span>Custom: {data.customHours} hours</span>\n                                    </div>\n                                  )}\n                                </div>\n                              </div>\n                            ) : (\n                              <p className=\"text-sm text-slate-500\">No shifts on this day</p>\n                            )}\n                          </div>\n                        );\n                      }\n                      return null;\n                    }}\n                  />\n                  <Bar dataKey=\"totalHours\" fill=\"#3b82f6\" radius={[4, 4, 0, 0]} minPointSize={5}>\n                    <LabelList \n                      dataKey=\"totalHours\" \n                      position=\"top\" \n                      formatter={(value: number) => value > 0 ? value.toFixed(1) : ''}\n                      fontSize={10}\n                    />\n                  </Bar>\n                </BarChart>\n              </ResponsiveContainer>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Loading State */}\n      {shiftsLoading && (\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"space-y-4\">\n              {[1, 2, 3].map((i) => (\n                <div key={i} className=\"flex items-center justify-between p-4 border border-slate-200 rounded-lg\">\n                  <div className=\"flex items-center gap-4\">\n                    <Skeleton className=\"h-6 w-6 rounded-full\" />\n                    <div>\n                      <Skeleton className=\"h-4 w-32 mb-2\" />\n                      <Skeleton className=\"h-3 w-48\" />\n                    </div>\n                  </div>\n                  <Skeleton className=\"h-6 w-16\" />\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Shifts List */}\n      {!shiftsLoading && (\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"space-y-4\">\n              {displayShifts.length > 0 ? (\n                displayShifts.map((shift) => (\n                  <div\n                    key={shift.id}\n                    className=\"flex items-center justify-between p-4 border border-slate-200 rounded-lg hover:border-slate-300 transition-colors\"\n                  >\n                    <div className=\"flex items-center gap-4\">\n                      <div className=\"flex items-center justify-center w-10 h-10 rounded-full bg-slate-100\">\n                        <Clock className=\"h-5 w-5 text-slate-600\" />\n                      </div>\n                      <div>\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <h3 className=\"font-semibold text-slate-900\">\n                            {new Date(shift.date).toLocaleDateString('en-US', {\n                              weekday: 'short',\n                              month: 'short',\n                              day: 'numeric'\n                            })}\n                          </h3>\n                          <Badge variant={getShiftTypeVariant(shift.shiftType)}>\n                            {shift.shiftType.charAt(0).toUpperCase() + shift.shiftType.slice(1)}\n                          </Badge>\n                        </div>\n                        <p className=\"text-sm text-slate-600\">\n                          {formatTime(shift.startTime)} - {formatTime(shift.endTime)} \n                          <span className=\"font-medium ml-2\">\n                            ({calculateDuration(shift.startTime, shift.endTime).toFixed(1)} hours)\n                          </span>\n                        </p>\n                        {shift.notes && (\n                          <p className=\"text-xs text-slate-500 mt-1 max-w-md truncate\">\n                            {shift.notes}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleEditShift(shift)}\n                      >\n                        <Edit className=\"h-4 w-4\" />\n                      </Button>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleDeleteShift(shift.id)}\n                      >\n                        <Trash2 className=\"h-4 w-4 text-red-500\" />\n                      </Button>\n                    </div>\n                  </div>\n                ))\n              ) : (\n                <div className=\"text-center py-8\">\n                  <BarChart3 className=\"h-12 w-12 text-slate-400 mx-auto mb-4\" />\n                  <p className=\"text-slate-500\">No shifts found for the selected criteria</p>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Edit Shift Dialog */}\n      <Dialog open={showEditDialog} onOpenChange={setShowEditDialog}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle>Edit Shift</DialogTitle>\n          </DialogHeader>\n          <EditShiftForm \n            shift={shiftToEdit} \n            timeOptions={timeOptions}\n            onSubmit={handleUpdateShift}\n          />\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\n// Edit Shift Form Component\nfunction EditShiftForm({ \n  shift, \n  timeOptions, \n  onSubmit \n}: { \n  shift: Shift | null; \n  timeOptions: { value: string; label: string }[];\n  onSubmit: (data: any) => void;\n}) {\n  const [formData, setFormData] = useState({\n    date: shift?.date || '',\n    shiftType: shift?.shiftType || 'morning',\n    startTime: shift?.startTime || '',\n    endTime: shift?.endTime || '',\n    notes: shift?.notes || ''\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onSubmit(formData);\n  };\n\n  if (!shift) return null;\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\n      <div>\n        <Label htmlFor=\"date\">Date</Label>\n        <Input\n          id=\"date\"\n          type=\"date\"\n          value={formData.date}\n          onChange={(e) => setFormData({ ...formData, date: e.target.value })}\n          required\n        />\n      </div>\n\n      <div>\n        <Label htmlFor=\"shiftType\">Shift Type</Label>\n        <Select value={formData.shiftType} onValueChange={(value) => setFormData({ ...formData, shiftType: value })}>\n          <SelectTrigger>\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"morning\">Morning</SelectItem>\n            <SelectItem value=\"evening\">Evening</SelectItem>\n            <SelectItem value=\"night\">Night</SelectItem>\n            <SelectItem value=\"double\">Double</SelectItem>\n            <SelectItem value=\"custom\">Custom</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div>\n          <Label htmlFor=\"startTime\">Start Time</Label>\n          <Select value={formData.startTime} onValueChange={(value) => setFormData({ ...formData, startTime: value })}>\n            <SelectTrigger>\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              {timeOptions.map((option) => (\n                <SelectItem key={option.value} value={option.value}>\n                  {option.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        <div>\n          <Label htmlFor=\"endTime\">End Time</Label>\n          <Select value={formData.endTime} onValueChange={(value) => setFormData({ ...formData, endTime: value })}>\n            <SelectTrigger>\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              {timeOptions.map((option) => (\n                <SelectItem key={option.value} value={option.value}>\n                  {option.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <div>\n        <Label htmlFor=\"notes\">Notes (optional)</Label>\n        <Textarea\n          id=\"notes\"\n          value={formData.notes}\n          onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n          placeholder=\"Add any notes about this shift...\"\n        />\n      </div>\n\n      <DialogFooter>\n        <Button type=\"submit\">\n          <Check className=\"h-4 w-4 mr-2\" />\n          Save Changes\n        </Button>\n      </DialogFooter>\n    </form>\n  );\n}\n","size_bytes":25237},"server/auth-utils.ts":{"content":"import jwt from 'jsonwebtoken';\nimport crypto from 'crypto';\nimport { storage } from './storage';\n\n// Enforce JWT_SECRET is set - no fallback allowed for security\nif (!process.env.JWT_SECRET) {\n  throw new Error(\n    'CRITICAL SECURITY ERROR: JWT_SECRET environment variable is not set. ' +\n    'JWT authentication cannot function securely without a secret key. ' +\n    'Please set JWT_SECRET in your environment variables before starting the application.'\n  );\n}\n\nconst JWT_SECRET = process.env.JWT_SECRET;\nconst JWT_ISSUER = 'shiftmate-app';\n\nexport interface JWTPayload {\n  userId: number;\n  email: string;\n  userType?: string;\n  role?: string;\n  iat: number;\n  exp: number;\n  iss: string;\n}\n\nexport interface RefreshTokenData {\n  userId: number;\n  rememberMe: boolean;\n}\n\nexport class AuthUtils {\n  // Generate access token (short-lived: 15 minutes)\n  static async generateAccessToken(userId: number, email: string): Promise<string> {\n    // Fetch user details to include userType and role in token\n    const user = await storage.getUser(userId);\n    \n    return jwt.sign(\n      {\n        userId,\n        email,\n        userType: user?.userType,\n        role: user?.role,\n        iss: JWT_ISSUER\n      },\n      JWT_SECRET,\n      {\n        expiresIn: '15m'\n      }\n    );\n  }\n\n  // Generate refresh token (cryptographically secure)\n  static generateRefreshToken(): string {\n    return crypto.randomBytes(64).toString('hex');\n  }\n\n  // Verify access token\n  static verifyAccessToken(token: string): JWTPayload | null {\n    try {\n      const decoded = jwt.verify(token, JWT_SECRET) as JWTPayload;\n      return decoded;\n    } catch (error) {\n      return null;\n    }\n  }\n\n  // Hash a token using SHA-256\n  static hashToken(token: string): string {\n    return crypto.createHash('sha256').update(token).digest('hex');\n  }\n\n  // Store refresh token in database\n  static async storeRefreshToken(\n    token: string, \n    userId: number, \n    rememberMe: boolean\n  ): Promise<void> {\n    const expiresAt = new Date();\n    \n    if (rememberMe) {\n      // 30 days for \"Remember me\"\n      expiresAt.setDate(expiresAt.getDate() + 30);\n    } else {\n      // 24 hours for regular sessions\n      expiresAt.setDate(expiresAt.getDate() + 1);\n    }\n\n    // Hash the token before storing\n    const tokenHash = this.hashToken(token);\n\n    await storage.createRefreshToken({\n      userId,\n      tokenHash,\n      expiresAt\n    });\n  }\n\n  // Validate and rotate refresh token\n  static async refreshTokens(\n    refreshToken: string\n  ): Promise<{ accessToken: string; newRefreshToken: string } | null> {\n    try {\n      // Hash the refresh token to find it in database\n      const tokenHash = this.hashToken(refreshToken);\n      \n      // Get refresh token from database\n      const tokenRecord = await storage.getRefreshTokenByHash(tokenHash);\n      \n      if (!tokenRecord || tokenRecord.revokedAt || new Date() > tokenRecord.expiresAt) {\n        return null;\n      }\n\n      // Get user data\n      const user = await storage.getUser(tokenRecord.userId);\n      if (!user) {\n        return null;\n      }\n\n      // Revoke old refresh token\n      await storage.revokeRefreshToken(tokenHash);\n\n      // Generate new tokens\n      const newAccessToken = await this.generateAccessToken(user.id, user.email);\n      const newRefreshToken = this.generateRefreshToken();\n\n      // Determine if it was a \"remember me\" session (based on original expiry)\n      const originalExpiryDays = Math.ceil(\n        (tokenRecord.expiresAt.getTime() - tokenRecord.createdAt.getTime()) / (1000 * 60 * 60 * 24)\n      );\n      const wasRememberMe = originalExpiryDays > 7; // If original expiry was more than 7 days\n\n      // Store new refresh token with same expiry pattern\n      await this.storeRefreshToken(newRefreshToken, user.id, wasRememberMe);\n\n      return {\n        accessToken: newAccessToken,\n        newRefreshToken\n      };\n    } catch (error) {\n      console.error('Error refreshing tokens:', error);\n      return null;\n    }\n  }\n\n  // Revoke refresh token (for logout)\n  static async revokeRefreshToken(token: string): Promise<void> {\n    const tokenHash = this.hashToken(token);\n    await storage.revokeRefreshToken(tokenHash);\n  }\n\n  // Clean up expired tokens (should be run periodically)\n  static async cleanupExpiredTokens(): Promise<void> {\n    await storage.cleanupExpiredTokens();\n  }\n}","size_bytes":4362},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"server/jwt-middleware.ts":{"content":"import { Request, Response, NextFunction } from 'express';\nimport { AuthUtils } from './auth-utils';\nimport { storage } from './storage';\n\n// Extend Express Request interface\ndeclare global {\n  namespace Express {\n    interface User {\n      id: number;\n      email: string;\n    }\n    interface Request {\n      user?: User;\n    }\n  }\n}\n\nexport const jwtAuth = async (req: Request, res: Response, next: NextFunction) => {\n  try {\n    const authHeader = req.headers.authorization;\n    const token = authHeader && authHeader.split(' ')[1]; // Bearer TOKEN\n\n    if (!token) {\n      return res.status(401).json({ message: 'Access token required' });\n    }\n\n    const decoded = AuthUtils.verifyAccessToken(token);\n    if (!decoded) {\n      return res.status(401).json({ message: 'Invalid or expired access token' });\n    }\n\n    // Verify user still exists\n    const user = await storage.getUser(decoded.userId);\n    if (!user) {\n      return res.status(401).json({ message: 'User not found' });\n    }\n\n    req.user = {\n      id: user.id,\n      email: user.email\n    };\n\n    next();\n  } catch (error) {\n    console.error('JWT Auth error:', error);\n    return res.status(401).json({ message: 'Authentication failed' });\n  }\n};\n\n// Optional auth middleware - doesn't fail if no token provided\nexport const optionalJwtAuth = async (req: Request, res: Response, next: NextFunction) => {\n  try {\n    const authHeader = req.headers.authorization;\n    const token = authHeader && authHeader.split(' ')[1];\n\n    console.log('OptionalJwtAuth - Authorization header:', authHeader ? 'present' : 'none');\n    console.log('OptionalJwtAuth - Token extracted:', token ? 'present' : 'none');\n\n    if (token) {\n      const decoded = AuthUtils.verifyAccessToken(token);\n      console.log('OptionalJwtAuth - Token decoded:', decoded ? 'success' : 'failed');\n      \n      if (decoded) {\n        const user = await storage.getUser(decoded.userId);\n        console.log('OptionalJwtAuth - User found:', user ? `user ${user.id}` : 'not found');\n        \n        if (user) {\n          req.user = {\n            id: user.id,\n            email: user.email\n          };\n          console.log('OptionalJwtAuth - User set in request:', req.user.id);\n        }\n      }\n    }\n\n    next();\n  } catch (error) {\n    console.error('OptionalJwtAuth error:', error);\n    // Don't fail, just continue without user\n    next();\n  }\n};","size_bytes":2384},"client/src/components/shift-form.tsx":{"content":"import { useMemo, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useCreateShift, useUpdateShift, useDeleteShift } from \"@/hooks/use-shifts\";\nimport type { Shift } from \"@shared/schema\";\nimport { generateTimeOptions } from \"@/lib/time-utils\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nconst shiftFormSchema = z.object({\n  date: z.string().min(1, \"Date is required\"),\n  shiftType: z.string().min(1, \"Shift type is required\"),\n  startTime: z.string().min(1, \"Start time is required\"),\n  endTime: z.string().min(1, \"End time is required\"),\n  notes: z.string().optional(),\n});\n\ntype ShiftFormData = z.infer<typeof shiftFormSchema>;\n\nconst shiftTypes = [\n  { value: \"morning\", label: \"Morning\" },\n  { value: \"afternoon\", label: \"Afternoon\" },\n  { value: \"night\", label: \"Night\" },\n];\n\ninterface ShiftFormProps {\n  onSuccess?: () => void;\n  editingShift?: Shift;\n  isEditing?: boolean;\n}\n\nexport function ShiftForm({ onSuccess, editingShift, isEditing }: ShiftFormProps) {\n  const { toast } = useToast();\n  const createShiftMutation = useCreateShift();\n  const updateShiftMutation = useUpdateShift();\n  const deleteShiftMutation = useDeleteShift();\n\n  const timeOptions = generateTimeOptions();\n  \n  const form = useForm<ShiftFormData>({\n    resolver: zodResolver(shiftFormSchema),\n    defaultValues: {\n      date: editingShift?.date || new Date().toISOString().split('T')[0],\n      shiftType: editingShift?.shiftType || \"\",\n      startTime: editingShift?.startTime || \"\",\n      endTime: editingShift?.endTime || \"\",\n      notes: editingShift?.notes || \"\",\n    },\n  });\n\n  // Reset form when editing shift changes\n  useEffect(() => {\n    if (editingShift && isEditing) {\n      form.reset({\n        date: editingShift.date,\n        shiftType: editingShift.shiftType,\n        startTime: editingShift.startTime,\n        endTime: editingShift.endTime,\n        notes: editingShift.notes || \"\",\n      });\n    }\n  }, [editingShift, isEditing, form]);\n  \n  // Watch shift type to automatically set times\n  const shiftType = form.watch(\"shiftType\");\n  \n  // Automatically set start and end times based on shift type\n  useEffect(() => {\n    if (shiftType && !isEditing) {\n      switch (shiftType) {\n        case \"morning\":\n          form.setValue(\"startTime\", \"08:00\");\n          form.setValue(\"endTime\", \"11:00\");\n          break;\n        case \"afternoon\":\n          form.setValue(\"startTime\", \"12:30\");\n          form.setValue(\"endTime\", \"17:00\");\n          break;\n        case \"night\":\n          form.setValue(\"startTime\", \"17:30\");\n          form.setValue(\"endTime\", \"23:00\");\n          break;\n      }\n    }\n  }, [shiftType, isEditing, form]);\n  \n  // Watch start time to filter end time options\n  const startTime = form.watch(\"startTime\");\n  \n  // Generate filtered end time options based on start time\n  const endTimeOptions = useMemo(() => {\n    if (!startTime) {\n      return timeOptions;\n    }\n    \n    // Find the index of the selected start time\n    const startIndex = timeOptions.findIndex(option => option.value === startTime);\n    \n    if (startIndex === -1) {\n      return timeOptions;\n    }\n    \n    // Return all times after the start time, plus times from the next day for overnight shifts\n    const afterStartTime = timeOptions.slice(startIndex + 1);\n    const nextDayTimes = timeOptions.slice(0, startIndex + 1).map(option => ({\n      ...option,\n      label: `${option.label} (+1 day)`\n    }));\n    \n    return [...afterStartTime, ...nextDayTimes];\n  }, [startTime, timeOptions]);\n\n  const onSubmit = async (data: ShiftFormData) => {\n    try {\n      if (isEditing && editingShift) {\n        // Update existing shift\n        await updateShiftMutation.mutateAsync({ \n          id: editingShift.id, \n          ...data \n        });\n        toast({\n          title: \"Shift updated\",\n          description: \"Your shift has been updated successfully.\",\n        });\n      } else {\n        // Create new shift\n        await createShiftMutation.mutateAsync(data);\n        toast({\n          title: \"Shift created\",\n          description: \"Your shift has been created successfully.\",\n        });\n      }\n      \n      onSuccess?.();\n      form.reset();\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: isEditing ? \"Failed to update shift.\" : \"Failed to create shift.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!editingShift) return;\n    \n    try {\n      await deleteShiftMutation.mutateAsync(editingShift.id);\n      toast({\n        title: \"Shift deleted\",\n        description: \"Your shift has been deleted successfully.\",\n      });\n      onSuccess?.();\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete shift.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n        <FormField\n          control={form.control}\n          name=\"date\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Date</FormLabel>\n              <FormControl>\n                <Input type=\"date\" {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"shiftType\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Shift Type</FormLabel>\n              <Select onValueChange={field.onChange} value={field.value}>\n                <FormControl>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select shift type\" />\n                  </SelectTrigger>\n                </FormControl>\n                <SelectContent>\n                  {shiftTypes.map((type) => (\n                    <SelectItem key={type.value} value={type.value}>\n                      {type.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"startTime\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Start Time</FormLabel>\n              <Select onValueChange={field.onChange} value={field.value}>\n                <FormControl>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select start time\" />\n                  </SelectTrigger>\n                </FormControl>\n                <SelectContent>\n                  {timeOptions.map((option) => (\n                    <SelectItem key={option.value} value={option.value}>\n                      {option.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"endTime\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>End Time</FormLabel>\n              <Select onValueChange={field.onChange} value={field.value}>\n                <FormControl>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select end time\" />\n                  </SelectTrigger>\n                </FormControl>\n                <SelectContent>\n                  {endTimeOptions.map((option) => (\n                    <SelectItem key={option.value} value={option.value}>\n                      {option.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"notes\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Notes (Optional)</FormLabel>\n              <FormControl>\n                <Textarea \n                  placeholder=\"Add any notes about this shift...\"\n                  {...field}\n                />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <div className=\"flex gap-2 pt-4\">\n          <Button \n            type=\"submit\" \n            disabled={createShiftMutation.isPending || updateShiftMutation.isPending}\n            className=\"flex-1\"\n          >\n            {createShiftMutation.isPending || updateShiftMutation.isPending \n              ? \"Saving...\" \n              : isEditing ? \"Update Shift\" : \"Add Shift\"\n            }\n          </Button>\n          \n          {isEditing && editingShift && (\n            <Button \n              type=\"button\" \n              variant=\"destructive\" \n              onClick={handleDelete}\n              disabled={deleteShiftMutation.isPending}\n            >\n              {deleteShiftMutation.isPending ? \"Deleting...\" : \"Delete\"}\n            </Button>\n          )}\n        </div>\n      </form>\n    </Form>\n  );\n}","size_bytes":9566},"server/services/sendgrid.ts":{"content":"import { MailService } from '@sendgrid/mail';\n\nconst mailService = new MailService();\n\n// Guard SendGrid initialization - only set API key if it exists and is valid\nif (process.env.SENDGRID_API_KEY && process.env.SENDGRID_API_KEY.startsWith('SG.')) {\n  mailService.setApiKey(process.env.SENDGRID_API_KEY);\n} else if (process.env.NODE_ENV === 'development') {\n  console.warn('SendGrid API key not configured or invalid. Email functionality will be disabled in development.');\n}\n\ninterface EmailParams {\n  to: string;\n  from: string;\n  subject: string;\n  text?: string;\n  html?: string;\n}\n\nexport async function sendEmail(params: EmailParams): Promise<boolean> {\n  try {\n    await mailService.send({\n      to: params.to,\n      from: params.from,\n      subject: params.subject,\n      text: params.text || \"\",\n      html: params.html || \"\",\n    });\n    return true;\n  } catch (error) {\n    console.error('SendGrid email error:', error);\n    return false;\n  }\n}\n\ninterface RosterShift {\n  id: number;\n  employeeId: number;\n  date: string;\n  startTime: string;\n  endTime: string;\n  type: string;\n  location?: string;\n  employeeName: string;\n  employeeEmail: string;\n}\n\nexport async function sendRosterEmail(\n  employeeEmail: string,\n  employeeName: string,\n  shifts: RosterShift[],\n  weekStart: string,\n  weekEnd: string,\n  companyName: string = \"ShiftMate\"\n): Promise<boolean> {\n  const subject = `Your Roster Schedule - Week of ${new Date(weekStart).toLocaleDateString()}`;\n  \n  // Generate HTML email content\n  const html = generateRosterEmailHTML(employeeName, shifts, weekStart, weekEnd, companyName);\n  const text = generateRosterEmailText(employeeName, shifts, weekStart, weekEnd, companyName);\n\n  return await sendEmail({\n    to: employeeEmail,\n    from: 'noreply@shiftmate.app', // You should use a verified domain\n    subject,\n    text,\n    html\n  });\n}\n\nfunction generateRosterEmailHTML(\n  employeeName: string,\n  shifts: RosterShift[],\n  weekStart: string,\n  weekEnd: string,\n  companyName: string\n): string {\n  const startDate = new Date(weekStart);\n  const endDate = new Date(weekEnd);\n  \n  return `\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <style>\n        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n        .header { background-color: #3b82f6; color: white; padding: 20px; text-align: center; }\n        .content { padding: 20px; }\n        .shifts-table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n        .shifts-table th, .shifts-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }\n        .shifts-table th { background-color: #f8f9fa; font-weight: bold; }\n        .shift-type { padding: 4px 8px; border-radius: 4px; font-size: 0.875rem; font-weight: 500; }\n        .morning { background-color: #fef3c7; color: #92400e; }\n        .afternoon { background-color: #dbeafe; color: #1e40af; }\n        .evening { background-color: #fde68a; color: #92400e; }\n        .night { background-color: #e0e7ff; color: #3730a3; }\n        .double { background-color: #f3e8ff; color: #6b21a8; }\n        .footer { margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; font-size: 0.875rem; color: #666; }\n      </style>\n    </head>\n    <body>\n      <div class=\"header\">\n        <h1> Your Weekly Roster</h1>\n        <p>${companyName}</p>\n      </div>\n      \n      <div class=\"content\">\n        <h2>Hello ${employeeName}!</h2>\n        <p>Here's your roster schedule for the week of <strong>${startDate.toLocaleDateString()}</strong> to <strong>${endDate.toLocaleDateString()}</strong>.</p>\n        \n        ${shifts.length > 0 ? `\n          <table class=\"shifts-table\">\n            <thead>\n              <tr>\n                <th>Date</th>\n                <th>Start Time</th>\n                <th>End Time</th>\n                <th>Type</th>\n                <th>Location</th>\n                <th>Duration</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${shifts.map(shift => `\n                <tr>\n                  <td>${new Date(shift.date).toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' })}</td>\n                  <td>${formatTime(shift.startTime)}</td>\n                  <td>${formatTime(shift.endTime)}</td>\n                  <td><span class=\"shift-type ${shift.type.toLowerCase()}\">${shift.type}</span></td>\n                  <td>${shift.location || '-'}</td>\n                  <td>${calculateDuration(shift.startTime, shift.endTime)}</td>\n                </tr>\n              `).join('')}\n            </tbody>\n          </table>\n          \n          <p><strong>Total Hours:</strong> ${calculateTotalHours(shifts)} hours</p>\n        ` : `\n          <p>You have no shifts scheduled for this week.</p>\n        `}\n        \n        <div class=\"footer\">\n          <p>If you have any questions about your roster, please contact your manager.</p>\n          <p><em>This is an automated message from ${companyName} roster management system.</em></p>\n        </div>\n      </div>\n    </body>\n    </html>\n  `;\n}\n\nfunction generateRosterEmailText(\n  employeeName: string,\n  shifts: RosterShift[],\n  weekStart: string,\n  weekEnd: string,\n  companyName: string\n): string {\n  const startDate = new Date(weekStart);\n  const endDate = new Date(weekEnd);\n  \n  let text = `Your Weekly Roster - ${companyName}\\n\\n`;\n  text += `Hello ${employeeName}!\\n\\n`;\n  text += `Here's your roster schedule for the week of ${startDate.toLocaleDateString()} to ${endDate.toLocaleDateString()}.\\n\\n`;\n  \n  if (shifts.length > 0) {\n    text += `SCHEDULED SHIFTS:\\n`;\n    text += `${'='.repeat(60)}\\n`;\n    \n    shifts.forEach(shift => {\n      const date = new Date(shift.date).toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });\n      const duration = calculateDuration(shift.startTime, shift.endTime);\n      text += `${date}\\n`;\n      text += `  Time: ${formatTime(shift.startTime)} - ${formatTime(shift.endTime)} (${duration})\\n`;\n      text += `  Type: ${shift.type}\\n`;\n      if (shift.location) text += `  Location: ${shift.location}\\n`;\n      text += `\\n`;\n    });\n    \n    text += `Total Hours: ${calculateTotalHours(shifts)} hours\\n\\n`;\n  } else {\n    text += `You have no shifts scheduled for this week.\\n\\n`;\n  }\n  \n  text += `If you have any questions about your roster, please contact your manager.\\n\\n`;\n  text += `This is an automated message from ${companyName} roster management system.`;\n  \n  return text;\n}\n\nfunction formatTime(time: string): string {\n  // Convert 24-hour format to 12-hour format\n  const [hours, minutes] = time.split(':');\n  const hour24 = parseInt(hours);\n  const hour12 = hour24 === 0 ? 12 : hour24 > 12 ? hour24 - 12 : hour24;\n  const ampm = hour24 >= 12 ? 'PM' : 'AM';\n  return `${hour12}:${minutes} ${ampm}`;\n}\n\nfunction calculateDuration(startTime: string, endTime: string): string {\n  const start = new Date(`2000-01-01T${startTime}:00`);\n  const end = new Date(`2000-01-01T${endTime}:00`);\n  let diffMs = end.getTime() - start.getTime();\n  \n  // Handle overnight shifts\n  if (diffMs < 0) {\n    diffMs += 24 * 60 * 60 * 1000;\n  }\n  \n  const hours = Math.floor(diffMs / (1000 * 60 * 60));\n  const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\n  \n  if (minutes === 0) {\n    return `${hours}h`;\n  } else {\n    return `${hours}h ${minutes}m`;\n  }\n}\n\nfunction calculateTotalHours(shifts: RosterShift[]): string {\n  let totalMinutes = 0;\n  \n  shifts.forEach(shift => {\n    const start = new Date(`2000-01-01T${shift.startTime}:00`);\n    const end = new Date(`2000-01-01T${shift.endTime}:00`);\n    let diffMs = end.getTime() - start.getTime();\n    \n    // Handle overnight shifts\n    if (diffMs < 0) {\n      diffMs += 24 * 60 * 60 * 1000;\n    }\n    \n    totalMinutes += diffMs / (1000 * 60);\n  });\n  \n  const hours = Math.floor(totalMinutes / 60);\n  const minutes = Math.floor(totalMinutes % 60);\n  \n  if (minutes === 0) {\n    return `${hours}`;\n  } else {\n    return `${hours}.${Math.round((minutes / 60) * 10)}`;\n  }\n}","size_bytes":8011},"server/routes.ts":{"content":"import type { Express, Request, Response } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport passport from \"passport\";\nimport { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\nimport cookieParser from \"cookie-parser\";\nimport { storage } from \"./storage\";\nimport { insertUserSchema, insertShiftSchema, insertNotificationSchema } from \"@shared/schema\";\nimport { AuthUtils } from \"./auth-utils\";\nimport { jwtAuth, optionalJwtAuth } from \"./jwt-middleware\";\nimport { sendRosterEmail } from \"./services/sendgrid\";\nimport { z } from \"zod\";\nimport session from \"express-session\";\nimport connectPg from \"connect-pg-simple\";\nimport { \n  calculateShiftBilling, \n  calculateMultipleShiftsBilling,\n  formatCurrency \n} from \"./billing-engine\";\nimport { rateTiers, publicHolidays, insertRateTierSchema, insertPublicHolidaySchema, insertEmployeeRateSchema } from \"@shared/schema\";\n\n// Extend the Request interface to include session\ninterface AuthenticatedRequest extends Request {\n  session: any;\n  userId?: number;\n}\n\n// Configure Google OAuth Strategy\nfunction setupGoogleAuth() {\n  if (process.env.GOOGLE_CLIENT_ID && process.env.GOOGLE_CLIENT_SECRET) {\n    passport.use(new GoogleStrategy({\n      clientID: process.env.GOOGLE_CLIENT_ID,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET,\n      callbackURL: \"/api/auth/google/callback\"\n    }, async (accessToken, refreshToken, profile, done) => {\n      try {\n        const email = profile.emails?.[0]?.value;\n        const name = profile.displayName;\n        \n        if (!email || !name) {\n          return done(new Error('Email or name not provided by Google'));\n        }\n\n        // Check if user exists\n        let user = await storage.getUserByEmail(email);\n        \n        if (!user) {\n          // Create new user\n          user = await storage.createUser({ email, name });\n        }\n        \n        return done(null, user);\n      } catch (error) {\n        return done(error);\n      }\n    }));\n\n    passport.serializeUser((user: any, done) => {\n      done(null, user.id);\n    });\n\n    passport.deserializeUser(async (id: number, done) => {\n      try {\n        const user = await storage.getUser(id);\n        done(null, user);\n      } catch (error) {\n        done(error);\n      }\n    });\n  }\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Add cookie parser for refresh tokens\n  app.use(cookieParser());\n\n  // Configure session middleware (keeping for Google OAuth compatibility)\n  const sessionTtl = 365 * 24 * 60 * 60 * 1000; // 1 year for mobile app\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n\n  app.use(session({\n    secret: process.env.SESSION_SECRET || 'your-secret-key',\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    rolling: true, // Reset expiration on each request\n    cookie: {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === 'production',\n      maxAge: sessionTtl, // 1 year for mobile persistence\n      sameSite: process.env.NODE_ENV === 'production' ? 'none' : 'lax' // Allow cross-origin for mobile apps\n    }\n  }));\n\n  // Initialize passport\n  app.use(passport.initialize());\n  app.use(passport.session());\n  \n  // Setup Google OAuth\n  setupGoogleAuth();\n\n  // Google OAuth routes\n  app.get(\"/api/auth/google\", (req, res, next) => {\n    // Store the intent (login or signup) in session\n    (req.session as any).authIntent = req.query.intent || 'login';\n    passport.authenticate('google', { scope: ['profile', 'email'] })(req, res, next);\n  });\n\n  app.get(\"/api/auth/google/callback\", \n    passport.authenticate('google', { failureRedirect: '/login?error=auth_failed', session: false }),\n    async (req, res) => {\n      try {\n        const user = req.user as any;\n        \n        if (!user) {\n          return res.redirect('/login?error=no_user');\n        }\n\n        // Generate JWT tokens\n        const accessToken = await AuthUtils.generateAccessToken(user.id, user.email);\n        const refreshToken = AuthUtils.generateRefreshToken();\n\n        // Store refresh token (30 days expiry)\n        await AuthUtils.storeRefreshToken(refreshToken, user.id, true);\n\n        // Set refresh token as httpOnly cookie (30 days)\n        res.cookie('refreshToken', refreshToken, {\n          httpOnly: true,\n          secure: process.env.NODE_ENV === 'production',\n          sameSite: 'lax',\n          maxAge: 30 * 24 * 60 * 60 * 1000, // 30 days\n        });\n\n        // Redirect to frontend with access token in URL fragment\n        // The frontend will extract and store the token\n        res.redirect(`/?token=${accessToken}`);\n      } catch (error) {\n        console.error('Error in Google OAuth callback:', error);\n        res.redirect('/login?error=token_generation_failed');\n      }\n    }\n  );\n\n  // JWT-based auth routes with persistent login\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      const { email, name, rememberMe = false } = req.body;\n      \n      console.log('Login attempt:', { email, name, rememberMe });\n      \n      // Check if user exists\n      let user = await storage.getUserByEmail(email);\n      \n      if (!user) {\n        // User doesn't exist, create them automatically\n        console.log('Creating new user during login:', { email, name });\n        user = await storage.createUser({ email, name });\n        console.log('Auto-signup successful for new user:', user.id);\n      }\n\n      // Generate tokens\n      const accessToken = await AuthUtils.generateAccessToken(user.id, user.email);\n      const refreshToken = AuthUtils.generateRefreshToken();\n\n      // Store refresh token\n      await AuthUtils.storeRefreshToken(refreshToken, user.id, rememberMe);\n\n      // Set refresh token as httpOnly cookie\n      const cookieExpiry = rememberMe \n        ? 30 * 24 * 60 * 60 * 1000  // 30 days\n        : 24 * 60 * 60 * 1000;      // 24 hours\n\n      res.cookie('refreshToken', refreshToken, {\n        httpOnly: true,\n        secure: process.env.NODE_ENV === 'production',\n        sameSite: 'strict',\n        maxAge: cookieExpiry\n      });\n\n      console.log('Login successful for user:', user.id, 'RememberMe:', rememberMe);\n      console.log('Sending access token in response:', accessToken ? 'YES' : 'NO');\n      res.json({ \n        user, \n        accessToken,\n        expiresIn: '15m' // Access token expiry\n      });\n    } catch (error) {\n      console.error('Login error:', error);\n      res.status(500).json({ message: \"Login failed\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  app.post(\"/api/auth/signup\", async (req, res) => {\n    try {\n      const { email, name } = req.body;\n      \n      console.log('Signup attempt:', { email, name });\n      \n      // Check if user already exists\n      const existingUser = await storage.getUserByEmail(email);\n      \n      if (existingUser) {\n        res.status(409).json({ message: \"User already exists. Please log in instead.\" });\n      } else {\n        // Create new user\n        console.log('Creating new user:', { email, name });\n        const newUser = await storage.createUser({ email, name });\n        (req.session as any).userId = newUser.id;\n        console.log('Signup successful for user:', newUser.id);\n        res.json({ user: newUser });\n      }\n    } catch (error) {\n      console.error('Signup error:', error);\n      res.status(500).json({ message: \"Signup failed\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Refresh token endpoint\n  app.post(\"/api/auth/refresh\", async (req, res) => {\n    try {\n      const { refreshToken } = req.cookies;\n      \n      if (!refreshToken) {\n        return res.status(401).json({ message: \"Refresh token not provided\" });\n      }\n\n      const result = await AuthUtils.refreshTokens(refreshToken);\n      \n      if (!result) {\n        // Clear invalid cookie\n        res.clearCookie('refreshToken');\n        return res.status(401).json({ message: \"Invalid or expired refresh token\" });\n      }\n\n      // Update refresh token cookie\n      res.cookie('refreshToken', result.newRefreshToken, {\n        httpOnly: true,\n        secure: process.env.NODE_ENV === 'production',\n        sameSite: 'strict',\n        maxAge: 30 * 24 * 60 * 60 * 1000 // 30 days\n      });\n\n      res.json({\n        accessToken: result.accessToken,\n        expiresIn: '15m'\n      });\n    } catch (error) {\n      console.error('Refresh token error:', error);\n      res.status(401).json({ message: \"Token refresh failed\" });\n    }\n  });\n\n  app.post(\"/api/auth/logout\", async (req, res) => {\n    try {\n      const { refreshToken } = req.cookies;\n      \n      if (refreshToken) {\n        // Revoke the refresh token\n        await AuthUtils.revokeRefreshToken(refreshToken);\n      }\n\n      // Clear cookies\n      res.clearCookie('refreshToken');\n      res.clearCookie('connect.sid');\n      \n      // Destroy session\n      req.session.destroy((err) => {\n        if (err) {\n          console.error('Session destroy error:', err);\n        }\n      });\n\n      res.json({ message: \"Logged out successfully\" });\n    } catch (error) {\n      console.error('Logout error:', error);\n      res.status(500).json({ message: \"Failed to logout\" });\n    }\n  });\n\n  // New JWT-based auth check endpoint\n  app.get(\"/api/auth/me\", optionalJwtAuth, async (req, res) => {\n    // First try JWT auth\n    if (req.user) {\n      try {\n        const user = await storage.getUser(req.user.id);\n        if (user) {\n          return res.json({ user });\n        }\n      } catch (error) {\n        console.error('JWT auth me error:', error);\n      }\n    }\n\n    // Fall back to session-based auth for backward compatibility\n    const userId = (req.session as any)?.userId;\n    if (!userId) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const user = await storage.getUser(userId);\n      if (!user) {\n        req.session.destroy(() => {});\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      \n      (req.session as any).touch();\n      res.json({ user });\n    } catch (error) {\n      console.error('Session auth me error:', error);\n      res.status(500).json({ message: \"Failed to get user\" });\n    }\n  });\n\n  // Enhanced middleware to check both JWT and session authentication\n  const requireAuth = (req: any, res: any, next: any) => {\n    console.log('RequireAuth - Checking authentication for:', req.url);\n    console.log('RequireAuth - JWT user:', req.user?.id || 'none');\n    console.log('RequireAuth - Session user:', req.session?.userId || 'none');\n    \n    // First check JWT auth (from middleware)\n    if (req.user?.id) {\n      req.userId = req.user.id;\n      console.log('RequireAuth - Using JWT auth for user:', req.userId);\n      return next();\n    }\n    \n    // Fall back to session-based auth for backward compatibility\n    const userId = req.session?.userId;\n    if (!userId) {\n      console.log('RequireAuth - No authentication found, returning 401');\n      return res.status(401).json({ message: \"Authentication required\" });\n    }\n    req.userId = userId;\n    console.log('RequireAuth - Using session auth for user:', req.userId);\n    next();\n  };\n\n  // Shift routes - support both JWT and session auth\n  app.get(\"/api/shifts\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    console.log('GET /api/shifts - Starting request for user:', req.userId);\n    try {\n      const { startDate, endDate } = req.query;\n      \n      let shifts;\n      if (startDate && endDate) {\n        shifts = await storage.getShiftsByUserAndDateRange(req.userId, startDate, endDate);\n      } else {\n        shifts = await storage.getShiftsByUser(req.userId);\n      }\n      \n      console.log('GET /api/shifts - Returning', shifts.length, 'shifts for user:', req.userId);\n      res.json(shifts);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get shifts\" });\n    }\n  });\n\n  app.post(\"/api/shifts\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      // Get user data to access their companyId\n      const user = await storage.getUser(req.userId);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n\n      const shiftData = insertShiftSchema.parse({\n        ...req.body,\n        userId: req.userId,\n        companyId: user.companyId // Automatically associate with user's company\n      });\n\n      const shift = await storage.createShift(shiftData);\n      res.status(201).json(shift);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid shift data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create shift\" });\n    }\n  });\n\n  app.put(\"/api/shifts/:id\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      \n      // Get user data to ensure companyId is maintained\n      const user = await storage.getUser(req.userId);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n\n      const shiftData = insertShiftSchema.partial().parse({\n        ...req.body,\n        // Ensure companyId is preserved/set during updates\n        companyId: user.companyId\n      });\n\n      const shift = await storage.updateShift(id, shiftData);\n      if (!shift) {\n        return res.status(404).json({ message: \"Shift not found\" });\n      }\n      \n      res.json(shift);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid shift data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to update shift\" });\n    }\n  });\n\n  app.delete(\"/api/shifts/:id\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const success = await storage.deleteShift(id);\n      \n      if (!success) {\n        return res.status(404).json({ message: \"Shift not found\" });\n      }\n      \n      res.json({ message: \"Shift deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete shift\" });\n    }\n  });\n\n  // New endpoints to separate personal shifts from roster shifts\n  \n  // GET /api/personal-shifts - Get shifts created by the user themselves\n  app.get(\"/api/personal-shifts\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    console.log('GET /api/personal-shifts - Starting request for user:', req.userId);\n    try {\n      const { startDate, endDate } = req.query;\n      \n      let shifts;\n      if (startDate && endDate) {\n        shifts = await storage.getShiftsByUserAndDateRange(req.userId, startDate, endDate);\n      } else {\n        shifts = await storage.getShiftsByUser(req.userId);\n      }\n      \n      // Filter to only personal shifts (created by user themselves or createdBy is null)\n      const personalShifts = shifts.filter((shift: any) => \n        !shift.createdBy || shift.createdBy === req.userId\n      );\n      \n      console.log('GET /api/personal-shifts - Returning', personalShifts.length, 'personal shifts for user:', req.userId);\n      res.json(personalShifts);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get personal shifts\" });\n    }\n  });\n\n  // GET /api/roster-shifts - Get shifts assigned to the user by managers\n  app.get(\"/api/roster-shifts\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    console.log('GET /api/roster-shifts - Starting request for user:', req.userId);\n    try {\n      const { startDate, endDate } = req.query;\n      \n      let shifts;\n      if (startDate && endDate) {\n        shifts = await storage.getShiftsByUserAndDateRange(req.userId, startDate, endDate);\n      } else {\n        shifts = await storage.getShiftsByUser(req.userId);\n      }\n      \n      // Filter to only roster shifts (created by someone else - managers)\n      const rosterShifts = shifts.filter((shift: any) => \n        shift.createdBy && shift.createdBy !== req.userId\n      );\n      \n      console.log('GET /api/roster-shifts - Returning', rosterShifts.length, 'roster shifts for user:', req.userId);\n      res.json(rosterShifts);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get roster shifts\" });\n    }\n  });\n\n  // Helper function to check if user is a manager\n  const isManager = async (userId: number): Promise<boolean> => {\n    try {\n      const user = await storage.getUser(userId);\n      return user?.role === 'manager' || user?.userType === 'business';\n    } catch {\n      return false;\n    }\n  };\n\n  // Roster Management Routes - Manager only\n  \n  // GET /api/roster - Get full team shifts for managers\n  app.get(\"/api/roster\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      if (!(await isManager(req.userId))) {\n        return res.status(403).json({ message: \"Manager access required\" });\n      }\n\n      const user = await storage.getUser(req.userId);\n      if (!user?.companyId) {\n        return res.status(400).json({ message: \"Company not found\" });\n      }\n\n      const { startDate, endDate } = req.query;\n      \n      let shifts;\n      if (startDate && endDate) {\n        shifts = await storage.getShiftsByCompanyAndDateRange(user.companyId, startDate, endDate);\n      } else {\n        shifts = await storage.getShiftsByCompany(user.companyId);\n      }\n      \n      res.json(shifts);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get roster shifts\" });\n    }\n  });\n\n  // POST /api/roster/shifts - Assign shifts to employees (bulk or single)\n  app.post(\"/api/roster/shifts\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      if (!(await isManager(req.userId))) {\n        return res.status(403).json({ message: \"Manager access required\" });\n      }\n\n      const user = await storage.getUser(req.userId);\n      if (!user?.companyId) {\n        return res.status(400).json({ message: \"Company not found\" });\n      }\n\n      const { shifts: shiftsToCreate } = req.body;\n      \n      // Handle both single shift and bulk shifts\n      const shiftsArray = Array.isArray(shiftsToCreate) ? shiftsToCreate : [shiftsToCreate || req.body];\n      \n      const createdShifts = [];\n      \n      for (const shiftData of shiftsArray) {\n        // Validate employee belongs to same company\n        const employee = await storage.getUser(shiftData.userId);\n        if (!employee || employee.companyId !== user.companyId) {\n          return res.status(403).json({ \n            message: `Employee ${shiftData.userId} not found or not in your company` \n          });\n        }\n\n        // Check for overlapping shifts for this employee\n        const existingShifts = await storage.getShiftsByUserAndDate(shiftData.userId, shiftData.date);\n        const hasOverlap = existingShifts.some(existing => {\n          const newStart = new Date(`2000-01-01T${shiftData.startTime}`);\n          const newEnd = new Date(`2000-01-01T${shiftData.endTime}`);\n          const existingStart = new Date(`2000-01-01T${existing.startTime}`);\n          const existingEnd = new Date(`2000-01-01T${existing.endTime}`);\n          \n          return (newStart < existingEnd && newEnd > existingStart);\n        });\n\n        if (hasOverlap) {\n          return res.status(409).json({ \n            message: `Shift overlaps with existing shift for employee ${employee.name} on ${shiftData.date}` \n          });\n        }\n\n        const processedShiftData = insertShiftSchema.parse({\n          ...shiftData,\n          companyId: user.companyId,\n          createdBy: req.userId,\n          status: 'scheduled'\n        });\n\n        const shift = await storage.createShift(processedShiftData);\n        createdShifts.push(shift);\n      }\n\n      res.status(201).json(createdShifts.length === 1 ? createdShifts[0] : createdShifts);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid shift data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create roster shifts\" });\n    }\n  });\n\n  // PUT /api/roster/shifts/:id - Edit assigned shift (manager only)\n  app.put(\"/api/roster/shifts/:id\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      if (!(await isManager(req.userId))) {\n        return res.status(403).json({ message: \"Manager access required\" });\n      }\n\n      const user = await storage.getUser(req.userId);\n      if (!user?.companyId) {\n        return res.status(400).json({ message: \"Company not found\" });\n      }\n\n      const id = parseInt(req.params.id);\n      \n      // Verify shift belongs to manager's company\n      const existingShift = await storage.getShift(id);\n      if (!existingShift || existingShift.companyId !== user.companyId) {\n        return res.status(404).json({ message: \"Shift not found or access denied\" });\n      }\n\n      const shiftData = insertShiftSchema.partial().parse({\n        ...req.body,\n        companyId: user.companyId,\n        createdBy: req.userId\n      });\n\n      const shift = await storage.updateShift(id, shiftData);\n      if (!shift) {\n        return res.status(404).json({ message: \"Shift not found\" });\n      }\n      \n      res.json(shift);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid shift data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to update roster shift\" });\n    }\n  });\n\n  // DELETE /api/roster/shifts/:id - Delete assigned shift (manager only)\n  app.delete(\"/api/roster/shifts/:id\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      if (!(await isManager(req.userId))) {\n        return res.status(403).json({ message: \"Manager access required\" });\n      }\n\n      const user = await storage.getUser(req.userId);\n      if (!user?.companyId) {\n        return res.status(400).json({ message: \"Company not found\" });\n      }\n\n      const id = parseInt(req.params.id);\n      \n      // Verify shift belongs to manager's company\n      const existingShift = await storage.getShift(id);\n      if (!existingShift || existingShift.companyId !== user.companyId) {\n        return res.status(404).json({ message: \"Shift not found or access denied\" });\n      }\n\n      const success = await storage.deleteShift(id);\n      \n      if (!success) {\n        return res.status(404).json({ message: \"Shift not found\" });\n      }\n      \n      res.json({ message: \"Roster shift deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete roster shift\" });\n    }\n  });\n\n  // GET /api/my-shifts - Get own assigned shifts for employees\n  app.get(\"/api/my-shifts\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const { startDate, endDate, status } = req.query;\n      \n      let shifts;\n      if (startDate && endDate) {\n        shifts = await storage.getShiftsByUserAndDateRange(req.userId, startDate, endDate);\n      } else {\n        shifts = await storage.getShiftsByUser(req.userId);\n      }\n      \n      // Filter by status if provided (e.g., only 'scheduled' shifts)\n      if (status) {\n        shifts = shifts.filter(shift => shift.status === status);\n      }\n      \n      res.json(shifts);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get assigned shifts\" });\n    }\n  });\n\n  // Analytics routes - support both JWT and session auth\n  app.get(\"/api/analytics/weekly-hours\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const { startDate, endDate } = req.query;\n      \n      if (!startDate || !endDate) {\n        return res.status(400).json({ message: \"startDate and endDate are required\" });\n      }\n      \n      const hours = await storage.getWeeklyHours(req.userId, startDate, endDate);\n      res.json({ hours });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get weekly hours\" });\n    }\n  });\n\n  app.get(\"/api/analytics/daily-average\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const { startDate, endDate } = req.query;\n      \n      if (!startDate || !endDate) {\n        return res.status(400).json({ message: \"startDate and endDate are required\" });\n      }\n      \n      const average = await storage.getDailyAverage(req.userId, startDate, endDate);\n      res.json({ average });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get daily average\" });\n    }\n  });\n\n  app.get(\"/api/analytics/missing-entries\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const { startDate, endDate } = req.query;\n      \n      if (!startDate || !endDate) {\n        return res.status(400).json({ message: \"startDate and endDate are required\" });\n      }\n      \n      const missingDates = await storage.getMissingEntries(req.userId, startDate, endDate);\n      res.json({ missingDates });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get missing entries\" });\n    }\n  });\n\n  // Billing routes - support both JWT and session auth\n  app.get(\"/api/billing/shift/:id\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const shiftId = parseInt(req.params.id);\n      const shift = await storage.getShift(shiftId);\n      \n      if (!shift) {\n        return res.status(404).json({ message: \"Shift not found\" });\n      }\n      \n      // Verify user owns this shift or is a manager in the same company\n      const user = await storage.getUser(req.userId);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      \n      if (shift.userId !== req.userId && shift.companyId !== user.companyId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      const billing = await calculateShiftBilling(\n        shift.id,\n        shift.userId, // Use employee's ID for employee-specific rates\n        shift.date,\n        shift.startTime,\n        shift.endTime,\n        shift.shiftType\n      );\n      \n      res.json(billing);\n    } catch (error) {\n      console.error(\"Error calculating shift billing:\", error);\n      res.status(500).json({ message: \"Failed to calculate shift billing\" });\n    }\n  });\n\n  app.get(\"/api/billing/shifts\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const { startDate, endDate } = req.query;\n      \n      if (!startDate || !endDate) {\n        return res.status(400).json({ message: \"startDate and endDate are required\" });\n      }\n      \n      const shifts = await storage.getShiftsByUserAndDateRange(req.userId, startDate, endDate);\n      \n      if (shifts.length === 0) {\n        return res.json([]);\n      }\n      \n      const billingData = await calculateMultipleShiftsBilling(\n        shifts.map(shift => ({\n          id: shift.id,\n          userId: shift.userId,\n          date: shift.date,\n          startTime: shift.startTime,\n          endTime: shift.endTime,\n          shiftType: shift.shiftType\n        }))\n      );\n      \n      res.json(billingData);\n    } catch (error) {\n      console.error(\"Error calculating shifts billing:\", error);\n      res.status(500).json({ message: \"Failed to calculate shifts billing\" });\n    }\n  });\n\n  // Employee billing report endpoint for managers\n  app.get(\"/api/billing/employee-report\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const { employeeId, startDate, endDate } = req.query;\n      \n      if (!employeeId || !startDate || !endDate) {\n        return res.status(400).json({ message: \"employeeId, startDate and endDate are required\" });\n      }\n      \n      const user = await storage.getUser(req.userId);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      \n      // Only business users, managers and business owners can generate employee reports\n      if (user.userType !== 'business' && user.userType !== 'business_owner' && user.role !== 'manager') {\n        return res.status(403).json({ message: \"Manager access required\" });\n      }\n      \n      // Get employee details\n      const employee = await storage.getUser(parseInt(employeeId));\n      if (!employee) {\n        return res.status(404).json({ message: \"Employee not found\" });\n      }\n      \n      // Verify employee belongs to same company\n      if (employee.companyId !== user.companyId) {\n        return res.status(403).json({ message: \"Access denied to employee in different company\" });\n      }\n      \n      // Get employee shifts for date range (exclude roster shifts)\n      const allShifts = await storage.getShiftsByUserAndDateRange(parseInt(employeeId), startDate, endDate);\n      \n      // Filter to only include uploaded shifts (exclude roster/scheduled shifts)\n      // Include shifts where createdBy is null or equals the employee's ID\n      const shifts = allShifts.filter(shift => \n        shift.createdBy === null || shift.createdBy === parseInt(employeeId)\n      );\n      \n      if (shifts.length === 0) {\n        return res.json({\n          employee: {\n            id: employee.id,\n            name: employee.name,\n            email: employee.email\n          },\n          period: { startDate, endDate },\n          shifts: [],\n          summary: {\n            totalHours: 0,\n            weekdayHours: 0,\n            weeknightHours: 0,\n            saturdayHours: 0,\n            sundayHours: 0,\n            publicHolidayHours: 0,\n            totalAmount: 0,\n            weekdayAmount: 0,\n            weeknightAmount: 0,\n            saturdayAmount: 0,\n            sundayAmount: 0,\n            publicHolidayAmount: 0\n          }\n        });\n      }\n      \n      // Calculate detailed billing for each shift\n      const billingData = await calculateMultipleShiftsBilling(\n        shifts.map(shift => ({\n          id: shift.id,\n          userId: shift.userId,\n          date: shift.date,\n          startTime: shift.startTime,\n          endTime: shift.endTime,\n          shiftType: shift.shiftType\n        }))\n      );\n      \n      // Calculate summary by rate type\n      let summary = {\n        totalHours: 0,\n        weekdayHours: 0,\n        weeknightHours: 0,\n        saturdayHours: 0,\n        sundayHours: 0,\n        publicHolidayHours: 0,\n        totalAmount: 0,\n        weekdayAmount: 0,\n        weeknightAmount: 0,\n        saturdayAmount: 0,\n        sundayAmount: 0,\n        publicHolidayAmount: 0\n      };\n      \n      billingData.forEach(billing => {\n        summary.totalHours += billing.total_hours;\n        summary.totalAmount += billing.total_amount;\n        \n        // Handle split billing (weekday/weeknight) by processing billing array entries\n        if (billing.day_type === 'weekday/weeknight') {\n          billing.billing.forEach(entry => {\n            // Determine rate type based on the rate used\n            // In split billing, first entry is weekday, second is weeknight\n            const isWeeknightRate = entry.rate > billing.billing[0].rate;\n            if (isWeeknightRate) {\n              summary.weeknightHours += entry.hours;\n              summary.weeknightAmount += entry.subtotal;\n            } else {\n              summary.weekdayHours += entry.hours;\n              summary.weekdayAmount += entry.subtotal;\n            }\n          });\n        } else {\n          // Add to specific rate type totals for non-split billing\n          switch (billing.day_type) {\n            case 'weekday':\n              summary.weekdayHours += billing.total_hours;\n              summary.weekdayAmount += billing.total_amount;\n              break;\n            case 'weeknight':\n              summary.weeknightHours += billing.total_hours;\n              summary.weeknightAmount += billing.total_amount;\n              break;\n            case 'saturday':\n              summary.saturdayHours += billing.total_hours;\n              summary.saturdayAmount += billing.total_amount;\n              break;\n            case 'sunday':\n              summary.sundayHours += billing.total_hours;\n              summary.sundayAmount += billing.total_amount;\n              break;\n            case 'publicHoliday':\n              summary.publicHolidayHours += billing.total_hours;\n              summary.publicHolidayAmount += billing.total_amount;\n              break;\n          }\n        }\n      });\n      \n      res.json({\n        employee: {\n          id: employee.id,\n          name: employee.name,\n          email: employee.email\n        },\n        period: { startDate, endDate },\n        shifts: billingData,\n        summary\n      });\n    } catch (error) {\n      console.error(\"Error generating employee billing report:\", error);\n      res.status(500).json({ message: \"Failed to generate employee billing report\" });\n    }\n  });\n\n  app.get(\"/api/rate-tiers\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.userId);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      \n      const companyId = user.companyId || 1; // fallback for individual users\n      \n      const rateTiers = await storage.getRateTiersByCompany(companyId);\n      \n      res.json(rateTiers);\n    } catch (error) {\n      console.error(\"Error fetching rate tiers:\", error);\n      res.status(500).json({ message: \"Failed to fetch rate tiers\" });\n    }\n  });\n\n  app.post(\"/api/rate-tiers\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.userId);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      \n      // Only managers and business owners can create rate tiers\n      if (user.userType !== 'business_owner' && user.role !== 'manager') {\n        return res.status(403).json({ message: \"Only managers can create rate tiers\" });\n      }\n      \n      const rateTierData = insertRateTierSchema.parse({\n        ...req.body,\n        companyId: user.companyId || 1\n      });\n      \n      const result = await storage.createRateTier(rateTierData);\n      \n      res.status(201).json(result);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid rate tier data\", errors: error.errors });\n      }\n      console.error(\"Error creating rate tier:\", error);\n      res.status(500).json({ message: \"Failed to create rate tier\" });\n    }\n  });\n\n  app.get(\"/api/public-holidays\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const holidays = await storage.getAllPublicHolidays();\n      \n      res.json(holidays);\n    } catch (error) {\n      console.error(\"Error fetching public holidays:\", error);\n      res.status(500).json({ message: \"Failed to fetch public holidays\" });\n    }\n  });\n\n  app.post(\"/api/public-holidays\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.userId);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      \n      // Only managers and business owners can add public holidays\n      if (user.userType !== 'business_owner' && user.role !== 'manager') {\n        return res.status(403).json({ message: \"Only managers can add public holidays\" });\n      }\n      \n      const holidayData = insertPublicHolidaySchema.parse(req.body);\n      \n      const result = await storage.createPublicHoliday(holidayData);\n      \n      res.status(201).json(result);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid holiday data\", errors: error.errors });\n      }\n      console.error(\"Error creating public holiday:\", error);\n      res.status(500).json({ message: \"Failed to create public holiday\" });\n    }\n  });\n\n  // Employee Rate Management Routes - Manager only\n  \n  // GET /api/employee-rates/:userId - Get rates for a specific employee\n  app.get(\"/api/employee-rates/:userId\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.userId);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      \n      // Only business users, managers and business owners can view employee rates\n      if (user.userType !== 'business' && user.userType !== 'business_owner' && user.role !== 'manager') {\n        return res.status(403).json({ message: \"Manager access required\" });\n      }\n      \n      const employeeId = parseInt(req.params.userId);\n      const employeeRates = await storage.getEmployeeRates(employeeId);\n      \n      if (!employeeRates) {\n        return res.status(404).json({ message: \"Employee rates not found\" });\n      }\n      \n      res.json(employeeRates);\n    } catch (error) {\n      console.error(\"Error fetching employee rates:\", error);\n      res.status(500).json({ message: \"Failed to fetch employee rates\" });\n    }\n  });\n\n  // GET /api/companies/:companyId/employee-rates - Get rates for all employees in a company\n  app.get(\"/api/companies/:companyId/employee-rates\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.userId);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      \n      // Only business users, managers and business owners can view employee rates\n      if (user.userType !== 'business' && user.userType !== 'business_owner' && user.role !== 'manager') {\n        return res.status(403).json({ message: \"Manager access required\" });\n      }\n      \n      const companyId = parseInt(req.params.companyId);\n      \n      // Verify user belongs to this company\n      if (user.companyId !== companyId) {\n        return res.status(403).json({ message: \"Access denied to this company\" });\n      }\n      \n      const employeeRates = await storage.getEmployeeRatesByCompany(companyId);\n      \n      res.json(employeeRates);\n    } catch (error) {\n      console.error(\"Error fetching company employee rates:\", error);\n      res.status(500).json({ message: \"Failed to fetch company employee rates\" });\n    }\n  });\n\n  // POST /api/employee-rates - Create employee rates\n  app.post(\"/api/employee-rates\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.userId);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      \n      // Only business users and managers can create employee rates\n      if (user.userType !== 'business' && user.userType !== 'business_owner' && user.role !== 'manager') {\n        return res.status(403).json({ message: \"Manager access required\" });\n      }\n      \n      const rateData = insertEmployeeRateSchema.parse({\n        ...req.body,\n        companyId: user.companyId\n      });\n      \n      const result = await storage.createEmployeeRates(rateData);\n      \n      res.status(201).json(result);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid employee rate data\", errors: error.errors });\n      }\n      console.error(\"Error creating employee rates:\", error);\n      res.status(500).json({ message: \"Failed to create employee rates\" });\n    }\n  });\n\n  // PUT /api/employee-rates/:userId - Update employee rates\n  app.put(\"/api/employee-rates/:userId\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.userId);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      \n      // Only business users and managers can update employee rates\n      if (user.userType !== 'business' && user.userType !== 'business_owner' && user.role !== 'manager') {\n        return res.status(403).json({ message: \"Manager access required\" });\n      }\n      \n      const employeeId = parseInt(req.params.userId);\n      const updateData = insertEmployeeRateSchema.partial().parse(req.body);\n      \n      const result = await storage.updateEmployeeRates(employeeId, updateData);\n      \n      if (!result) {\n        return res.status(404).json({ message: \"Employee rates not found\" });\n      }\n      \n      res.json(result);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid employee rate data\", errors: error.errors });\n      }\n      console.error(\"Error updating employee rates:\", error);\n      res.status(500).json({ message: \"Failed to update employee rates\" });\n    }\n  });\n\n  app.post(\"/api/billing/preview\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const user = await storage.getUser(req.userId);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      \n      // Validate preview data\n      const previewSchema = z.object({\n        shiftType: z.string(),\n        date: z.string(),\n        startTime: z.string(),\n        endTime: z.string(),\n        hoursWorked: z.number().positive(),\n        employeeId: z.number().optional() // For manager preview of specific employee\n      });\n      \n      const previewData = previewSchema.parse(req.body);\n      \n      // Determine which employee's rates to use for preview\n      let employeeId = req.userId; // Default to current user\n      if (previewData.employeeId) {\n        // Only managers can preview other employees' rates\n        if (user.userType !== 'business_owner' && user.role !== 'manager') {\n          return res.status(403).json({ message: \"Manager access required to preview employee rates\" });\n        }\n        employeeId = previewData.employeeId;\n      }\n      \n      // Use the billing engine to calculate preview with employee rates\n      const billing = await calculateShiftBilling(\n        -1, // Mock ID for preview\n        employeeId,\n        previewData.date,\n        previewData.startTime,\n        previewData.endTime,\n        previewData.shiftType\n      );\n      \n      res.json(billing);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid preview data\", errors: error.errors });\n      }\n      console.error(\"Error calculating billing preview:\", error);\n      res.status(500).json({ message: \"Failed to calculate billing preview\" });\n    }\n  });\n\n  // Notification routes - support both JWT and session auth\n  app.get(\"/api/notifications\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const notifications = await storage.getNotificationsByUser(req.userId);\n      res.json(notifications);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get notifications\" });\n    }\n  });\n\n  app.post(\"/api/notifications\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const notificationData = insertNotificationSchema.parse({\n        ...req.body,\n        userId: req.userId\n      });\n\n      const notification = await storage.createNotification(notificationData);\n      res.status(201).json(notification);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid notification data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create notification\" });\n    }\n  });\n\n  app.put(\"/api/notifications/:id/read\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const success = await storage.markNotificationAsRead(id);\n      \n      if (!success) {\n        return res.status(404).json({ message: \"Notification not found\" });\n      }\n      \n      res.json({ message: \"Notification marked as read\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to mark notification as read\" });\n    }\n  });\n\n  // Admin routes for database management - support both JWT and session auth\n  app.get(\"/api/admin/stats\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const userCount = await storage.getUserCount();\n      const shiftCount = await storage.getShiftCount();\n      const totalHours = await storage.getTotalHours();\n      const notificationCount = await storage.getNotificationCount();\n      \n      res.json({\n        userCount,\n        shiftCount,\n        totalHours,\n        notificationCount\n      });\n    } catch (error) {\n      console.error(\"Error fetching admin stats:\", error);\n      res.status(500).json({ message: \"Failed to fetch statistics\" });\n    }\n  });\n\n  app.get(\"/api/admin/users\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const users = await storage.getAllUsers();\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error fetching all users:\", error);\n      res.status(500).json({ message: \"Failed to fetch users\" });\n    }\n  });\n\n  app.get(\"/api/admin/shifts\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const shifts = await storage.getAllShiftsWithUsers();\n      res.json(shifts);\n    } catch (error) {\n      console.error(\"Error fetching all shifts:\", error);\n      res.status(500).json({ message: \"Failed to fetch shifts\" });\n    }\n  });\n\n  app.post(\"/api/admin/sql\", optionalJwtAuth, requireAuth, async (req: any, res) => {\n    try {\n      const { query } = req.body;\n      \n      if (!query) {\n        return res.status(400).json({ message: \"SQL query is required\" });\n      }\n\n      // Basic safety check - only allow SELECT queries for security\n      const trimmedQuery = query.trim().toLowerCase();\n      if (!trimmedQuery.startsWith('select')) {\n        return res.status(400).json({ \n          message: \"Only SELECT queries are allowed for security reasons\" \n        });\n      }\n\n      const result = await storage.executeRawQuery(query);\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error executing SQL query:\", error);\n      res.status(500).json({ \n        message: \"Query execution failed\", \n        error: error instanceof Error ? error.message : String(error)\n      });\n    }\n  });\n\n  // Business routes - support both JWT and session auth  \n  app.post(\"/api/companies\", optionalJwtAuth, requireAuth, async (req, res) => {\n    try {\n      const companyData = req.body;\n      const company = await storage.createCompany(companyData);\n      res.status(201).json(company);\n    } catch (error) {\n      console.error(\"Error creating company:\", error);\n      res.status(500).json({ message: \"Failed to create company\" });\n    }\n  });\n\n  app.get(\"/api/companies/:id/employees\", optionalJwtAuth, requireAuth, async (req, res) => {\n    try {\n      const companyId = parseInt(req.params.id);\n      const employees = await storage.getCompanyEmployees(companyId);\n      res.json(employees);\n    } catch (error) {\n      console.error(\"Error getting company employees:\", error);\n      res.status(500).json({ message: \"Failed to get company employees\" });\n    }\n  });\n\n  app.get(\"/api/companies/:id/shifts\", optionalJwtAuth, requireAuth, async (req, res) => {\n    try {\n      const companyId = parseInt(req.params.id);\n      const { startDate, endDate } = req.query;\n      \n      let shifts;\n      if (startDate && endDate) {\n        shifts = await storage.getShiftsByCompanyAndDateRange(companyId, startDate as string, endDate as string);\n      } else {\n        shifts = await storage.getShiftsByCompany(companyId);\n      }\n      \n      res.json(shifts);\n    } catch (error) {\n      console.error(\"Error getting company shifts:\", error);\n      res.status(500).json({ message: \"Failed to get company shifts\" });\n    }\n  });\n\n  app.get(\"/api/companies/:id/pending-shifts\", optionalJwtAuth, requireAuth, async (req, res) => {\n    try {\n      const companyId = parseInt(req.params.id);\n      const pendingShifts = await storage.getPendingShifts(companyId);\n      res.json(pendingShifts);\n    } catch (error) {\n      console.error(\"Error getting pending shifts:\", error);\n      res.status(500).json({ message: \"Failed to get pending shifts\" });\n    }\n  });\n\n  app.post(\"/api/shifts/:id/approve\", optionalJwtAuth, requireAuth, async (req, res) => {\n    try {\n      const shiftId = parseInt(req.params.id);\n      const { approvedBy } = req.body;\n      \n      const shift = await storage.approveShift(shiftId, approvedBy);\n      \n      if (!shift) {\n        return res.status(404).json({ message: \"Shift not found\" });\n      }\n      \n      res.json(shift);\n    } catch (error) {\n      console.error(\"Error approving shift:\", error);\n      res.status(500).json({ message: \"Failed to approve shift\" });\n    }\n  });\n\n  // Email roster endpoints\n  app.post(\"/api/companies/:id/send-roster-email\", optionalJwtAuth, requireAuth, async (req, res) => {\n    try {\n      const companyId = parseInt(req.params.id);\n      const { employeeId, weekStart, weekEnd } = req.body;\n      \n      // Get employee details\n      const employees = await storage.getCompanyEmployees(companyId);\n      const employee = employees.find(emp => emp.id === employeeId);\n      \n      if (!employee) {\n        return res.status(404).json({ message: \"Employee not found\" });\n      }\n      \n      // Get shifts for the employee for the specified week\n      const shifts = await storage.getShiftsByCompanyAndDateRange(companyId, weekStart, weekEnd);\n      const employeeShifts = shifts.filter(shift => shift.userId === employeeId);\n      \n      // Transform shifts to match email interface\n      const rosterShifts = employeeShifts.map(shift => ({\n        id: shift.id,\n        employeeId: shift.userId,\n        date: shift.date,\n        startTime: shift.startTime,\n        endTime: shift.endTime,\n        type: shift.shiftType,\n        location: shift.location || undefined,\n        employeeName: employee.name,\n        employeeEmail: employee.email\n      }));\n      \n      // Send email\n      const success = await sendRosterEmail(\n        employee.email,\n        employee.name,\n        rosterShifts,\n        weekStart,\n        weekEnd,\n        \"ShiftMate\" // Could be made configurable per company\n      );\n      \n      if (success) {\n        res.json({ message: \"Roster email sent successfully\", employee: employee.name });\n      } else {\n        res.status(500).json({ message: \"Failed to send roster email\" });\n      }\n    } catch (error) {\n      console.error(\"Error sending roster email:\", error);\n      res.status(500).json({ message: \"Failed to send roster email\" });\n    }\n  });\n\n  app.post(\"/api/companies/:id/send-all-roster-emails\", optionalJwtAuth, requireAuth, async (req, res) => {\n    try {\n      const companyId = parseInt(req.params.id);\n      const { weekStart, weekEnd } = req.body;\n      \n      // Get all employees\n      const employees = await storage.getCompanyEmployees(companyId);\n      \n      // Get all shifts for the week\n      const shifts = await storage.getShiftsByCompanyAndDateRange(companyId, weekStart, weekEnd);\n      \n      const results = [];\n      \n      // Send email to each employee with their shifts\n      for (const employee of employees) {\n        const employeeShifts = shifts.filter(shift => shift.userId === employee.id);\n        \n        // Transform shifts to match email interface\n        const rosterShifts = employeeShifts.map(shift => ({\n          id: shift.id,\n          employeeId: shift.userId,\n          date: shift.date,\n          startTime: shift.startTime,\n          endTime: shift.endTime,\n          type: shift.shiftType,\n          location: shift.location || undefined,\n          employeeName: employee.name,\n          employeeEmail: employee.email\n        }));\n        \n        try {\n          const success = await sendRosterEmail(\n            employee.email,\n            employee.name,\n            rosterShifts,\n            weekStart,\n            weekEnd,\n            \"ShiftMate\"\n          );\n          \n          results.push({\n            employee: employee.name,\n            email: employee.email,\n            success,\n            shiftsCount: rosterShifts.length\n          });\n        } catch (error) {\n          console.error(`Failed to send email to ${employee.name}:`, error);\n          results.push({\n            employee: employee.name,\n            email: employee.email,\n            success: false,\n            shiftsCount: employeeShifts.length,\n            error: error instanceof Error ? error.message : 'Unknown error'\n          });\n        }\n      }\n      \n      const successCount = results.filter(r => r.success).length;\n      const totalCount = results.length;\n      \n      res.json({\n        message: `Roster emails sent: ${successCount}/${totalCount} successful`,\n        results,\n        summary: {\n          total: totalCount,\n          successful: successCount,\n          failed: totalCount - successCount\n        }\n      });\n    } catch (error) {\n      console.error(\"Error sending roster emails:\", error);\n      res.status(500).json({ message: \"Failed to send roster emails\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":53070},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\n// Storage for JWT tokens with persistence\nlet accessToken: string | null = null;\nlet refreshPromise: Promise<void> | null = null;\nlet isInitialized = false;\n\n// Initialize token from localStorage on first access\nfunction initializeToken() {\n  if (!isInitialized) {\n    try {\n      const stored = localStorage.getItem('shiftmate_access_token');\n      accessToken = stored;\n      isInitialized = true;\n      console.log('Token initialized from localStorage:', accessToken ? 'token present' : 'null');\n    } catch (error) {\n      console.error('Failed to initialize token from localStorage:', error);\n      isInitialized = true;\n    }\n  }\n}\n\nexport function setAccessToken(token: string | null) {\n  initializeToken();\n  accessToken = token;\n  try {\n    if (token) {\n      localStorage.setItem('shiftmate_access_token', token);\n    } else {\n      localStorage.removeItem('shiftmate_access_token');\n    }\n  } catch (error) {\n    console.error('Failed to store token in localStorage:', error);\n  }\n  console.log('setAccessToken called with:', token ? 'token present' : 'null');\n}\n\nexport function getAccessToken(): string | null {\n  initializeToken();\n  console.log('getAccessToken called, returning:', accessToken ? 'token present' : 'null');\n  return accessToken;\n}\n\n// Refresh access token using refresh token\nexport async function refreshAccessToken(): Promise<boolean> {\n  if (refreshPromise) {\n    await refreshPromise;\n    return !!accessToken;\n  }\n\n  refreshPromise = (async () => {\n    try {\n      const response = await fetch('/api/auth/refresh', {\n        method: 'POST',\n        credentials: 'include'\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        setAccessToken(data.accessToken);\n      } else {\n        setAccessToken(null);\n      }\n    } catch (error) {\n      console.error('Token refresh failed:', error);\n      setAccessToken(null);\n    } finally {\n      refreshPromise = null;\n    }\n  })();\n\n  await refreshPromise;\n  return !!accessToken;\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const makeRequest = async (token?: string) => {\n    const headers: HeadersInit = {\n      ...(data ? { \"Content-Type\": \"application/json\" } : {}),\n      ...(token ? { \"Authorization\": `Bearer ${token}` } : {})\n    };\n\n    return fetch(url, {\n      method,\n      headers,\n      body: data ? JSON.stringify(data) : undefined,\n      credentials: \"include\",\n    });\n  };\n\n  // Ensure we have an access token, refresh if null\n  let currentToken = getAccessToken();\n  \n  // If no token available, try to refresh first\n  if (!currentToken) {\n    console.log('No access token available for API request, attempting refresh');\n    const refreshed = await refreshAccessToken();\n    currentToken = getAccessToken();\n    console.log('After refresh attempt, token:', currentToken ? 'present' : 'still null');\n  }\n  \n  let res = await makeRequest(currentToken || undefined);\n  console.log(`API Request: ${method} ${url} with token: ${currentToken ? 'present' : 'none'}`);\n\n  // If 401, try to refresh (whether we had a token or not)\n  if (res.status === 401) {\n    console.log('401 error, attempting token refresh');\n    const refreshed = await refreshAccessToken();\n    const newToken = getAccessToken();\n    if (refreshed && newToken) {\n      console.log('Token refreshed automatically, retrying request');\n      res = await makeRequest(newToken);\n    } else {\n      console.log('Token refresh failed or no new token received');\n    }\n  }\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const makeRequest = async (token?: string) => {\n      const headers: HeadersInit = {\n        ...(token ? { \"Authorization\": `Bearer ${token}` } : {})\n      };\n      \n      console.log(`Making query request to ${queryKey[0]} with token: ${token ? 'present' : 'none'}`);\n      console.log('Headers being sent:', JSON.stringify(headers));\n\n      return fetch(queryKey[0] as string, {\n        headers,\n        credentials: \"include\",\n      });\n    };\n\n    // Ensure we have the latest access token, refresh if null\n    let currentToken = getAccessToken();\n    \n    // If no token available, try to refresh first\n    if (!currentToken) {\n      console.log('No access token available, attempting refresh');\n      const refreshed = await refreshAccessToken();\n      currentToken = getAccessToken();\n      console.log('After refresh attempt, token:', currentToken ? 'present' : 'still null');\n    }\n    \n    console.log(`Query Request: ${queryKey[0]} with token: ${currentToken ? 'present' : 'none'}`);\n    let res = await makeRequest(currentToken || undefined);\n\n    // If 401, try to refresh (whether we had a token or not)\n    if (res.status === 401) {\n      console.log('Query 401 error, attempting token refresh');\n      const refreshed = await refreshAccessToken();\n      const newToken = getAccessToken();\n      if (refreshed && newToken) {\n        console.log('Token refreshed, retrying query');\n        res = await makeRequest(newToken);\n        console.log(`Retry Query Request: ${queryKey[0]} with token: ${newToken ? 'present' : 'none'}`);\n      } else {\n        console.log('Token refresh failed or no new token received');\n      }\n    }\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":6162},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/pages/signup.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Link, useLocation } from \"wouter\";\nimport { FcGoogle } from \"react-icons/fc\";\n\nexport default function SignUp() {\n  const [email, setEmail] = useState(\"\");\n  const [name, setName] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const { toast } = useToast();\n  const [, navigate] = useLocation();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!email || !name) {\n      toast({\n        title: \"Error\",\n        description: \"Please fill in all fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      const response = await fetch(\"/api/auth/signup\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ email, name }),\n        credentials: \"include\",\n      });\n\n      const data = await response.json();\n\n      if (response.ok) {\n        toast({\n          title: \"Success\",\n          description: \"Account created successfully!\",\n        });\n        navigate(\"/\");\n      } else {\n        toast({\n          title: \"Error\",\n          description: data.message || \"Signup failed\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Network error. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleGoogleSignUp = () => {\n    window.location.href = \"/api/auth/google?intent=signup\";\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 px-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"space-y-1\">\n          <CardTitle className=\"text-2xl font-bold text-center\">Create Account</CardTitle>\n          <CardDescription className=\"text-center\">\n            Sign up for ShiftMate to start managing your shifts\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <Button\n            variant=\"outline\"\n            className=\"w-full\"\n            onClick={handleGoogleSignUp}\n            disabled={isLoading}\n          >\n            <FcGoogle className=\"mr-2 h-4 w-4\" />\n            Sign up with Google\n          </Button>\n          \n          <div className=\"relative\">\n            <div className=\"absolute inset-0 flex items-center\">\n              <Separator className=\"w-full\" />\n            </div>\n            <div className=\"relative flex justify-center text-xs uppercase\">\n              <span className=\"bg-background px-2 text-muted-foreground\">\n                Or continue with email\n              </span>\n            </div>\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"name\">Full Name</Label>\n              <Input\n                id=\"name\"\n                type=\"text\"\n                placeholder=\"Enter your full name\"\n                value={name}\n                onChange={(e) => setName(e.target.value)}\n                disabled={isLoading}\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"Enter your email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                disabled={isLoading}\n                required\n              />\n            </div>\n            <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>\n              {isLoading ? \"Creating Account...\" : \"Create Account\"}\n            </Button>\n          </form>\n\n          <div className=\"text-center text-sm text-muted-foreground\">\n            Already have an account?{\" \"}\n            <Link href=\"/login\">\n              <a className=\"text-primary hover:underline\">Sign in</a>\n            </Link>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":4485},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"PRD_Mobile_ShiftMate.md":{"content":" # Product Requirements Document: ShiftMate Mobile\n\n## Project Overview\n\n**Product Name:** ShiftMate Mobile  \n**Version:** 1.0  \n**Document Date:** June 10, 2025  \n**Product Type:** Native Mobile Application for Shift Management\n\n## Executive Summary\n\nShiftMate Mobile is a comprehensive shift management mobile application designed for support workers, freelance contractors, and shift-based professionals. The native mobile app enables users to efficiently log shifts, track hours, view analytics, and export reports with features like automatic shift timers, calendar visualization, and persistent user authentication.\n\n## Product Vision\n\nTo streamline workforce scheduling and tracking for shift-based professionals by providing an intuitive, native mobile platform that automates time tracking and simplifies shift management with seamless offline capabilities.\n\n## Target Users\n\n- Support workers and caregivers\n- Freelance contractors  \n- Part-time employees with variable schedules\n- Shift-based professionals across industries\n- Small business owners managing personal work hours\n\n## Core Features\n\n### 1. User Authentication & Management\n- **Google OAuth Integration**: Secure login using Google accounts\n- **Persistent Authentication**: Remains signed in until manual logout\n- **Biometric Authentication**: Face ID/Touch ID for quick access\n- **User Profiles**: Store user information (name, email, profile image)\n- **Automatic Token Refresh**: Silent background authentication renewal\n- **Secure Storage**: Device keychain storage for credentials\n\n### 2. Shift Management\n- **Manual Shift Entry**: Add shifts with date, start/end times, type, and notes\n- **Shift Types**: Pre-defined categories (morning, evening, night, double, custom)\n- **Smart Time Selection**: End time options start from selected start time\n- **Shift Editing**: Modify existing shifts with touch-friendly interface\n- **Validation**: Prevent invalid time combinations and ensure data integrity\n- **Offline Mode**: Create shifts without internet connection\n\n### 3. Automatic Shift Timer\n- **Real-time Timer**: Live tracking of elapsed work time with background support\n- **Start/Stop Functionality**: One-touch shift timing with haptic feedback\n- **Quarter-hour Rounding**: Automatic rounding to 00, 15, 30, 45 minutes\n- **Automatic Shift Creation**: Creates shift entry when timer stops\n- **Background Timer**: Continues running when app is backgrounded\n- **Lock Screen Widget**: Timer display on lock screen\n- **Shift Type Detection**: Auto-determines type based on start time:\n  - 5:00 AM - 11:00 AM: Morning shift\n  - 11:01 AM - 4:00 PM: Evening shift\n  - 4:01 PM - 4:59 AM: Night shift\n- **Minimum Duration**: 15-minute minimum shift requirement\n\n### 4. Dashboard & Analytics\n- **Weekly Hours Tracking**: Current and previous week comparison\n- **Recent Shifts Display**: Last 3 shifts with swipe-to-edit\n- **Shift Timer Widget**: Prominent timer with start/end controls\n- **Total Shifts Counter**: All-time shift statistics\n- **Next Shift Alerts**: Push notifications for upcoming shifts\n- **Visual Indicators**: Color-coded shift types and status\n- **Pull-to-Refresh**: Update data with native gesture\n\n### 5. Calendar View\n- **Monthly Calendar**: Touch-optimized calendar with gesture navigation\n- **Shift Visualization**: Color-coded shifts by type\n- **Day Selection**: Tap dates to view/add shifts\n- **Swipe Navigation**: Month-to-month navigation\n- **Current Date Highlighting**: Clear visual current day indicator\n\n### 6. Reporting & Export\n- **PDF Reports**: Comprehensive shift reports optimized for mobile viewing\n- **Daily Hours Summary**: Table showing total hours per day\n- **CSV Export**: Raw data export via email or cloud storage\n- **Share Functionality**: Native sharing to email, cloud drives\n- **Configurable Options**: Choose report sections (details, summary, averages)\n- **Date Range Selection**: Touch-friendly date pickers\n\n### 7. Native Mobile Features\n- **Push Notifications**: Shift reminders and timer alerts\n- **Background Processing**: Timer continues when app is closed\n- **Haptic Feedback**: Touch responses for timer controls\n- **Native Navigation**: Platform-specific navigation patterns\n- **Dark Mode Support**: Automatic system theme detection\n- **Accessibility**: VoiceOver/TalkBack support\n\n### 8. Offline Capabilities\n- **Local Storage**: SQLite database for offline functionality\n- **Sync on Connect**: Automatic data synchronization when online\n- **Conflict Resolution**: Smart merging of offline and online data\n- **Offline Timer**: Full timer functionality without internet\n\n## Technical Architecture\n\n### Mobile Platform\n- **iOS**: Swift/SwiftUI for iOS 14+\n- **Android**: Kotlin/Jetpack Compose for Android 8+ (API 26+)\n- **Cross-Platform Option**: React Native or Flutter for unified codebase\n\n### Data Layer\n- **Local Database**: SQLite with Room (Android) / Core Data (iOS)\n- **Cloud Sync**: RESTful API with PostgreSQL backend\n- **Authentication**: OAuth 2.0 with secure token storage\n- **Offline-First**: Local-first architecture with background sync\n\n### Backend Services\n- **API Server**: Node.js with Express.js\n- **Database**: PostgreSQL with Drizzle ORM\n- **Authentication**: JWT with refresh tokens\n- **Push Notifications**: Firebase Cloud Messaging\n- **File Storage**: Cloud storage for exports\n\n### Security\n- **Keychain Storage**: Secure credential storage\n- **Certificate Pinning**: API communication security\n- **Biometric Authentication**: Device-level security integration\n- **Data Encryption**: AES encryption for local storage\n\n## User Experience Flow\n\n### First-Time User Journey\n1. Download app from App Store/Play Store\n2. Open app  Welcome screen\n3. Tap \"Sign in with Google\"  OAuth flow\n4. Account creation  Permission requests (notifications, background)\n5. Tutorial/onboarding  Dashboard\n6. Persistent login until manual logout\n\n### Daily Usage Flow\n1. Open app (auto-login)  Dashboard\n2. Tap \"Start Shift\"  Timer begins with notification\n3. App can be backgrounded  Timer continues\n4. Return to app or use lock screen widget  View progress\n5. Tap \"End Shift\"  Automatic shift creation with haptic feedback\n6. View recent shifts  Swipe to edit\n\n### Notification Flow\n1. Timer running  Background notification\n2. Shift reminder  Push notification\n3. Weekly summary  Scheduled notification\n\n## Platform-Specific Features\n\n### iOS Features\n- **Shortcuts Integration**: Siri shortcuts for timer control\n- **Widget Support**: Home screen and lock screen widgets\n- **Apple Watch**: Companion app for timer control\n- **Face ID/Touch ID**: Biometric authentication\n- **Live Activities**: Dynamic Island timer display\n\n### Android Features\n- **Quick Settings Tile**: Timer toggle in notification panel\n- **Android Widgets**: Home screen timer widget\n- **Wear OS**: Companion app for smartwatches\n- **Fingerprint/Face**: Biometric authentication\n- **Adaptive Icons**: Dynamic app icon support\n\n## Performance Requirements\n\n- **App Launch Time**: < 1 second cold start\n- **Timer Accuracy**: 1-second precision with background processing\n- **Data Sync**: < 3 seconds for standard synchronization\n- **Battery Optimization**: Minimal impact during background timer\n- **Memory Usage**: < 50MB typical usage\n- **Storage**: < 100MB app size, < 50MB user data\n\n## Security Requirements\n\n- **OAuth 2.0**: Secure authentication flow\n- **Token Storage**: Keychain/KeyStore secure storage\n- **API Security**: Certificate pinning and encryption\n- **Local Encryption**: AES-256 for sensitive data\n- **Session Management**: Automatic token refresh\n- **Logout Security**: Complete credential clearing\n\n## Persistent Authentication Design\n\n### Implementation\n- **Secure Token Storage**: Refresh tokens stored in device keychain\n- **Automatic Refresh**: Silent token renewal before expiration\n- **Biometric Unlock**: Optional quick access with Face ID/Touch ID\n- **Manual Logout**: Explicit logout button in settings\n- **Session Validity**: Tokens valid until manual logout or security event\n\n### User Experience\n- First login  Stays logged in permanently\n- App deletion  Requires re-authentication\n- Manual logout  Returns to login screen\n- Device change  Requires re-authentication\n- Security breach  Remote logout capability\n\n## Offline-First Architecture\n\n### Data Strategy\n- **Local Primary**: All operations work offline first\n- **Background Sync**: Automatic sync when connection available\n- **Conflict Resolution**: Last-write-wins with user review option\n- **Cache Strategy**: Intelligent data caching and cleanup\n\n### Sync Behavior\n- **Real-time**: Immediate sync when online\n- **Batch Sync**: Multiple changes synchronized together\n- **Retry Logic**: Automatic retry with exponential backoff\n- **User Feedback**: Sync status indicators\n\n## App Store Requirements\n\n### iOS App Store\n- **Privacy Labels**: Data usage transparency\n- **App Tracking**: Optional analytics with user consent\n- **Content Rating**: 4+ (general audience)\n- **Device Support**: iPhone, iPad, Apple Watch\n\n### Google Play Store\n- **Privacy Policy**: Comprehensive data handling disclosure\n- **Permissions**: Minimal required permissions\n- **Target API**: Latest Android API level\n- **Device Support**: Phones, tablets, Wear OS\n\n## Success Metrics\n\n- **User Engagement**: 80% weekly active user rate\n- **Timer Usage**: 70% of shifts created via timer\n- **Retention Rate**: 85% monthly user retention\n- **Crash Rate**: < 0.1% session crashes\n- **App Store Rating**: 4.5+ stars average\n\n## Launch Strategy\n\n### MVP Features (Phase 1)\n- Core timer functionality\n- Basic shift management\n- Google OAuth authentication\n- Simple reporting\n\n### Enhanced Features (Phase 2)\n- Advanced analytics\n- Push notifications\n- Widget support\n- Export improvements\n\n### Premium Features (Phase 3)\n- Team collaboration\n- Advanced reporting\n- API integrations\n- Multi-location support\n\nThis mobile-focused PRD provides a comprehensive native application experience with persistent authentication and offline-first capabilities optimized for shift-based workers.","size_bytes":10107},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* Mobile-first touch optimizations */\n@layer base {\n  html {\n    /* Prevent zoom on input focus for mobile */\n    -webkit-text-size-adjust: 100%;\n    -ms-text-size-adjust: 100%;\n  }\n  \n  body {\n    /* Improved touch scrolling */\n    -webkit-overflow-scrolling: touch;\n    overscroll-behavior: contain;\n  }\n  \n  /* Touch-friendly button sizing */\n  button, [role=\"button\"] {\n    min-height: 44px;\n    min-width: 44px;\n  }\n  \n  /* Improve tap targets for mobile */\n  .touch-target {\n    min-height: 44px;\n    min-width: 44px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n  \n  /* Mobile-optimized input fields */\n  input, textarea, select {\n    font-size: 16px; /* Prevent zoom on iOS */\n    border-radius: 8px;\n  }\n  \n  /* Prevent callouts on long press */\n  .no-callout {\n    -webkit-touch-callout: none;\n    -webkit-user-select: none;\n    -khtml-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n  }\n}\n\n:root {\n      --background: 0 0% 100%;\n--foreground: 20 14.3% 4.1%;\n--muted: 60 4.8% 95.9%;\n--muted-foreground: 25 5.3% 44.7%;\n--popover: 0 0% 100%;\n--popover-foreground: 20 14.3% 4.1%;\n--card: 0 0% 100%;\n--card-foreground: 20 14.3% 4.1%;\n--border: 20 5.9% 90%;\n--input: 20 5.9% 90%;\n--primary: 207 90% 54%;\n--primary-foreground: 211 100% 99%;\n--secondary: 60 4.8% 95.9%;\n--secondary-foreground: 24 9.8% 10%;\n--accent: 60 4.8% 95.9%;\n--accent-foreground: 24 9.8% 10%;\n--destructive: 0 84.2% 60.2%;\n--destructive-foreground: 60 9.1% 97.8%;\n--ring: 20 14.3% 4.1%;\n--radius: 0.5rem;\n  }\n  .dark {\n      --background: 240 10% 3.9%;\n--foreground: 0 0% 98%;\n--muted: 240 3.7% 15.9%;\n--muted-foreground: 240 5% 64.9%;\n--popover: 240 10% 3.9%;\n--popover-foreground: 0 0% 98%;\n--card: 240 10% 3.9%;\n--card-foreground: 0 0% 98%;\n--border: 240 3.7% 15.9%;\n--input: 240 3.7% 15.9%;\n--primary: 207 90% 54%;\n--primary-foreground: 211 100% 99%;\n--secondary: 240 3.7% 15.9%;\n--secondary-foreground: 0 0% 98%;\n--accent: 240 3.7% 15.9%;\n--accent-foreground: 0 0% 98%;\n--destructive: 0 62.8% 30.6%;\n--destructive-foreground: 0 0% 98%;\n--ring: 240 4.9% 83.9%;\n--radius: 0.5rem;\n  }\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}","size_bytes":2335},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"server/src/index.ts":{"content":"import express from \"express\";\nimport cors from \"cors\";\n//  si tens router, manten esta lnea:\nimport routes from \"./routes/index\";\n\nconst app = express();\napp.use(cors());\napp.use(express.json());\n\n//  salud directa (para descartar problemas de router)\napp.get(\"/api/health\", (_req, res) => res.json({ ok: true, ts: Date.now() }));\n\n//  tus rutas (si las uss)\napp.use(\"/api\", routes);\n\n//  MUY IMPORTANTE: 0.0.0.0 para que se vea desde fuera\nconst port = Number(process.env.PORT) || 3000;\napp.listen(port, \"0.0.0.0\", () => {\n  console.log(`[api] listening on ${port}`);\n});\n","size_bytes":598},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/calendar-grid.tsx":{"content":"import { useMemo } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\nimport type { Shift } from \"@shared/schema\";\nimport { formatTime } from \"@/lib/time-utils\";\n\ninterface CalendarGridProps {\n  currentDate: Date;\n  onDateChange: (date: Date) => void;\n  shifts: Shift[];\n  onDayClick?: (date: string) => void;\n}\n\nconst DAYS_OF_WEEK = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];\n\nconst SHIFT_TYPE_COLORS = {\n  morning: 'bg-emerald-500',\n  afternoon: 'bg-blue-500',\n  night: 'bg-purple-500',\n};\n\nexport function CalendarGrid({ currentDate, onDateChange, shifts, onDayClick }: CalendarGridProps) {\n  const { year, month, daysInMonth, firstDayOfMonth, today } = useMemo(() => {\n    const year = currentDate.getFullYear();\n    const month = currentDate.getMonth();\n    const daysInMonth = new Date(year, month + 1, 0).getDate();\n    const firstDayOfMonth = new Date(year, month, 1).getDay();\n    const today = new Date().toISOString().split('T')[0];\n    \n    return { year, month, daysInMonth, firstDayOfMonth, today };\n  }, [currentDate]);\n\n  const shiftsByDate = useMemo(() => {\n    const map = new Map<string, Shift[]>();\n    shifts.forEach(shift => {\n      const existing = map.get(shift.date) || [];\n      map.set(shift.date, [...existing, shift]);\n    });\n    return map;\n  }, [shifts]);\n\n  const previousMonth = () => {\n    const newDate = new Date(currentDate);\n    newDate.setMonth(month - 1);\n    onDateChange(newDate);\n  };\n\n  const nextMonth = () => {\n    const newDate = new Date(currentDate);\n    newDate.setMonth(month + 1);\n    onDateChange(newDate);\n  };\n\n  const renderCalendarDay = (day: number, isCurrentMonth: boolean = true, monthOffset: number = 0) => {\n    const actualMonth = month + monthOffset;\n    const actualYear = actualMonth < 0 ? year - 1 : actualMonth > 11 ? year + 1 : year;\n    const normalizedMonth = actualMonth < 0 ? 11 : actualMonth > 11 ? 0 : actualMonth;\n    \n    const dateString = `${actualYear}-${(normalizedMonth + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;\n    const dayShifts = shiftsByDate.get(dateString) || [];\n    const isToday = dateString === today;\n    const hasMissingEntry = isCurrentMonth && dayShifts.length === 0;\n\n    return (\n      <div\n        key={`${actualYear}-${normalizedMonth}-${day}`}\n        className={`h-20 p-2 relative cursor-pointer transition-colors ${\n          isCurrentMonth ? 'bg-white hover:bg-slate-50' : 'bg-slate-50'\n        } ${isToday ? 'bg-blue-50 border-2 border-blue-300' : ''} ${\n          hasMissingEntry && isCurrentMonth ? 'border-2 border-red-200' : ''\n        }`}\n        onClick={() => isCurrentMonth && onDayClick?.(dateString)}\n      >\n        <span className={`text-sm font-medium ${\n          isCurrentMonth ? (isToday ? 'text-blue-900' : 'text-slate-900') : 'text-slate-400'\n        }`}>\n          {day}\n        </span>\n        \n        {isToday && (\n          <span className=\"absolute bottom-1 left-1 text-xs text-blue-600\">\n            Today\n          </span>\n        )}\n        \n        {hasMissingEntry && isCurrentMonth && (\n          <span className=\"absolute top-1 right-1 text-xs text-red-500\">!</span>\n        )}\n        \n        {dayShifts.length > 0 && (\n          <div className=\"absolute bottom-1 left-1 right-1 space-y-0.5\">\n            {dayShifts.slice(0, 2).map((shift, index) => (\n              <div\n                key={index}\n                className={`w-full h-1 rounded-full ${\n                  SHIFT_TYPE_COLORS[shift.shiftType as keyof typeof SHIFT_TYPE_COLORS] || 'bg-gray-500'\n                }`}\n                title={`${shift.shiftType} (${formatTime(shift.startTime)} - ${formatTime(shift.endTime)})`}\n              />\n            ))}\n            {dayShifts.length > 2 && (\n              <div className=\"text-xs text-slate-500\">+{dayShifts.length - 2} more</div>\n            )}\n          </div>\n        )}\n      </div>\n    );\n  };\n\n  const renderCalendarGrid = () => {\n    const days = [];\n    \n    // Previous month's trailing days\n    const prevMonth = month === 0 ? 11 : month - 1;\n    const prevYear = month === 0 ? year - 1 : year;\n    const daysInPrevMonth = new Date(prevYear, prevMonth + 1, 0).getDate();\n    \n    for (let i = firstDayOfMonth - 1; i >= 0; i--) {\n      days.push(renderCalendarDay(daysInPrevMonth - i, false, -1));\n    }\n    \n    // Current month's days\n    for (let day = 1; day <= daysInMonth; day++) {\n      days.push(renderCalendarDay(day, true, 0));\n    }\n    \n    // Next month's leading days\n    const remainingDays = 42 - days.length; // 6 rows  7 days\n    for (let day = 1; day <= remainingDays; day++) {\n      days.push(renderCalendarDay(day, false, 1));\n    }\n    \n    return days;\n  };\n\n  return (\n    <div className=\"bg-white rounded-xl shadow-sm border border-slate-200\">\n      <div className=\"p-6 border-b border-slate-200\">\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"text-lg font-semibold text-slate-900\">\n            {currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}\n          </h3>\n          <div className=\"flex items-center space-x-2\">\n            <Button variant=\"ghost\" size=\"sm\" onClick={previousMonth}>\n              <ChevronLeft className=\"h-4 w-4\" />\n            </Button>\n            <Button variant=\"ghost\" size=\"sm\" onClick={nextMonth}>\n              <ChevronRight className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n      \n      <div className=\"p-6\">\n        <div className=\"grid grid-cols-7 gap-px bg-slate-200 rounded-lg overflow-hidden\">\n          {/* Header Days */}\n          {DAYS_OF_WEEK.map(day => (\n            <div key={day} className=\"bg-slate-50 p-3 text-center\">\n              <span className=\"text-xs font-medium text-slate-600\">{day}</span>\n            </div>\n          ))}\n          \n          {/* Calendar Days */}\n          {renderCalendarGrid()}\n        </div>\n\n        {/* Legend */}\n        <div className=\"mt-6 flex flex-wrap items-center gap-6\">\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"w-3 h-3 bg-emerald-500 rounded-full\"></div>\n            <span className=\"text-sm text-slate-600\">Morning Shift</span>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"w-3 h-3 bg-blue-500 rounded-full\"></div>\n            <span className=\"text-sm text-slate-600\">Evening Shift</span>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"w-3 h-3 bg-purple-500 rounded-full\"></div>\n            <span className=\"text-sm text-slate-600\">Night Shift</span>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"w-3 h-3 bg-amber-500 rounded-full\"></div>\n            <span className=\"text-sm text-slate-600\">Double Shift</span>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"w-3 h-3 border-2 border-red-300 rounded-full\"></div>\n            <span className=\"text-sm text-slate-600\">Missing Entry</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":7205},"client/src/hooks/use-email.ts":{"content":"import { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport function useSendRosterEmail(companyId: number) {\n  const { toast } = useToast();\n  \n  return useMutation({\n    mutationFn: async (data: {\n      employeeId: number;\n      weekStart: string;\n      weekEnd: string;\n    }) => {\n      console.log('Sending roster email for employee:', data.employeeId);\n      const response = await apiRequest('POST', `/api/companies/${companyId}/send-roster-email`, data);\n      return response.json();\n    },\n    onSuccess: (data: any) => {\n      console.log('Roster email sent successfully:', data);\n      toast({\n        title: \"Email Sent\",\n        description: `Roster email sent successfully to ${data.employee}`,\n      });\n    },\n    onError: (error) => {\n      console.error('Failed to send roster email:', error);\n      toast({\n        title: \"Email Failed\",\n        description: \"Failed to send roster email. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n}\n\nexport function useSendAllRosterEmails(companyId: number) {\n  const { toast } = useToast();\n  \n  return useMutation({\n    mutationFn: async (data: {\n      weekStart: string;\n      weekEnd: string;\n    }) => {\n      console.log('Sending roster emails to all employees for week:', data.weekStart, 'to', data.weekEnd);\n      const response = await apiRequest('POST', `/api/companies/${companyId}/send-all-roster-emails`, data);\n      return response.json();\n    },\n    onSuccess: (data: any) => {\n      console.log('Roster emails sent:', data);\n      toast({\n        title: \"Emails Sent\",\n        description: `${data.summary.successful}/${data.summary.total} roster emails sent successfully`,\n      });\n    },\n    onError: (error) => {\n      console.error('Failed to send roster emails:', error);\n      toast({\n        title: \"Email Failed\",\n        description: \"Failed to send roster emails. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n}","size_bytes":2049},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/pages/login.tsx":{"content":"import { useState } from \"react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Clock } from \"lucide-react\";\nimport { FcGoogle } from \"react-icons/fc\";\n\nexport default function Login() {\n  const [email, setEmail] = useState(\"\");\n  const [name, setName] = useState(\"\");\n  const [rememberMe, setRememberMe] = useState(false);\n  const { login, isLoggingIn } = useAuth();\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (email && name) {\n      login({ email, name, rememberMe });\n    }\n  };\n\n  const handleGoogleLogin = () => {\n    window.location.href = \"/api/auth/google?intent=login\";\n  };\n\n  return (\n    <div className=\"min-h-screen bg-slate-50 flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"text-center\">\n          <div className=\"mx-auto w-12 h-12 mb-4 flex items-center justify-center\">\n            <Clock className=\"w-12 h-12 text-blue-600\" />\n          </div>\n          <CardTitle className=\"text-2xl font-bold\">Welcome to ShiftMate</CardTitle>\n          <CardDescription>\n            Sign in to manage your work shifts\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {/* Google OAuth Button */}\n          <Button\n            variant=\"outline\"\n            className=\"w-full h-12\"\n            onClick={handleGoogleLogin}\n            type=\"button\"\n            data-testid=\"button-google-signin\"\n          >\n            <FcGoogle className=\"mr-2 h-5 w-5\" />\n            Sign in with Google\n          </Button>\n          \n          {/* Separator */}\n          <div className=\"relative my-6\">\n            <div className=\"absolute inset-0 flex items-center\">\n              <Separator className=\"w-full\" />\n            </div>\n            <div className=\"relative flex justify-center text-xs uppercase\">\n              <span className=\"bg-white px-2 text-slate-500\">\n                Or continue with email\n              </span>\n            </div>\n          </div>\n\n          {/* Email/Name Login Form */}\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"email\">Email</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"your@email.com\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                required\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"name\">Full Name</Label>\n              <Input\n                id=\"name\"\n                type=\"text\"\n                placeholder=\"John Doe\"\n                value={name}\n                onChange={(e) => setName(e.target.value)}\n                required\n              />\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox \n                id=\"rememberMe\" \n                checked={rememberMe}\n                onCheckedChange={(checked) => setRememberMe(checked as boolean)}\n              />\n              <Label \n                htmlFor=\"rememberMe\" \n                className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n              >\n                Remember me for 30 days\n              </Label>\n            </div>\n            <Button \n              type=\"submit\" \n              className=\"w-full\" \n              disabled={isLoggingIn || !email || !name}\n            >\n              {isLoggingIn ? \"Signing in...\" : \"Sign In\"}\n            </Button>\n          </form>\n          \n          <div className=\"mt-6 text-center\">\n            <p className=\"text-sm text-slate-500\">\n              New users will be automatically registered\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":4161},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\n// Catch any unhandled errors that might cause premature exit\nprocess.on('uncaughtException', (err) => {\n  console.error('Uncaught Exception:', err);\n});\n\nprocess.on('unhandledRejection', (reason, promise) => {\n  console.error('Unhandled Rejection at:', promise, 'reason:', reason);\n});\n\nconst app = express();\n\n// Session configuration\napp.use(session({\n  secret: process.env.SESSION_SECRET || 'your-secret-key-change-in-production',\n  resave: false,\n  saveUninitialized: false,\n  cookie: {\n    secure: false,\n    httpOnly: true,\n    maxAge: 24 * 60 * 60 * 1000\n  }\n}) as any);\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\nconst server = await registerRoutes(app);\n\napp.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n  const status = err.status || err.statusCode || 500;\n  const message = err.message || \"Internal Server Error\";\n\n  res.status(status).json({ message });\n  throw err;\n});\n\n// importantly only setup vite in development and after\n// setting up all the other routes so the catch-all route\n// doesn't interfere with the other routes\nif (app.get(\"env\") === \"development\") {\n  await setupVite(app, server);\n} else {\n  serveStatic(app);\n}\n\n// ALWAYS serve the app on port 5000\n// this serves both the API and the client.\n// It is the only port that is not firewalled.\nconst port = 5000;\nserver.listen(port, \"0.0.0.0\", () => {\n  log(`serving on port ${port}`);\n});\n\n// Workaround for ESM/tsx top-level await issue\n// Keep the process alive by maintaining an active interval\nsetInterval(() => {\n  // Empty callback to keep event loop active\n}, 60000);\n","size_bytes":2596},"server/storage.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport { Pool } from \"pg\";\nimport { eq, and, gte, lte, desc, sql, or, isNull, isNotNull } from \"drizzle-orm\";\nimport { \n  users, \n  shifts, \n  notifications,\n  companies,\n  refreshTokens,\n  rateTiers,\n  publicHolidays,\n  employeeRates,\n  type User, \n  type InsertUser, \n  type Shift, \n  type InsertShift,\n  type Notification,\n  type InsertNotification,\n  type Company,\n  type InsertCompany,\n  type RefreshToken,\n  type InsertRefreshToken,\n  type RateTier,\n  type InsertRateTier,\n  type PublicHoliday,\n  type InsertPublicHoliday,\n  type EmployeeRate,\n  type InsertEmployeeRate\n} from \"@shared/schema\";\n\nconst connectionString = process.env.DATABASE_URL;\nif (!connectionString) {\n  throw new Error(\"DATABASE_URL environment variable is required\");\n}\n\nconsole.log('Connecting to database with PostgreSQL driver...');\n\n// Parse connection string manually to handle special characters\nconst match = connectionString.match(/^postgresql:\\/\\/([^:]+):([^@]+)@([^:]+):(\\d+)\\/(.+)$/);\nif (!match) {\n  throw new Error('Invalid DATABASE_URL format');\n}\n\nconst [, username, password, host, port, database] = match;\n\nconsole.log('Parsed connection details for PostgreSQL');\n\nconst pool = new Pool({\n  user: username,\n  password: password,\n  host: host,\n  port: parseInt(port),\n  database: database,\n  ssl: {\n    rejectUnauthorized: false\n  }\n});\n\nconst db = drizzle(pool);\n\nexport interface IStorage {\n  // User methods\n  getUser(id: number): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  \n  // Company methods\n  getCompany(id: number): Promise<Company | undefined>;\n  getCompanyByEmail(email: string): Promise<Company | undefined>;\n  createCompany(company: InsertCompany): Promise<Company>;\n  getCompanyEmployees(companyId: number): Promise<User[]>;\n  \n  // Shift methods\n  getShift(id: number): Promise<Shift | undefined>;\n  getShiftsByUser(userId: number): Promise<Shift[]>;\n  getShiftsByUserAndDate(userId: number, date: string): Promise<Shift[]>;\n  getShiftsByUserAndDateRange(userId: number, startDate: string, endDate: string): Promise<Shift[]>;\n  getShiftsByCompany(companyId: number): Promise<Shift[]>;\n  getShiftsByCompanyAndDateRange(companyId: number, startDate: string, endDate: string): Promise<Shift[]>;\n  getPendingShifts(companyId: number): Promise<Shift[]>;\n  createShift(shift: InsertShift): Promise<Shift>;\n  updateShift(id: number, shift: Partial<InsertShift>): Promise<Shift | undefined>;\n  deleteShift(id: number): Promise<boolean>;\n  approveShift(id: number, approvedBy: number): Promise<Shift | undefined>;\n  \n  // Analytics methods\n  getWeeklyHours(userId: number, startDate: string, endDate: string): Promise<number>;\n  getCompanyWeeklyHours(companyId: number, startDate: string, endDate: string): Promise<number>;\n  getDailyAverage(userId: number, startDate: string, endDate: string): Promise<number>;\n  getMissingEntries(userId: number, startDate: string, endDate: string): Promise<string[]>;\n  \n  // Notification methods\n  getNotificationsByUser(userId: number): Promise<Notification[]>;\n  createNotification(notification: InsertNotification): Promise<Notification>;\n  markNotificationAsRead(id: number): Promise<boolean>;\n  \n  // Refresh token methods\n  createRefreshToken(token: InsertRefreshToken): Promise<RefreshToken>;\n  getRefreshTokenByHash(tokenHash: string): Promise<RefreshToken | undefined>;\n  revokeRefreshToken(tokenHash: string): Promise<void>;\n  cleanupExpiredTokens(): Promise<void>;\n  \n  // Admin methods\n  getUserCount(): Promise<number>;\n  getShiftCount(): Promise<number>;\n  getTotalHours(): Promise<number>;\n  getNotificationCount(): Promise<number>;\n  getAllUsers(): Promise<User[]>;\n  getAllShiftsWithUsers(): Promise<any[]>;\n  executeRawQuery(query: string): Promise<any>;\n}\n\nexport class DbStorage implements IStorage {\n  // User methods\n  async getUser(id: number): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    try {\n      console.log('Searching for user with email:', email);\n      const result = await db.select().from(users).where(eq(users.email, email)).limit(1);\n      console.log('getUserByEmail result:', result);\n      return result[0];\n    } catch (error) {\n      console.error('Error in getUserByEmail:', error);\n      throw error;\n    }\n  }\n\n  async createUser(user: InsertUser): Promise<User> {\n    try {\n      console.log('Creating user:', user);\n      const result = await db.insert(users).values(user).returning();\n      console.log('createUser result:', result);\n      return result[0];\n    } catch (error) {\n      console.error('Error in createUser:', error);\n      throw error;\n    }\n  }\n\n  // Company methods\n  async getCompany(id: number): Promise<Company | undefined> {\n    const result = await db.select().from(companies).where(eq(companies.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getCompanyByEmail(email: string): Promise<Company | undefined> {\n    const result = await db.select().from(companies).where(eq(companies.email, email)).limit(1);\n    return result[0];\n  }\n\n  async createCompany(company: InsertCompany): Promise<Company> {\n    const result = await db.insert(companies).values(company).returning();\n    return result[0];\n  }\n\n  async getCompanyEmployees(companyId: number): Promise<User[]> {\n    return await db.select().from(users).where(eq(users.companyId, companyId));\n  }\n\n  // Shift methods\n  async getShift(id: number): Promise<Shift | undefined> {\n    const result = await db.select().from(shifts).where(eq(shifts.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getShiftsByUser(userId: number): Promise<Shift[]> {\n    return await db.select().from(shifts).where(eq(shifts.userId, userId)).orderBy(desc(shifts.date));\n  }\n\n  async getShiftsByUserAndDate(userId: number, date: string): Promise<Shift[]> {\n    return await db.select().from(shifts)\n      .where(\n        and(\n          eq(shifts.userId, userId),\n          eq(shifts.date, date)\n        )\n      )\n      .orderBy(shifts.startTime);\n  }\n\n  async getShiftsByUserAndDateRange(userId: number, startDate: string, endDate: string): Promise<Shift[]> {\n    return await db.select().from(shifts)\n      .where(\n        and(\n          eq(shifts.userId, userId),\n          gte(shifts.date, startDate),\n          lte(shifts.date, endDate)\n        )\n      )\n      .orderBy(shifts.date);\n  }\n\n  async createShift(shift: InsertShift): Promise<Shift> {\n    const result = await db.insert(shifts).values(shift).returning();\n    return result[0];\n  }\n\n  async updateShift(id: number, shift: Partial<InsertShift>): Promise<Shift | undefined> {\n    const result = await db.update(shifts).set(shift).where(eq(shifts.id, id)).returning();\n    return result[0];\n  }\n\n  async deleteShift(id: number): Promise<boolean> {\n    const result = await db.delete(shifts).where(eq(shifts.id, id));\n    return result.rowCount !== null && result.rowCount > 0;\n  }\n\n  async getShiftsByCompany(companyId: number): Promise<Shift[]> {\n    return await db.select().from(shifts).where(eq(shifts.companyId, companyId)).orderBy(desc(shifts.date));\n  }\n\n  async getShiftsByCompanyAndDateRange(companyId: number, startDate: string, endDate: string): Promise<Shift[]> {\n    return await db.select().from(shifts)\n      .where(\n        and(\n          eq(shifts.companyId, companyId),\n          gte(shifts.date, startDate),\n          lte(shifts.date, endDate)\n        )\n      )\n      .orderBy(shifts.date);\n  }\n\n  async getPendingShifts(companyId: number): Promise<Shift[]> {\n    return await db.select().from(shifts)\n      .where(\n        and(\n          eq(shifts.companyId, companyId),\n          eq(shifts.status, 'pending_approval')\n        )\n      )\n      .orderBy(desc(shifts.date));\n  }\n\n  async approveShift(id: number, approvedBy: number): Promise<Shift | undefined> {\n    const result = await db.update(shifts)\n      .set({ \n        status: 'approved', \n        approvedBy: approvedBy, \n        approvedAt: new Date()\n      })\n      .where(eq(shifts.id, id))\n      .returning();\n    return result[0];\n  }\n\n  // Analytics methods\n  async getWeeklyHours(userId: number, startDate: string, endDate: string): Promise<number> {\n    const shiftsInRange = await this.getShiftsByUserAndDateRange(userId, startDate, endDate);\n    \n    // Filter to only include uploaded shifts (exclude roster shifts)\n    const uploadedShifts = shiftsInRange.filter(shift => \n      !shift.createdBy || shift.createdBy === userId\n    );\n    \n    let totalMinutes = 0;\n    for (const shift of uploadedShifts) {\n      const start = new Date(`2000-01-01T${shift.startTime}`);\n      const end = new Date(`2000-01-01T${shift.endTime}`);\n      \n      // Handle overnight shifts\n      if (end < start) {\n        end.setDate(end.getDate() + 1);\n      }\n      \n      const shiftMinutes = (end.getTime() - start.getTime()) / (1000 * 60);\n      totalMinutes += shiftMinutes;\n    }\n    \n    return totalMinutes / 60; // Convert to hours\n  }\n\n  async getCompanyWeeklyHours(companyId: number, startDate: string, endDate: string): Promise<number> {\n    const shiftsInRange = await this.getShiftsByCompanyAndDateRange(companyId, startDate, endDate);\n    \n    let totalMinutes = 0;\n    for (const shift of shiftsInRange) {\n      const start = new Date(`2000-01-01T${shift.startTime}`);\n      const end = new Date(`2000-01-01T${shift.endTime}`);\n      \n      // Handle overnight shifts\n      if (end < start) {\n        end.setDate(end.getDate() + 1);\n      }\n      \n      const shiftMinutes = (end.getTime() - start.getTime()) / (1000 * 60);\n      totalMinutes += shiftMinutes;\n    }\n    \n    return totalMinutes / 60; // Convert to hours\n  }\n\n  async getDailyAverage(userId: number, startDate: string, endDate: string): Promise<number> {\n    const totalHours = await this.getWeeklyHours(userId, startDate, endDate);\n    const start = new Date(startDate);\n    const end = new Date(endDate);\n    const daysDiff = Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)) + 1;\n    \n    return daysDiff > 0 ? totalHours / daysDiff : 0;\n  }\n\n  async getMissingEntries(userId: number, startDate: string, endDate: string): Promise<string[]> {\n    const shiftsInRange = await this.getShiftsByUserAndDateRange(userId, startDate, endDate);\n    const shiftDates = new Set(shiftsInRange.map(shift => shift.date));\n    \n    const missingDates: string[] = [];\n    const start = new Date(startDate);\n    const end = new Date(endDate);\n    \n    for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {\n      const dateStr = d.toISOString().split('T')[0];\n      if (!shiftDates.has(dateStr)) {\n        missingDates.push(dateStr);\n      }\n    }\n    \n    return missingDates;\n  }\n\n  // Notification methods\n  async getNotificationsByUser(userId: number): Promise<Notification[]> {\n    return await db.select().from(notifications)\n      .where(eq(notifications.userId, userId))\n      .orderBy(desc(notifications.createdAt));\n  }\n\n  async createNotification(notification: InsertNotification): Promise<Notification> {\n    const result = await db.insert(notifications).values(notification).returning();\n    return result[0];\n  }\n\n  async markNotificationAsRead(id: number): Promise<boolean> {\n    const result = await db.update(notifications)\n      .set({ isRead: true })\n      .where(eq(notifications.id, id));\n    return result.rowCount !== null && result.rowCount > 0;\n  }\n\n  // Refresh token methods\n  async createRefreshToken(token: InsertRefreshToken): Promise<RefreshToken> {\n    const result = await db.insert(refreshTokens).values(token).returning();\n    return result[0];\n  }\n\n  async getRefreshTokenByHash(tokenHash: string): Promise<RefreshToken | undefined> {\n    const result = await db.select().from(refreshTokens)\n      .where(and(\n        eq(refreshTokens.tokenHash, tokenHash),\n        isNull(refreshTokens.revokedAt)\n      ))\n      .limit(1);\n    return result[0];\n  }\n\n  async revokeRefreshToken(tokenHash: string): Promise<void> {\n    await db.update(refreshTokens)\n      .set({ revokedAt: new Date() })\n      .where(eq(refreshTokens.tokenHash, tokenHash));\n  }\n\n  async cleanupExpiredTokens(): Promise<void> {\n    await db.delete(refreshTokens)\n      .where(or(\n        isNotNull(refreshTokens.revokedAt),\n        lte(refreshTokens.expiresAt, new Date())\n      ));\n  }\n\n  // Admin methods\n  async getUserCount(): Promise<number> {\n    try {\n      const result = await db.select({ count: sql<number>`count(*)` }).from(users);\n      return result[0]?.count || 0;\n    } catch (error) {\n      console.error('Error getting user count:', error);\n      return 0;\n    }\n  }\n\n  async getShiftCount(): Promise<number> {\n    try {\n      const result = await db.select({ count: sql<number>`count(*)` }).from(shifts);\n      return result[0]?.count || 0;\n    } catch (error) {\n      console.error('Error getting shift count:', error);\n      return 0;\n    }\n  }\n\n  async getTotalHours(): Promise<number> {\n    try {\n      const allShifts = await db.select().from(shifts);\n      let totalHours = 0;\n      \n      for (const shift of allShifts) {\n        const start = new Date(`2000-01-01T${shift.startTime}`);\n        const end = new Date(`2000-01-01T${shift.endTime}`);\n        \n        // Handle overnight shifts\n        if (end < start) {\n          end.setDate(end.getDate() + 1);\n        }\n        \n        const duration = (end.getTime() - start.getTime()) / (1000 * 60 * 60);\n        totalHours += duration;\n      }\n      \n      return totalHours;\n    } catch (error) {\n      console.error('Error calculating total hours:', error);\n      return 0;\n    }\n  }\n\n  async getNotificationCount(): Promise<number> {\n    try {\n      const result = await db.select({ count: sql<number>`count(*)` }).from(notifications);\n      return result[0]?.count || 0;\n    } catch (error) {\n      console.error('Error getting notification count:', error);\n      return 0;\n    }\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    try {\n      return await db.select().from(users).orderBy(desc(users.createdAt));\n    } catch (error) {\n      console.error('Error getting all users:', error);\n      return [];\n    }\n  }\n\n  async getAllShiftsWithUsers(): Promise<any[]> {\n    try {\n      const result = await db\n        .select({\n          id: shifts.id,\n          userId: shifts.userId,\n          date: shifts.date,\n          startTime: shifts.startTime,\n          endTime: shifts.endTime,\n          shiftType: shifts.shiftType,\n          notes: shifts.notes,\n          createdAt: shifts.createdAt,\n          userName: users.name\n        })\n        .from(shifts)\n        .leftJoin(users, eq(shifts.userId, users.id))\n        .orderBy(desc(shifts.createdAt));\n\n      // Calculate duration for each shift\n      return result.map(shift => {\n        const start = new Date(`2000-01-01T${shift.startTime}`);\n        const end = new Date(`2000-01-01T${shift.endTime}`);\n        \n        // Handle overnight shifts\n        if (end < start) {\n          end.setDate(end.getDate() + 1);\n        }\n        \n        const duration = (end.getTime() - start.getTime()) / (1000 * 60 * 60);\n        \n        return {\n          ...shift,\n          duration\n        };\n      });\n    } catch (error) {\n      console.error('Error getting all shifts with users:', error);\n      return [];\n    }\n  }\n\n  async executeRawQuery(query: string): Promise<any> {\n    try {\n      const result = await db.execute(sql.raw(query));\n      return result;\n    } catch (error) {\n      console.error('Error executing raw query:', error);\n      throw error;\n    }\n  }\n\n  // Rate Tier Methods\n  async getRateTiersByCompany(companyId: number): Promise<any[]> {\n    try {\n      return await db\n        .select()\n        .from(rateTiers)\n        .where(eq(rateTiers.companyId, companyId))\n        .orderBy(rateTiers.shiftType, rateTiers.dayType, rateTiers.tierOrder);\n    } catch (error) {\n      console.error('Error fetching rate tiers:', error);\n      throw error;\n    }\n  }\n\n  async createRateTier(data: any): Promise<any> {\n    try {\n      const [result] = await db\n        .insert(rateTiers)\n        .values(data)\n        .returning();\n      return result;\n    } catch (error) {\n      console.error('Error creating rate tier:', error);\n      throw error;\n    }\n  }\n\n  // Public Holiday Methods\n  async getAllPublicHolidays(): Promise<any[]> {\n    try {\n      return await db\n        .select()\n        .from(publicHolidays)\n        .orderBy(publicHolidays.date);\n    } catch (error) {\n      console.error('Error fetching public holidays:', error);\n      throw error;\n    }\n  }\n\n  async createPublicHoliday(data: any): Promise<any> {\n    try {\n      const [result] = await db\n        .insert(publicHolidays)\n        .values(data)\n        .returning();\n      return result;\n    } catch (error) {\n      console.error('Error creating public holiday:', error);\n      throw error;\n    }\n  }\n\n  // Employee Rate Methods\n  async getEmployeeRates(userId: number): Promise<any> {\n    try {\n      const [result] = await db\n        .select()\n        .from(employeeRates)\n        .where(eq(employeeRates.userId, userId))\n        .limit(1);\n      return result || null;\n    } catch (error) {\n      console.error('Error fetching employee rates:', error);\n      throw error;\n    }\n  }\n\n  async getEmployeeRatesByCompany(companyId: number): Promise<any[]> {\n    try {\n      return await db\n        .select({\n          id: employeeRates.id,\n          userId: employeeRates.userId,\n          weekdayRate: employeeRates.weekdayRate,\n          weeknightRate: employeeRates.weeknightRate,\n          saturdayRate: employeeRates.saturdayRate,\n          sundayRate: employeeRates.sundayRate,\n          publicHolidayRate: employeeRates.publicHolidayRate,\n          currency: employeeRates.currency,\n          validFrom: employeeRates.validFrom,\n          validTo: employeeRates.validTo,\n          userName: users.name,\n          userEmail: users.email\n        })\n        .from(employeeRates)\n        .leftJoin(users, eq(employeeRates.userId, users.id))\n        .where(eq(employeeRates.companyId, companyId))\n        .orderBy(users.name);\n    } catch (error) {\n      console.error('Error fetching company employee rates:', error);\n      throw error;\n    }\n  }\n\n  async createEmployeeRates(data: any): Promise<any> {\n    try {\n      const [result] = await db\n        .insert(employeeRates)\n        .values(data)\n        .returning();\n      return result;\n    } catch (error) {\n      console.error('Error creating employee rates:', error);\n      throw error;\n    }\n  }\n\n  async updateEmployeeRates(userId: number, data: any): Promise<any> {\n    try {\n      const [result] = await db\n        .update(employeeRates)\n        .set({\n          ...data,\n          updatedAt: new Date()\n        })\n        .where(eq(employeeRates.userId, userId))\n        .returning();\n      return result;\n    } catch (error) {\n      console.error('Error updating employee rates:', error);\n      throw error;\n    }\n  }\n\n  async deleteEmployeeRates(userId: number): Promise<boolean> {\n    try {\n      await db\n        .delete(employeeRates)\n        .where(eq(employeeRates.userId, userId));\n      return true;\n    } catch (error) {\n      console.error('Error deleting employee rates:', error);\n      throw error;\n    }\n  }\n}\n\nexport const storage = new DbStorage();\n","size_bytes":19445},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/header.tsx":{"content":"import { Menu, Bell, Clock } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { formatDateRange, getWeekDates } from \"@/lib/time-utils\";\n\ninterface HeaderProps {\n  title: string;\n  subtitle: string;\n  onMobileMenuToggle?: () => void;\n}\n\nexport function Header({ title, subtitle, onMobileMenuToggle }: HeaderProps) {\n  const currentWeek = getWeekDates(new Date());\n  const weekRange = formatDateRange(currentWeek.start, currentWeek.end);\n\n  return (\n    <header className=\"bg-white border-b border-slate-200 px-4 py-4 lg:px-8\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center space-x-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"lg:hidden\"\n            onClick={onMobileMenuToggle}\n          >\n            <Menu className=\"h-5 w-5\" />\n          </Button>\n          <div className=\"flex items-center space-x-3\">\n            <Clock className=\"w-10 h-10 text-blue-600\" />\n            <div>\n              <h2 className=\"text-2xl font-bold text-slate-900\">{title}</h2>\n              <p className=\"text-sm text-slate-500\">{subtitle}</p>\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"flex items-center space-x-4\">\n          <Button variant=\"ghost\" size=\"sm\" className=\"relative\">\n            <Bell className=\"h-5 w-5\" />\n            <span className=\"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full\"></span>\n          </Button>\n          <div className=\"hidden sm:block text-right\">\n            <p className=\"text-sm font-medium text-slate-900\">Current Week</p>\n            <p className=\"text-xs text-slate-500\">{weekRange}</p>\n          </div>\n        </div>\n      </div>\n    </header>\n  );\n}\n","size_bytes":1761},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/hooks/use-auth.ts":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { login, logout, getCurrentUser, type User } from \"@/lib/auth\";\n\nexport function useAuth() {\n  const { data: auth, isLoading, error } = useQuery({\n    queryKey: [\"/api/auth/me\"],\n    queryFn: getCurrentUser,\n    retry: (failureCount, error: any) => {\n      // Retry network errors but not auth errors\n      if (error?.message?.includes('401')) {\n        return false;\n      }\n      return failureCount < 3;\n    },\n    staleTime: 1000 * 60 * 10, // 10 minutes - longer cache for persistent sessions\n    gcTime: 1000 * 60 * 60, // 1 hour - extend garbage collection for mobile\n    refetchOnWindowFocus: true, // Check auth when app becomes active\n    refetchOnMount: true, // Always check auth on component mount\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: ({ email, name, rememberMe = false }: { email: string; name: string; rememberMe?: boolean }) => \n      login(email, name, rememberMe),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n    },\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: logout,\n    onSuccess: () => {\n      // Clear all data on logout for mobile security\n      queryClient.setQueryData([\"/api/auth/me\"], null);\n      queryClient.clear();\n      // Force page reload to clear any cached state\n      window.location.href = '/login';\n    },\n  });\n\n  return {\n    user: auth?.user,\n    isAuthenticated: !!auth?.user,\n    isLoading,\n    login: loginMutation.mutate,\n    logout: logoutMutation.mutate,\n    isLoggingIn: loginMutation.isPending,\n    isLoggingOut: logoutMutation.isPending,\n  };\n}\n","size_bytes":1705},"PRODUCT_REQUIREMENTS_DOCUMENT.md":{"content":"# ShiftMate - Product Requirements Document (PRD)\n\n**Version:** 1.0  \n**Date:** September 26, 2025  \n**Document Owner:** Product Team  \n**Status:** Active  \n\n---\n\n## Table of Contents\n\n1. [Executive Summary](#executive-summary)\n2. [Product Overview](#product-overview)\n3. [Business Goals & Objectives](#business-goals--objectives)\n4. [Target Users](#target-users)\n5. [User Stories & Use Cases](#user-stories--use-cases)\n6. [Functional Requirements](#functional-requirements)\n7. [Technical Requirements](#technical-requirements)\n8. [User Experience Requirements](#user-experience-requirements)\n9. [Security & Compliance](#security--compliance)\n10. [Success Metrics](#success-metrics)\n11. [Timeline & Milestones](#timeline--milestones)\n\n---\n\n## Executive Summary\n\nShiftMate is a comprehensive web-based shift management application designed for shift-based professionals and businesses to efficiently manage, track, and report on work schedules. The platform serves both individual users tracking their personal shifts and business administrators managing company-wide shift operations.\n\n### Key Value Propositions\n- **Real-time shift tracking** with persistent timer functionality\n- **Multi-tenant architecture** supporting both individual and business users\n- **Comprehensive analytics** with visual reporting and export capabilities\n- **Mobile-optimized interface** for on-the-go shift management\n- **Automated time calculations** with quarter-hour rounding\n\n---\n\n## Product Overview\n\n### Vision Statement\nTo become the leading shift management platform that empowers workers and businesses to optimize their time tracking, scheduling, and workforce analytics.\n\n### Mission Statement\nProvide an intuitive, reliable, and comprehensive solution for shift management that increases productivity, improves work-life balance, and enables data-driven workforce decisions.\n\n### Core Features\n1. **Individual Shift Management** - Personal shift tracking and analytics\n2. **Business Dashboard** - Company-wide shift oversight and employee management\n3. **Real-time Timer** - Background-persistent shift timing\n4. **Calendar Integration** - Visual schedule management\n5. **Reporting & Analytics** - Comprehensive data insights and export capabilities\n\n---\n\n## Business Goals & Objectives\n\n### Primary Goals\n- **Increase workforce productivity** by 25% through better shift tracking\n- **Reduce administrative overhead** by 40% through automation\n- **Improve schedule compliance** by 30% with real-time visibility\n- **Enable data-driven decisions** through comprehensive analytics\n\n### Secondary Goals\n- Achieve 95% user satisfaction rating\n- Support 10,000+ concurrent users\n- Maintain 99.9% uptime reliability\n- Expand to mobile native applications\n\n### Business Metrics\n- Monthly Active Users (MAU)\n- Average Session Duration\n- Feature Adoption Rate\n- Customer Retention Rate\n- Revenue per User (Business accounts)\n\n---\n\n## Target Users\n\n### Primary Users\n\n#### 1. Individual Shift Workers\n- **Demographics:** Age 18-55, various industries (retail, hospitality, healthcare, manufacturing)\n- **Pain Points:** Manual time tracking, missed shifts, poor schedule visibility\n- **Goals:** Accurate hour tracking, schedule management, earnings optimization\n\n#### 2. Business Managers/Administrators\n- **Demographics:** Small to medium business managers, HR departments\n- **Pain Points:** Manual schedule coordination, compliance tracking, labor cost management\n- **Goals:** Workforce optimization, cost control, compliance monitoring\n\n### Secondary Users\n\n#### 3. HR Personnel\n- **Needs:** Employee onboarding, compliance reporting, policy enforcement\n- **Use Cases:** Bulk user management, audit trails, system administration\n\n#### 4. Payroll Administrators\n- **Needs:** Accurate time data, export capabilities, integration with payroll systems\n- **Use Cases:** Payroll processing, overtime calculation, reporting\n\n---\n\n## User Stories & Use Cases\n\n### Epic 1: Individual Shift Management\n\n#### User Story 1.1: Manual Shift Entry\n**As a** shift worker  \n**I want to** manually enter my shift details (date, start time, end time, type)  \n**So that** I can track my work hours accurately\n\n**Acceptance Criteria:**\n- User can select date from calendar picker\n- User can input start and end times\n- User can select from predefined shift types (morning, evening, night, double, custom)\n- System validates time entries and prevents impossible combinations\n- User can add optional notes and location information\n\n#### User Story 1.2: Real-time Shift Timer\n**As a** shift worker  \n**I want to** start and stop a timer for my shift  \n**So that** I can track my hours automatically without manual entry\n\n**Acceptance Criteria:**\n- Timer persists across browser sessions and device sleep\n- Timer displays current duration in real-time\n- User can pause and resume timer\n- Timer automatically creates shift entry when stopped\n- System applies quarter-hour rounding rules\n\n#### User Story 1.3: Personal Analytics\n**As a** shift worker  \n**I want to** view my shift analytics and reports  \n**So that** I can understand my work patterns and earnings\n\n**Acceptance Criteria:**\n- Dashboard displays weekly hours with comparison to previous period\n- Charts show shift distribution by type and time\n- Export functionality for PDF and CSV formats\n- Historical data access for up to 12 months\n\n### Epic 2: Business Management\n\n#### User Story 2.1: Employee Oversight\n**As a** business manager  \n**I want to** view all employee shifts in a centralized dashboard  \n**So that** I can monitor workforce activity and compliance\n\n**Acceptance Criteria:**\n- Timeline view showing all employee shifts by date\n- Employee hours summary with totals and averages\n- Filter capabilities by employee, date range, and shift type\n- Real-time updates when employees clock in/out\n\n#### User Story 2.2: Team Management\n**As a** business manager  \n**I want to** manage my team members and their permissions  \n**So that** I can control access and maintain organizational structure\n\n**Acceptance Criteria:**\n- Add/remove employees from company account\n- Assign roles and permissions (employee, supervisor, admin)\n- View employee profiles and contact information\n- Track employee status (active/inactive)\n\n### Epic 3: Reporting & Analytics\n\n#### User Story 3.1: Comprehensive Reporting\n**As a** business user  \n**I want to** generate detailed reports on workforce metrics  \n**So that** I can make informed business decisions\n\n**Acceptance Criteria:**\n- Customizable date ranges for report generation\n- Multiple chart types (bar, line, pie) for data visualization\n- Export options in multiple formats (PDF, CSV, Excel)\n- Automated report scheduling and email delivery\n\n---\n\n## Functional Requirements\n\n### Core Functionality\n\n#### 1. Authentication & User Management\n- **FR-1.1:** Google OAuth 2.0 integration for secure login\n- **FR-1.2:** Session-based authentication with persistent sessions\n- **FR-1.3:** Multi-tenant user architecture (individual vs. business)\n- **FR-1.4:** User profile management with editable information\n- **FR-1.5:** Password-free authentication flow\n\n#### 2. Shift Management\n- **FR-2.1:** Manual shift entry with date, time, and type selection\n- **FR-2.2:** Real-time timer with background persistence\n- **FR-2.3:** Automatic quarter-hour rounding for time calculations\n- **FR-2.4:** Shift editing and deletion capabilities\n- **FR-2.5:** Bulk shift operations for business users\n- **FR-2.6:** Shift approval workflow for business accounts\n\n#### 3. Calendar & Scheduling\n- **FR-3.1:** Monthly calendar view with shift visualization\n- **FR-3.2:** Weekly timeline view with hourly time slots\n- **FR-3.3:** Color-coded shift types for easy identification\n- **FR-3.4:** Interactive day selection for shift management\n- **FR-3.5:** Recurring shift pattern support\n\n#### 4. Analytics & Reporting\n- **FR-4.1:** Real-time dashboard with key metrics\n- **FR-4.2:** Chart visualization using multiple chart types\n- **FR-4.3:** Customizable date ranges and filtering\n- **FR-4.4:** Export functionality (PDF, CSV formats)\n- **FR-4.5:** Comparative analytics (period-over-period)\n\n#### 5. Business Features\n- **FR-5.1:** Company-wide shift visibility and management\n- **FR-5.2:** Employee management and role assignment\n- **FR-5.3:** Shift approval and oversight workflows\n- **FR-5.4:** Bulk data operations and management tools\n- **FR-5.5:** Multi-employee analytics and reporting\n\n### Data Management\n\n#### 6. Data Storage & Integrity\n- **FR-6.1:** PostgreSQL database with ACID compliance\n- **FR-6.2:** Automated data backup and recovery\n- **FR-6.3:** Data retention policies and archiving\n- **FR-6.4:** Audit trails for all user actions\n- **FR-6.5:** Data validation and constraint enforcement\n\n---\n\n## Technical Requirements\n\n### System Architecture\n\n#### Frontend Requirements\n- **TR-1.1:** React 18+ with TypeScript for type safety\n- **TR-1.2:** Responsive design supporting mobile, tablet, and desktop\n- **TR-1.3:** Progressive Web App (PWA) capabilities\n- **TR-1.4:** Real-time updates using WebSocket connections\n- **TR-1.5:** Offline functionality for core features\n\n#### Backend Requirements\n- **TR-2.1:** Node.js with Express.js framework\n- **TR-2.2:** RESTful API architecture with JSON responses\n- **TR-2.3:** PostgreSQL database with connection pooling\n- **TR-2.4:** JWT-based authentication with refresh tokens\n- **TR-2.5:** Rate limiting and request throttling\n\n#### Performance Requirements\n- **TR-3.1:** Page load times under 2 seconds\n- **TR-3.2:** API response times under 500ms for 95% of requests\n- **TR-3.3:** Support for 1000+ concurrent users\n- **TR-3.4:** Database query optimization for large datasets\n- **TR-3.5:** CDN integration for static asset delivery\n\n#### Integration Requirements\n- **TR-4.1:** Google OAuth 2.0 for authentication\n- **TR-4.2:** Email notification service integration\n- **TR-4.3:** Export service for report generation\n- **TR-4.4:** WebSocket for real-time updates\n- **TR-4.5:** Future: Payroll system API integration\n\n### Development Stack\n\n#### Core Technologies\n- **Frontend:** React, TypeScript, Tailwind CSS, shadcn/ui\n- **Backend:** Node.js, Express.js, TypeScript\n- **Database:** PostgreSQL with Drizzle ORM\n- **Authentication:** Passport.js with Google OAuth\n- **State Management:** TanStack Query (React Query)\n- **Build Tools:** Vite, esbuild\n\n#### Development Tools\n- **Version Control:** Git with feature branch workflow\n- **Code Quality:** ESLint, Prettier, TypeScript strict mode\n- **Testing:** Jest, React Testing Library, Playwright E2E\n- **Deployment:** Replit with autoscale deployment\n- **Monitoring:** Application performance monitoring (APM)\n\n---\n\n## User Experience Requirements\n\n### Design Principles\n\n#### 1. Simplicity & Clarity\n- **UX-1.1:** Intuitive navigation with clear information hierarchy\n- **UX-1.2:** Minimal cognitive load with progressive disclosure\n- **UX-1.3:** Consistent visual language and interaction patterns\n- **UX-1.4:** Clear error messages and user feedback\n\n#### 2. Mobile-First Design\n- **UX-2.1:** Touch-friendly interface with 44px minimum touch targets\n- **UX-2.2:** Optimized form inputs to prevent mobile zoom\n- **UX-2.3:** Thumb-friendly navigation placement\n- **UX-2.4:** Adaptive layouts for various screen sizes\n\n#### 3. Accessibility\n- **UX-3.1:** WCAG 2.1 AA compliance\n- **UX-3.2:** Keyboard navigation support\n- **UX-3.3:** Screen reader compatibility\n- **UX-3.4:** High contrast mode support\n- **UX-3.5:** Alternative text for all images and icons\n\n#### 4. Performance & Responsiveness\n- **UX-4.1:** Skeleton loading states for data fetching\n- **UX-4.2:** Optimistic UI updates for user actions\n- **UX-4.3:** Smooth animations and transitions\n- **UX-4.4:** Progressive loading for large datasets\n\n### Interface Requirements\n\n#### Navigation & Layout\n- **UX-5.1:** Persistent navigation with clear current location\n- **UX-5.2:** Breadcrumb navigation for deep pages\n- **UX-5.3:** Quick action buttons for common tasks\n- **UX-5.4:** Contextual menus and shortcuts\n\n#### Data Presentation\n- **UX-6.1:** Scannable tables with sorting and filtering\n- **UX-6.2:** Interactive charts with hover details\n- **UX-6.3:** Clear visual hierarchy for data importance\n- **UX-6.4:** Customizable view options (list, grid, timeline)\n\n---\n\n## Security & Compliance\n\n### Security Requirements\n\n#### 1. Authentication & Authorization\n- **SEC-1.1:** Multi-factor authentication support\n- **SEC-1.2:** Role-based access control (RBAC)\n- **SEC-1.3:** Session management with timeout\n- **SEC-1.4:** JWT token rotation and validation\n- **SEC-1.5:** OAuth 2.0 secure implementation\n\n#### 2. Data Protection\n- **SEC-2.1:** Data encryption at rest and in transit\n- **SEC-2.2:** PII data handling and protection\n- **SEC-2.3:** Secure API endpoints with rate limiting\n- **SEC-2.4:** Input validation and sanitization\n- **SEC-2.5:** SQL injection prevention\n\n#### 3. Privacy & Compliance\n- **SEC-3.1:** GDPR compliance for EU users\n- **SEC-3.2:** CCPA compliance for California users\n- **SEC-3.3:** Data retention and deletion policies\n- **SEC-3.4:** User consent management\n- **SEC-3.5:** Privacy policy and terms of service\n\n#### 4. System Security\n- **SEC-4.1:** Regular security audits and penetration testing\n- **SEC-4.2:** Dependency vulnerability scanning\n- **SEC-4.3:** Secure deployment and infrastructure\n- **SEC-4.4:** Backup and disaster recovery procedures\n- **SEC-4.5:** Incident response plan\n\n---\n\n## Success Metrics\n\n### Key Performance Indicators (KPIs)\n\n#### User Engagement\n- **Daily Active Users (DAU):** Target 1,000+ daily users\n- **Monthly Active Users (MAU):** Target 5,000+ monthly users\n- **Session Duration:** Average 15+ minutes per session\n- **Feature Adoption:** 80%+ of users using core features\n- **User Retention:** 70%+ 30-day retention rate\n\n#### Business Metrics\n- **Customer Acquisition Cost (CAC):** Target under $50\n- **Customer Lifetime Value (CLV):** Target $500+\n- **Monthly Recurring Revenue (MRR):** Growth target 20% month-over-month\n- **Churn Rate:** Target under 5% monthly\n- **Net Promoter Score (NPS):** Target 50+\n\n#### Technical Performance\n- **System Uptime:** 99.9% availability\n- **Page Load Speed:** Under 2 seconds average\n- **API Response Time:** Under 500ms for 95% of requests\n- **Error Rate:** Under 1% of all requests\n- **Security Incidents:** Zero critical security breaches\n\n#### Product Quality\n- **User Satisfaction:** 4.5+ star rating\n- **Support Ticket Volume:** Decrease 20% quarter-over-quarter\n- **Bug Reports:** Under 10 critical bugs per release\n- **Feature Completion Rate:** 90%+ of planned features delivered\n- **Code Coverage:** 80%+ test coverage\n\n---\n\n## Timeline & Milestones\n\n### Phase 1: Foundation (Completed)\n**Timeline:** June - August 2025  \n**Status:**  Completed\n\n#### Deliverables\n-  Core authentication system with Google OAuth\n-  Basic shift entry and tracking functionality\n-  Individual user dashboard and analytics\n-  PostgreSQL database setup with Drizzle ORM\n-  Responsive UI with shadcn/ui components\n\n### Phase 2: Business Features (Completed)\n**Timeline:** August - September 2025  \n**Status:**  Completed\n\n#### Deliverables\n-  Multi-tenant architecture implementation\n-  Business dashboard with company oversight\n-  Employee management and role assignment\n-  Advanced analytics and reporting features\n-  JWT authentication system\n\n### Phase 3: Enhancement & Optimization (Current)\n**Timeline:** September - October 2025  \n**Status:**  In Progress\n\n#### Deliverables\n-  Performance optimization and bug fixes\n-  Comprehensive testing suite (E2E, unit, integration)\n-  Advanced reporting and export features\n-  Mobile app optimization\n-  Security audit and compliance review\n\n### Phase 4: Scale & Expansion (Planned)\n**Timeline:** November 2025 - January 2026  \n**Status:**  Planned\n\n#### Deliverables\n-  Native mobile applications (iOS, Android)\n-  Advanced scheduling and forecasting\n-  Third-party integrations (payroll systems)\n-  Enterprise features and compliance\n-  API marketplace and developer tools\n\n### Phase 5: Advanced Features (Future)\n**Timeline:** Q1 2026+  \n**Status:**  Conceptual\n\n#### Potential Features\n-  AI-powered shift optimization\n-  Predictive analytics and workforce forecasting\n-  Advanced compliance and reporting tools\n-  Integration marketplace\n-  White-label solutions for enterprises\n\n---\n\n## Appendices\n\n### Appendix A: Glossary\n\n**Shift:** A defined work period with start time, end time, and type designation  \n**Business User:** An administrator account managing multiple employees  \n**Individual User:** A single worker tracking personal shifts  \n**Quarter-hour Rounding:** Automatic time adjustment to nearest 15-minute increment  \n**Real-time Timer:** Background-persistent timing functionality  \n**Multi-tenant:** Architecture supporting multiple isolated user organizations  \n\n### Appendix B: Technical Architecture Diagram\n\n```\n        \n   Frontend              Backend             Database      \n   (React)          (Express)       (PostgreSQL)   \n                                                           \n  React Query         JWT Auth            Drizzle ORM   \n  Tailwind CSS        Session Mgmt        Connection    \n  shadcn/ui           Rate Limiting        Pooling       \n        \n                                                       \n                                    \n           External APIs  \n                                         \n                          Google OAuth  \n                          Email Service \n                          Export APIs   \n                        \n```\n\n### Appendix C: Change Log\n\n**Version 1.0** (September 26, 2025)\n- Initial PRD creation\n- Comprehensive requirements documentation\n- Technical architecture specification\n- Success metrics definition\n\n---\n\n**Document Status:** Active  \n**Next Review Date:** December 26, 2025  \n**Stakeholder Approval Required:** Product Manager, Engineering Lead, Business Owner\n\n---\n\n*This document serves as the authoritative source for ShiftMate product requirements and will be updated as the product evolves.*","size_bytes":18947},"client/src/pages/add-shift.tsx":{"content":"import { ShiftForm } from \"@/components/shift-form\";\nimport { useLocation, useSearch } from \"wouter\";\nimport { useShifts } from \"@/hooks/use-shifts\";\n\nexport default function AddShift() {\n  const [, setLocation] = useLocation();\n  const search = useSearch();\n  \n  // Check if we're editing an existing shift\n  const editId = new URLSearchParams(search).get('edit');\n  const { data: shifts } = useShifts();\n  const shiftToEdit = editId ? shifts?.find(shift => shift.id === parseInt(editId)) : undefined;\n\n  const handleSuccess = () => {\n    setLocation(\"/dashboard\");\n  };\n\n  return (\n    <div className=\"p-4 lg:p-8\">\n      <div className=\"max-w-2xl mx-auto\">\n        <ShiftForm \n          onSuccess={handleSuccess} \n          editingShift={shiftToEdit}\n          isEditing={!!shiftToEdit}\n        />\n      </div>\n    </div>\n  );\n}\n","size_bytes":831},"replit.md":{"content":"# ShiftMate - Shift Management Application\n\n## Overview\n\nShiftMate is a comprehensive web application designed for shift-based professionals to manage, track, and report on their work shifts. The application provides an intuitive interface for adding shifts, viewing calendar schedules, generating reports, and real-time shift timing capabilities.\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: React 18 with TypeScript\n- **Build Tool**: Vite for fast development and optimized production builds\n- **UI Library**: shadcn/ui components built on Radix UI primitives\n- **Styling**: Tailwind CSS with mobile-first responsive design\n- **State Management**: TanStack Query (React Query) for server state management\n- **Routing**: Wouter for lightweight client-side routing\n- **Form Handling**: React Hook Form with Zod schema validation\n\n### Backend Architecture\n- **Runtime**: Node.js with Express.js server\n- **Language**: TypeScript with ES modules\n- **Session Management**: Express sessions with PostgreSQL storage\n- **Authentication**: Passport.js with Google OAuth 2.0 strategy\n- **API Design**: RESTful endpoints with JSON responses\n\n### Database Layer\n- **Database**: PostgreSQL 16\n- **ORM**: Drizzle ORM with type-safe queries\n- **Connection**: Node.js pg driver with connection pooling\n- **Schema Management**: Drizzle Kit for migrations and schema management\n\n## Key Components\n\n### Authentication System\n- **Dual Authentication**: Google OAuth 2.0 + JWT token-based authentication\n- **Access Tokens**: 15-minute expiry, stored in localStorage + memory\n- **Refresh Tokens**: 30-day expiry, stored as httpOnly + secure cookies\n- **Token Security**: SHA-256 hashing for database storage, no plaintext tokens\n- **Auto-refresh**: Transparent token refresh on 401 errors with request retry\n- **Session Management**: Legacy session-based auth maintained for backward compatibility\n- **User Profile**: Automatic account creation via Google OAuth\n- **Required Environment Variables**: JWT_SECRET (enforced, no fallback allowed)\n\n### Shift Management\n- Manual shift entry with date, time, and type selection\n- Real-time shift timer with background persistence\n- Automatic quarter-hour rounding for time tracking\n- Support for multiple shift types (morning, evening, night, double, custom)\n- Recurring shift patterns (daily, weekly, custom)\n\n### Calendar System\n- Monthly calendar view with shift visualization\n- Color-coded shift types for easy identification\n- Interactive day selection for shift management\n- Responsive grid layout optimized for mobile devices\n\n### Reporting & Analytics\n- Weekly hours tracking with comparison to previous periods\n- Export functionality (PDF and CSV formats)\n- Chart visualization using Recharts library\n- Customizable date ranges and filtering options\n\n### Roster Management (Business Accounts)\n- Visual weekly calendar interface for shift assignment\n- Employee vs. days grid layout for easy shift planning\n- Manager-level access controls for roster modification\n- Real-time CRUD operations for shift assignments\n- Modal-based shift creation and editing with form validation\n- Support for location-based shift assignments\n- Week-by-week navigation for roster planning\n\n### Mobile Optimization\n- Touch-friendly interface with 44px minimum touch targets\n- Mobile-first responsive design\n- Background timer persistence using localStorage\n- Optimized form inputs to prevent mobile zoom\n\n## Data Flow\n\n### User Authentication Flow\n1. User initiates login via Google OAuth\n2. Passport.js handles OAuth callback and user verification\n3. User profile created or retrieved from database\n4. Session established with PostgreSQL session store\n5. Frontend receives authentication state via React Query\n\n### Shift Management Flow\n1. User creates shift via form or timer interface\n2. Client validates data using Zod schemas\n3. API endpoint processes shift creation with user context\n4. Database insertion via Drizzle ORM\n5. React Query cache invalidation triggers UI updates\n6. Real-time updates across all relevant components\n\n### Timer Functionality\n1. Timer state persisted in localStorage for reliability\n2. Background execution continues when app is backgrounded\n3. Automatic shift creation when timer is stopped\n4. Quarter-hour rounding applied to final duration\n\n## External Dependencies\n\n### Production Dependencies\n- **UI Components**: Radix UI primitives for accessible components\n- **Charts**: Recharts for data visualization\n- **Date Handling**: date-fns for date manipulation\n- **HTTP Client**: Fetch API with custom wrapper for type safety\n- **Database**: @neondatabase/serverless for PostgreSQL connection\n- **Authentication**: Passport.js with Google OAuth strategy\n\n### Development Dependencies\n- **Build Tools**: Vite, esbuild for production builds\n- **Type Checking**: TypeScript with strict configuration\n- **Code Quality**: ESLint and Prettier (implied)\n- **Development Server**: Hot module replacement via Vite\n\n## Deployment Strategy\n\n### Build Process\n- Frontend built with Vite to static assets in `dist/public`\n- Backend bundled with esbuild for Node.js production\n- Single production build command: `npm run build`\n\n### Environment Configuration\n- Development: `npm run dev` with hot reloading\n- Production: `npm run start` with optimized builds\n- Database: Environment variable-based PostgreSQL connection\n- Sessions: Configurable secret key for production security\n\n### Platform Compatibility\n- Deployed on Replit with autoscale deployment target\n- PostgreSQL 16 module integration\n- **Port Configuration**: Single-port architecture on port 5000\n- Environment-specific build optimization\n\n### Port Configuration Details\n\n**Architecture**: ShiftMate uses a unified single-port architecture where both the frontend and backend run on the same port.\n\n**Current Setup**:\n- **Internal Port**: 5000 (application listens here)\n- **External Port**: Should map to 80 for standard web access\n- **Technology**: Vite dev server integrated into Express via middleware (not running separately)\n\n**How It Works**:\n1. Express server starts on port 5000\n2. In development mode, Vite middleware is integrated into Express\n3. All frontend and backend traffic flows through port 5000\n4. No separate Vite server on port 5173 - it's embedded in Express\n\n**Important Notes**:\n- The application does NOT run on port 3000\n- Port 5173 is not used in production (Vite middleware mode)\n- For proper external access, `.replit` should map `localPort = 5000` to `externalPort = 80`\n- This single-port design simplifies deployment and avoids CORS issues\n\n**Correct `.replit` Port Mapping** (manual update required):\n```toml\n[[ports]]\nlocalPort = 5000\nexternalPort = 80\n```\n\n**Why This Matters**:\n- `localPort = 5000`: Matches where the app actually listens\n- `externalPort = 80`: Standard HTTP port for web traffic (no port number in URL)\n- Ensures traffic is routed correctly to the application\n\n## Documentation\n\n### Product Requirements Document (PRD)\n- **PRODUCT_REQUIREMENTS_DOCUMENT.md**: Comprehensive PRD covering all product requirements, user stories, technical specifications, and success metrics for ShiftMate\n\n## Changelog\n- October 29, 2025. SECURITY: Implemented JWT authentication system with dual-token architecture (access + refresh tokens), SHA-256 token hashing, httpOnly cookies, and enforced JWT_SECRET requirement (removed hardcoded fallback for security)\n- October 29, 2025. FEATURE: Added automatic token refresh on 401 errors with request retry in frontend queryClient\n- October 29, 2025. DATABASE: Added refreshTokens table with tokenHash, expiresAt, and revokedAt fields for secure token management\n- October 29, 2025. DOCUMENTATION: Created AUTH_TESTING.md with comprehensive JWT authentication testing guide and security best practices\n- October 29, 2025. DOCUMENTATION: Added comprehensive port configuration documentation explaining single-port architecture (port 5000) and correct .replit mapping requirements\n- October 29, 2025. INFRASTRUCTURE: Fixed critical server startup issues - removed keepalive .unref(), created dirname-shim.mjs for ES module __dirname support, corrected server/package.json configuration\n- September 26, 2025. FEATURE: Implemented comprehensive roster planning functionality for business accounts including visual weekly grid interface, manager shift assignments, modal-based CRUD operations, and real-time roster management with full API backend support\n- September 26, 2025. DOCUMENTATION: Created comprehensive Product Requirements Document (PRD) with user stories, technical requirements, and success metrics\n- September 26, 2025. BUGFIX: Fixed Daily Summary Table in business dashboard to properly display employee hours by handling undefined values\n- August 12, 2025. MAJOR FIX: Resolved critical JWT authentication issue preventing shift data access across all dashboards\n- August 12, 2025. Updated all data hooks (individual and business) to use JWT-enabled apiRequest instead of basic fetch\n- August 12, 2025. Individual users can now access all 47+ shifts with proper authentication and analytics\n- August 12, 2025. Business dashboard now displays 105+ company shifts from 4 employees with real-time data\n- August 11, 2025. Fixed critical multi-tenant data integrity issue: Individual user shifts now automatically associate with their company, enabling real-time visibility in business dashboards\n- August 11, 2025. Resolved routing 404 errors for both business and individual users with proper wildcard catch-all routes\n- August 11, 2025. Updated 10 historical shifts to have proper company association, restoring business timeline data integrity\n- August 8, 2025. Implementing multi-tenant architecture with separate user and business portals similar to Deputy-style interface\n- August 8, 2025. Updated database schema to support companies table, user types, and business management features\n- August 8, 2025. Changed \"This Week's Hours\" to display last 7 days (rolling period) instead of Monday-Sunday week\n- August 8, 2025. Created landing page for portal selection between individual users and business accounts\n- July 11, 2025. Redesigned Calendar to Google Calendar-style weekly view with hourly time slots (6 AM - 11 PM)\n- July 11, 2025. Integrated ShiftMate logo throughout the application (header, sidebar, mobile sidebar, and login page)\n- July 11, 2025. Fixed chart display issues with minPointSize, Y-axis domain, and proper shift type mapping\n- June 28, 2025. Implemented persistent authentication with 1-year session duration and cross-device support\n- June 13, 2025. Initial setup\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.","size_bytes":10683},"client/src/hooks/use-timer.ts":{"content":"import { useState, useEffect, useCallback } from 'react';\n\ninterface TimerState {\n  isActive: boolean;\n  startTime: Date | null;\n  elapsedTime: number;\n}\n\nconst STORAGE_KEY = 'shiftTimer';\n\nexport function useTimer() {\n  const [isActive, setIsActive] = useState(false);\n  const [startTime, setStartTime] = useState<Date | null>(null);\n  const [elapsedTime, setElapsedTime] = useState(0);\n\n  // Load timer state from localStorage on mount\n  useEffect(() => {\n    const savedTimerState = localStorage.getItem(STORAGE_KEY);\n    if (savedTimerState) {\n      try {\n        const { isActive: savedIsActive, startTime: savedStartTime } = JSON.parse(savedTimerState);\n        if (savedIsActive && savedStartTime) {\n          const savedStart = new Date(savedStartTime);\n          setIsActive(true);\n          setStartTime(savedStart);\n          \n          // Calculate elapsed time since the saved start time\n          const now = new Date();\n          const elapsed = Math.floor((now.getTime() - savedStart.getTime()) / 1000);\n          setElapsedTime(elapsed);\n        }\n      } catch (error) {\n        console.error('Failed to load timer state:', error);\n        localStorage.removeItem(STORAGE_KEY);\n      }\n    }\n  }, []);\n\n  // Timer update effect - runs continuously when active\n  useEffect(() => {\n    let interval: NodeJS.Timeout;\n    \n    if (isActive && startTime) {\n      interval = setInterval(() => {\n        const now = new Date();\n        const elapsed = Math.floor((now.getTime() - startTime.getTime()) / 1000);\n        setElapsedTime(elapsed);\n        \n        // Update localStorage periodically\n        localStorage.setItem(STORAGE_KEY, JSON.stringify({\n          isActive: true,\n          startTime: startTime.toISOString()\n        }));\n      }, 1000);\n    }\n    \n    return () => {\n      if (interval) {\n        clearInterval(interval);\n      }\n    };\n  }, [isActive, startTime]);\n\n  const startTimer = useCallback(() => {\n    const now = new Date();\n    setStartTime(now);\n    setIsActive(true);\n    setElapsedTime(0);\n    \n    // Save timer state to localStorage\n    localStorage.setItem(STORAGE_KEY, JSON.stringify({\n      isActive: true,\n      startTime: now.toISOString()\n    }));\n  }, []);\n\n  const stopTimer = useCallback(() => {\n    setIsActive(false);\n    setStartTime(null);\n    setElapsedTime(0);\n    \n    // Clear timer state from localStorage\n    localStorage.removeItem(STORAGE_KEY);\n  }, []);\n\n  const formatElapsedTime = useCallback((seconds: number) => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n    \n    if (hours > 0) {\n      return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n    } else {\n      return `${minutes}:${secs.toString().padStart(2, '0')}`;\n    }\n  }, []);\n\n  return {\n    isActive,\n    startTime,\n    elapsedTime,\n    startTimer,\n    stopTimer,\n    formatElapsedTime\n  };\n}","size_bytes":2953},"client/src/pages/admin.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Database } from \"lucide-react\";\n\nexport default function Admin() {\n  return (\n    <div className=\"p-4 lg:p-8 space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold text-slate-900\">Database Management</h1>\n        <p className=\"text-slate-600\">View database schema and execute SQL queries</p>\n      </div>\n\n      <div className=\"grid grid-cols-1 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Database className=\"h-5 w-5\" />\n              Database Schema\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div>\n                <h4 className=\"font-semibold text-slate-900 mb-2\">shiftmate_users</h4>\n                <div className=\"bg-slate-50 p-3 rounded-lg text-sm font-mono\">\n                  id (serial, primary key)<br/>\n                  email (text, unique, not null)<br/>\n                  name (text, not null)<br/>\n                  created_at (timestamp, default now)\n                </div>\n              </div>\n              \n              <div>\n                <h4 className=\"font-semibold text-slate-900 mb-2\">shiftmate_shifts</h4>\n                <div className=\"bg-slate-50 p-3 rounded-lg text-sm font-mono\">\n                  id (serial, primary key)<br/>\n                  user_id (integer, references users.id)<br/>\n                  date (date, not null)<br/>\n                  start_time (time, not null)<br/>\n                  end_time (time, not null)<br/>\n                  shift_type (text, not null)<br/>\n                  notes (text)<br/>\n                  is_recurring (boolean, default false)<br/>\n                  recurring_pattern (text)<br/>\n                  recurring_end_date (date)<br/>\n                  created_at (timestamp, default now)\n                </div>\n              </div>\n              \n              <div>\n                <h4 className=\"font-semibold text-slate-900 mb-2\">shiftmate_notifications</h4>\n                <div className=\"bg-slate-50 p-3 rounded-lg text-sm font-mono\">\n                  id (serial, primary key)<br/>\n                  user_id (integer, references users.id)<br/>\n                  type (text, not null)<br/>\n                  message (text, not null)<br/>\n                  is_read (boolean, default false)<br/>\n                  created_at (timestamp, default now)\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Database Management Commands</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              <div className=\"bg-slate-50 p-3 rounded-lg\">\n                <h5 className=\"font-medium text-slate-900 mb-1\">Push Schema Changes</h5>\n                <code className=\"text-sm text-slate-600\">npm run db:push</code>\n                <p className=\"text-xs text-slate-500 mt-1\">Applies schema changes to the database</p>\n              </div>\n              \n              <div className=\"bg-slate-50 p-3 rounded-lg\">\n                <h5 className=\"font-medium text-slate-900 mb-1\">SQL Queries</h5>\n                <p className=\"text-sm text-slate-600\">Use the SQL execution tool to run direct queries</p>\n                <p className=\"text-xs text-slate-500 mt-1\">Access database tables and perform operations</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":3623},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"server/src/routes/index.ts":{"content":"import { Router } from \"express\";\nimport health from \"./health\";\nconst router = Router();\nrouter.use(\"/health\", health);\nexport default router;\n","size_bytes":144},"client/src/App.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Switch, Route, Link, useLocation } from \"wouter\";\nimport { queryClient, setAccessToken } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Sidebar } from \"@/components/sidebar\";\nimport { Header } from \"@/components/header\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Clock, User, X } from \"lucide-react\";\n\n// Pages\nimport Dashboard from \"@/pages/dashboard\";\nimport Calendar from \"@/pages/calendar\";\nimport MyRoster from \"@/pages/my-roster\";\nimport AddShift from \"@/pages/add-shift\";\nimport Shifts from \"@/pages/shifts\";\nimport Reports from \"@/pages/reports\";\nimport Login from \"@/pages/login\";\nimport Admin from \"@/pages/admin\";\nimport NotFound from \"@/pages/not-found\";\nimport Landing from \"@/pages/landing\";\nimport BusinessDashboard from \"@/pages/business-dashboard\";\n\nconst PAGE_TITLES = {\n  \"/\": { title: \"Dashboard\", subtitle: \"Welcome back! Here's your business overview.\" },\n  \"/dashboard\": { title: \"Dashboard\", subtitle: \"Welcome back! Here's your business overview.\" },\n  \"/business-dashboard\": { title: \"Dashboard\", subtitle: \"Welcome back! Here's your business overview.\" },\n  \"/calendar\": { title: \"Calendar\", subtitle: \"View and manage your shifts on the calendar.\" },\n  \"/my-roster\": { title: \"My Roster\", subtitle: \"View your assigned shifts in mobile-optimized agenda format.\" },\n  \"/add-shift\": { title: \"Add Shift\", subtitle: \"Log a new work shift.\" },\n  \"/shifts\": { title: \"All Shifts\", subtitle: \"View, edit, and manage your shift history.\" },\n  \"/reports\": { title: \"Reports\", subtitle: \"Generate and download shift reports.\" },\n};\n\nfunction MobileSidebar({ onClose }: { onClose: () => void }) {\n  const [location] = useLocation();\n  const { user, logout } = useAuth();\n\n  const navItems = [\n    { path: \"/\", label: \"Dashboard\", icon: \"BarChart3\" },\n    { path: \"/calendar\", label: \"Calendar\", icon: \"Calendar\" },\n    { path: \"/my-roster\", label: \"My Roster\", icon: \"CalendarDays\" },\n    { path: \"/add-shift\", label: \"Add Shift\", icon: \"Plus\" },\n    { path: \"/reports\", label: \"Reports\", icon: \"FileText\" },\n  ];\n\n  const handleNavClick = () => {\n    onClose();\n  };\n\n  return (\n    <div className=\"flex flex-col h-full\">\n      <div className=\"p-6 border-b border-slate-200\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-3\">\n            <Clock className=\"w-8 h-8 text-blue-600\" />\n            <h1 className=\"text-xl font-bold text-slate-900\">ShiftMate</h1>\n          </div>\n          <button \n            onClick={onClose}\n            className=\"p-2 hover:bg-slate-100 rounded-lg\"\n          >\n            <X className=\"h-5 w-5\" />\n          </button>\n        </div>\n      </div>\n      \n      <nav className=\"flex-1 px-6 py-6\">\n        <ul className=\"space-y-2\">\n          {navItems.map((item) => {\n            const isActive = location === item.path;\n            \n            return (\n              <li key={item.path}>\n                <Link href={item.path}>\n                  <button\n                    onClick={handleNavClick}\n                    className={`w-full flex items-center space-x-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors text-left ${\n                      isActive\n                        ? \"bg-primary/10 text-primary border border-primary/20\"\n                        : \"text-slate-600 hover:bg-slate-50 hover:text-slate-900\"\n                    }`}\n                  >\n                    <span className=\"text-lg\">{getIconForNavItem(item.icon)}</span>\n                    <span>{item.label}</span>\n                  </button>\n                </Link>\n              </li>\n            );\n          })}\n        </ul>\n      </nav>\n\n      <div className=\"p-6 border-t border-slate-200\">\n        {user && (\n          <div className=\"mb-4\">\n            <div className=\"flex items-center space-x-3 mb-3\">\n              <div className=\"w-8 h-8 bg-slate-200 rounded-full flex items-center justify-center\">\n                <User className=\"h-4 w-4 text-slate-600\" />\n              </div>\n              <div>\n                <p className=\"text-sm font-medium text-slate-900\">{user.name}</p>\n                <p className=\"text-xs text-slate-500\">{user.email}</p>\n              </div>\n            </div>\n            <button\n              onClick={() => {\n                logout();\n                onClose();\n              }}\n              className=\"w-full px-3 py-2 text-sm text-slate-600 hover:text-slate-900 hover:bg-slate-50 rounded-lg transition-colors text-left\"\n            >\n              Sign out\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction getIconForNavItem(iconName: string) {\n  const icons: Record<string, string> = {\n    BarChart3: \"\",\n    Calendar: \"\",\n    CalendarDays: \"\",\n    Plus: \"\",\n    FileText: \"\"\n  };\n  return icons[iconName] || \"\";\n}\n\nfunction AppLayout({ children, location }: { children: React.ReactNode; location: string }) {\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\n  const pageInfo = PAGE_TITLES[location as keyof typeof PAGE_TITLES] || { \n    title: \"ShiftMate\", \n    subtitle: \"Manage your work shifts\" \n  };\n\n  const toggleMobileMenu = () => {\n    setIsMobileMenuOpen(!isMobileMenuOpen);\n  };\n\n  const closeMobileMenu = () => {\n    setIsMobileMenuOpen(false);\n  };\n\n  return (\n    <div className=\"min-h-screen flex bg-slate-50\">\n      <Sidebar />\n      \n      {/* Mobile Menu Overlay */}\n      {isMobileMenuOpen && (\n        <div \n          className=\"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden\"\n          onClick={closeMobileMenu}\n        />\n      )}\n      \n      {/* Mobile Sidebar */}\n      <div className={`fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform transition-transform duration-300 ease-in-out lg:hidden ${\n        isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full'\n      }`}>\n        <MobileSidebar onClose={closeMobileMenu} />\n      </div>\n      \n      <main className=\"flex-1 flex flex-col overflow-hidden\">\n        <Header \n          title={pageInfo.title}\n          subtitle={pageInfo.subtitle}\n          onMobileMenuToggle={toggleMobileMenu}\n        />\n        <div className=\"flex-1 overflow-auto\">\n          {children}\n        </div>\n      </main>\n    </div>\n  );\n}\n\nfunction AuthenticatedApp() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Dashboard} />\n      <Route path=\"/dashboard\" component={Dashboard} />\n      <Route path=\"/calendar\" component={Calendar} />\n      <Route path=\"/add-shift\" component={AddShift} />\n      <Route path=\"/reports\" component={Reports} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction Router() {\n  const { isAuthenticated, isLoading, user } = useAuth();\n  const [location] = useLocation();\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-slate-50\">\n        <div className=\"space-y-4 w-full max-w-md\">\n          <Skeleton className=\"h-12 w-12 rounded-lg mx-auto\" />\n          <Skeleton className=\"h-4 w-32 mx-auto\" />\n          <Skeleton className=\"h-3 w-48 mx-auto\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return (\n      <Switch>\n        <Route path=\"/login\" component={Login} />\n        <Route path=\"/landing\" component={Landing} />\n        <Route component={Landing} />\n      </Switch>\n    );\n  }\n\n  // Determine which interface to show based on user type\n  const userType = (user as any)?.userType || 'individual';\n  const isBusinessUser = userType === 'business';\n\n  if (isBusinessUser) {\n    return (\n      <Switch>\n        <Route path=\"/\" component={() => <AppLayout location=\"/\"><BusinessDashboard /></AppLayout>} />\n        <Route path=\"/dashboard\" component={() => <AppLayout location=\"/dashboard\"><BusinessDashboard /></AppLayout>} />\n        <Route path=\"/business-dashboard\" component={() => <AppLayout location=\"/business-dashboard\"><BusinessDashboard /></AppLayout>} />\n        <Route path=\"/billing\" component={() => <AppLayout location=\"/billing\"><BusinessDashboard defaultTab=\"billing\" /></AppLayout>} />\n        <Route path=\"/calendar\" component={() => <AppLayout location=\"/calendar\"><BusinessDashboard /></AppLayout>} />\n        <Route path=\"/reports\" component={() => <AppLayout location=\"/reports\"><Reports /></AppLayout>} />\n        <Route path=\"*\" component={() => <AppLayout location=\"/\"><BusinessDashboard /></AppLayout>} />\n      </Switch>\n    );\n  }\n\n  return (\n    <Switch>\n      <Route path=\"/\" component={() => <AppLayout location=\"/\"><Dashboard /></AppLayout>} />\n      <Route path=\"/dashboard\" component={() => <AppLayout location=\"/dashboard\"><Dashboard /></AppLayout>} />\n      <Route path=\"/calendar\" component={() => <AppLayout location=\"/calendar\"><Calendar /></AppLayout>} />\n      <Route path=\"/my-roster\" component={() => <AppLayout location=\"/my-roster\"><MyRoster /></AppLayout>} />\n      <Route path=\"/add-shift\" component={() => <AppLayout location=\"/add-shift\"><AddShift /></AppLayout>} />\n      <Route path=\"/shifts\" component={() => <AppLayout location=\"/shifts\"><Shifts /></AppLayout>} />\n      <Route path=\"/reports\" component={() => <AppLayout location=\"/reports\"><Reports /></AppLayout>} />\n      <Route path=\"*\" component={() => <AppLayout location=\"/\"><Dashboard /></AppLayout>} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  useEffect(() => {\n    // Extract token from URL after Google OAuth callback\n    const urlParams = new URLSearchParams(window.location.search);\n    const token = urlParams.get('token');\n    \n    if (token) {\n      // Store the access token\n      setAccessToken(token);\n      \n      // Remove token from URL without page reload\n      const newUrl = window.location.pathname;\n      window.history.replaceState({}, '', newUrl);\n      \n      // Invalidate auth query to trigger refresh with new token\n      queryClient.invalidateQueries({ queryKey: ['/api/auth/me'] });\n    }\n  }, []);\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <Router />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":10385},"client/src/pages/login-new.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Link, useLocation } from \"wouter\";\nimport { FcGoogle } from \"react-icons/fc\";\nimport { Clock } from \"lucide-react\";\n\nexport default function LoginNew() {\n  const [email, setEmail] = useState(\"\");\n  const [name, setName] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const { toast } = useToast();\n  const [, navigate] = useLocation();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!email || !name) {\n      toast({\n        title: \"Error\",\n        description: \"Please fill in all fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      const response = await fetch(\"/api/auth/login\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ email, name }),\n        credentials: \"include\",\n      });\n\n      const data = await response.json();\n\n      if (response.ok) {\n        toast({\n          title: \"Success\",\n          description: \"Logged in successfully!\",\n        });\n        navigate(\"/\");\n      } else {\n        if (response.status === 401) {\n          toast({\n            title: \"Account Not Found\",\n            description: \"No account found with this email. Please sign up first.\",\n            variant: \"destructive\",\n          });\n        } else {\n          toast({\n            title: \"Error\",\n            description: data.message || \"Login failed\",\n            variant: \"destructive\",\n          });\n        }\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Network error. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleGoogleLogin = () => {\n    window.location.href = \"/api/auth/google?intent=login\";\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 px-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"space-y-1 text-center\">\n          <div className=\"mx-auto w-12 h-12 bg-primary rounded-lg flex items-center justify-center mb-4\">\n            <Clock className=\"h-6 w-6 text-primary-foreground\" />\n          </div>\n          <CardTitle className=\"text-2xl font-bold\">Welcome Back</CardTitle>\n          <CardDescription>\n            Sign in to your ShiftMate account\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <Button\n            variant=\"outline\"\n            className=\"w-full\"\n            onClick={handleGoogleLogin}\n            disabled={isLoading}\n          >\n            <FcGoogle className=\"mr-2 h-4 w-4\" />\n            Sign in with Google\n          </Button>\n          \n          <div className=\"relative\">\n            <div className=\"absolute inset-0 flex items-center\">\n              <Separator className=\"w-full\" />\n            </div>\n            <div className=\"relative flex justify-center text-xs uppercase\">\n              <span className=\"bg-background px-2 text-muted-foreground\">\n                Or continue with email\n              </span>\n            </div>\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"name\">Full Name</Label>\n              <Input\n                id=\"name\"\n                type=\"text\"\n                placeholder=\"Enter your full name\"\n                value={name}\n                onChange={(e) => setName(e.target.value)}\n                disabled={isLoading}\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"Enter your email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                disabled={isLoading}\n                required\n              />\n            </div>\n            <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>\n              {isLoading ? \"Signing in...\" : \"Sign In\"}\n            </Button>\n          </form>\n\n          <div className=\"text-center text-sm text-muted-foreground\">\n            Don't have an account?{\" \"}\n            <Link href=\"/signup\">\n              <a className=\"text-primary hover:underline\">Sign up</a>\n            </Link>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":4913},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2254},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/lib/token-refresh.ts":{"content":"import { refreshAccessToken, setAccessToken } from './queryClient';\nimport { queryClient } from './queryClient';\n\n// Initialize token refresh system\nexport function initializeTokenRefresh() {\n  // Try to refresh token on app start\n  refreshAccessToken().then(success => {\n    if (success) {\n      console.log('Token refreshed on app initialization');\n      // Invalidate auth query to get fresh user data\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n    } else {\n      console.log('No valid refresh token found');\n    }\n  }).catch(error => {\n    console.error('Token refresh initialization failed:', error);\n  });\n\n  // Set up periodic token refresh (every 10 minutes)\n  setInterval(async () => {\n    try {\n      const success = await refreshAccessToken();\n      if (success) {\n        console.log('Token refreshed automatically');\n      }\n    } catch (error) {\n      console.error('Automatic token refresh failed:', error);\n    }\n  }, 10 * 60 * 1000); // 10 minutes\n\n  // Refresh token when page becomes visible (mobile app return)\n  document.addEventListener('visibilitychange', async () => {\n    if (!document.hidden) {\n      try {\n        const success = await refreshAccessToken();\n        if (success) {\n          console.log('Token refreshed on visibility change');\n          queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n        }\n      } catch (error) {\n        console.error('Visibility change token refresh failed:', error);\n      }\n    }\n  });\n}","size_bytes":1498},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"hsl(var(--background))\",\n        foreground: \"hsl(var(--foreground))\",\n        card: {\n          DEFAULT: \"hsl(var(--card))\",\n          foreground: \"hsl(var(--card-foreground))\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover))\",\n          foreground: \"hsl(var(--popover-foreground))\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary))\",\n          foreground: \"hsl(var(--primary-foreground))\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary))\",\n          foreground: \"hsl(var(--secondary-foreground))\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted))\",\n          foreground: \"hsl(var(--muted-foreground))\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent))\",\n          foreground: \"hsl(var(--accent-foreground))\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive))\",\n          foreground: \"hsl(var(--destructive-foreground))\",\n        },\n        border: \"hsl(var(--border))\",\n        input: \"hsl(var(--input))\",\n        ring: \"hsl(var(--ring))\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1))\",\n          \"2\": \"hsl(var(--chart-2))\",\n          \"3\": \"hsl(var(--chart-3))\",\n          \"4\": \"hsl(var(--chart-4))\",\n          \"5\": \"hsl(var(--chart-5))\",\n        },\n        sidebar: {\n          DEFAULT: \"hsl(var(--sidebar-background))\",\n          foreground: \"hsl(var(--sidebar-foreground))\",\n          primary: \"hsl(var(--sidebar-primary))\",\n          \"primary-foreground\": \"hsl(var(--sidebar-primary-foreground))\",\n          accent: \"hsl(var(--sidebar-accent))\",\n          \"accent-foreground\": \"hsl(var(--sidebar-accent-foreground))\",\n          border: \"hsl(var(--sidebar-border))\",\n          ring: \"hsl(var(--sidebar-ring))\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2787},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/pages/dashboard.tsx":{"content":"import { useState, useEffect, useMemo } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Clock, History, TrendingUp, AlertTriangle, Plus, Play, Square, Edit, Check, X, Trash2, BarChart3, Calendar, FileText } from \"lucide-react\";\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, LabelList } from \"recharts\";\nimport { usePersonalShifts, useIndividualRosterShifts, useWeeklyHours, useCreateShift, useUpdateShift, useDeleteShift } from \"@/hooks/use-shifts\";\nimport { getWeekDates, getLast7Days, formatTime, calculateDuration, generateTimeOptions, formatDateRange } from \"@/lib/time-utils\";\nimport { exportToCSV, exportToPDF } from \"@/lib/export\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Link } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useTimer } from \"@/hooks/use-timer\";\nimport type { Shift } from \"@shared/schema\";\n\n// Extended type for shifts with roster indicator\ntype ExtendedShift = Shift & { isRosterShift: boolean };\n\nexport default function Dashboard() {\n  const currentWeek = getWeekDates(new Date());\n  const last7Days = getLast7Days(new Date());\n  const previousWeekStart = new Date(currentWeek.start);\n  previousWeekStart.setDate(previousWeekStart.getDate() - 7);\n  const previousWeekEnd = new Date(currentWeek.end);\n  previousWeekEnd.setDate(previousWeekEnd.getDate() - 7);\n  \n  const previousWeek = {\n    start: previousWeekStart.toISOString().split('T')[0],\n    end: previousWeekEnd.toISOString().split('T')[0]\n  };\n\n  // Use global timer hook\n  const { isActive: isShiftActive, startTime: shiftStartTime, elapsedTime, startTimer, stopTimer } = useTimer();\n  \n  // Post-shift confirmation dialog state\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\n  const [pendingShiftData, setPendingShiftData] = useState<any>(null);\n  const [editableShift, setEditableShift] = useState<any>(null);\n  \n  // Edit shift modal state\n  const [showEditDialog, setShowEditDialog] = useState(false);\n  const [shiftToEdit, setShiftToEdit] = useState<Shift | null>(null);\n  \n  // Recent Shifts date range filter state\n  const [recentShiftsStartDate, setRecentShiftsStartDate] = useState(currentWeek.start);\n  const [recentShiftsEndDate, setRecentShiftsEndDate] = useState(currentWeek.end);\n\n  // Fetch only personal shifts for Recent Shifts section (roster shifts have their own page)\n  const { data: recentShifts = [], isLoading: shiftsLoading } = usePersonalShifts();\n  \n  const { data: thisWeekHours, isLoading: thisWeekLoading } = useWeeklyHours(last7Days.start, last7Days.end);\n  const { data: lastWeekHours, isLoading: lastWeekLoading } = useWeeklyHours(previousWeek.start, previousWeek.end);\n  const createShiftMutation = useCreateShift();\n  const updateShiftMutation = useUpdateShift();\n  const deleteShiftMutation = useDeleteShift();\n  const { toast } = useToast();\n\n  // Filter recent shifts by date range\n  const filteredRecentShifts = useMemo(() => {\n    if (!recentShifts) return [];\n    return recentShifts.filter((shift: Shift) => \n      shift.date >= recentShiftsStartDate && shift.date <= recentShiftsEndDate\n    );\n  }, [recentShifts, recentShiftsStartDate, recentShiftsEndDate]);\n\n  const recentShiftsToShow = useMemo(() => {\n    return filteredRecentShifts?.slice(0, 3) || [];\n  }, [filteredRecentShifts]);\n\n  // Calculate total hours for filtered recent shifts\n  const filteredRecentShiftsTotalHours = useMemo(() => {\n    return filteredRecentShifts.reduce((total: number, shift: Shift) => \n      total + calculateDuration(shift.startTime, shift.endTime), 0\n    );\n  }, [filteredRecentShifts]);\n\n  // Prepare chart data for filtered recent shifts\n  const recentShiftsChartData = useMemo(() => {\n    // Generate all dates in the selected range\n    const dateRange: string[] = [];\n    const startParts = recentShiftsStartDate.split('-').map(Number);\n    const endParts = recentShiftsEndDate.split('-').map(Number);\n    const start = new Date(Date.UTC(startParts[0], startParts[1] - 1, startParts[2]));\n    const end = new Date(Date.UTC(endParts[0], endParts[1] - 1, endParts[2]));\n    \n    for (let d = new Date(start); d <= end; d.setUTCDate(d.getUTCDate() + 1)) {\n      dateRange.push(d.toISOString().split('T')[0]);\n    }\n\n    // Group shifts by date\n    const shiftsByDate = filteredRecentShifts.reduce((acc: Record<string, Shift[]>, shift: Shift) => {\n      const date = shift.date;\n      if (!acc[date]) {\n        acc[date] = [];\n      }\n      acc[date].push(shift);\n      return acc;\n    }, {} as Record<string, Shift[]>);\n\n    // Create chart data for each date in the range (including days with no shifts)\n    return dateRange.map((dateString) => {\n      // Parse date in UTC to avoid timezone shifts\n      const [year, month, day] = dateString.split('-').map(Number);\n      const utcDate = new Date(Date.UTC(year, month - 1, day));\n      const dayName = utcDate.toLocaleDateString('en-US', { weekday: 'short', timeZone: 'UTC' });\n      const formattedDate = `${dayName} ${month}/${day}`;\n      \n      const shifts = shiftsByDate[dateString] || [];\n      \n      // Calculate total hours and shift type breakdown\n      const totalHours = shifts.reduce((sum: number, shift: Shift) => \n        sum + calculateDuration(shift.startTime, shift.endTime), 0);\n      \n      const shiftTypeHours = {\n        morningHours: 0,\n        afternoonHours: 0,\n        nightHours: 0\n      };\n      \n      shifts.forEach((shift: Shift) => {\n        const duration = Number(calculateDuration(shift.startTime, shift.endTime).toFixed(2));\n        switch (shift.shiftType) {\n          case 'morning':\n            shiftTypeHours.morningHours += duration;\n            break;\n          case 'afternoon':\n          case 'evening': // Handle old 'evening' shift type as 'afternoon'\n            shiftTypeHours.afternoonHours += duration;\n            break;\n          case 'night':\n            shiftTypeHours.nightHours += duration;\n            break;\n        }\n      });\n\n      // Round all shift type hours to 2 decimal places\n      Object.keys(shiftTypeHours).forEach(key => {\n        shiftTypeHours[key as keyof typeof shiftTypeHours] = Number(\n          shiftTypeHours[key as keyof typeof shiftTypeHours].toFixed(2)\n        );\n      });\n\n      return {\n        day: formattedDate,\n        date: dateString,\n        totalHours: Number(totalHours.toFixed(2)),\n        shiftsCount: shifts.length,\n        ...shiftTypeHours\n      };\n    });\n  }, [filteredRecentShifts, recentShiftsStartDate, recentShiftsEndDate]);\n\n\n\n  // Prepare weekly chart data for last 7 days\n  const weeklyChartData = useMemo(() => {\n    if (!recentShifts) return [];\n\n    // Generate all 7 days using UTC to avoid timezone issues\n    return Array.from({ length: 7 }, (_, index) => {\n      const startParts = last7Days.start.split('-').map(Number);\n      const startDate = new Date(Date.UTC(startParts[0], startParts[1] - 1, startParts[2]));\n      const currentDate = new Date(startDate);\n      currentDate.setUTCDate(startDate.getUTCDate() + index);\n      const dateString = currentDate.toISOString().split('T')[0];\n      \n      // Parse date components in UTC\n      const [year, month, day] = dateString.split('-').map(Number);\n      const utcDate = new Date(Date.UTC(year, month - 1, day));\n      \n      // Get the actual day name for this date using UTC\n      const actualDayName = utcDate.toLocaleDateString('en-US', { weekday: 'long', timeZone: 'UTC' });\n      \n      // Filter shifts for this specific day\n      const dayShifts = recentShifts.filter((shift: Shift) => shift.date === dateString);\n      \n      // Calculate total hours and create shift data for stacking\n      const totalHours = dayShifts.reduce((sum: number, shift: Shift) => \n        sum + calculateDuration(shift.startTime, shift.endTime), 0);\n      \n      // Group shifts by type and calculate hours for each type\n      const shiftTypeHours = {\n        morningHours: 0,\n        afternoonHours: 0,\n        nightHours: 0\n      };\n      \n      dayShifts.forEach((shift: Shift) => {\n        const duration = Number(calculateDuration(shift.startTime, shift.endTime).toFixed(2));\n        switch (shift.shiftType) {\n          case 'morning':\n            shiftTypeHours.morningHours += duration;\n            break;\n          case 'afternoon':\n          case 'evening': // Handle old 'evening' shift type as 'afternoon'\n            shiftTypeHours.afternoonHours += duration;\n            break;\n          case 'night':\n            shiftTypeHours.nightHours += duration;\n            break;\n        }\n      });\n      \n      // Round all shift type hours to 2 decimal places\n      Object.keys(shiftTypeHours).forEach(key => {\n        shiftTypeHours[key as keyof typeof shiftTypeHours] = Number(\n          shiftTypeHours[key as keyof typeof shiftTypeHours].toFixed(2)\n        );\n      });\n      \n      // Use the actual day name with UTC date components\n      const dayWithDate = `${actualDayName.slice(0, 3)} ${month}/${day}`;\n      \n      return {\n        day: dayWithDate, // Short day names with date\n        fullDay: actualDayName,\n        date: dateString,\n        totalHours: Number(totalHours.toFixed(2)),\n        shiftsCount: dayShifts.length,\n        shifts: dayShifts,\n        ...shiftTypeHours\n      };\n    });\n  }, [recentShifts, last7Days.start]);\n\n\n  // Get unique shift colors based on type\n  const getShiftColor = (shiftType: string) => {\n    const colors = {\n      morning: '#10b981', // emerald-500\n      afternoon: '#3b82f6', // blue-500\n      night: '#6366f1',   // indigo-500\n    };\n    return colors[shiftType as keyof typeof colors] || '#6b7280';\n  };\n\n  const formatElapsedTime = (seconds: number): string => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n    \n    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const roundToNearestQuarter = (minutes: number): number => {\n    return Math.round(minutes / 15) * 15;\n  };\n\n  const roundStartTimeToQuarter = (date: Date): string => {\n    const hours = date.getHours();\n    const minutes = date.getMinutes();\n    // Round DOWN to nearest quarter for start time\n    const roundedMinutes = Math.floor(minutes / 15) * 15;\n    \n    return `${hours.toString().padStart(2, '0')}:${roundedMinutes.toString().padStart(2, '0')}`;\n  };\n\n  const roundEndTimeToQuarter = (date: Date): string => {\n    const hours = date.getHours();\n    const minutes = date.getMinutes();\n    \n    // End time rounding logic:\n    // Minutes 0-7  rounds to 0\n    // Minutes 8-22  rounds to 15\n    // Minutes 23-37  rounds to 30\n    // Minutes 38-52  rounds to 45\n    // Minutes 53-59  rounds to 0 (next hour)\n    let roundedMinutes;\n    if (minutes <= 7) {\n      roundedMinutes = 0;\n    } else if (minutes <= 22) {\n      roundedMinutes = 15;\n    } else if (minutes <= 37) {\n      roundedMinutes = 30;\n    } else if (minutes <= 52) {\n      roundedMinutes = 45;\n    } else {\n      roundedMinutes = 0;\n    }\n    \n    let finalHours = hours;\n    let finalMinutes = roundedMinutes;\n    \n    // If rounded to 0 and original minutes were 53-59, move to next hour\n    if (minutes >= 53 && roundedMinutes === 0) {\n      finalHours += 1;\n    }\n    \n    if (finalHours >= 24) {\n      finalHours = 0;\n    }\n    \n    return `${finalHours.toString().padStart(2, '0')}:${finalMinutes.toString().padStart(2, '0')}`;\n  };\n\n  const determineShiftType = (startTime: Date): string => {\n    const hour = startTime.getHours();\n    const minute = startTime.getMinutes();\n    const totalMinutes = hour * 60 + minute;\n    \n    // 5:00 AM - 11:00 AM: Morning shift\n    if (totalMinutes >= 300 && totalMinutes <= 660) {\n      return 'morning';\n    }\n    // 11:01 AM - 4:00 PM: Afternoon shift  \n    else if (totalMinutes >= 661 && totalMinutes <= 960) {\n      return 'afternoon';\n    }\n    // 4:01 PM - 4:59 AM: Night shift\n    else {\n      return 'night';\n    }\n  };\n\n  const handleStartShift = () => {\n    startTimer();\n  };\n\n  const handleEndShift = async () => {\n    if (!shiftStartTime) {\n      console.error('No shift start time found');\n      toast({\n        title: \"Error\",\n        description: \"No active shift found to end.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    const endTime = new Date();\n    const totalMinutes = Math.floor((endTime.getTime() - shiftStartTime.getTime()) / 60000);\n    \n    console.log('Shift duration:', totalMinutes, 'minutes');\n    console.log('Shift start time:', shiftStartTime);\n    console.log('Shift end time:', endTime);\n    \n    // Validate minimum shift duration (1 minute)\n    if (totalMinutes < 1) {\n      toast({\n        title: \"Shift too short\",\n        description: \"Minimum shift duration is 1 minute.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    const roundedMinutes = roundToNearestQuarter(totalMinutes);\n    \n    // Use actual start and end times from the timer with quarter-hour rounding\n    const startTimeStr = roundStartTimeToQuarter(shiftStartTime);\n    const endTimeStr = roundEndTimeToQuarter(endTime);\n    \n    const shiftType = determineShiftType(shiftStartTime);\n    const shiftDate = shiftStartTime.toISOString().split('T')[0];\n    \n    const shiftData = {\n      date: shiftDate,\n      startTime: startTimeStr,\n      endTime: endTimeStr,\n      shiftType: shiftType,\n      notes: '',\n      duration: (roundedMinutes / 60).toFixed(2)\n    };\n    \n    console.log('Preparing shift confirmation with data:', shiftData);\n    \n    // Show confirmation dialog instead of immediately creating shift\n    setPendingShiftData(shiftData);\n    setEditableShift({ ...shiftData });\n    setShowConfirmDialog(true);\n    \n    // Stop the timer since shift is being processed\n    stopTimer();\n  };\n\n  const handleConfirmShift = async () => {\n    if (!editableShift) return;\n    \n    try {\n      const { duration, ...shiftToCreate } = editableShift;\n      await createShiftMutation.mutateAsync(shiftToCreate);\n      \n      toast({\n        title: \"Shift recorded\",\n        description: `${editableShift.shiftType.charAt(0).toUpperCase() + editableShift.shiftType.slice(1)} shift created - ${duration} hours`,\n      });\n      \n      setShowConfirmDialog(false);\n      setPendingShiftData(null);\n      setEditableShift(null);\n      \n    } catch (error) {\n      console.error('Failed to create shift:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to save shift\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleCancelShift = () => {\n    setShowConfirmDialog(false);\n    setPendingShiftData(null);\n    setEditableShift(null);\n    \n    toast({\n      title: \"Shift cancelled\",\n      description: \"Timer reset to 00:00:00\",\n    });\n  };\n\n  const handleDeletePendingShift = () => {\n    setShowConfirmDialog(false);\n    setPendingShiftData(null);\n    setEditableShift(null);\n    \n    toast({\n      title: \"Shift deleted\",\n      description: \"Timer reset to 00:00:00\",\n    });\n  };\n\n  const timeOptions = generateTimeOptions();\n\n  // Handle opening edit modal\n  const handleEditShift = (shift: Shift) => {\n    setShiftToEdit(shift);\n    setShowEditDialog(true);\n  };\n\n  // Handle updating shift\n  const handleUpdateShift = async (updatedData: any) => {\n    if (!shiftToEdit) return;\n    \n    try {\n      await updateShiftMutation.mutateAsync({ id: shiftToEdit.id, ...updatedData });\n      toast({\n        title: \"Success\",\n        description: \"Shift updated successfully!\",\n      });\n      setShowEditDialog(false);\n      setShiftToEdit(null);\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update shift. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Handle report generation for Recent Shifts\n  const handleGenerateReport = (format: 'pdf' | 'csv') => {\n    const options = {\n      format,\n      startDate: recentShiftsStartDate,\n      endDate: recentShiftsEndDate,\n      includeDetails: true,\n      includeSummary: true,\n      includeAverages: true,\n      includeMissing: false\n    };\n\n    if (format === 'csv') {\n      exportToCSV(filteredRecentShifts, options);\n    } else {\n      exportToPDF(filteredRecentShifts, options);\n    }\n\n    toast({\n      title: \"Report Generated\",\n      description: `${format.toUpperCase()} report for ${formatDateRange(recentShiftsStartDate, recentShiftsEndDate)} has been downloaded.`,\n    });\n  };\n\n  // Handle deleting existing shift from edit modal\n  const handleDeleteExistingShift = async () => {\n    if (!shiftToEdit) return;\n    \n    try {\n      await deleteShiftMutation.mutateAsync(shiftToEdit.id);\n      toast({\n        title: \"Success\",\n        description: \"Shift deleted successfully!\",\n      });\n      setShowEditDialog(false);\n      setShiftToEdit(null);\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete shift. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const shiftTypeColors = {\n    morning: 'bg-emerald-500',\n    evening: 'bg-blue-500',\n    night: 'bg-purple-500',\n    double: 'bg-amber-500',\n    custom: 'bg-gray-500',\n  };\n\n  const alerts = useMemo(() => {\n    const alertList = [];\n    \n    // Find next upcoming shift\n    if (recentShifts && recentShifts.length > 0) {\n      const today = new Date().toISOString().split('T')[0];\n      const upcomingShifts = recentShifts\n        .filter((shift: Shift) => shift.date >= today)\n        .sort((a: Shift, b: Shift) => new Date(a.date).getTime() - new Date(b.date).getTime());\n      \n      if (upcomingShifts.length > 0) {\n        const nextShift = upcomingShifts[0];\n        const shiftDate = new Date(nextShift.date);\n        const isToday = nextShift.date === today;\n        const isTomorrow = new Date(nextShift.date).getTime() === new Date(today).getTime() + 24 * 60 * 60 * 1000;\n        \n        let dateText = shiftDate.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });\n        if (isToday) dateText = 'Today';\n        if (isTomorrow) dateText = 'Tomorrow';\n        \n        alertList.push({\n          type: 'info',\n          icon: Clock,\n          title: 'Next Shift',\n          description: `${dateText}  ${formatTime(nextShift.startTime)} - ${formatTime(nextShift.endTime)} (${nextShift.shiftType})`,\n          bgColor: 'bg-blue-50',\n          borderColor: 'border-blue-200',\n          textColor: 'text-blue-900',\n          descColor: 'text-blue-700'\n        });\n      }\n    }\n\n    // Check for long shifts (12+ hours)\n    if (recentShifts) {\n      const longShifts = recentShifts.filter((shift: Shift) => \n        calculateDuration(shift.startTime, shift.endTime) >= 12\n      );\n      \n      if (longShifts.length > 0) {\n        alertList.push({\n          type: 'warning',\n          icon: Clock,\n          title: 'Long Shift Alert',\n          description: `${longShifts.length} shift(s) over 12 hours`,\n          bgColor: 'bg-amber-50',\n          borderColor: 'border-amber-200',\n          textColor: 'text-amber-900',\n          descColor: 'text-amber-700'\n        });\n      }\n    }\n\n    return alertList;\n  }, [recentShifts]);\n\n  return (\n    <div className=\"p-4 lg:p-8\">\n      {/* Add Manual Shift - Featured Button */}\n      <div className=\"mb-8\">\n        <Link href=\"/add-shift\">\n          <Button size=\"lg\" className=\"w-full text-lg px-8 py-4 h-auto touch-target\">\n            <Plus className=\"h-6 w-6 mr-3\" />\n            Add Manual Shift\n          </Button>\n        </Link>\n      </div>\n\n      {/* Stats Overview */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-slate-600\">Last 7 Days Hours</p>\n                {thisWeekLoading ? (\n                  <Skeleton className=\"h-8 w-16 mt-1\" />\n                ) : (\n                  <p className=\"text-4xl font-bold text-blue-600\">\n                    {thisWeekHours?.toFixed(1) || \"0\"}h\n                  </p>\n                )}\n              </div>\n              <div className=\"w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center\">\n                <Clock className=\"h-8 w-8 text-blue-600\" />\n              </div>\n            </div>\n            <div className=\"mt-4 flex items-center text-sm\">\n              <span className=\"text-slate-600\">Last 7 days total</span>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-slate-600\">\n                  Shift Timer {isShiftActive && <span className=\"text-green-600 animate-pulse\"> Running</span>}\n                </p>\n                <p className={`text-4xl font-bold tabular-nums ${isShiftActive ? 'text-green-600' : 'text-slate-900'}`}>\n                  {isShiftActive ? formatElapsedTime(elapsedTime) : \"00:00:00\"}\n                </p>\n              </div>\n              <div className={`w-16 h-16 rounded-full flex items-center justify-center touch-target ${\n                isShiftActive ? 'bg-red-100 animate-pulse' : 'bg-green-100'\n              }`}>\n                {isShiftActive ? (\n                  <Square className=\"h-8 w-8 text-red-600\" />\n                ) : (\n                  <Play className=\"h-8 w-8 text-green-600\" />\n                )}\n              </div>\n            </div>\n            <div className=\"mt-6 space-y-3\">\n              <Button \n                onClick={isShiftActive ? handleEndShift : handleStartShift}\n                variant={isShiftActive ? \"destructive\" : \"default\"}\n                size=\"lg\"\n                className=\"w-full h-14 text-lg touch-target no-callout\"\n                disabled={createShiftMutation.isPending}\n              >\n                {createShiftMutation.isPending \n                  ? \"Creating shift...\" \n                  : isShiftActive \n                    ? \"End Shift\" \n                    : \"Start Shift\"\n                }\n              </Button>\n              {isShiftActive && (\n                <Button \n                  onClick={stopTimer}\n                  variant=\"outline\"\n                  size=\"lg\"\n                  className=\"w-full h-12 text-base touch-target\"\n                >\n                  Cancel Shift\n                </Button>\n              )}\n            </div>\n            {isShiftActive && shiftStartTime && (\n              <div className=\"mt-3 p-2 bg-green-50 rounded-lg text-sm text-green-700 text-center\">\n                Started at {shiftStartTime.toLocaleTimeString('en-US', { \n                  hour: '2-digit', \n                  minute: '2-digit' \n                })}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n      </div>\n\n      <div className=\"space-y-8\">\n        {/* Weekly Hours Chart */}\n        <div>\n          <Card>\n            <div className=\"p-6 border-b border-slate-200\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center\">\n                    <BarChart3 className=\"h-5 w-5 text-blue-600\" />\n                  </div>\n                  <div>\n                    <h3 className=\"text-lg font-semibold text-slate-900\">Last 7 Days Hours</h3>\n                    <p className=\"text-sm text-slate-500\">Daily breakdown of your recent shifts</p>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <CardContent className=\"p-6\">\n              {shiftsLoading ? (\n                <div className=\"h-64 flex items-center justify-center\">\n                  <Skeleton className=\"h-48 w-full\" />\n                </div>\n              ) : weeklyChartData.length > 0 ? (\n                <div className=\"h-64\">\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <BarChart data={weeklyChartData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>\n                      <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f1f5f9\" />\n                      <XAxis \n                        dataKey=\"day\" \n                        tick={{ fontSize: 12, fill: '#64748b' }}\n                        tickLine={{ stroke: '#cbd5e1' }}\n                      />\n                      <YAxis \n                        tick={{ fontSize: 12, fill: '#64748b' }}\n                        tickLine={{ stroke: '#cbd5e1' }}\n                        domain={[0, 'dataMax + 2']}\n                        label={{ value: 'Hours', angle: -90, position: 'insideLeft', style: { textAnchor: 'middle', fontSize: '12px', fill: '#64748b' } }}\n                      />\n                      <Tooltip\n                        content={({ active, payload, label }) => {\n                          if (active && payload && payload.length) {\n                            const data = payload[0].payload;\n                            return (\n                              <div className=\"bg-white p-3 border border-slate-200 rounded-lg shadow-lg\">\n                                <p className=\"font-semibold text-slate-900\">{data.fullDay}</p>\n                                <p className=\"text-sm text-slate-600 mb-2\">{new Date(data.date).toLocaleDateString()}</p>\n                                {data.shiftsCount > 0 ? (\n                                  <div className=\"space-y-1\">\n                                    <p className=\"text-sm font-medium text-slate-900\">\n                                      Total: {data.totalHours} hours ({data.shiftsCount} shift{data.shiftsCount > 1 ? 's' : ''})\n                                    </p>\n                                    <div className=\"space-y-1 mt-2\">\n                                      {data.morningHours > 0 && (\n                                        <div className=\"flex items-center gap-2 text-xs\">\n                                          <div className=\"w-3 h-3 rounded-full bg-emerald-500\"></div>\n                                          <span>Morning: {data.morningHours} hours</span>\n                                        </div>\n                                      )}\n                                      {data.afternoonHours > 0 && (\n                                        <div className=\"flex items-center gap-2 text-xs\">\n                                          <div className=\"w-3 h-3 rounded-full bg-blue-500\"></div>\n                                          <span>Afternoon: {data.afternoonHours} hours</span>\n                                        </div>\n                                      )}\n                                      {data.nightHours > 0 && (\n                                        <div className=\"flex items-center gap-2 text-xs\">\n                                          <div className=\"w-3 h-3 rounded-full bg-indigo-500\"></div>\n                                          <span>Night: {data.nightHours} hours</span>\n                                        </div>\n                                      )}\n\n                                    </div>\n                                    {data.shifts && data.shifts.length > 0 && (\n                                      <div className=\"mt-2 pt-2 border-t border-slate-200\">\n                                        <p className=\"text-xs font-medium text-slate-700 mb-1\">Individual Shifts:</p>\n                                        {data.shifts.map((shift: any, index: number) => (\n                                          <div key={shift.id} className=\"text-xs text-slate-600 bg-slate-50 p-1.5 rounded mb-1\">\n                                            <div className=\"font-medium capitalize\">{shift.shiftType}</div>\n                                            <div>{formatTime(shift.startTime)} - {formatTime(shift.endTime)}</div>\n                                            <div>{calculateDuration(shift.startTime, shift.endTime).toFixed(2)} hours</div>\n                                          </div>\n                                        ))}\n                                      </div>\n                                    )}\n                                  </div>\n                                ) : (\n                                  <p className=\"text-sm text-slate-500\">No shifts</p>\n                                )}\n                              </div>\n                            );\n                          }\n                          return null;\n                        }}\n                      />\n                      {/* Render separate bars for each shift type */}\n                      <Bar dataKey=\"morningHours\" stackId=\"shifts\" fill=\"#10b981\" name=\"Morning Shifts\" minPointSize={3} />\n                      <Bar dataKey=\"afternoonHours\" stackId=\"shifts\" fill=\"#3b82f6\" name=\"Afternoon Shifts\" minPointSize={3} />\n                      <Bar dataKey=\"nightHours\" stackId=\"shifts\" fill=\"#6366f1\" name=\"Night Shifts\" minPointSize={3} />\n                      {/* Add total hours label on top of stacked bars */}\n                      <Bar \n                        dataKey=\"totalHours\" \n                        fill=\"transparent\" \n                        name=\"Total\"\n                        stackId=\"total\"\n                      >\n                        <LabelList \n                          dataKey=\"totalHours\" \n                          position=\"top\" \n                          style={{ \n                            fontSize: '12px', \n                            fontWeight: '600',\n                            fill: '#374151'\n                          }}\n                          formatter={(value: number) => value > 0 ? `${value}h` : ''}\n                        />\n                      </Bar>\n                    </BarChart>\n                  </ResponsiveContainer>\n                </div>\n              ) : (\n                <div className=\"h-64 flex items-center justify-center text-slate-500\">\n                  <div className=\"text-center\">\n                    <BarChart3 className=\"h-12 w-12 mx-auto mb-3 text-slate-300\" />\n                    <p className=\"text-sm\">No shifts recorded this week</p>\n                    <p className=\"text-xs text-slate-400 mt-1\">Start tracking your shifts to see the chart</p>\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Recent Shifts */}\n        <div>\n          <Card>\n            <div className=\"p-6 border-b border-slate-200\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3 className=\"text-lg font-semibold text-slate-900\">Recent Shifts</h3>\n                <Link href=\"/shifts\">\n                  <Button variant=\"ghost\" size=\"sm\">\n                    View All\n                  </Button>\n                </Link>\n              </div>\n              \n              {/* Date Range Filter */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\n                <div>\n                  <Label htmlFor=\"start-date\" className=\"text-sm font-medium text-slate-700\">\n                    Start Date\n                  </Label>\n                  <Input\n                    id=\"start-date\"\n                    type=\"date\"\n                    value={recentShiftsStartDate}\n                    onChange={(e) => setRecentShiftsStartDate(e.target.value)}\n                    className=\"mt-1\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"end-date\" className=\"text-sm font-medium text-slate-700\">\n                    End Date\n                  </Label>\n                  <Input\n                    id=\"end-date\"\n                    type=\"date\"\n                    value={recentShiftsEndDate}\n                    onChange={(e) => setRecentShiftsEndDate(e.target.value)}\n                    className=\"mt-1\"\n                  />\n                </div>\n              </div>\n\n              {/* Total Hours and Report Generation */}\n              <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4 p-4 bg-slate-50 rounded-lg\">\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"flex items-center gap-2\">\n                    <Clock className=\"h-5 w-5 text-slate-600\" />\n                    <div>\n                      <p className=\"text-sm font-medium text-slate-900\">\n                        Total Hours: {filteredRecentShiftsTotalHours.toFixed(2)}\n                      </p>\n                      <p className=\"text-xs text-slate-600\">\n                        {formatDateRange(recentShiftsStartDate, recentShiftsEndDate)}\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Calendar className=\"h-5 w-5 text-slate-600\" />\n                    <div>\n                      <p className=\"text-sm font-medium text-slate-900\">\n                        {filteredRecentShifts.length} Shifts\n                      </p>\n                      <p className=\"text-xs text-slate-600\">\n                        {recentShiftsChartData.length} Days\n                      </p>\n                    </div>\n                  </div>\n                </div>\n                <div className=\"flex gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => handleGenerateReport('csv')}\n                    disabled={filteredRecentShifts.length === 0}\n                  >\n                    <FileText className=\"h-4 w-4 mr-2\" />\n                    CSV Report\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => handleGenerateReport('pdf')}\n                    disabled={filteredRecentShifts.length === 0}\n                  >\n                    <FileText className=\"h-4 w-4 mr-2\" />\n                    PDF Report\n                  </Button>\n                </div>\n              </div>\n\n              {/* Bar Chart for Selected Date Range */}\n              {recentShiftsChartData.length > 0 && (\n                <div className=\"mb-4\">\n                  <h4 className=\"text-sm font-medium text-slate-700 mb-3\">Daily Hours Breakdown</h4>\n                  <div className=\"h-64\">\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <BarChart data={recentShiftsChartData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>\n                        <CartesianGrid strokeDasharray=\"3 3\" />\n                        <XAxis \n                          dataKey=\"day\" \n                          tick={{ fontSize: 12 }}\n                          angle={-45}\n                          textAnchor=\"end\"\n                          height={60}\n                        />\n                        <YAxis \n                          tick={{ fontSize: 12 }}\n                          domain={[0, 'dataMax + 2']}\n                          label={{ value: 'Hours', angle: -90, position: 'insideLeft' }}\n                        />\n                        <Tooltip\n                          content={({ active, payload, label }) => {\n                            if (active && payload && payload.length > 0) {\n                              const data = payload[0].payload;\n                              return (\n                                <div className=\"bg-white p-3 border border-slate-200 rounded-lg shadow-lg\">\n                                  <p className=\"font-medium text-slate-900 mb-2\">{label}</p>\n                                  {data.shiftsCount > 0 ? (\n                                    <div className=\"space-y-1\">\n                                      <p className=\"text-sm font-medium text-slate-900\">\n                                        Total: {data.totalHours} hours ({data.shiftsCount} shift{data.shiftsCount > 1 ? 's' : ''})\n                                      </p>\n                                      <div className=\"space-y-1 mt-2\">\n                                        {data.morningHours > 0 && (\n                                          <div className=\"flex items-center gap-2 text-xs\">\n                                            <div className=\"w-3 h-3 rounded-full bg-emerald-500\"></div>\n                                            <span>Morning: {data.morningHours} hours</span>\n                                          </div>\n                                        )}\n                                        {data.afternoonHours > 0 && (\n                                          <div className=\"flex items-center gap-2 text-xs\">\n                                            <div className=\"w-3 h-3 rounded-full bg-blue-500\"></div>\n                                            <span>Afternoon: {data.afternoonHours} hours</span>\n                                          </div>\n                                        )}\n                                        {data.nightHours > 0 && (\n                                          <div className=\"flex items-center gap-2 text-xs\">\n                                            <div className=\"w-3 h-3 rounded-full bg-indigo-500\"></div>\n                                            <span>Night: {data.nightHours} hours</span>\n                                          </div>\n                                        )}\n                                      </div>\n                                    </div>\n                                  ) : (\n                                    <p className=\"text-sm text-slate-500\">No shifts</p>\n                                  )}\n                                </div>\n                              );\n                            }\n                            return null;\n                          }}\n                        />\n                        <Bar dataKey=\"morningHours\" stackId=\"shifts\" fill=\"#10b981\" name=\"Morning Shifts\" minPointSize={3} />\n                        <Bar dataKey=\"afternoonHours\" stackId=\"shifts\" fill=\"#3b82f6\" name=\"Afternoon Shifts\" minPointSize={3} />\n                        <Bar dataKey=\"nightHours\" stackId=\"shifts\" fill=\"#6366f1\" name=\"Night Shifts\" minPointSize={3} />\n                        {/* Add total hours label on top of stacked bars */}\n                        <Bar \n                          dataKey=\"totalHours\" \n                          fill=\"transparent\" \n                          name=\"Total\"\n                          stackId=\"total\"\n                        >\n                          <LabelList \n                            dataKey=\"totalHours\" \n                            position=\"top\" \n                            style={{ \n                              fontSize: '12px', \n                              fontWeight: '600',\n                              fill: '#374151'\n                            }}\n                            formatter={(value: number) => value > 0 ? `${value}h` : ''}\n                          />\n                        </Bar>\n                      </BarChart>\n                    </ResponsiveContainer>\n                  </div>\n                </div>\n              )}\n            </div>\n            <div className=\"divide-y divide-slate-200\">\n              {shiftsLoading ? (\n                Array.from({ length: 3 }).map((_, i) => (\n                  <div key={i} className=\"p-6 flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-4\">\n                      <Skeleton className=\"w-3 h-3 rounded-full\" />\n                      <div>\n                        <Skeleton className=\"h-4 w-24 mb-1\" />\n                        <Skeleton className=\"h-3 w-20\" />\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <Skeleton className=\"h-4 w-32 mb-1\" />\n                      <Skeleton className=\"h-3 w-16\" />\n                    </div>\n                  </div>\n                ))\n              ) : recentShiftsToShow.length > 0 ? (\n                recentShiftsToShow.map((shift: Shift) => (\n                  <div key={shift.id} className=\"p-6 flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-4\">\n                      <div className={`w-3 h-3 rounded-full ${\n                        shiftTypeColors[shift.shiftType as keyof typeof shiftTypeColors] || 'bg-gray-500'\n                      }`}></div>\n                      <div>\n                        <p className=\"font-medium text-slate-900 capitalize\">\n                          {shift.shiftType} Shift\n                        </p>\n                        <p className=\"text-sm text-slate-500\">\n                          {new Date(shift.date).toLocaleDateString('en-US', { \n                            month: 'short', \n                            day: 'numeric', \n                            year: 'numeric' \n                          })}\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center space-x-4\">\n                      <div className=\"text-right\">\n                        <p className=\"font-medium text-slate-900\">\n                          {formatTime(shift.startTime)} - {formatTime(shift.endTime)}\n                        </p>\n                        <p className=\"text-sm text-slate-500\">\n                          {calculateDuration(shift.startTime, shift.endTime).toFixed(2)} hours\n                        </p>\n                      </div>\n                      <Button \n                        variant=\"ghost\" \n                        size=\"sm\" \n                        className=\"touch-target\"\n                        onClick={() => handleEditShift(shift)}\n                      >\n                        <Edit className=\"h-5 w-5\" />\n                      </Button>\n                    </div>\n                  </div>\n                ))\n              ) : (\n                <div className=\"p-6 text-center text-slate-500\">\n                  No shifts recorded yet\n                </div>\n              )}\n            </div>\n          </Card>\n        </div>\n\n        {/* Alerts */}\n        <div className=\"space-y-6\">\n          <Card>\n            <CardContent className=\"p-6\">\n              <h3 className=\"text-lg font-semibold text-slate-900 mb-4\">Alerts</h3>\n              <div className=\"space-y-3\">\n                {alerts.length > 0 ? (\n                  alerts.map((alert, index) => {\n                    const Icon = alert.icon;\n                    return (\n                      <div\n                        key={index}\n                        className={`flex items-start space-x-3 p-3 rounded-lg border ${alert.bgColor} ${alert.borderColor}`}\n                      >\n                        <Icon className={`h-4 w-4 mt-0.5 ${alert.textColor.replace('text-', 'text-').replace('-900', '-500')}`} />\n                        <div>\n                          <p className={`text-sm font-medium ${alert.textColor}`}>\n                            {alert.title}\n                          </p>\n                          <p className={`text-xs ${alert.descColor}`}>\n                            {alert.description}\n                          </p>\n                        </div>\n                      </div>\n                    );\n                  })\n                ) : (\n                  <div className=\"text-sm text-slate-500 text-center py-4\">\n                    No alerts at this time\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {/* Shift Confirmation Dialog */}\n      <Dialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Confirm Shift Details</DialogTitle>\n          </DialogHeader>\n          \n          {editableShift && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"shift-date\">Date</Label>\n                  <Input\n                    id=\"shift-date\"\n                    type=\"date\"\n                    value={editableShift.date}\n                    onChange={(e) => setEditableShift({...editableShift, date: e.target.value})}\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"shift-type\">Shift Type</Label>\n                  <Select\n                    value={editableShift.shiftType}\n                    onValueChange={(value) => setEditableShift({...editableShift, shiftType: value})}\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"morning\">Morning</SelectItem>\n                      <SelectItem value=\"evening\">Evening</SelectItem>\n                      <SelectItem value=\"night\">Night</SelectItem>\n                      <SelectItem value=\"double\">Double</SelectItem>\n                      <SelectItem value=\"custom\">Custom</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"start-time\">Start Time</Label>\n                  <Select\n                    value={editableShift.startTime}\n                    onValueChange={(value) => setEditableShift({...editableShift, startTime: value})}\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {timeOptions.map((option) => (\n                        <SelectItem key={option.value} value={option.value}>\n                          {option.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"end-time\">End Time</Label>\n                  <Select\n                    value={editableShift.endTime}\n                    onValueChange={(value) => setEditableShift({...editableShift, endTime: value})}\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {timeOptions.map((option) => (\n                        <SelectItem key={option.value} value={option.value}>\n                          {option.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"shift-notes\">Notes (Optional)</Label>\n                <Textarea\n                  id=\"shift-notes\"\n                  placeholder=\"Add notes about this shift...\"\n                  value={editableShift.notes}\n                  onChange={(e) => setEditableShift({...editableShift, notes: e.target.value})}\n                  rows={3}\n                />\n              </div>\n\n              <div className=\"p-3 bg-slate-50 rounded-lg\">\n                <div className=\"text-sm text-slate-600\">Duration: <span className=\"font-semibold\">{editableShift.duration} hours</span></div>\n                <div className=\"text-sm text-slate-600\">Type: <span className=\"font-semibold capitalize\">{editableShift.shiftType}</span></div>\n              </div>\n            </div>\n          )}\n\n          <DialogFooter className=\"gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={handleDeletePendingShift}\n              className=\"flex items-center gap-2\"\n            >\n              <Trash2 className=\"h-4 w-4\" />\n              Delete\n            </Button>\n            <Button\n              onClick={handleConfirmShift}\n              disabled={createShiftMutation.isPending}\n              className=\"flex items-center gap-2\"\n            >\n              <Check className=\"h-4 w-4\" />\n              {createShiftMutation.isPending ? \"Saving...\" : \"Confirm\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Shift Modal */}\n      <Dialog open={showEditDialog} onOpenChange={setShowEditDialog}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Edit Shift</DialogTitle>\n          </DialogHeader>\n          \n          {shiftToEdit && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"edit-shift-date\">Date</Label>\n                  <Input\n                    id=\"edit-shift-date\"\n                    type=\"date\"\n                    defaultValue={shiftToEdit.date}\n                    onChange={(e) => setShiftToEdit({...shiftToEdit, date: e.target.value})}\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"edit-shift-type\">Shift Type</Label>\n                  <Select\n                    value={shiftToEdit.shiftType}\n                    onValueChange={(value) => setShiftToEdit({...shiftToEdit, shiftType: value})}\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"morning\">Morning</SelectItem>\n                      <SelectItem value=\"evening\">Evening</SelectItem>\n                      <SelectItem value=\"night\">Night</SelectItem>\n                      <SelectItem value=\"double\">Double</SelectItem>\n                      <SelectItem value=\"custom\">Custom</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"edit-start-time\">Start Time</Label>\n                  <Select\n                    value={shiftToEdit.startTime}\n                    onValueChange={(value) => setShiftToEdit({...shiftToEdit, startTime: value})}\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {timeOptions.map((option) => (\n                        <SelectItem key={option.value} value={option.value}>\n                          {option.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"edit-end-time\">End Time</Label>\n                  <Select\n                    value={shiftToEdit.endTime}\n                    onValueChange={(value) => setShiftToEdit({...shiftToEdit, endTime: value})}\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {timeOptions.map((option) => (\n                        <SelectItem key={option.value} value={option.value}>\n                          {option.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"edit-shift-notes\">Notes</Label>\n                <Textarea\n                  id=\"edit-shift-notes\"\n                  placeholder=\"Add notes about this shift...\"\n                  defaultValue={shiftToEdit.notes || ''}\n                  onChange={(e) => setShiftToEdit({...shiftToEdit, notes: e.target.value})}\n                  rows={3}\n                />\n              </div>\n\n              <div className=\"p-3 bg-slate-50 rounded-lg\">\n                <div className=\"text-sm text-slate-600\">\n                  Duration: <span className=\"font-semibold\">{calculateDuration(shiftToEdit.startTime, shiftToEdit.endTime).toFixed(2)} hours</span>\n                </div>\n                <div className=\"text-sm text-slate-600\">\n                  Type: <span className=\"font-semibold capitalize\">{shiftToEdit.shiftType}</span>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <DialogFooter className=\"gap-2\">\n            <Button\n              variant=\"destructive\"\n              onClick={handleDeleteExistingShift}\n              disabled={deleteShiftMutation.isPending}\n              className=\"flex items-center gap-2\"\n            >\n              <Trash2 className=\"h-4 w-4\" />\n              {deleteShiftMutation.isPending ? 'Deleting...' : 'Delete'}\n            </Button>\n            <Button\n              onClick={() => {\n                if (shiftToEdit) {\n                  const { id, userId, createdAt, ...updateData } = shiftToEdit;\n                  handleUpdateShift(updateData);\n                }\n              }}\n              disabled={updateShiftMutation.isPending}\n              className=\"flex items-center gap-2\"\n            >\n              <Check className=\"h-4 w-4\" />\n              {updateShiftMutation.isPending ? \"Updating...\" : \"Update\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":54304},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"server/src/routes/health.ts":{"content":"import { Router } from \"express\";\nconst r = Router();\nr.get(\"/\", (_req, res) => res.json({ ok: true, ts: Date.now() }));\nexport default r;\n","size_bytes":139},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/pages/landing.tsx":{"content":"import { useState } from \"react\";\nimport { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Building2, User, Clock, BarChart3, Shield, Users, Timer, FileText, Calendar, TrendingUp } from \"lucide-react\";\n\nexport default function Landing() {\n  const [selectedPlan, setSelectedPlan] = useState<'individual' | 'business' | null>(null);\n\n  const individualFeatures = [\n    { icon: Timer, title: \"Personal Timer\", desc: \"Track your own shifts with precision\" },\n    { icon: Calendar, title: \"Personal Calendar\", desc: \"View and manage your schedule\" },\n    { icon: FileText, title: \"Reports & Export\", desc: \"Generate detailed shift reports\" },\n    { icon: BarChart3, title: \"Analytics\", desc: \"Track your productivity trends\" },\n  ];\n\n  const businessFeatures = [\n    { icon: Users, title: \"Team Management\", desc: \"Manage multiple employees and shifts\" },\n    { icon: Shield, title: \"Shift Approval\", desc: \"Review and approve employee timesheets\" },\n    { icon: TrendingUp, title: \"Advanced Analytics\", desc: \"Business insights and reporting\" },\n    { icon: Building2, title: \"Multi-location\", desc: \"Handle multiple business locations\" },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100\">\n      {/* Header */}\n      <header className=\"bg-white/80 backdrop-blur-sm border-b border-slate-200/50 sticky top-0 z-50\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center space-x-3\">\n              <Clock className=\"w-8 h-8 text-blue-600\" />\n              <h1 className=\"text-xl font-bold text-slate-900\">ShiftMate</h1>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <Link href=\"/login?type=individual\">\n                <Button variant=\"ghost\" size=\"sm\">Sign In</Button>\n              </Link>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n        {/* Hero Section */}\n        <div className=\"text-center mb-16\">\n          <h1 className=\"text-4xl md:text-6xl font-bold text-slate-900 mb-6\">\n            Everything in one place\n          </h1>\n          <p className=\"text-xl text-slate-600 max-w-3xl mx-auto mb-8\">\n            No more manual spreadsheets or outdated paper schedules. ShiftMate works seamlessly across desktop and mobile.\n          </p>\n          <div className=\"flex justify-center\">\n            <Badge variant=\"secondary\" className=\"px-4 py-2 text-sm\">\n              Try ShiftMate Premium for free, find the right plan later\n            </Badge>\n          </div>\n        </div>\n\n        {/* Plan Selection */}\n        <div className=\"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto mb-16\">\n          {/* Individual Plan */}\n          <Card className={`relative transition-all duration-300 hover:shadow-xl cursor-pointer ${\n            selectedPlan === 'individual' ? 'ring-2 ring-blue-500 shadow-lg' : ''\n          }`} onClick={() => setSelectedPlan('individual')}>\n            <CardContent className=\"p-8\">\n              <div className=\"text-center mb-6\">\n                <div className=\"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <User className=\"h-8 w-8 text-blue-600\" />\n                </div>\n                <h3 className=\"text-2xl font-bold text-slate-900 mb-2\">For Individuals</h3>\n                <p className=\"text-slate-600\">Perfect for freelancers and shift workers</p>\n              </div>\n\n              <div className=\"space-y-4 mb-8\">\n                {individualFeatures.map((feature, index) => (\n                  <div key={index} className=\"flex items-start space-x-3\">\n                    <feature.icon className=\"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0\" />\n                    <div>\n                      <p className=\"font-medium text-slate-900\">{feature.title}</p>\n                      <p className=\"text-sm text-slate-600\">{feature.desc}</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n\n              <div className=\"text-center\">\n                <div className=\"mb-4\">\n                  <span className=\"text-3xl font-bold text-slate-900\">Free</span>\n                  <span className=\"text-slate-600 ml-2\">to start</span>\n                </div>\n                <Link href=\"/login?type=individual\">\n                  <Button \n                    className=\"w-full bg-blue-600 hover:bg-blue-700\" \n                    size=\"lg\"\n                  >\n                    Join team on ShiftMate\n                  </Button>\n                </Link>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Business Plan */}\n          <Card className={`relative transition-all duration-300 hover:shadow-xl cursor-pointer ${\n            selectedPlan === 'business' ? 'ring-2 ring-indigo-500 shadow-lg' : ''\n          }`} onClick={() => setSelectedPlan('business')}>\n            <CardContent className=\"p-8\">\n              <div className=\"text-center mb-6\">\n                <div className=\"w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <Building2 className=\"h-8 w-8 text-indigo-600\" />\n                </div>\n                <h3 className=\"text-2xl font-bold text-slate-900 mb-2\">For Business</h3>\n                <p className=\"text-slate-600\">Manage teams and streamline operations</p>\n              </div>\n\n              <div className=\"space-y-4 mb-8\">\n                {businessFeatures.map((feature, index) => (\n                  <div key={index} className=\"flex items-start space-x-3\">\n                    <feature.icon className=\"h-5 w-5 text-indigo-600 mt-0.5 flex-shrink-0\" />\n                    <div>\n                      <p className=\"font-medium text-slate-900\">{feature.title}</p>\n                      <p className=\"text-sm text-slate-600\">{feature.desc}</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n\n              <div className=\"text-center\">\n                <div className=\"mb-4\">\n                  <span className=\"text-3xl font-bold text-slate-900\">$29</span>\n                  <span className=\"text-slate-600 ml-2\">per month</span>\n                </div>\n                <Link href=\"/login?type=business\">\n                  <Button \n                    className=\"w-full bg-indigo-600 hover:bg-indigo-700\" \n                    size=\"lg\"\n                  >\n                    Create business on ShiftMate\n                  </Button>\n                </Link>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Footer CTA */}\n        <div className=\"text-center\">\n          <p className=\"text-slate-600 mb-4\">Already have an account?</p>\n          <Link href=\"/login\">\n            <Button variant=\"outline\" size=\"lg\">Log in</Button>\n          </Link>\n        </div>\n      </main>\n    </div>\n  );\n}","size_bytes":7178},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/pages/my-roster.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useIndividualRosterShifts } from \"@/hooks/use-shifts\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { Clock, Plus, ChevronLeft, ChevronRight, CalendarIcon, User, ChevronDown } from \"lucide-react\";\nimport { formatTime, calculateDuration } from \"@/lib/time-utils\";\nimport { Link } from \"wouter\";\nimport type { Shift } from \"@shared/schema\";\nimport { PayBreakdown } from \"@/components/PayBreakdown\";\n\n// Helper function to get start of week (Monday)\nconst getStartOfWeek = (date: Date): Date => {\n  const d = new Date(date);\n  const day = d.getDay();\n  const diff = d.getDate() - day + (day === 0 ? -6 : 1); // Adjust for Sunday\n  return new Date(d.setDate(diff));\n};\n\n// Helper function to get week date range\nconst getWeekRange = (startDate: Date): Date[] => {\n  const dates: Date[] = [];\n  const current = new Date(startDate);\n  \n  for (let i = 0; i < 7; i++) {\n    dates.push(new Date(current));\n    current.setDate(current.getDate() + 1);\n  }\n  \n  return dates;\n};\n\n// Helper function to get shift color based on type (roster shifts have light colors)\nconst getShiftColor = (shiftType: string): string => {\n  const rosterColors = {\n    morning: 'bg-emerald-100 text-emerald-800 border-emerald-300',\n    afternoon: 'bg-blue-100 text-blue-800 border-blue-300',\n    evening: 'bg-blue-100 text-blue-800 border-blue-300', // Handle old 'evening' type\n    night: 'bg-indigo-100 text-indigo-800 border-indigo-300',\n    default: 'bg-gray-100 text-gray-800 border-gray-300'\n  };\n\n  const colorKey = shiftType.toLowerCase() as keyof typeof rosterColors;\n  return rosterColors[colorKey] || rosterColors.default;\n};\n\n// Mobile agenda view components\nconst MobileAgendaView = ({ \n  weekDates, \n  shiftsByDate, \n  onShiftClick \n}: { \n  weekDates: Date[]; \n  shiftsByDate: Record<string, Shift[]>; \n  onShiftClick: (shift: Shift) => void;\n}) => {\n  const [openDays, setOpenDays] = useState<Set<string>>(new Set());\n\n  const toggleDay = (dateStr: string) => {\n    const newOpenDays = new Set(openDays);\n    if (newOpenDays.has(dateStr)) {\n      newOpenDays.delete(dateStr);\n    } else {\n      newOpenDays.add(dateStr);\n    }\n    setOpenDays(newOpenDays);\n  };\n\n  return (\n    <div className=\"space-y-2\">\n      {weekDates.map(date => {\n        const dateStr = date.toISOString().split('T')[0];\n        const dayShifts = shiftsByDate[dateStr] || [];\n        const isToday = dateStr === new Date().toISOString().split('T')[0];\n        const isOpen = openDays.has(dateStr);\n        \n        return (\n          <Card key={dateStr} className={`${isToday ? 'ring-2 ring-blue-200 bg-blue-50/30' : ''}`}>\n            <Collapsible open={isOpen} onOpenChange={() => toggleDay(dateStr)}>\n              <CollapsibleTrigger asChild>\n                <CardHeader className=\"pb-3 cursor-pointer hover:bg-slate-50 transition-colors\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className={`text-center ${isToday ? 'text-blue-600' : 'text-slate-600'}`}>\n                        <div className=\"text-xs font-medium uppercase tracking-wide\">\n                          {date.toLocaleDateString('en-US', { weekday: 'short' })}\n                        </div>\n                        <div className={`text-lg font-bold ${isToday ? 'text-blue-600' : 'text-slate-900'}`}>\n                          {date.getDate()}\n                        </div>\n                      </div>\n                      <div>\n                        <h3 className={`font-medium ${isToday ? 'text-blue-900' : 'text-slate-900'}`}>\n                          {date.toLocaleDateString('en-US', { \n                            weekday: 'long', \n                            month: 'long', \n                            day: 'numeric' \n                          })}\n                        </h3>\n                        <p className=\"text-sm text-slate-600\">\n                          {dayShifts.length === 0 ? 'No shifts' : `${dayShifts.length} shift${dayShifts.length !== 1 ? 's' : ''}`}\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      {dayShifts.length > 0 && (\n                        <div className=\"text-sm font-medium text-slate-600\">\n                          {dayShifts.reduce((total, shift) => total + calculateDuration(shift.startTime, shift.endTime), 0).toFixed(1)}h\n                        </div>\n                      )}\n                      <ChevronDown className={`h-4 w-4 text-slate-400 transition-transform ${isOpen ? 'rotate-180' : ''}`} />\n                    </div>\n                  </div>\n                </CardHeader>\n              </CollapsibleTrigger>\n              \n              {dayShifts.length > 0 && (\n                <CollapsibleContent>\n                  <CardContent className=\"pt-0 space-y-3\">\n                    {dayShifts.map(shift => {\n                      const duration = calculateDuration(shift.startTime, shift.endTime);\n                      return (\n                        <div\n                          key={shift.id}\n                          data-testid={`mobile-shift-${shift.id}`}\n                          className={`p-4 rounded-lg cursor-pointer transition-all hover:shadow-md border-2 border-dashed ${getShiftColor(shift.shiftType)}`}\n                          onClick={() => onShiftClick(shift)}\n                        >\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex items-center gap-3 flex-1\">\n                              <CalendarIcon className=\"h-5 w-5 flex-shrink-0\" />\n                              <div className=\"flex-1 min-w-0\">\n                                <div className=\"font-semibold text-base capitalize\">\n                                  {shift.shiftType} Shift\n                                </div>\n                                <div className=\"text-sm opacity-90 font-medium\">\n                                  {formatTime(shift.startTime)} - {formatTime(shift.endTime)}\n                                </div>\n                                {shift.notes && (\n                                  <div className=\"text-sm opacity-75 mt-1 truncate\">\n                                    {shift.notes}\n                                  </div>\n                                )}\n                              </div>\n                            </div>\n                            <div className=\"text-right\">\n                              <div className=\"text-sm font-bold\">\n                                {duration.toFixed(1)}h\n                              </div>\n                              <div className=\"text-xs opacity-75\">\n                                Roster\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </CardContent>\n                </CollapsibleContent>\n              )}\n            </Collapsible>\n          </Card>\n        );\n      })}\n    </div>\n  );\n};\n\nexport default function MyRoster() {\n  const [currentWeekStart, setCurrentWeekStart] = useState(() => getStartOfWeek(new Date()));\n  const [selectedShift, setSelectedShift] = useState<Shift | null>(null);\n  \n  // Get week date range\n  const weekDates = useMemo(() => getWeekRange(currentWeekStart), [currentWeekStart]);\n  \n  // Get roster shifts for the week (only manager-planned shifts)\n  const startDate = weekDates[0].toISOString().split('T')[0];\n  const endDate = weekDates[6].toISOString().split('T')[0];\n  \n  const { data: shifts = [], isLoading } = useIndividualRosterShifts(startDate, endDate);\n\n  // Group shifts by date\n  const shiftsByDate = useMemo(() => {\n    const grouped: Record<string, Shift[]> = {};\n    shifts.forEach((shift: Shift) => {\n      if (!grouped[shift.date]) {\n        grouped[shift.date] = [];\n      }\n      grouped[shift.date].push(shift);\n    });\n    return grouped;\n  }, [shifts]);\n\n  // Calculate total hours for the week\n  const totalHours = useMemo(() => {\n    return shifts.reduce((total: number, shift: Shift) => {\n      return total + calculateDuration(shift.startTime, shift.endTime);\n    }, 0);\n  }, [shifts]);\n\n  const navigateWeeks = (direction: 'prev' | 'next') => {\n    const newDate = new Date(currentWeekStart);\n    newDate.setDate(newDate.getDate() + (direction === 'next' ? 7 : -7));\n    setCurrentWeekStart(newDate);\n  };\n\n  const goToCurrentWeek = () => {\n    setCurrentWeekStart(getStartOfWeek(new Date()));\n  };\n\n  const isCurrentWeek = () => {\n    const currentWeekStartDate = getStartOfWeek(new Date());\n    return currentWeekStart.toDateString() === currentWeekStartDate.toDateString();\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"p-4 lg:p-8\">\n        <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 h-96 flex items-center justify-center\">\n          <div className=\"text-slate-500\">Loading roster...</div>\n        </div>\n      </div>\n    );\n  }\n\n  const formatWeekRange = (dates: Date[]) => {\n    const firstDate = dates[0];\n    const lastDate = dates[6];\n    const firstMonth = firstDate.toLocaleDateString('en-US', { month: 'short' });\n    const lastMonth = lastDate.toLocaleDateString('en-US', { month: 'short' });\n    const year = firstDate.getFullYear();\n    \n    if (firstMonth === lastMonth) {\n      return `${firstMonth} ${firstDate.getDate()}-${lastDate.getDate()}, ${year}`;\n    } else {\n      return `${firstMonth} ${firstDate.getDate()} - ${lastMonth} ${lastDate.getDate()}, ${year}`;\n    }\n  };\n\n  return (\n    <div className=\"p-4 lg:p-8\">\n      <div className=\"space-y-4 md:space-y-6\">\n        {/* Mobile Summary Bar */}\n        <div className=\"md:hidden bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100\">\n          <div className=\"grid grid-cols-3 gap-4 text-center\">\n            <div>\n              <div className=\"text-xs text-slate-600 mb-1\">Total Hours</div>\n              <div className=\"text-lg font-bold text-slate-900\">{totalHours.toFixed(1)}h</div>\n            </div>\n            <div>\n              <div className=\"text-xs text-slate-600 mb-1\">Total Shifts</div>\n              <div className=\"text-lg font-bold text-slate-900\">{shifts.length}</div>\n            </div>\n            <div>\n              <div className=\"text-xs text-slate-600 mb-1\">Avg per Day</div>\n              <div className=\"text-lg font-bold text-slate-900\">\n                {shifts.length > 0 ? (totalHours / 7).toFixed(1) : 0}h\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Header with Navigation */}\n        <div className=\"flex flex-col gap-4 md:flex-row md:items-center md:justify-between\">\n          <div className=\"flex flex-col md:flex-row md:items-center md:space-x-4\">\n            <div className=\"mb-3 md:mb-0\">\n              <h1 className=\"text-xl font-semibold text-slate-900\">My Roster</h1>\n              <p className=\"text-sm text-slate-600\">{formatWeekRange(weekDates)}</p>\n              <p className=\"text-xs text-slate-500 mt-1\">Manager-assigned shifts only</p>\n            </div>\n            \n            {/* Navigation - Larger buttons for mobile */}\n            <div className=\"flex items-center space-x-3\">\n              <Button\n                variant=\"outline\"\n                size=\"default\"\n                data-testid=\"button-prev-week\"\n                onClick={() => navigateWeeks('prev')}\n                className=\"min-h-[44px] px-4\"\n              >\n                <ChevronLeft className=\"h-5 w-5 md:h-4 md:w-4\" />\n                <span className=\"ml-2 md:hidden\">Previous</span>\n              </Button>\n              <Button\n                variant=\"outline\"\n                size=\"default\"\n                data-testid=\"button-next-week\"\n                onClick={() => navigateWeeks('next')}\n                className=\"min-h-[44px] px-4\"\n              >\n                <ChevronRight className=\"h-5 w-5 md:h-4 md:w-4\" />\n                <span className=\"ml-2 md:hidden\">Next</span>\n              </Button>\n              {!isCurrentWeek() && (\n                <Button\n                  variant=\"outline\"\n                  size=\"default\"\n                  data-testid=\"button-today\"\n                  onClick={goToCurrentWeek}\n                  className=\"min-h-[44px] px-4\"\n                >\n                  Today\n                </Button>\n              )}\n            </div>\n          </div>\n          \n          {/* Desktop Summary and Add Button */}\n          <div className=\"flex flex-col md:flex-row md:items-center md:space-x-4 gap-3 md:gap-0\">\n            <div className=\"hidden md:block text-sm text-slate-600\">\n              Total Hours: <span className=\"font-semibold\">{totalHours.toFixed(1)}h</span>\n            </div>\n            <Link href=\"/add-shift\">\n              <Button size=\"default\" className=\"min-h-[44px] w-full md:w-auto\" data-testid=\"button-add-shift\">\n                <Plus className=\"h-5 w-5 md:h-4 md:w-4 mr-2\" />\n                Add Shift\n              </Button>\n            </Link>\n          </div>\n        </div>\n\n        {/* Roster Agenda View */}\n        <MobileAgendaView \n          weekDates={weekDates}\n          shiftsByDate={shiftsByDate}\n          onShiftClick={setSelectedShift}\n        />\n\n        {/* Shift Details Dialog */}\n        <Dialog open={!!selectedShift} onOpenChange={() => setSelectedShift(null)}>\n          <DialogContent className=\"sm:max-w-[425px]\">\n            <DialogHeader>\n              <DialogTitle>Shift Details</DialogTitle>\n            </DialogHeader>\n            {selectedShift && (\n              <div className=\"space-y-4\">\n                {/* Roster Shift Indicator */}\n                <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-center gap-2\">\n                  <CalendarIcon className=\"h-4 w-4 text-blue-600\" />\n                  <div className=\"text-sm text-blue-800\">\n                    <div className=\"font-medium\">Roster Shift</div>\n                    <div className=\"text-xs\">This shift was assigned by your manager</div>\n                  </div>\n                </div>\n                \n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"text-sm font-medium text-slate-600\">Date</label>\n                    <div className=\"text-sm text-slate-900\">\n                      {new Date(selectedShift.date).toLocaleDateString('en-US', { \n                        weekday: 'long', \n                        year: 'numeric', \n                        month: 'long', \n                        day: 'numeric' \n                      })}\n                    </div>\n                  </div>\n                  <div>\n                    <label className=\"text-sm font-medium text-slate-600\">Shift Type</label>\n                    <div className=\"text-sm text-slate-900\">{selectedShift.shiftType}</div>\n                  </div>\n                </div>\n                \n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"text-sm font-medium text-slate-600\">Start Time</label>\n                    <div className=\"text-sm text-slate-900\">{formatTime(selectedShift.startTime)}</div>\n                  </div>\n                  <div>\n                    <label className=\"text-sm font-medium text-slate-600\">End Time</label>\n                    <div className=\"text-sm text-slate-900\">{formatTime(selectedShift.endTime)}</div>\n                  </div>\n                </div>\n                \n                <div>\n                  <label className=\"text-sm font-medium text-slate-600\">Duration</label>\n                  <div className=\"text-sm text-slate-900\">\n                    {calculateDuration(selectedShift.startTime, selectedShift.endTime).toFixed(1)} hours\n                  </div>\n                </div>\n                \n                {/* Pay Breakdown Section */}\n                <PayBreakdown shift={selectedShift} />\n                \n                {selectedShift.notes && (\n                  <div>\n                    <label className=\"text-sm font-medium text-slate-600\">Notes</label>\n                    <div className=\"text-sm text-slate-900 bg-slate-50 p-3 rounded-lg mt-1\">\n                      {selectedShift.notes}\n                    </div>\n                  </div>\n                )}\n                \n                {!selectedShift.notes && (\n                  <div className=\"text-sm text-slate-500 italic\">\n                    No notes added for this shift.\n                  </div>\n                )}\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n\n        {/* Desktop Summary Stats (hidden on mobile - mobile has summary bar at top) */}\n        <div className=\"hidden md:grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center\">\n                <Clock className=\"h-5 w-5 text-blue-600 mr-2\" />\n                <div>\n                  <div className=\"text-sm text-slate-600\">Total Hours</div>\n                  <div className=\"text-xl font-semibold\">{totalHours.toFixed(1)}h</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center\">\n                <div className=\"w-5 h-5 bg-emerald-500 rounded mr-2\"></div>\n                <div>\n                  <div className=\"text-sm text-slate-600\">Total Shifts</div>\n                  <div className=\"text-xl font-semibold\">{shifts.length}</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center\">\n                <div className=\"w-5 h-5 bg-blue-500 rounded mr-2\"></div>\n                <div>\n                  <div className=\"text-sm text-slate-600\">Avg per Day</div>\n                  <div className=\"text-xl font-semibold\">\n                    {shifts.length > 0 ? (totalHours / 7).toFixed(1) : 0}h\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":18796},"client/src/lib/export.ts":{"content":"import { Shift } from \"@shared/schema\";\n\nexport interface ExportOptions {\n  format: 'pdf' | 'csv';\n  startDate: string;\n  endDate: string;\n  includeDetails: boolean;\n  includeSummary: boolean;\n  includeAverages: boolean;\n  includeMissing: boolean;\n}\n\n// Helper function to format date as dd/mm/yyyy\nfunction formatDateDDMMYYYY(dateString: string): string {\n  const date = new Date(dateString);\n  const day = date.getDate().toString().padStart(2, '0');\n  const month = (date.getMonth() + 1).toString().padStart(2, '0');\n  const year = date.getFullYear();\n  return `${day}/${month}/${year}`;\n}\n\n// Format date range helper function  \nfunction formatDateRange(startDate: string, endDate: string): string {\n  return `${formatDateDDMMYYYY(startDate)} to ${formatDateDDMMYYYY(endDate)}`;\n}\n\nexport function exportToCSV(shifts: Shift[], options: ExportOptions): void {\n  // Sort shifts from oldest to newest\n  const sortedShifts = [...shifts].sort((a, b) => a.date.localeCompare(b.date));\n  \n  const headers = ['Date', 'Shift Type', 'Start Time', 'End Time', 'Duration (hours)', 'Notes'];\n  const rows = sortedShifts.map(shift => {\n    const start = new Date(`2000-01-01T${shift.startTime}`);\n    const end = new Date(`2000-01-01T${shift.endTime}`);\n    \n    // Handle overnight shifts\n    if (end < start) {\n      end.setDate(end.getDate() + 1);\n    }\n    \n    const duration = (end.getTime() - start.getTime()) / (1000 * 60 * 60);\n    \n    return [\n      formatDateDDMMYYYY(shift.date),\n      shift.shiftType,\n      shift.startTime,\n      shift.endTime,\n      duration.toFixed(2),\n      shift.notes || ''\n    ];\n  });\n\n  const csvContent = [headers, ...rows]\n    .map(row => row.map(cell => `\"${cell}\"`).join(','))\n    .join('\\n');\n\n  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n  const link = document.createElement('a');\n  const url = URL.createObjectURL(blob);\n  \n  link.setAttribute('href', url);\n  link.setAttribute('download', 'Shift Report.csv');\n  link.style.visibility = 'hidden';\n  \n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n}\n\nfunction generateShiftTableRows(shifts: Shift[]): string {\n  // Group shifts by date\n  const shiftsByDate: { [key: string]: Shift[] } = {};\n  shifts.forEach(shift => {\n    if (!shiftsByDate[shift.date]) {\n      shiftsByDate[shift.date] = [];\n    }\n    shiftsByDate[shift.date].push(shift);\n  });\n  \n  let tableRows = '';\n  \n  // Process each date\n  Object.keys(shiftsByDate).sort().forEach(date => {\n    const dayShifts = shiftsByDate[date];\n    \n    // Sort shifts by type (morning first) then by start time\n    const typeOrder: { [key: string]: number } = { 'morning': 1, 'evening': 2, 'night': 3, 'double': 4, 'custom': 5 };\n    dayShifts.sort((a, b) => {\n      const typeA = typeOrder[a.shiftType] || 6;\n      const typeB = typeOrder[b.shiftType] || 6;\n      if (typeA !== typeB) return typeA - typeB;\n      return a.startTime.localeCompare(b.startTime);\n    });\n    \n    // Calculate daily total\n    let dailyTotal = 0;\n    dayShifts.forEach(shift => {\n      const start = new Date('2000-01-01T' + shift.startTime);\n      const end = new Date('2000-01-01T' + shift.endTime);\n      if (end < start) end.setDate(end.getDate() + 1);\n      dailyTotal += (end.getTime() - start.getTime()) / (1000 * 60 * 60);\n    });\n    \n    // Get day name\n    const dayName = new Date(date).toLocaleDateString('en-US', { weekday: 'long' });\n    \n    // Add daily total row\n    tableRows += `<tr class=\"daily-total-row\">\n        <td><strong>${dayName}</strong></td>\n        <td><strong>${formatDateDDMMYYYY(date)}</strong></td>\n        <td><strong>DAILY TOTAL</strong></td>\n        <td>-</td>\n        <td>-</td>\n        <td><strong>${dailyTotal.toFixed(2)}h</strong></td>\n        <td>-</td>\n      </tr>`;\n    \n    // Add individual shifts\n    dayShifts.forEach(shift => {\n      const start = new Date('2000-01-01T' + shift.startTime);\n      const end = new Date('2000-01-01T' + shift.endTime);\n      if (end < start) end.setDate(end.getDate() + 1);\n      const duration = (end.getTime() - start.getTime()) / (1000 * 60 * 60);\n      \n      tableRows += `<tr>\n          <td>${dayName}</td>\n          <td>${formatDateDDMMYYYY(date)}</td>\n          <td><span class=\"shift-type ${shift.shiftType}\">${shift.shiftType}</span></td>\n          <td>${shift.startTime}</td>\n          <td>${shift.endTime}</td>\n          <td>${duration.toFixed(2)}h</td>\n          <td>${shift.notes ? shift.notes.substring(0, 20) + (shift.notes.length > 20 ? '...' : '') : '-'}</td>\n        </tr>`;\n    });\n  });\n  \n  // Add grand total\n  tableRows += `<tr class=\"total-highlight\">\n      <td colspan=\"5\"><strong>GRAND TOTAL</strong></td>\n      <td><strong>${calculateTotalHours(shifts).toFixed(2)}h</strong></td>\n      <td><strong>${shifts.length} shifts</strong></td>\n    </tr>`;\n  \n  return tableRows;\n}\n\nexport function exportToPDF(shifts: Shift[], options: ExportOptions): void {\n  const totalHours = calculateTotalHours(shifts);\n  \n  // Sort shifts chronologically by date and time\n  const sortedShifts = [...shifts].sort((a, b) => {\n    const dateCompare = new Date(a.date).getTime() - new Date(b.date).getTime();\n    if (dateCompare !== 0) return dateCompare;\n    return a.startTime.localeCompare(b.startTime);\n  });\n\n  // Group shifts by date and calculate daily totals\n  const shiftsByDate = new Map<string, Shift[]>();\n  sortedShifts.forEach(shift => {\n    if (!shiftsByDate.has(shift.date)) {\n      shiftsByDate.set(shift.date, []);\n    }\n    shiftsByDate.get(shift.date)!.push(shift);\n  });\n\n  let tableRows = '';\n  \n  // Generate rows for each day\n  shiftsByDate.forEach((dayShifts, date) => {\n    const dayName = new Date(date + 'T00:00:00').toLocaleDateString('en-GB', { weekday: 'short' });\n    let dailyTotal = 0;\n    \n    // Add shifts for this day\n    dayShifts.forEach(shift => {\n      const start = new Date('2000-01-01T' + shift.startTime);\n      const end = new Date('2000-01-01T' + shift.endTime);\n      if (end < start) end.setDate(end.getDate() + 1);\n      const duration = (end.getTime() - start.getTime()) / (1000 * 60 * 60);\n      dailyTotal += duration;\n      \n      tableRows += `<tr>\n          <td>${dayName}</td>\n          <td>${formatDateDDMMYYYY(date)}</td>\n          <td>${shift.shiftType}</td>\n          <td>${shift.startTime}</td>\n          <td>${shift.endTime}</td>\n          <td>${duration.toFixed(2)}h</td>\n          <td>${shift.notes || '-'}</td>\n        </tr>`;\n    });\n    \n    // Add daily total row\n    tableRows += `<tr class=\"daily-total\">\n        <td colspan=\"5\"><strong>Daily Total</strong></td>\n        <td><strong>${dailyTotal.toFixed(2)}h</strong></td>\n        <td>-</td>\n      </tr>`;\n  });\n  \n  // Add period total\n  tableRows += `<tr class=\"period-total\">\n      <td colspan=\"5\"><strong>Period Total</strong></td>\n      <td><strong>${totalHours.toFixed(2)}h</strong></td>\n      <td>-</td>\n    </tr>`;\n\n  const htmlContent = `\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset=\"utf-8\">\n      <title>Shift Report</title>\n      <style>\n        @page { size: A4; margin: 15mm; }\n        body { \n          font-family: Arial, sans-serif; \n          font-size: 11px; \n          line-height: 1.3; \n          color: #333; \n          margin: 0; \n          padding: 0; \n        }\n        .header {\n          text-align: center;\n          margin-bottom: 20px;\n          padding-bottom: 10px;\n          border-bottom: 1px solid #ddd;\n        }\n        .header h1 {\n          font-size: 18px;\n          margin: 0 0 5px 0;\n          color: #333;\n        }\n        .header p {\n          font-size: 12px;\n          color: #666;\n          margin: 0;\n        }\n        table {\n          width: 100%;\n          border-collapse: collapse;\n          font-size: 11px;\n        }\n        th {\n          background: #f5f5f5;\n          border: 1px solid #ddd;\n          padding: 8px 6px;\n          font-weight: 600;\n          text-align: center;\n        }\n        td {\n          border: 1px solid #ddd;\n          padding: 6px;\n          text-align: center;\n        }\n        .daily-total {\n          background: #2563eb;\n          color: white;\n          font-weight: bold;\n        }\n        .period-total {\n          background: #1e40af;\n          color: white;\n          font-weight: bold;\n          font-size: 12px;\n        }\n      </style>\n    </head>\n    <body>\n      <div class=\"header\">\n        <h1>Shift Report</h1>\n        <p>${formatDateRange(options.startDate, options.endDate)}</p>\n      </div>\n\n      <table>\n        <thead>\n          <tr>\n            <th>Day</th>\n            <th>Date</th>\n            <th>Type</th>\n            <th>Start</th>\n            <th>End</th>\n            <th>Duration</th>\n            <th>Notes</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${tableRows}\n        </tbody>\n      </table>\n    </body>\n    </html>\n  `;\n\n  // Open print dialog for PDF generation\n  const printWindow = window.open('', '_blank');\n  if (printWindow) {\n    printWindow.document.write(htmlContent);\n    printWindow.document.close();\n    printWindow.document.title = 'Shift Report';\n    printWindow.focus();\n    printWindow.print();\n  }\n}\n\nfunction calculateTotalHours(shifts: Shift[]): number {\n  return shifts.reduce((total, shift) => {\n    const start = new Date(`2000-01-01T${shift.startTime}`);\n    const end = new Date(`2000-01-01T${shift.endTime}`);\n    \n    if (end < start) {\n      end.setDate(end.getDate() + 1);\n    }\n    \n    const duration = (end.getTime() - start.getTime()) / (1000 * 60 * 60);\n    return total + duration;\n  }, 0);\n}\n\nfunction calculateDailyHours(shifts: Shift[]): { date: string; totalHours: number }[] {\n  const dailyTotals = new Map<string, number>();\n  \n  shifts.forEach(shift => {\n    const start = new Date(`2000-01-01T${shift.startTime}`);\n    const end = new Date(`2000-01-01T${shift.endTime}`);\n    \n    if (end < start) {\n      end.setDate(end.getDate() + 1);\n    }\n    \n    const duration = (end.getTime() - start.getTime()) / (1000 * 60 * 60);\n    const currentTotal = dailyTotals.get(shift.date) || 0;\n    dailyTotals.set(shift.date, currentTotal + duration);\n  });\n  \n  return Array.from(dailyTotals.entries())\n    .map(([date, totalHours]) => ({ date, totalHours }))\n    .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\n}\n","size_bytes":10327},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/lib/auth.ts":{"content":"import { apiRequest } from \"./queryClient\";\n\nexport interface User {\n  id: number;\n  email: string;\n  name: string;\n  createdAt: string;\n}\n\nexport interface AuthResponse {\n  user: User;\n}\n\nexport async function login(email: string, name: string, rememberMe = false): Promise<AuthResponse & { accessToken?: string }> {\n  const response = await apiRequest(\"POST\", \"/api/auth/login\", { email, name, rememberMe });\n  const data = await response.json();\n  \n  console.log('Login response data:', { hasUser: !!data.user, hasAccessToken: !!data.accessToken });\n  \n  // Store access token if provided\n  if (data.accessToken) {\n    const { setAccessToken } = await import('@/lib/queryClient');\n    setAccessToken(data.accessToken);\n    console.log('Access token stored successfully');\n  } else {\n    console.log('No access token in login response');\n  }\n\n  return data;\n}\n\nexport async function logout(): Promise<void> {\n  await apiRequest(\"POST\", \"/api/auth/logout\");\n  // Clear stored access token\n  const { setAccessToken } = await import('@/lib/queryClient');\n  setAccessToken(null);\n}\n\nexport async function getCurrentUser(): Promise<AuthResponse | null> {\n  try {\n    const response = await apiRequest(\"GET\", \"/api/auth/me\");\n    return response.json();\n  } catch (error) {\n    return null;\n  }\n}\n","size_bytes":1293},"client/src/pages/shifts.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Edit, Trash2, Check, Clock, Filter, Search, Calendar, FileText, BarChart3 } from \"lucide-react\";\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, LabelList } from \"recharts\";\nimport { usePersonalShifts, useIndividualRosterShifts, useUpdateShift, useDeleteShift } from \"@/hooks/use-shifts\";\nimport { generateTimeOptions, formatTime, calculateDuration, formatDateRange, getWeekDates } from \"@/lib/time-utils\";\nimport { exportToCSV, exportToPDF } from \"@/lib/export\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Shift } from \"@shared/schema\";\n\n// Extended type for shifts with roster indicator\ntype ExtendedShift = Shift & { isRosterShift: boolean };\n\nexport default function Shifts() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [filterType, setFilterType] = useState(\"all\");\n  const [showEditDialog, setShowEditDialog] = useState(false);\n  const [shiftToEdit, setShiftToEdit] = useState<ExtendedShift | null>(null);\n  \n  // Date range filter state\n  const currentWeek = getWeekDates(new Date());\n  const [startDate, setStartDate] = useState(currentWeek.start);\n  const [endDate, setEndDate] = useState(currentWeek.end);\n  \n  // Fetch both personal and roster shifts separately\n  const { data: personalShifts = [], isLoading: isLoadingPersonal } = usePersonalShifts();\n  const { data: rosterShifts = [], isLoading: isLoadingRoster } = useIndividualRosterShifts();\n  \n  const shiftsLoading = isLoadingPersonal || isLoadingRoster;\n  \n  // Combine shifts with type indicators\n  const allShifts = useMemo((): ExtendedShift[] => [\n    ...personalShifts.map((shift: Shift) => ({ ...shift, isRosterShift: false })),\n    ...rosterShifts.map((shift: Shift) => ({ ...shift, isRosterShift: true }))\n  ], [personalShifts, rosterShifts]);\n  \n  const updateShiftMutation = useUpdateShift();\n  const deleteShiftMutation = useDeleteShift();\n  const { toast } = useToast();\n\n  const timeOptions = generateTimeOptions();\n\n  // Filter shifts by date range, search term, and type\n  const filteredShifts = useMemo(() => {\n    if (!allShifts) return [];\n    \n    return allShifts.filter(shift => {\n      // Date range filter\n      const shiftDate = shift.date;\n      const isInDateRange = shiftDate >= startDate && shiftDate <= endDate;\n      \n      // Search filter\n      const matchesSearch = shift.shiftType.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        shift.date.includes(searchTerm) ||\n        (shift.notes && shift.notes.toLowerCase().includes(searchTerm.toLowerCase()));\n      \n      // Type filter\n      const matchesType = filterType === \"all\" || shift.shiftType === filterType;\n      \n      return isInDateRange && matchesSearch && matchesType;\n    });\n  }, [allShifts, startDate, endDate, searchTerm, filterType]);\n\n  // Calculate total hours for filtered shifts\n  const totalFilteredHours = useMemo(() => {\n    return filteredShifts.reduce((total, shift) => \n      total + calculateDuration(shift.startTime, shift.endTime), 0\n    );\n  }, [filteredShifts]);\n\n  // Prepare chart data for filtered shifts (including all days in range)\n  const chartData = useMemo(() => {\n    // Generate all dates in the selected range\n    const startDateObj = new Date(startDate);\n    const endDateObj = new Date(endDate);\n    const dateRange: Date[] = [];\n    \n    for (let d = new Date(startDateObj); d <= endDateObj; d.setDate(d.getDate() + 1)) {\n      dateRange.push(new Date(d));\n    }\n\n    // Group shifts by date\n    const shiftsByDate = filteredShifts.reduce((acc, shift) => {\n      const date = shift.date;\n      if (!acc[date]) {\n        acc[date] = [];\n      }\n      acc[date].push(shift);\n      return acc;\n    }, {} as Record<string, any[]>);\n\n    // Create chart data for each date in the range (including days with no shifts)\n    return dateRange.map((currentDate) => {\n      const dateString = currentDate.toISOString().split('T')[0];\n      const dayName = currentDate.toLocaleDateString('en-US', { weekday: 'short' });\n      const formattedDate = `${dayName} ${currentDate.getMonth() + 1}/${currentDate.getDate()}`;\n      \n      const shifts = shiftsByDate[dateString] || [];\n      \n      // Calculate total hours and shift type breakdown\n      const totalHours = shifts.reduce((sum, shift) => \n        sum + calculateDuration(shift.startTime, shift.endTime), 0);\n      \n      const shiftTypeHours = {\n        morningHours: 0,\n        eveningHours: 0,\n        nightHours: 0,\n        doubleHours: 0,\n        customHours: 0\n      };\n      \n      shifts.forEach((shift) => {\n        const duration = Number(calculateDuration(shift.startTime, shift.endTime).toFixed(2));\n        switch (shift.shiftType) {\n          case 'morning':\n            shiftTypeHours.morningHours += duration;\n            break;\n          case 'evening':\n            shiftTypeHours.eveningHours += duration;\n            break;\n          case 'night':\n            shiftTypeHours.nightHours += duration;\n            break;\n          case 'double':\n            shiftTypeHours.doubleHours += duration;\n            break;\n          case 'custom':\n            shiftTypeHours.customHours += duration;\n            break;\n        }\n      });\n\n      // Round all shift type hours to 2 decimal places\n      Object.keys(shiftTypeHours).forEach(key => {\n        shiftTypeHours[key as keyof typeof shiftTypeHours] = Number(\n          shiftTypeHours[key as keyof typeof shiftTypeHours].toFixed(2)\n        );\n      });\n\n      return {\n        day: formattedDate,\n        date: dateString,\n        totalHours: Number(totalHours.toFixed(2)),\n        shiftsCount: shifts.length,\n        shifts: shifts,\n        ...shiftTypeHours\n      };\n    });\n  }, [filteredShifts, startDate, endDate]);\n\n  // Handle report generation\n  const handleGenerateReport = (format: 'pdf' | 'csv') => {\n    const options = {\n      format,\n      startDate,\n      endDate,\n      includeDetails: true,\n      includeSummary: true,\n      includeAverages: true,\n      includeMissing: false\n    };\n\n    if (format === 'csv') {\n      exportToCSV(filteredShifts, options);\n    } else {\n      exportToPDF(filteredShifts, options);\n    }\n\n    toast({\n      title: \"Report Generated\",\n      description: `${format.toUpperCase()} report for ${formatDateRange(startDate, endDate)} has been downloaded.`,\n    });\n  };\n\n  // Sort filtered shifts by date (most recent first)\n  const displayShifts = useMemo(() => {\n    return filteredShifts.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\n  }, [filteredShifts]);\n\n  const handleEditShift = (shift: ExtendedShift) => {\n    // Only allow editing personal shifts, not roster shifts\n    if (shift.isRosterShift) {\n      toast({\n        title: \"Cannot Edit Roster Shift\",\n        description: \"This shift was assigned by your manager and cannot be edited.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    setShiftToEdit(shift);\n    setShowEditDialog(true);\n  };\n\n  const handleUpdateShift = async (shiftData: any) => {\n    if (!shiftToEdit) return;\n\n    try {\n      await updateShiftMutation.mutateAsync({ \n        id: shiftToEdit.id, \n        ...shiftData \n      });\n      \n      toast({\n        title: \"Success\",\n        description: \"Shift updated successfully!\",\n      });\n      \n      setShowEditDialog(false);\n      setShiftToEdit(null);\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update shift. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleDeleteShift = async (shift: ExtendedShift) => {\n    // Only allow deleting personal shifts, not roster shifts\n    if (shift.isRosterShift) {\n      toast({\n        title: \"Cannot Delete Roster Shift\",\n        description: \"This shift was assigned by your manager and cannot be deleted.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    try {\n      await deleteShiftMutation.mutateAsync(shift.id);\n      toast({\n        title: \"Success\",\n        description: \"Shift deleted successfully!\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete shift. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const shiftTypeColors = {\n    morning: 'bg-emerald-500',\n    evening: 'bg-amber-500',\n    night: 'bg-indigo-500',\n    double: 'bg-red-500',\n    custom: 'bg-violet-500'\n  };\n\n  const getShiftTypeVariant = (type: string) => {\n    const variants: Record<string, \"default\" | \"secondary\" | \"destructive\" | \"outline\"> = {\n      morning: \"default\",\n      evening: \"secondary\", \n      night: \"outline\",\n      double: \"destructive\",\n      custom: \"secondary\"\n    };\n    return variants[type] || \"outline\";\n  };\n\n  return (\n    <div className=\"p-4 lg:p-8 space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold text-slate-900\">All Shifts</h1>\n        <p className=\"text-slate-600\">View, edit, and manage your shift history</p>\n      </div>\n\n      {/* Enhanced Search, Filter, and Date Range Controls */}\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"space-y-4\">\n            {/* Date Range Filter */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"start-date\" className=\"text-sm font-medium text-slate-700\">\n                  Start Date\n                </Label>\n                <Input\n                  id=\"start-date\"\n                  type=\"date\"\n                  value={startDate}\n                  onChange={(e) => setStartDate(e.target.value)}\n                  className=\"mt-1\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"end-date\" className=\"text-sm font-medium text-slate-700\">\n                  End Date\n                </Label>\n                <Input\n                  id=\"end-date\"\n                  type=\"date\"\n                  value={endDate}\n                  onChange={(e) => setEndDate(e.target.value)}\n                  className=\"mt-1\"\n                />\n              </div>\n            </div>\n\n            {/* Search and Type Filter */}\n            <div className=\"flex flex-col sm:flex-row gap-4\">\n              <div className=\"flex-1\">\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 h-4 w-4\" />\n                  <Input\n                    placeholder=\"Search shifts by type, date, notes, or time...\"\n                    value={searchTerm}\n                    onChange={(e) => setSearchTerm(e.target.value)}\n                    className=\"pl-10\"\n                  />\n                </div>\n              </div>\n              <div className=\"sm:w-48\">\n                <Select value={filterType} onValueChange={setFilterType}>\n                  <SelectTrigger>\n                    <Filter className=\"h-4 w-4 mr-2\" />\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All Types</SelectItem>\n                    <SelectItem value=\"morning\">Morning</SelectItem>\n                    <SelectItem value=\"evening\">Evening</SelectItem>\n                    <SelectItem value=\"night\">Night</SelectItem>\n                    <SelectItem value=\"double\">Double</SelectItem>\n                    <SelectItem value=\"custom\">Custom</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            {/* Total Hours and Report Generation */}\n            <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 p-4 bg-slate-50 rounded-lg\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"flex items-center gap-2\">\n                  <Clock className=\"h-5 w-5 text-slate-600\" />\n                  <div>\n                    <p className=\"text-sm font-medium text-slate-900\">\n                      Total Hours: {totalFilteredHours.toFixed(2)}\n                    </p>\n                    <p className=\"text-xs text-slate-600\">\n                      {formatDateRange(startDate, endDate)}\n                    </p>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Calendar className=\"h-5 w-5 text-slate-600\" />\n                  <div>\n                    <p className=\"text-sm font-medium text-slate-900\">\n                      {filteredShifts.length} Shifts\n                    </p>\n                    <p className=\"text-xs text-slate-600\">\n                      {chartData.length} Days\n                    </p>\n                  </div>\n                </div>\n              </div>\n              <div className=\"flex gap-2\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => handleGenerateReport('csv')}\n                  disabled={filteredShifts.length === 0}\n                >\n                  <FileText className=\"h-4 w-4 mr-2\" />\n                  CSV Report\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => handleGenerateReport('pdf')}\n                  disabled={filteredShifts.length === 0}\n                >\n                  <FileText className=\"h-4 w-4 mr-2\" />\n                  PDF Report\n                </Button>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Bar Chart for Selected Date Range */}\n      {chartData.length > 0 && (\n        <Card>\n          <CardContent className=\"p-6\">\n            <h3 className=\"text-lg font-semibold text-slate-900 mb-4\">Daily Hours Breakdown</h3>\n            <div className=\"h-64\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <BarChart data={chartData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>\n                  <CartesianGrid strokeDasharray=\"3 3\" />\n                  <XAxis \n                    dataKey=\"day\" \n                    tick={{ fontSize: 12 }}\n                    angle={-45}\n                    textAnchor=\"end\"\n                    height={60}\n                  />\n                  <YAxis \n                    tick={{ fontSize: 12 }}\n                    label={{ value: 'Hours', angle: -90, position: 'insideLeft' }}\n                  />\n                  <Tooltip\n                    content={({ active, payload, label }) => {\n                      if (active && payload && payload.length > 0) {\n                        const data = payload[0].payload;\n                        return (\n                          <div className=\"bg-white p-3 border border-slate-200 rounded-lg shadow-lg\">\n                            <p className=\"font-medium text-slate-900 mb-2\">{label}</p>\n                            {data.shiftsCount > 0 ? (\n                              <div className=\"space-y-1\">\n                                <p className=\"text-sm font-medium text-slate-900\">\n                                  Total: {data.totalHours} hours ({data.shiftsCount} shift{data.shiftsCount > 1 ? 's' : ''})\n                                </p>\n                                <div className=\"space-y-1 mt-2\">\n                                  {data.morningHours > 0 && (\n                                    <div className=\"flex items-center gap-2 text-xs\">\n                                      <div className=\"w-3 h-3 rounded-full bg-emerald-500\"></div>\n                                      <span>Morning: {data.morningHours} hours</span>\n                                    </div>\n                                  )}\n                                  {data.eveningHours > 0 && (\n                                    <div className=\"flex items-center gap-2 text-xs\">\n                                      <div className=\"w-3 h-3 rounded-full bg-amber-500\"></div>\n                                      <span>Evening: {data.eveningHours} hours</span>\n                                    </div>\n                                  )}\n                                  {data.nightHours > 0 && (\n                                    <div className=\"flex items-center gap-2 text-xs\">\n                                      <div className=\"w-3 h-3 rounded-full bg-indigo-500\"></div>\n                                      <span>Night: {data.nightHours} hours</span>\n                                    </div>\n                                  )}\n                                  {data.doubleHours > 0 && (\n                                    <div className=\"flex items-center gap-2 text-xs\">\n                                      <div className=\"w-3 h-3 rounded-full bg-red-500\"></div>\n                                      <span>Double: {data.doubleHours} hours</span>\n                                    </div>\n                                  )}\n                                  {data.customHours > 0 && (\n                                    <div className=\"flex items-center gap-2 text-xs\">\n                                      <div className=\"w-3 h-3 rounded-full bg-violet-500\"></div>\n                                      <span>Custom: {data.customHours} hours</span>\n                                    </div>\n                                  )}\n                                </div>\n                                {data.shifts && data.shifts.length > 0 && (\n                                  <div className=\"mt-2 pt-2 border-t border-slate-200\">\n                                    <p className=\"text-xs font-medium text-slate-700 mb-1\">Individual Shifts:</p>\n                                    {data.shifts.map((shift: any, index: number) => (\n                                      <div key={shift.id} className=\"text-xs text-slate-600 bg-slate-50 p-1.5 rounded mb-1\">\n                                        <div className=\"font-medium capitalize\">{shift.shiftType}</div>\n                                        <div>{formatTime(shift.startTime)} - {formatTime(shift.endTime)}</div>\n                                        <div>{calculateDuration(shift.startTime, shift.endTime).toFixed(2)} hours</div>\n                                      </div>\n                                    ))}\n                                  </div>\n                                )}\n                              </div>\n                            ) : (\n                              <p className=\"text-sm text-slate-500\">No shifts</p>\n                            )}\n                          </div>\n                        );\n                      }\n                      return null;\n                    }}\n                  />\n                  <Bar dataKey=\"morningHours\" stackId=\"shifts\" fill=\"#10b981\" name=\"Morning Shifts\" />\n                  <Bar dataKey=\"eveningHours\" stackId=\"shifts\" fill=\"#f59e0b\" name=\"Evening Shifts\" />\n                  <Bar dataKey=\"nightHours\" stackId=\"shifts\" fill=\"#6366f1\" name=\"Night Shifts\" />\n                  <Bar dataKey=\"doubleHours\" stackId=\"shifts\" fill=\"#ef4444\" name=\"Double Shifts\" />\n                  <Bar dataKey=\"customHours\" stackId=\"shifts\" fill=\"#8b5cf6\" name=\"Custom Shifts\">\n                    <LabelList \n                      dataKey=\"totalHours\" \n                      position=\"top\" \n                      style={{ \n                        fontSize: '12px', \n                        fontWeight: '600',\n                        fill: '#374151'\n                      }}\n                      formatter={(value: number) => value > 0 ? `${value}h` : ''}\n                    />\n                  </Bar>\n                </BarChart>\n              </ResponsiveContainer>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {chartData.length === 0 && filteredShifts.length === 0 && (\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"text-center py-8\">\n              <BarChart3 className=\"h-12 w-12 mx-auto mb-3 text-slate-300\" />\n              <p className=\"text-lg font-medium text-slate-900\">No shifts found</p>\n              <p className=\"text-slate-600\">Try adjusting your date range or search filters</p>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Shifts List */}\n      <Card>\n        <CardContent className=\"p-0\">\n          {shiftsLoading ? (\n            <div className=\"divide-y divide-slate-200\">\n              {Array.from({ length: 6 }).map((_, i) => (\n                <div key={i} className=\"p-6 flex items-center justify-between\">\n                  <div className=\"flex items-center space-x-4\">\n                    <Skeleton className=\"w-3 h-3 rounded-full\" />\n                    <div>\n                      <Skeleton className=\"h-4 w-32 mb-1\" />\n                      <Skeleton className=\"h-3 w-24\" />\n                    </div>\n                  </div>\n                  <div className=\"text-right\">\n                    <Skeleton className=\"h-4 w-40 mb-1\" />\n                    <Skeleton className=\"h-3 w-20\" />\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <Skeleton className=\"h-8 w-8\" />\n                    <Skeleton className=\"h-8 w-8\" />\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : filteredShifts.length > 0 ? (\n            <div className=\"divide-y divide-slate-200\">\n              {filteredShifts.map((shift) => (\n                <div key={shift.id} className=\"p-6 flex items-center justify-between hover:bg-slate-50 transition-colors\">\n                  <div className=\"flex items-center space-x-4\">\n                    <div className={`w-3 h-3 rounded-full ${\n                      shiftTypeColors[shift.shiftType as keyof typeof shiftTypeColors] || 'bg-gray-500'\n                    }`}></div>\n                    <div>\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        <p className=\"font-medium text-slate-900 capitalize\">\n                          {shift.shiftType} Shift\n                        </p>\n                        <Badge variant={getShiftTypeVariant(shift.shiftType)} className=\"text-xs\">\n                          {shift.shiftType}\n                        </Badge>\n                      </div>\n                      <p className=\"text-sm text-slate-500\">\n                        {new Date(shift.date).toLocaleDateString('en-US', { \n                          weekday: 'short',\n                          month: 'short', \n                          day: 'numeric', \n                          year: 'numeric' \n                        })}\n                      </p>\n                      {shift.notes && (\n                        <p className=\"text-xs text-slate-400 mt-1 max-w-xs truncate\">\n                          {shift.notes}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"font-medium text-slate-900\">\n                      {formatTime(shift.startTime)} - {formatTime(shift.endTime)}\n                    </p>\n                    <p className=\"text-sm text-slate-500\">\n                      {calculateDuration(shift.startTime, shift.endTime).toFixed(2)} hours\n                    </p>\n                  </div>\n                  <div className=\"flex items-center gap-2 ml-4\">\n                    {shift.isRosterShift ? (\n                      <div className=\"flex items-center gap-2 px-2 py-1 bg-blue-50 rounded-lg\">\n                        <Calendar className=\"h-3 w-3 text-blue-600\" />\n                        <span className=\"text-xs text-blue-800 font-medium\">Roster Shift</span>\n                      </div>\n                    ) : (\n                      <>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\" \n                          className=\"touch-target h-8 w-8 p-0\"\n                          onClick={() => handleEditShift(shift)}\n                        >\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\" \n                          className=\"touch-target h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50\"\n                          onClick={() => handleDeleteShift(shift)}\n                          disabled={deleteShiftMutation.isPending}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"p-12 text-center\">\n              <Clock className=\"h-12 w-12 text-slate-300 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-medium text-slate-900 mb-2\">No shifts found</h3>\n              <p className=\"text-slate-500\">\n                {searchTerm || filterType !== \"all\" \n                  ? \"Try adjusting your search or filter criteria\" \n                  : \"Start tracking your shifts to see them here\"\n                }\n              </p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Edit Shift Modal */}\n      <Dialog open={showEditDialog} onOpenChange={setShowEditDialog}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Edit Shift</DialogTitle>\n          </DialogHeader>\n          \n          {shiftToEdit && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"edit-shift-date\">Date</Label>\n                  <Input\n                    id=\"edit-shift-date\"\n                    type=\"date\"\n                    defaultValue={shiftToEdit.date}\n                    onChange={(e) => setShiftToEdit({...shiftToEdit, date: e.target.value})}\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"edit-shift-type\">Shift Type</Label>\n                  <Select\n                    value={shiftToEdit.shiftType}\n                    onValueChange={(value) => setShiftToEdit({...shiftToEdit, shiftType: value})}\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"morning\">Morning</SelectItem>\n                      <SelectItem value=\"evening\">Evening</SelectItem>\n                      <SelectItem value=\"night\">Night</SelectItem>\n                      <SelectItem value=\"double\">Double</SelectItem>\n                      <SelectItem value=\"custom\">Custom</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"edit-start-time\">Start Time</Label>\n                  <Select\n                    value={shiftToEdit.startTime}\n                    onValueChange={(value) => setShiftToEdit({...shiftToEdit, startTime: value})}\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {timeOptions.map((option) => (\n                        <SelectItem key={option.value} value={option.value}>\n                          {option.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"edit-end-time\">End Time</Label>\n                  <Select\n                    value={shiftToEdit.endTime}\n                    onValueChange={(value) => setShiftToEdit({...shiftToEdit, endTime: value})}\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {timeOptions.map((option) => (\n                        <SelectItem key={option.value} value={option.value}>\n                          {option.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"edit-shift-notes\">Notes</Label>\n                <Textarea\n                  id=\"edit-shift-notes\"\n                  placeholder=\"Add notes about this shift...\"\n                  defaultValue={shiftToEdit.notes || ''}\n                  onChange={(e) => setShiftToEdit({...shiftToEdit, notes: e.target.value})}\n                  rows={3}\n                />\n              </div>\n\n              <div className=\"p-3 bg-slate-50 rounded-lg\">\n                <div className=\"text-sm text-slate-600\">\n                  Duration: <span className=\"font-semibold\">{calculateDuration(shiftToEdit.startTime, shiftToEdit.endTime).toFixed(2)} hours</span>\n                </div>\n                <div className=\"text-sm text-slate-600\">\n                  Type: <span className=\"font-semibold capitalize\">{shiftToEdit.shiftType}</span>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <DialogFooter className=\"gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => setShowEditDialog(false)}\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={() => {\n                if (shiftToEdit) {\n                  const { id, userId, createdAt, ...updateData } = shiftToEdit;\n                  handleUpdateShift(updateData);\n                }\n              }}\n              disabled={updateShiftMutation.isPending}\n              className=\"flex items-center gap-2\"\n            >\n              <Check className=\"h-4 w-4\" />\n              {updateShiftMutation.isPending ? \"Updating...\" : \"Update\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":30933},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/pages/business-dashboard.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useForm } from \"react-hook-form\";\nimport { Users, Clock, TrendingUp, DollarSign, Calendar as CalendarIcon, UserCheck, AlertTriangle, Building2, Filter, ChevronLeft, ChevronRight, Mail, Send } from \"lucide-react\";\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, LineChart, Line, PieChart, Pie, Cell } from \"recharts\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useCompanyEmployees, useCompanyShifts, usePendingShifts, useApproveShift, useRosterShifts, useCreateRosterShift, useUpdateRosterShift, useDeleteRosterShift } from \"@/hooks/use-business\";\nimport { useSendRosterEmail, useSendAllRosterEmails } from \"@/hooks/use-email\";\nimport { BillingManagement } from \"@/components/BillingManagement\";\nimport { EmployeeRatesManagement } from \"@/components/EmployeeRatesManagement\";\nimport { EmployeeReportsManagement } from \"@/components/EmployeeReportsManagement\";\nimport { getDateRange, formatDuration } from \"@/lib/time-utils\";\nimport { format, startOfWeek, endOfWeek, startOfMonth, endOfMonth, addDays, addWeeks, addMonths, subWeeks, subMonths, subDays, parseISO } from \"date-fns\";\nimport type { User } from \"@shared/schema\";\n\n// Mock data for charts until real data is available\nconst mockWeeklyData = [\n  { day: \"Mon\", totalHours: 32, employees: 4 },\n  { day: \"Tue\", totalHours: 35, employees: 4 },\n  { day: \"Wed\", totalHours: 28, employees: 3 },\n  { day: \"Thu\", totalHours: 40, employees: 4 },\n  { day: \"Fri\", totalHours: 38, employees: 4 },\n  { day: \"Sat\", totalHours: 20, employees: 2 },\n  { day: \"Sun\", totalHours: 15, employees: 2 },\n];\n\nconst mockDepartmentData = [\n  { name: \"Sales\", value: 45, color: \"#3b82f6\" },\n  { name: \"Support\", value: 30, color: \"#10b981\" },\n  { name: \"Management\", value: 25, color: \"#6366f1\" },\n];\n\ninterface BusinessDashboardProps {\n  defaultTab?: string;\n}\n\nexport default function BusinessDashboard({ defaultTab = \"overview\" }: BusinessDashboardProps) {\n  const { user, isLoading: userLoading } = useAuth();\n  const [selectedTimeframe, setSelectedTimeframe] = useState(\"week\");\n  const [currentDate, setCurrentDate] = useState(new Date());\n  const [customStartDate, setCustomStartDate] = useState(\"\");\n  const [customEndDate, setCustomEndDate] = useState(\"\");\n  const [viewMode, setViewMode] = useState<\"week\" | \"month\" | \"custom\">(\"week\");\n  const [overviewStartDate, setOverviewStartDate] = useState(format(subDays(new Date(), 7), 'yyyy-MM-dd'));\n  const [overviewEndDate, setOverviewEndDate] = useState(format(new Date(), 'yyyy-MM-dd'));\n  const [hoveredShift, setHoveredShift] = useState<any>(null);\n  const [mousePosition, setMousePosition] = useState({ x: 0, y: 0 });\n  \n  // Roster management state\n  const [isShiftModalOpen, setIsShiftModalOpen] = useState(false);\n  const [editingShift, setEditingShift] = useState<any>(null);\n  const [selectedEmployee, setSelectedEmployee] = useState<any>(null);\n  const [selectedDate, setSelectedDate] = useState<string>(\"\");\n  \n  // Drag selection state\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragStart, setDragStart] = useState<{date: string, hour: number} | null>(null);\n  const [dragEnd, setDragEnd] = useState<{date: string, hour: number} | null>(null);\n  const [dragPreview, setDragPreview] = useState<{date: string, startHour: number, endHour: number} | null>(null);\n  \n  // Email notification state\n  const [isEmailModalOpen, setIsEmailModalOpen] = useState(false);\n  const [emailSending, setEmailSending] = useState(false);\n  const [emailResults, setEmailResults] = useState<any>(null);\n\n  // Calculate date range based on view mode\n  const getDateRangeForView = () => {\n    if (viewMode === \"custom\" && customStartDate && customEndDate) {\n      return {\n        startDate: customStartDate,\n        endDate: customEndDate\n      };\n    }\n    \n    if (viewMode === \"month\") {\n      const start = startOfMonth(currentDate);\n      const end = endOfMonth(currentDate);\n      return {\n        startDate: format(start, 'yyyy-MM-dd'),\n        endDate: format(end, 'yyyy-MM-dd')\n      };\n    }\n    \n    // Default to week view\n    const start = startOfWeek(currentDate, { weekStartsOn: 1 }); // Monday start\n    const end = endOfWeek(currentDate, { weekStartsOn: 1 });\n    return {\n      startDate: format(start, 'yyyy-MM-dd'),\n      endDate: format(end, 'yyyy-MM-dd')\n    };\n  };\n\n  const { startDate, endDate } = getDateRangeForView();\n\n  // Cast user to include company properties\n  const businessUser = user as any;\n\n  // Fetch real company data\n  const { data: employees = [], isLoading: employeesLoading, error: employeesError } = useCompanyEmployees(businessUser?.companyId || 0);\n  const { data: shifts = [], isLoading: shiftsLoading, error: shiftsError } = useCompanyShifts(businessUser?.companyId || 0, startDate, endDate);\n  const { data: pendingShifts = [], isLoading: pendingLoading, error: pendingError } = usePendingShifts(businessUser?.companyId || 0);\n  \n  // Fetch ALL shifts for calendar (not date filtered)\n  const { data: allShifts = [], isLoading: allShiftsLoading } = useCompanyShifts(businessUser?.companyId || 0);\n\n  // Roster management hooks\n  const weekStart = format(startOfWeek(currentDate, { weekStartsOn: 1 }), 'yyyy-MM-dd');\n  const weekEnd = format(endOfWeek(currentDate, { weekStartsOn: 1 }), 'yyyy-MM-dd');\n  const { data: rosterShifts = [], isLoading: rosterLoading } = useRosterShifts(weekStart, weekEnd);\n  const createRosterShiftMutation = useCreateRosterShift();\n  const updateRosterShiftMutation = useUpdateRosterShift();\n  const deleteRosterShiftMutation = useDeleteRosterShift();\n\n  const approveShiftMutation = useApproveShift();\n  \n  // Email mutations\n  const sendRosterEmailMutation = useSendRosterEmail(businessUser?.companyId || 0);\n  const sendAllRosterEmailsMutation = useSendAllRosterEmails(businessUser?.companyId || 0);\n\n  // Process shift data for daily breakdown\n  const processShiftData = () => {\n    const employeeList = Array.isArray(employees) ? employees : [];\n    const shiftList = Array.isArray(shifts) ? shifts : [];\n    \n    // Group shifts by date and employee\n    const dailyData: Record<string, Record<number, number>> = {};\n    \n    shiftList.forEach((shift: any) => {\n      if (!shift.startTime || !shift.endTime || !shift.date) return;\n      \n      const start = new Date(`2000-01-01T${shift.startTime}`);\n      const end = new Date(`2000-01-01T${shift.endTime}`);\n      if (end < start) end.setDate(end.getDate() + 1);\n      \n      const hours = (end.getTime() - start.getTime()) / (1000 * 60 * 60);\n      \n      if (!dailyData[shift.date]) {\n        dailyData[shift.date] = {};\n      }\n      if (!dailyData[shift.date][shift.userId]) {\n        dailyData[shift.date][shift.userId] = 0;\n      }\n      dailyData[shift.date][shift.userId] += hours;\n    });\n    \n    // Convert to chart format\n    const chartData = Object.entries(dailyData).map(([date, employeeHours]) => {\n      const dayData: any = { date: format(parseISO(date), 'MMM dd') };\n      let totalHours = 0;\n      \n      employeeList.forEach((employee: any) => {\n        const hours = employeeHours[employee.id] || 0;\n        dayData[employee.name] = hours;\n        totalHours += hours;\n      });\n      \n      dayData.totalHours = totalHours;\n      return dayData;\n    }).sort((a, b) => a.date.localeCompare(b.date));\n    \n    return { dailyData, chartData, employeeList };\n  };\n\n  const { dailyData, chartData, employeeList: processedEmployeeList } = processShiftData();\n\n  // Navigation functions\n  const navigatePrevious = () => {\n    if (viewMode === \"week\") {\n      setCurrentDate(prev => subWeeks(prev, 1));\n    } else if (viewMode === \"month\") {\n      setCurrentDate(prev => subMonths(prev, 1));\n    }\n  };\n\n  const navigateNext = () => {\n    if (viewMode === \"week\") {\n      setCurrentDate(prev => addWeeks(prev, 1));\n    } else if (viewMode === \"month\") {\n      setCurrentDate(prev => addMonths(prev, 1));\n    }\n  };\n\n  const getDateRangeLabel = () => {\n    if (viewMode === \"custom\") {\n      return `${customStartDate} to ${customEndDate}`;\n    }\n    if (viewMode === \"month\") {\n      return format(currentDate, 'MMMM yyyy');\n    }\n    const start = startOfWeek(currentDate, { weekStartsOn: 1 });\n    const end = endOfWeek(currentDate, { weekStartsOn: 1 });\n    return `${format(start, 'MMM dd')} - ${format(end, 'MMM dd, yyyy')}`;\n  };\n\n  // If user is not a business user, show access denied\n  if (user && businessUser.userType !== 'business') {\n    return (\n      <div className=\"p-6 text-center\">\n        <h1 className=\"text-2xl font-bold text-slate-900 mb-4\">Access Denied</h1>\n        <p className=\"text-slate-600\">You need to be a business user to access this dashboard.</p>\n      </div>\n    );\n  }\n\n  // Calculate real metrics\n  const employeeArray = Array.isArray(employees) ? employees : [];\n  const shiftList = Array.isArray(shifts) ? shifts : [];\n  const pendingList = Array.isArray(pendingShifts) ? pendingShifts : [];\n\n  const totalEmployees = employeeArray.length;\n  const activeEmployees = employeeArray.filter((emp: any) => emp.isActive !== false).length;\n  const totalWeeklyHours = shiftList.reduce((sum: number, shift: any) => {\n    if (!shift.startTime || !shift.endTime) return sum;\n    const start = new Date(`2000-01-01T${shift.startTime}`);\n    const end = new Date(`2000-01-01T${shift.endTime}`);\n    if (end < start) end.setDate(end.getDate() + 1);\n    return sum + (end.getTime() - start.getTime()) / (1000 * 60 * 60);\n  }, 0);\n  const pendingApprovals = pendingList.length;\n\n  // Handle shift approval\n  const handleApproveShift = (shiftId: number) => {\n    if (businessUser?.id) {\n      approveShiftMutation.mutate({ shiftId, approvedBy: businessUser.id });\n    }\n  };\n\n  // Roster management handlers\n  const handleAddShift = (employee: any, date: string) => {\n    setSelectedEmployee(employee);\n    setSelectedDate(date);\n    setEditingShift(null);\n    setIsShiftModalOpen(true);\n  };\n\n  const handleEditShift = (shift: any) => {\n    console.log('Editing shift:', shift); // Debug log\n    setEditingShift(shift);\n    setSelectedEmployee(null);\n    setSelectedDate(shift.date || \"\");\n    setIsShiftModalOpen(true);\n  };\n\n  const handleDeleteShift = async (shiftId: number) => {\n    if (confirm('Are you sure you want to delete this shift?')) {\n      try {\n        await deleteRosterShiftMutation.mutateAsync(shiftId);\n      } catch (error) {\n        console.error('Failed to delete shift:', error);\n      }\n    }\n  };\n\n  // Conflict detection helper\n  const checkForConflicts = (employeeId: number, date: string, startTime: string, endTime: string, excludeShiftId?: number) => {\n    const conflicts = Array.isArray(rosterShifts) ? rosterShifts.filter((shift: any) => {\n      // Skip the shift being edited\n      if (excludeShiftId && shift.id === excludeShiftId) return false;\n      \n      // Only check shifts for the same employee and date\n      if (shift.userId !== employeeId || shift.date !== date) return false;\n      \n      // Parse times\n      const newStart = new Date(`2000-01-01T${startTime}:00`);\n      const newEnd = new Date(`2000-01-01T${endTime}:00`);\n      const existingStart = new Date(`2000-01-01T${shift.startTime}:00`);\n      const existingEnd = new Date(`2000-01-01T${shift.endTime}:00`);\n      \n      // Check for overlap: shifts overlap if new start < existing end AND new end > existing start\n      return newStart < existingEnd && newEnd > existingStart;\n    }) : [];\n    \n    return conflicts;\n  };\n\n  const handleSaveShift = async (shiftData: any) => {\n    try {\n      const employeeId = selectedEmployee?.id || editingShift?.userId;\n      const date = selectedDate || editingShift?.date;\n      \n      // Check for conflicts before saving\n      const conflicts = checkForConflicts(\n        employeeId,\n        date,\n        shiftData.startTime,\n        shiftData.endTime,\n        editingShift?.id\n      );\n      \n      if (conflicts.length > 0) {\n        const conflictTimes = conflicts.map((shift: any) => \n          `${shift.startTime} - ${shift.endTime}`\n        ).join(', ');\n        \n        const shouldContinue = confirm(\n          ` Schedule Conflict Detected!\\n\\nThis employee already has shifts scheduled at:\\n${conflictTimes}\\n\\nDo you want to proceed anyway?`\n        );\n        \n        if (!shouldContinue) {\n          return;\n        }\n      }\n\n      if (editingShift && editingShift.id) {\n        // Update existing shift\n        console.log('Updating shift - editingShift:', editingShift); // Debug log\n        console.log('Shift ID for update:', editingShift.id); // Debug log\n        await updateRosterShiftMutation.mutateAsync({\n          shiftId: editingShift.id,\n          shiftData: {\n            ...shiftData,\n            userId: parseInt(shiftData.employeeId),\n            date: editingShift.date\n          }\n        });\n      } else {\n        // Create new shift\n        await createRosterShiftMutation.mutateAsync({\n          ...shiftData,\n          userId: parseInt(shiftData.employeeId) || selectedEmployee?.id,\n          date: selectedDate,\n          status: 'scheduled'\n        });\n      }\n      setIsShiftModalOpen(false);\n      setEditingShift(null);\n      setSelectedEmployee(null);\n      setSelectedDate(\"\");\n    } catch (error) {\n      console.error('Failed to save shift:', error);\n    }\n  };\n\n  const handleAddShiftAtTime = (date: string, time: string) => {\n    setSelectedDate(date);\n    setSelectedEmployee(null);\n    setEditingShift({\n      startTime: time,\n      endTime: time.replace(/\\d{2}:/, (match) => {\n        const hour = parseInt(match.slice(0, 2));\n        return `${(hour + 3).toString().padStart(2, '0')}:`;\n      })\n    });\n    setIsShiftModalOpen(true);\n  };\n\n  // Drag selection handlers\n  const handleMouseDown = (date: string, hour: number, event: any) => {\n    // Prevent drag if clicking on existing shift\n    if ((event.target as Element).closest('.shift-block')) {\n      return;\n    }\n    \n    event.preventDefault();\n    setIsDragging(true);\n    setDragStart({ date, hour });\n    setDragEnd({ date, hour });\n    setDragPreview({ date, startHour: hour, endHour: hour });\n  };\n\n  const handleMouseEnter = (date: string, hour: number) => {\n    if (isDragging && dragStart) {\n      // Only allow dragging within the same day\n      if (date === dragStart.date) {\n        const startHour = Math.min(dragStart.hour, hour);\n        const endHour = Math.max(dragStart.hour, hour);\n        setDragEnd({ date, hour });\n        setDragPreview({ date, startHour, endHour });\n      }\n    }\n  };\n\n  const handleMouseUp = () => {\n    if (isDragging && dragStart && dragEnd && dragPreview) {\n      const startTime = `${dragPreview.startHour.toString().padStart(2, '0')}:00`;\n      const endTime = `${(dragPreview.endHour + 1).toString().padStart(2, '0')}:00`;\n      \n      // Open shift creation modal with calculated times\n      setSelectedDate(dragPreview.date);\n      setSelectedEmployee(null);\n      setEditingShift({\n        startTime,\n        endTime\n      });\n      setIsShiftModalOpen(true);\n    }\n    \n    // Reset drag state\n    setIsDragging(false);\n    setDragStart(null);\n    setDragEnd(null);\n    setDragPreview(null);\n  };\n\n  // Add global mouse up listener\n  useEffect(() => {\n    const handleGlobalMouseUp = () => {\n      if (isDragging) {\n        handleMouseUp();\n      }\n    };\n\n    document.addEventListener('mouseup', handleGlobalMouseUp);\n    return () => document.removeEventListener('mouseup', handleGlobalMouseUp);\n  }, [isDragging, dragStart, dragEnd, dragPreview]);\n\n  return (\n    <div className=\"p-6 space-y-6 max-w-7xl mx-auto\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-slate-900\">Business Dashboard</h1>\n          <p className=\"text-slate-600\">\n            Welcome back, {businessUser?.name}! Here's your team overview.\n          </p>\n          {businessUser?.companyId && (\n            <p className=\"text-sm text-slate-500 mt-1\">\n              Company ID: {businessUser.companyId} | Role: {businessUser.role || 'Owner'}\n            </p>\n          )}\n        </div>\n        <div className=\"flex items-center gap-3\">\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={navigatePrevious}\n              disabled={viewMode === \"custom\"}\n            >\n              <ChevronLeft className=\"h-4 w-4\" />\n            </Button>\n            <div className=\"text-sm font-medium min-w-[200px] text-center\">\n              {getDateRangeLabel()}\n            </div>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={navigateNext}\n              disabled={viewMode === \"custom\"}\n            >\n              <ChevronRight className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          \n          <Select value={viewMode} onValueChange={(value: \"week\" | \"month\" | \"custom\") => setViewMode(value)}>\n            <SelectTrigger className=\"w-32\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"week\">Week</SelectItem>\n              <SelectItem value=\"month\">Month</SelectItem>\n              <SelectItem value=\"custom\">Custom</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      {/* Custom Date Range Picker */}\n      {viewMode === \"custom\" && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Filter className=\"h-5 w-5\" />\n              Custom Date Range\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"start-date\">Start Date</Label>\n                <Input\n                  id=\"start-date\"\n                  type=\"date\"\n                  value={customStartDate}\n                  onChange={(e) => setCustomStartDate(e.target.value)}\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"end-date\">End Date</Label>\n                <Input\n                  id=\"end-date\"\n                  type=\"date\"\n                  value={customEndDate}\n                  onChange={(e) => setCustomEndDate(e.target.value)}\n                />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Loading State */}\n      {(userLoading || employeesLoading || shiftsLoading) && (\n        <div className=\"space-y-6\">\n          <Skeleton className=\"h-8 w-64\" />\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n            {[...Array(4)].map((_, i) => (\n              <Skeleton key={i} className=\"h-32\" />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Main Content Tabs */}\n      <Tabs defaultValue={defaultTab} className=\"space-y-6\">\n        <TabsList className=\"grid w-full grid-cols-4\">\n          <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n          <TabsTrigger value=\"employees\">Employees</TabsTrigger>\n          <TabsTrigger value=\"roster\">Roster Planner</TabsTrigger>\n          <TabsTrigger value=\"billing\">Billing</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"overview\" className=\"space-y-6\">\n          {/* Date Filter Controls */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Filter className=\"h-5 w-5\" />\n                Overview Filters\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex flex-col sm:flex-row gap-4 items-end\">\n                <div className=\"grid grid-cols-2 gap-4 flex-1\">\n                  <div>\n                    <label className=\"text-sm font-medium mb-2 block\">Start Date</label>\n                    <input\n                      type=\"date\"\n                      value={overviewStartDate}\n                      onChange={(e) => setOverviewStartDate(e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    />\n                  </div>\n                  <div>\n                    <label className=\"text-sm font-medium mb-2 block\">End Date</label>\n                    <input\n                      type=\"date\"\n                      value={overviewEndDate}\n                      onChange={(e) => setOverviewEndDate(e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    />\n                  </div>\n                </div>\n                <div className=\"flex gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => {\n                      const today = new Date();\n                      const weekAgo = subDays(today, 7);\n                      setOverviewStartDate(format(weekAgo, 'yyyy-MM-dd'));\n                      setOverviewEndDate(format(today, 'yyyy-MM-dd'));\n                    }}\n                  >\n                    Last 7 Days\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => {\n                      const today = new Date();\n                      const monthStart = startOfMonth(today);\n                      setOverviewStartDate(format(monthStart, 'yyyy-MM-dd'));\n                      setOverviewEndDate(format(today, 'yyyy-MM-dd'));\n                    }}\n                  >\n                    This Month\n                  </Button>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {(() => {\n            // Filter to only include uploaded shifts (exclude roster shifts)\n            const filteredShifts = Array.isArray(allShifts) \n              ? allShifts.filter((shift: any) => \n                  shift.date >= overviewStartDate && \n                  shift.date <= overviewEndDate &&\n                  (!shift.createdBy || shift.createdBy === shift.userId)\n                ) \n              : [];\n\n            // Generate timeline chart data\n            const timelineData = (() => {\n              const shiftsByDate = filteredShifts.reduce((acc: any, shift: any) => {\n                if (!acc[shift.date]) {\n                  acc[shift.date] = [];\n                }\n                acc[shift.date].push(shift);\n                return acc;\n              }, {});\n\n              const sortedDates = Object.keys(shiftsByDate).sort();\n              \n              return sortedDates.map(date => {\n                const dayShifts = shiftsByDate[date];\n                \n                // Calculate total hours for the day\n                const totalHours = dayShifts.reduce((total: number, shift: any) => {\n                  if (!shift.startTime || !shift.endTime) return total;\n                  const start = new Date(`2000-01-01T${shift.startTime}`);\n                  const end = new Date(`2000-01-01T${shift.endTime}`);\n                  if (end < start) end.setDate(end.getDate() + 1);\n                  return total + ((end.getTime() - start.getTime()) / (1000 * 60 * 60));\n                }, 0);\n\n                // Calculate hours per employee\n                const employeeHours = dayShifts.reduce((acc: any, shift: any) => {\n                  const employee = employees.find((emp: any) => emp.id === shift.userId);\n                  const employeeName = employee?.name?.split(' ')[0] || `User${shift.userId}`;\n                  \n                  if (!shift.startTime || !shift.endTime) return acc;\n                  const start = new Date(`2000-01-01T${shift.startTime}`);\n                  const end = new Date(`2000-01-01T${shift.endTime}`);\n                  if (end < start) end.setDate(end.getDate() + 1);\n                  const hours = (end.getTime() - start.getTime()) / (1000 * 60 * 60);\n                  \n                  acc[employeeName] = (acc[employeeName] || 0) + hours;\n                  return acc;\n                }, {});\n\n                return {\n                  date: format(parseISO(date), 'MMM dd'),\n                  fullDate: date,\n                  totalHours: Number(totalHours.toFixed(1)),\n                  shifts: dayShifts.length,\n                  ...employeeHours\n                };\n              });\n            })();\n\n            // Calculate period totals\n            const totalPeriodHours = filteredShifts.reduce((total: number, shift: any) => {\n              if (!shift.startTime || !shift.endTime) return total;\n              const start = new Date(`2000-01-01T${shift.startTime}`);\n              const end = new Date(`2000-01-01T${shift.endTime}`);\n              if (end < start) end.setDate(end.getDate() + 1);\n              return total + ((end.getTime() - start.getTime()) / (1000 * 60 * 60));\n            }, 0);\n\n            // Calculate employee totals for the period\n            const employeeTotals = filteredShifts.reduce((acc: any, shift: any) => {\n              const employee = employees.find((emp: any) => emp.id === shift.userId);\n              const employeeName = employee?.name || `User ${shift.userId}`;\n              \n              if (!shift.startTime || !shift.endTime) return acc;\n              const start = new Date(`2000-01-01T${shift.startTime}`);\n              const end = new Date(`2000-01-01T${shift.endTime}`);\n              if (end < start) end.setDate(end.getDate() + 1);\n              const hours = (end.getTime() - start.getTime()) / (1000 * 60 * 60);\n              \n              acc[employeeName] = (acc[employeeName] || 0) + hours;\n              return acc;\n            }, {});\n\n            const uniqueEmployees = Array.from(new Set(filteredShifts.map((shift: any) => {\n              const employee = employees.find((emp: any) => emp.id === shift.userId);\n              return employee?.name?.split(' ')[0] || `User${shift.userId}`;\n            })));\n\n            return (\n              <>\n                {/* Period Summary Cards */}\n                <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                  <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">Total Hours</CardTitle>\n                      <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">{totalPeriodHours.toFixed(1)}h</div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {format(parseISO(overviewStartDate), 'MMM dd')} - {format(parseISO(overviewEndDate), 'MMM dd')}\n                      </p>\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">Total Shifts</CardTitle>\n                      <CalendarIcon className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">{filteredShifts.length}</div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {timelineData.length} days worked\n                      </p>\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">Daily Average</CardTitle>\n                      <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">\n                        {timelineData.length > 0 ? (totalPeriodHours / timelineData.length).toFixed(1) : '0'}h\n                      </div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Per working day\n                      </p>\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                      <CardTitle className=\"text-sm font-medium\">Active Employees</CardTitle>\n                      <Users className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">{Object.keys(employeeTotals).length}</div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        In this period\n                      </p>\n                    </CardContent>\n                  </Card>\n                </div>\n\n                {/* Timeline Chart - Days vs Hours */}\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Shift Timeline</CardTitle>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Days (x-axis) vs Hours (y-axis) showing when shifts occur\n                    </p>\n                  </CardHeader>\n                  <CardContent>\n                    {filteredShifts.length > 0 ? (\n                      (() => {\n                        // Group shifts by date\n                        const shiftsByDate = filteredShifts.reduce((acc: any, shift: any) => {\n                          if (!acc[shift.date]) {\n                            acc[shift.date] = [];\n                          }\n                          acc[shift.date].push(shift);\n                          return acc;\n                        }, {});\n\n                        const sortedDates = Object.keys(shiftsByDate).sort();\n                        const maxDays = 14; // Show max 14 days for readability\n                        const displayDates = sortedDates.slice(0, maxDays);\n\n                        // Get unique employees and assign colors\n                        const uniqueEmployees = Array.from(new Set(filteredShifts.map((shift: any) => shift.userId)))\n                          .map(userId => employees.find((emp: any) => emp.id === userId))\n                          .filter(Boolean);\n\n                        const getEmployeeColor = (userId: number) => {\n                          const index = uniqueEmployees.findIndex((emp: any) => emp.id === userId);\n                          const colors = [\n                            { bg: 'bg-blue-500', border: 'border-blue-600', text: 'text-white' },\n                            { bg: 'bg-green-500', border: 'border-green-600', text: 'text-white' },\n                            { bg: 'bg-purple-500', border: 'border-purple-600', text: 'text-white' },\n                            { bg: 'bg-red-500', border: 'border-red-600', text: 'text-white' },\n                            { bg: 'bg-yellow-500', border: 'border-yellow-600', text: 'text-black' },\n                            { bg: 'bg-pink-500', border: 'border-pink-600', text: 'text-white' },\n                            { bg: 'bg-indigo-500', border: 'border-indigo-600', text: 'text-white' },\n                            { bg: 'bg-teal-500', border: 'border-teal-600', text: 'text-white' },\n                            { bg: 'bg-orange-500', border: 'border-orange-600', text: 'text-white' },\n                            { bg: 'bg-cyan-500', border: 'border-cyan-600', text: 'text-white' }\n                          ];\n                          return colors[index % colors.length] || colors[0];\n                        };\n\n                        return (\n                          <div className=\"relative\">\n                            {/* Chart container */}\n                            <div className=\"relative bg-gray-50 border rounded-lg p-4 pb-24\" style={{ height: '680px' }}>\n                              {/* Y-axis labels (Hours) - 0:00 at top, 24:00 at bottom */}\n                              <div className=\"absolute left-0 top-0 bottom-0 w-12 flex flex-col justify-between text-xs text-gray-600 py-4\">\n                                {Array.from({ length: 25 }, (_, i) => (\n                                  <div key={i} className=\"text-right pr-2\">\n                                    {i.toString().padStart(2, '0')}:00\n                                  </div>\n                                ))}\n                              </div>\n\n                              {/* Chart area */}\n                              <div className=\"ml-12 mr-4 relative h-full\">\n                                {/* Grid lines - horizontal (hours) */}\n                                {Array.from({ length: 25 }, (_, i) => (\n                                  <div\n                                    key={i}\n                                    className=\"absolute w-full border-t border-gray-200\"\n                                    style={{ top: `${(i / 24) * 100}%` }}\n                                  />\n                                ))}\n                                \n                                {/* Grid lines - vertical (days) */}\n                                {displayDates.map((_, i) => (\n                                  <div\n                                    key={i}\n                                    className=\"absolute h-full border-l border-gray-300\"\n                                    style={{ left: `${((i + 1) / displayDates.length) * 100}%` }}\n                                  />\n                                ))}\n\n                                {/* Shift blocks */}\n                                {displayDates.map((date, dateIndex) => {\n                                  const dayShifts = shiftsByDate[date];\n                                  \n                                  // Stack all shifts vertically for this day\n                                  return dayShifts.map((shift: any, shiftIndex: number) => {\n                                      if (!shift.startTime || !shift.endTime) return null;\n                                      \n                                      const employee = employees.find((emp: any) => emp.id === shift.userId);\n                                      const employeeName = employee?.name || `User ${shift.userId}`;\n                                      \n                                      // Parse start and end times\n                                      const [startHours, startMinutes] = shift.startTime.split(':').map(Number);\n                                      const [endHours, endMinutes] = shift.endTime.split(':').map(Number);\n                                      \n                                      const startTime = startHours + startMinutes / 60;\n                                      let endTime = endHours + endMinutes / 60;\n                                      \n                                      // Handle overnight shifts\n                                      if (endTime <= startTime) {\n                                        endTime += 24;\n                                      }\n                                      \n                                      // Convert to percentage positions (0:00 at top, 24:00 at bottom)\n                                      const topPercent = (startTime / 24) * 100;\n                                      const heightPercent = ((Math.min(endTime, 24) - startTime) / 24) * 100;\n                                      \n                                      // X position - stack vertically for non-doubled shifts, side by side for doubled\n                                      const columnWidth = (1 / displayDates.length) * 100;\n                                      const leftPercent = (dateIndex / displayDates.length) * 100;\n                                      const widthPercent = Math.max(columnWidth * 0.95, 3); // Use most of column width\n                                      \n                                      const colorScheme = getEmployeeColor(shift.userId);\n                                      \n                                      return (\n                                        <div\n                                          key={`${shift.id}-${dateIndex}-${shiftIndex}`}\n                                          className={`absolute border-2 rounded opacity-90 hover:opacity-100 hover:scale-105 transition-all cursor-pointer ${colorScheme.bg} ${colorScheme.border}`}\n                                          style={{\n                                            left: `${leftPercent}%`,\n                                            width: `${widthPercent}%`,\n                                            top: `${topPercent}%`,\n                                            height: `${Math.max(heightPercent, 2)}%`\n                                          }}\n                                          onMouseEnter={(e) => {\n                                            setHoveredShift({\n                                              ...shift,\n                                              employeeName,\n                                              date,\n                                              duration: ((Math.min(endTime, 24) - startTime)).toFixed(1)\n                                            });\n                                            setMousePosition({ x: e.clientX, y: e.clientY });\n                                          }}\n                                          onMouseLeave={() => setHoveredShift(null)}\n                                          onMouseMove={(e) => setMousePosition({ x: e.clientX, y: e.clientY })}\n                                          title={`${employeeName}: ${shift.startTime} - ${shift.endTime}`}\n                                        >\n                                          <div className={`text-xs font-medium p-1 truncate ${colorScheme.text}`}>\n                                            {employeeName.split(' ')[0]}\n                                          </div>\n                                        </div>\n                                      );\n                                    });\n                                })}\n                              </div>\n\n                              {/* X-axis labels (Days) with totals */}\n                              <div className=\"absolute bottom-0 left-12 right-4 flex justify-between text-xs text-gray-600 pt-8\">\n                                {displayDates.map((date) => {\n                                  const dayShifts = shiftsByDate[date];\n                                  const dayTotal = dayShifts.reduce((total: number, shift: any) => {\n                                    if (!shift.startTime || !shift.endTime) return total;\n                                    const [startHours, startMinutes] = shift.startTime.split(':').map(Number);\n                                    const [endHours, endMinutes] = shift.endTime.split(':').map(Number);\n                                    const startTime = startHours + startMinutes / 60;\n                                    let endTime = endHours + endMinutes / 60;\n                                    if (endTime <= startTime) endTime += 24;\n                                    return total + (endTime - startTime);\n                                  }, 0);\n                                  \n                                  return (\n                                    <div key={date} className=\"text-center\" style={{ width: `${100 / displayDates.length}%` }}>\n                                      <div className=\"font-medium mb-1\">{format(parseISO(date), 'MMM dd')}</div>\n                                      <div className=\"text-gray-500 mb-2\">{format(parseISO(date), 'EEE')}</div>\n                                      <div className=\"font-bold text-blue-600 text-lg\">{dayTotal.toFixed(1)}h</div>\n                                    </div>\n                                  );\n                                })}\n                              </div>\n                            </div>\n\n                            {/* Employee Legend */}\n                            <div className=\"mt-4\">\n                              <h4 className=\"text-sm font-medium mb-3 text-center\">Employee Colors</h4>\n                              <div className=\"flex flex-wrap gap-4 justify-center\">\n                                {uniqueEmployees.map((employee: any) => {\n                                  const colorScheme = getEmployeeColor(employee.id);\n                                  return (\n                                    <div key={employee.id} className=\"flex items-center gap-2\">\n                                      <div className={`w-4 h-4 rounded border-2 ${colorScheme.bg} ${colorScheme.border}`}></div>\n                                      <span className=\"text-sm font-medium\">{employee.name}</span>\n                                    </div>\n                                  );\n                                })}\n                              </div>\n                            </div>\n                          </div>\n                        );\n                      })()\n                    ) : (\n                      <div className=\"text-center py-8\">\n                        <Clock className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                        <h3 className=\"text-lg font-medium\">No shifts for selected period</h3>\n                        <p className=\"text-muted-foreground\">Adjust the date range to view shift timeline.</p>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n\n                {/* Hover Tooltip */}\n                {hoveredShift && (\n                  <div \n                    className=\"fixed z-50 bg-white border border-gray-300 rounded-lg shadow-lg p-4 pointer-events-none\"\n                    style={{ \n                      left: `${mousePosition.x + 10}px`, \n                      top: `${mousePosition.y - 10}px`,\n                      maxWidth: '300px'\n                    }}\n                  >\n                    <div className=\"space-y-2\">\n                      <div className=\"font-semibold text-gray-900\">{hoveredShift.employeeName}</div>\n                      <div className=\"text-sm text-gray-600\">{format(parseISO(hoveredShift.date), 'EEEE, MMM dd, yyyy')}</div>\n                      <div className=\"grid grid-cols-2 gap-2 text-sm\">\n                        <div>\n                          <span className=\"font-medium text-blue-700\">Start:</span> {hoveredShift.startTime?.slice(0, 5)}\n                        </div>\n                        <div>\n                          <span className=\"font-medium text-green-700\">End:</span> {hoveredShift.endTime?.slice(0, 5)}\n                        </div>\n                      </div>\n                      <div className=\"text-sm\">\n                        <span className=\"font-medium text-purple-700\">Duration:</span> {hoveredShift.duration}h\n                      </div>\n                      <div className=\"text-sm\">\n                        <span className=\"font-medium text-orange-700\">Type:</span> <span className=\"capitalize\">{hoveredShift.shiftType}</span>\n                      </div>\n                      {hoveredShift.notes && (\n                        <div className=\"text-sm\">\n                          <span className=\"font-medium text-gray-700\">Notes:</span> {hoveredShift.notes}\n                        </div>\n                      )}\n                      {hoveredShift.location && (\n                        <div className=\"text-sm\">\n                          <span className=\"font-medium text-gray-700\">Location:</span> {hoveredShift.location}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                )}\n\n\n\n                {/* Employee Hours Breakdown */}\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Employee Hours Summary</CardTitle>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Total hours per employee in selected period\n                    </p>\n                  </CardHeader>\n                  <CardContent>\n                    {Object.keys(employeeTotals).length > 0 ? (\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                        {Object.entries(employeeTotals)\n                          .sort(([,a], [,b]) => (b as number) - (a as number))\n                          .map(([name, hours]) => (\n                          <div key={name} className=\"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4\">\n                            <div className=\"flex items-center justify-between\">\n                              <div>\n                                <h3 className=\"font-semibold text-gray-900\">{name}</h3>\n                                <p className=\"text-sm text-gray-600\">\n                                  {filteredShifts.filter((shift: any) => {\n                                    const employee = employees.find((emp: any) => emp.id === shift.userId);\n                                    return (employee?.name || `User ${shift.userId}`) === name;\n                                  }).length} shifts\n                                </p>\n                              </div>\n                              <div className=\"text-right\">\n                                <div className=\"text-2xl font-bold text-blue-900\">{(hours as number).toFixed(1)}h</div>\n                                <div className=\"text-xs text-blue-700\">\n                                  {timelineData.length > 0 ? ((hours as number) / timelineData.length).toFixed(1) : '0'}h/day avg\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      <div className=\"text-center py-8 text-gray-500\">\n                        No employee data for the selected period.\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              </>\n            );\n          })()}\n        </TabsContent>\n\n        <TabsContent value=\"employees\" className=\"space-y-6\">\n          {/* Daily Hours Breakdown */}\n          <Card>\n            <CardHeader>\n              <CardTitle>Daily Hours by Employee</CardTitle>\n              <p className=\"text-sm text-muted-foreground\">\n                Hours worked per day split by team members\n              </p>\n            </CardHeader>\n            <CardContent>\n              {chartData.length > 0 ? (\n                <ResponsiveContainer width=\"100%\" height={400}>\n                  <BarChart data={chartData} margin={{ top: 20, right: 30, left: 40, bottom: 5 }}>\n                    <CartesianGrid strokeDasharray=\"3 3\" />\n                    <XAxis dataKey=\"date\" />\n                    <YAxis \n                      label={{ value: 'Hours', angle: -90, position: 'insideLeft' }}\n                      tickFormatter={(value) => `${value}h`}\n                    />\n                    <Tooltip \n                      formatter={(value: any, name: string) => [\n                        `${Number(value).toFixed(1)}h`,\n                        name\n                      ]}\n                    />\n                    {processedEmployeeList.map((employee: any, index: number) => (\n                      <Bar\n                        key={employee.id}\n                        dataKey={employee.name}\n                        stackId=\"hours\"\n                        fill={`hsl(${(index * 137.5) % 360}, 70%, 50%)`}\n                      />\n                    ))}\n                  </BarChart>\n                </ResponsiveContainer>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <Clock className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-medium\">No shift data</h3>\n                  <p className=\"text-muted-foreground\">No shifts recorded for the selected period.</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Daily Summary Table */}\n          <Card>\n            <CardHeader>\n              <CardTitle>Daily Summary</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {Object.keys(dailyData).length > 0 ? (\n                <div className=\"overflow-x-auto\">\n                  <table className=\"w-full text-sm\">\n                    <thead>\n                      <tr className=\"border-b\">\n                        <th className=\"text-left p-2\">Date</th>\n                        {processedEmployeeList.map((employee: any) => (\n                          <th key={employee.id} className=\"text-left p-2\">{employee.name}</th>\n                        ))}\n                        <th className=\"text-left p-2 font-bold\">Total</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {Object.entries(dailyData).map(([date, employeeHours]) => {\n                        const totalHours = Object.values(employeeHours).reduce((sum: number, hours: any) => sum + hours, 0);\n                        return (\n                          <tr key={date} className=\"border-b\">\n                            <td className=\"p-2 font-medium\">\n                              {format(parseISO(date), 'MMM dd, yyyy')}\n                            </td>\n                            {processedEmployeeList.map((employee: any) => {\n                              const hours = employeeHours[employee.id] || 0;\n                              return (\n                                <td key={employee.id} className=\"p-2\">\n                                  {hours > 0 ? `${hours.toFixed(1)}h` : '-'}\n                                </td>\n                              );\n                            })}\n                            <td className=\"p-2 font-bold\">{totalHours.toFixed(1)}h</td>\n                          </tr>\n                        );\n                      })}\n                    </tbody>\n                  </table>\n                </div>\n              ) : (\n                <div className=\"text-center py-4\">\n                  <p className=\"text-muted-foreground\">No data available for the selected period.</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"employees\" className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Team Members</CardTitle>\n              <p className=\"text-sm text-muted-foreground\">\n                Manage your team and view their performance\n              </p>\n            </CardHeader>\n            <CardContent>\n              {employeesLoading ? (\n                <div className=\"space-y-4\">\n                  {[...Array(3)].map((_, i) => (\n                    <Skeleton key={i} className=\"h-16 w-full\" />\n                  ))}\n                </div>\n              ) : employeeArray.length > 0 ? (\n                <div className=\"space-y-4\">\n                  {employeeArray.map((employee: any) => (\n                    <div key={employee.id} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                      <div className=\"flex items-center space-x-4\">\n                        <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\n                          <span className=\"text-sm font-medium text-blue-700\">\n                            {employee.name?.charAt(0) || 'U'}\n                          </span>\n                        </div>\n                        <div>\n                          <h3 className=\"font-medium\">{employee.name}</h3>\n                          <p className=\"text-sm text-muted-foreground\">{employee.email}</p>\n                        </div>\n                      </div>\n                      <div className=\"text-right\">\n                        <Badge variant={employee.isActive ? \"default\" : \"secondary\"}>\n                          {employee.isActive ? \"Active\" : \"Inactive\"}\n                        </Badge>\n                        <p className=\"text-sm text-muted-foreground mt-1\">\n                          Role: {employee.role || \"Employee\"}\n                        </p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <Users className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-medium\">No employees found</h3>\n                  <p className=\"text-muted-foreground\">Add employees to your company to see them here.</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"roster\" className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Roster Planner</CardTitle>\n              <p className=\"text-sm text-muted-foreground\">\n                Plan and assign shifts to your team members\n              </p>\n            </CardHeader>\n            <CardContent>\n              {/* Week Navigation */}\n              <div className=\"flex items-center justify-between mb-6\">\n                <div className=\"flex items-center gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setCurrentDate(subWeeks(currentDate, 1))}\n                  >\n                    <ChevronLeft className=\"h-4 w-4\" />\n                  </Button>\n                  <h2 className=\"text-lg font-semibold\">\n                    Week of {format(startOfWeek(currentDate, { weekStartsOn: 1 }), 'MMM dd, yyyy')}\n                  </h2>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setCurrentDate(addWeeks(currentDate, 1))}\n                  >\n                    <ChevronRight className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setCurrentDate(new Date())}\n                  >\n                    This Week\n                  </Button>\n                  <Button\n                    variant=\"default\"\n                    size=\"sm\"\n                    onClick={() => {\n                      sendAllRosterEmailsMutation.mutate({\n                        weekStart,\n                        weekEnd\n                      });\n                    }}\n                    disabled={sendAllRosterEmailsMutation.isPending}\n                    data-testid=\"button-send-all-roster-emails\"\n                  >\n                    {sendAllRosterEmailsMutation.isPending ? (\n                      <>\n                        <Clock className=\"h-4 w-4 mr-2 animate-spin\" />\n                        Sending...\n                      </>\n                    ) : (\n                      <>\n                        <Send className=\"h-4 w-4 mr-2\" />\n                        Email Roster to All\n                      </>\n                    )}\n                  </Button>\n                </div>\n              </div>\n\n              {/* Calendar Grid */}\n              <div className=\"border rounded-lg overflow-hidden\">\n                {/* Header Row - Days of the week */}\n                <div className=\"grid grid-cols-8 border-b bg-gray-50 sticky top-0 z-10\">\n                  <div className=\"p-2 font-medium text-xs border-r bg-gray-50\">Time</div>\n                  {(() => {\n                    const weekStart = startOfWeek(currentDate, { weekStartsOn: 1 });\n                    return Array.from({ length: 7 }, (_, i) => {\n                      const day = addDays(weekStart, i);\n                      return (\n                        <div key={i} className=\"p-2 text-center font-medium text-xs border-r last:border-r-0 bg-gray-50\">\n                          <div>{format(day, 'EEE')}</div>\n                          <div className=\"text-xs text-gray-500\">{format(day, 'MMM dd')}</div>\n                        </div>\n                      );\n                    });\n                  })()}\n                </div>\n\n                {/* Hour Rows (7 AM - 11 PM) */}\n                <div className=\"max-h-[600px] overflow-y-auto\">\n                  {Array.from({ length: 16 }, (_, hourIndex) => {\n                    const hour = 7 + hourIndex; // 7 AM to 11 PM (7 + 15 = 22)\n                    const timeDisplay = hour === 0 ? '12 AM' : \n                                      hour < 12 ? `${hour} AM` : \n                                      hour === 12 ? '12 PM' : \n                                      `${hour - 12} PM`;\n                    \n                    return (\n                      <div key={hour} className=\"grid grid-cols-8 border-b last:border-b-0 relative\">\n                        {/* Time Column */}\n                        <div className=\"p-2 border-r bg-gray-50 text-xs font-medium text-gray-700 sticky left-0 z-10\">\n                          {timeDisplay}\n                        </div>\n                        \n                        {/* Day Columns */}\n                        {(() => {\n                          const weekStart = startOfWeek(currentDate, { weekStartsOn: 1 });\n                          return Array.from({ length: 7 }, (_, dayIndex) => {\n                            const day = addDays(weekStart, dayIndex);\n                            const dateStr = format(day, 'yyyy-MM-dd');\n                            \n                            // Create template shifts for each day\n                            const templateShifts = [\n                              {\n                                id: `template-morning-${dateStr}`,\n                                type: 'template',\n                                shiftType: 'morning',\n                                startTime: '08:00',\n                                endTime: '11:00',\n                                date: dateStr,\n                                name: 'Morning Shift'\n                              },\n                              {\n                                id: `template-afternoon-${dateStr}`,\n                                type: 'template',\n                                shiftType: 'afternoon',\n                                startTime: '12:30',\n                                endTime: '17:00',\n                                date: dateStr,\n                                name: 'Afternoon Shift'\n                              },\n                              {\n                                id: `template-night-${dateStr}`,\n                                type: 'template',\n                                shiftType: 'night',\n                                startTime: '17:30',\n                                endTime: '23:00',\n                                date: dateStr,\n                                name: 'Night Shift'\n                              }\n                            ];\n\n                            // Find actual shifts that overlap with this hour\n                            const actualShifts = Array.isArray(rosterShifts) ? rosterShifts.filter((shift: any) => {\n                              if (shift.date !== dateStr) return false;\n                              \n                              const shiftStart = parseInt(shift.startTime?.split(':')[0] || '0');\n                              const shiftEnd = parseInt(shift.endTime?.split(':')[0] || '0');\n                              \n                              // Check if this hour falls within the shift time\n                              return hour >= shiftStart && hour < shiftEnd;\n                            }) : [];\n\n                            // Find template shifts that overlap with this hour (and don't have actual shifts)\n                            const templateShiftsForHour = templateShifts.filter(template => {\n                              const templateStart = parseInt(template.startTime.split(':')[0]);\n                              const templateEnd = parseInt(template.endTime.split(':')[0]);\n                              \n                              // Check if this hour falls within template time\n                              if (hour < templateStart || hour >= templateEnd) return false;\n                              \n                              // Don't show template if there's already an actual shift covering this time\n                              const hasActualShift = actualShifts.some(actualShift => {\n                                const actualStart = parseInt(actualShift.startTime?.split(':')[0] || '0');\n                                const actualEnd = parseInt(actualShift.endTime?.split(':')[0] || '0');\n                                \n                                // Check if template overlaps with actual shift\n                                return (templateStart < actualEnd && templateEnd > actualStart);\n                              });\n                              \n                              return !hasActualShift;\n                            });\n\n                            const hourShifts = [...actualShifts, ...templateShiftsForHour];\n\n                            return (\n                              <div \n                                key={dayIndex} \n                                className={`relative border-r last:border-r-0 min-h-[30px] transition-colors cursor-pointer group select-none ${\n                                  dragPreview && dragPreview.date === dateStr && \n                                  hour >= dragPreview.startHour && hour <= dragPreview.endHour\n                                    ? 'bg-blue-200 border-blue-300'\n                                    : 'bg-white hover:bg-gray-50'\n                                }`}\n                                onClick={() => {\n                                  if (!isDragging) {\n                                    handleAddShiftAtTime(dateStr, `${hour.toString().padStart(2, '0')}:00`);\n                                  }\n                                }}\n                                onMouseDown={(e) => handleMouseDown(dateStr, hour, e)}\n                                onMouseEnter={() => handleMouseEnter(dateStr, hour)}\n                                data-testid={`calendar-cell-${dateStr}-${hour}`}\n                              >\n                                {/* Shift blocks */}\n                                {hourShifts.map((shift: any) => {\n                                  const shiftStart = parseInt(shift.startTime?.split(':')[0] || '0');\n                                  const shiftStartMinutes = parseInt(shift.startTime?.split(':')[1] || '0');\n                                  const shiftEnd = parseInt(shift.endTime?.split(':')[0] || '0');\n                                  const shiftEndMinutes = parseInt(shift.endTime?.split(':')[1] || '0');\n                                  \n                                  // Only show the shift block on its starting hour\n                                  if (hour !== shiftStart) return null;\n                                  \n                                  // Calculate height based on duration\n                                  const durationInHours = (shiftEnd - shiftStart) + (shiftEndMinutes - shiftStartMinutes) / 60;\n                                  const blockHeight = Math.max(1, durationInHours) * 30; // 30px per hour\n                                  \n                                  // Handle template shifts vs actual shifts\n                                  if (shift.type === 'template') {\n                                    return (\n                                      <div\n                                        key={shift.id}\n                                        className=\"shift-block absolute left-1 right-1 rounded-md p-2 z-10 border-2 border-dashed border-gray-300 bg-gray-50 hover:bg-gray-100 transition-colors cursor-pointer\"\n                                        style={{ \n                                          height: `${blockHeight}px`,\n                                          top: `${(shiftStartMinutes / 60) * 30}px`\n                                        }}\n                                        onClick={(e) => {\n                                          e.stopPropagation();\n                                          // Open modal to assign employee to this template\n                                          setSelectedDate(shift.date);\n                                          setSelectedEmployee(null);\n                                          setEditingShift({\n                                            shiftType: shift.shiftType,\n                                            startTime: shift.startTime,\n                                            endTime: shift.endTime,\n                                            date: shift.date,\n                                            notes: '',\n                                            location: '',\n                                            isTemplate: true  // Mark as template to simplify form\n                                          });\n                                          setIsShiftModalOpen(true);\n                                        }}\n                                        title={`Click to assign employee to ${shift.name}`}\n                                        data-testid={`template-shift-${shift.shiftType}-${dateStr}`}\n                                      >\n                                        <div className=\"text-xs font-medium text-gray-700 text-center\">\n                                          {shift.name}\n                                        </div>\n                                        <div className=\"text-xs text-gray-600 text-center\">\n                                          {shift.startTime.slice(0, 5)} - {shift.endTime.slice(0, 5)}\n                                        </div>\n                                        <div className=\"text-xs text-gray-500 text-center mt-1\">\n                                          Click to assign\n                                        </div>\n                                      </div>\n                                    );\n                                  }\n                                  \n                                  // Handle actual shifts\n                                  const employee = employeeArray.find((emp: any) => emp.id === shift.userId);\n                                  \n                                  // Check for conflicts with this shift\n                                  const shiftConflicts = checkForConflicts(\n                                    shift.userId,\n                                    shift.date,\n                                    shift.startTime,\n                                    shift.endTime,\n                                    shift.id\n                                  );\n                                  const hasConflict = shiftConflicts.length > 0;\n                                  \n                                  return (\n                                    <div\n                                      key={shift.id}\n                                      className={`shift-block absolute left-1 right-1 rounded-md p-2 z-20 shadow-sm hover:shadow-md transition-shadow cursor-pointer ${\n                                        hasConflict \n                                          ? 'bg-red-100 border-2 border-red-400'\n                                          : 'bg-blue-100 border border-blue-200'\n                                      }`}\n                                      style={{ \n                                        height: `${blockHeight}px`,\n                                        top: `${(shiftStartMinutes / 60) * 30}px`\n                                      }}\n                                      onClick={(e) => {\n                                        e.stopPropagation();\n                                        handleEditShift(shift);\n                                      }}\n                                      title={hasConflict ? ` Conflict detected with ${shiftConflicts.length} other shift(s)` : ''}\n                                    >\n                                      <div className={`text-xs font-medium truncate flex items-center gap-1 ${\n                                        hasConflict ? 'text-red-900' : 'text-blue-900'\n                                      }`}>\n                                        {hasConflict && <span title=\"Schedule conflict\"></span>}\n                                        {employee?.name || 'Unknown'}\n                                      </div>\n                                      <div className={`text-xs ${hasConflict ? 'text-red-700' : 'text-blue-700'}`}>\n                                        {shift.startTime?.slice(0, 5)} - {shift.endTime?.slice(0, 5)}\n                                      </div>\n                                      <div className={`text-xs capitalize truncate ${hasConflict ? 'text-red-600' : 'text-blue-600'}`}>\n                                        {shift.shiftType}\n                                      </div>\n                                      {shift.location && (\n                                        <div className=\"text-xs text-blue-500 truncate mt-1\">\n                                          {shift.location}\n                                        </div>\n                                      )}\n                                      <div className=\"flex gap-1 mt-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                                        <Button\n                                          size=\"sm\"\n                                          variant=\"ghost\"\n                                          className=\"h-4 w-4 p-0 text-blue-400 hover:text-blue-600\"\n                                          onClick={(e) => {\n                                            e.stopPropagation();\n                                            handleEditShift(shift);\n                                          }}\n                                        >\n                                          \n                                        </Button>\n                                        <Button\n                                          size=\"sm\"\n                                          variant=\"ghost\"\n                                          className=\"h-4 w-4 p-0 text-blue-400 hover:text-red-600\"\n                                          onClick={(e) => {\n                                            e.stopPropagation();\n                                            handleDeleteShift(shift.id);\n                                          }}\n                                        >\n                                          \n                                        </Button>\n                                      </div>\n                                    </div>\n                                  );\n                                })}\n                                \n                                {/* Drag preview overlay */}\n                                {dragPreview && dragPreview.date === dateStr && \n                                 hour >= dragPreview.startHour && hour <= dragPreview.endHour && (\n                                  <div className=\"absolute inset-0 bg-blue-300 bg-opacity-40 border-2 border-blue-400 flex items-center justify-center\">\n                                    {hour === dragPreview.startHour && (\n                                      <div className=\"text-xs font-medium text-blue-800 bg-white bg-opacity-90 px-2 py-1 rounded shadow\">\n                                        {dragPreview.endHour - dragPreview.startHour + 1}h shift\n                                        <br />\n                                        {`${dragPreview.startHour.toString().padStart(2, '0')}:00 - ${(dragPreview.endHour + 1).toString().padStart(2, '0')}:00`}\n                                      </div>\n                                    )}\n                                  </div>\n                                )}\n\n                                {/* Add shift indicator on hover (only when not dragging) */}\n                                {!isDragging && (\n                                  <div className=\"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-blue-50 bg-opacity-50\">\n                                    <span className=\"text-xs text-blue-600 font-medium\">+ Add Shift</span>\n                                  </div>\n                                )}\n                              </div>\n                            );\n                          });\n                        })()}\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n\n              {/* Employee Hours Summary */}\n              <div className=\"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6\">\n                {/* Weekly Hours Summary */}\n                <div className=\"p-4 bg-gray-50 rounded-lg\">\n                  <h4 className=\"text-sm font-medium mb-3\">Weekly Hours Summary</h4>\n                  <div className=\"space-y-2\">\n                    {employeeArray.map((employee: any) => {\n                      // Calculate total hours for this employee this week\n                      const employeeShifts = Array.isArray(rosterShifts) ? rosterShifts.filter((shift: any) => \n                        shift.userId === employee.id\n                      ) : [];\n                      \n                      const totalHours = employeeShifts.reduce((sum: number, shift: any) => {\n                        if (!shift.startTime || !shift.endTime) return sum;\n                        \n                        const [startHour, startMinute] = shift.startTime.split(':').map(Number);\n                        const [endHour, endMinute] = shift.endTime.split(':').map(Number);\n                        \n                        const startDecimal = startHour + startMinute / 60;\n                        const endDecimal = endHour + endMinute / 60;\n                        const duration = endDecimal - startDecimal;\n                        \n                        return sum + Math.max(0, duration);\n                      }, 0);\n\n                      return (\n                        <div key={employee.id} className=\"flex items-center justify-between p-2 bg-white rounded border\">\n                          <div className=\"flex items-center space-x-3\">\n                            <div className=\"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center\">\n                              <span className=\"text-xs font-medium text-blue-700\">\n                                {employee.name?.charAt(0) || 'U'}\n                              </span>\n                            </div>\n                            <div>\n                              <div className=\"text-sm font-medium\">{employee.name}</div>\n                              <div className=\"text-xs text-gray-500\">{employee.role || 'Employee'}</div>\n                            </div>\n                          </div>\n                          <div className=\"text-right\">\n                            <div className=\"text-sm font-semibold text-blue-600\">\n                              {totalHours.toFixed(1)}h\n                            </div>\n                            <div className=\"text-xs text-gray-500\">\n                              {employeeShifts.length} shifts\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })}\n                    \n                    {/* Total Summary */}\n                    <div className=\"mt-3 pt-3 border-t border-gray-200\">\n                      <div className=\"flex justify-between items-center\">\n                        <span className=\"text-sm font-medium text-gray-700\">Total Week Hours</span>\n                        <span className=\"text-lg font-bold text-blue-600\">\n                          {Array.isArray(rosterShifts) ? rosterShifts.reduce((sum: number, shift: any) => {\n                            if (!shift.startTime || !shift.endTime) return sum;\n                            \n                            const [startHour, startMinute] = shift.startTime.split(':').map(Number);\n                            const [endHour, endMinute] = shift.endTime.split(':').map(Number);\n                            \n                            const startDecimal = startHour + startMinute / 60;\n                            const endDecimal = endHour + endMinute / 60;\n                            const duration = endDecimal - startDecimal;\n                            \n                            return sum + Math.max(0, duration);\n                          }, 0).toFixed(1) : '0.0'}h\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Schedule Conflicts Panel */}\n                <div className=\"p-4 bg-red-50 rounded-lg\">\n                  <h4 className=\"text-sm font-medium mb-3 flex items-center gap-2\">\n                    <AlertTriangle className=\"h-4 w-4 text-red-500\" />\n                    Schedule Conflicts\n                  </h4>\n                  <div className=\"space-y-2\">\n                    {(() => {\n                      // Find all shifts with conflicts\n                      const shiftsWithConflicts = Array.isArray(rosterShifts) ? rosterShifts.filter((shift: any) => {\n                        const conflicts = checkForConflicts(\n                          shift.userId,\n                          shift.date,\n                          shift.startTime,\n                          shift.endTime,\n                          shift.id\n                        );\n                        return conflicts.length > 0;\n                      }) : [];\n\n                      if (shiftsWithConflicts.length === 0) {\n                        return (\n                          <div className=\"text-center py-4\">\n                            <div className=\"text-green-600 text-sm\"> No conflicts detected</div>\n                            <div className=\"text-xs text-gray-500 mt-1\">All shifts are properly scheduled</div>\n                          </div>\n                        );\n                      }\n\n                      return shiftsWithConflicts.map((shift: any) => {\n                        const employee = employeeArray.find((emp: any) => emp.id === shift.userId);\n                        const conflicts = checkForConflicts(\n                          shift.userId,\n                          shift.date,\n                          shift.startTime,\n                          shift.endTime,\n                          shift.id\n                        );\n\n                        return (\n                          <div key={shift.id} className=\"p-2 bg-white rounded border border-red-200\">\n                            <div className=\"flex items-center justify-between\">\n                              <div>\n                                <div className=\"text-xs font-medium text-red-900\">\n                                  {employee?.name || 'Unknown Employee'}\n                                </div>\n                                <div className=\"text-xs text-red-700\">\n                                  {format(parseISO(shift.date), 'EEE, MMM dd')}  {shift.startTime?.slice(0, 5)} - {shift.endTime?.slice(0, 5)}\n                                </div>\n                              </div>\n                              <div className=\"text-xs text-red-600\">\n                                {conflicts.length} conflict{conflicts.length > 1 ? 's' : ''}\n                              </div>\n                            </div>\n                            <div className=\"mt-1\">\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                className=\"h-6 text-xs border-red-300 text-red-700 hover:bg-red-100\"\n                                onClick={() => handleEditShift(shift)}\n                              >\n                                Resolve Conflict\n                              </Button>\n                            </div>\n                          </div>\n                        );\n                      });\n                    })()}\n                  </div>\n                </div>\n\n                {/* Instructions */}\n                <div className=\"p-4 bg-gray-50 rounded-lg\">\n                  <h4 className=\"text-sm font-medium mb-3\">How to Use Calendar</h4>\n                  <div className=\"text-xs text-gray-600 space-y-2\">\n                    <div className=\"flex items-start space-x-2\">\n                      <span className=\"w-4 h-4 bg-blue-100 rounded flex items-center justify-center mt-0.5\">\n                        <span className=\"text-blue-600 text-xs\">+</span>\n                      </span>\n                      <div>\n                        <p className=\"font-medium\">Click any time slot to create a shift</p>\n                        <p className=\"text-gray-500\">Select employee and set shift details</p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-start space-x-2\">\n                      <span className=\"w-4 h-4 bg-green-100 rounded flex items-center justify-center mt-0.5\">\n                        <span className=\"text-green-600 text-xs\"></span>\n                      </span>\n                      <div>\n                        <p className=\"font-medium\">Click shift blocks to edit</p>\n                        <p className=\"text-gray-500\">Modify times, employee, or location</p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-start space-x-2\">\n                      <span className=\"w-4 h-4 bg-red-100 rounded flex items-center justify-center mt-0.5\">\n                        <span className=\"text-red-600 text-xs\"></span>\n                      </span>\n                      <div>\n                        <p className=\"font-medium\">Delete shifts with trash icon</p>\n                        <p className=\"text-gray-500\">Removes shift from schedule</p>\n                      </div>\n                    </div>\n                    <div className=\"mt-3 pt-2 border-t border-gray-200\">\n                      <p className=\"text-xs text-gray-500\">\n                        <span className=\"font-medium\">Time Range:</span> 7:00 AM - 11:00 PM daily\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"billing\" className=\"space-y-6\">\n          <Tabs defaultValue=\"employee-rates\" className=\"space-y-4\">\n            <TabsList className=\"grid w-full grid-cols-3\">\n              <TabsTrigger value=\"employee-rates\" data-testid=\"tab-employee-rates\">Employee Rates</TabsTrigger>\n              <TabsTrigger value=\"employee-reports\" data-testid=\"tab-employee-reports\">Employee Reports</TabsTrigger>\n              <TabsTrigger value=\"legacy-tiers\" data-testid=\"tab-legacy-tiers\">Legacy Rate Tiers</TabsTrigger>\n            </TabsList>\n            \n            <TabsContent value=\"employee-rates\">\n              <EmployeeRatesManagement companyId={businessUser?.companyId || 1} />\n            </TabsContent>\n            \n            <TabsContent value=\"employee-reports\">\n              <EmployeeReportsManagement companyId={businessUser?.companyId || 1} />\n            </TabsContent>\n            \n            <TabsContent value=\"legacy-tiers\">\n              <BillingManagement companyId={businessUser?.companyId || 1} />\n            </TabsContent>\n          </Tabs>\n        </TabsContent>\n      </Tabs>\n\n      {/* Shift Modal */}\n      <Dialog open={isShiftModalOpen} onOpenChange={setIsShiftModalOpen}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingShift ? 'Edit Shift' : 'Add New Shift'}\n            </DialogTitle>\n            <DialogDescription>\n              {editingShift ? 'Modify the shift details below.' : 'Create a new shift assignment for your team.'}\n            </DialogDescription>\n          </DialogHeader>\n          <ShiftForm\n            initialData={editingShift}\n            employee={selectedEmployee}\n            date={selectedDate}\n            onSave={handleSaveShift}\n            onCancel={() => setIsShiftModalOpen(false)}\n            isLoading={createRosterShiftMutation.isPending || updateRosterShiftMutation.isPending}\n          />\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\n// Shift Form Component\nfunction ShiftForm({ \n  initialData, \n  employee, \n  date, \n  onSave, \n  onCancel, \n  isLoading \n}: {\n  initialData?: any;\n  employee?: any;\n  date?: string;\n  onSave: (data: any) => void;\n  onCancel: () => void;\n  isLoading: boolean;\n}) {\n  const { data: employees = [] } = useCompanyEmployees(1); // Replace with dynamic company ID\n  \n  const form = useForm({\n    defaultValues: {\n      employeeId: (employee?.id || initialData?.userId || '').toString(),\n      shiftType: initialData?.shiftType || 'Morning',\n      startTime: initialData?.startTime || '09:00',\n      endTime: initialData?.endTime || '17:00',\n      location: initialData?.location || '',\n      notes: initialData?.notes || ''\n    }\n  });\n\n  // Reset form when initialData changes (for editing)\n  useEffect(() => {\n    if (initialData) {\n      form.reset({\n        employeeId: (initialData.userId || '').toString(),\n        shiftType: initialData.shiftType || 'Morning',\n        startTime: initialData.startTime || '09:00',\n        endTime: initialData.endTime || '17:00',\n        location: initialData.location || '',\n        notes: initialData.notes || ''\n      });\n    } else if (employee) {\n      form.reset({\n        employeeId: employee.id.toString(),\n        shiftType: 'Morning',\n        startTime: '09:00',\n        endTime: '17:00',\n        location: '',\n        notes: ''\n      });\n    }\n  }, [initialData, employee, form]);\n\n  // Preset shift templates\n  const shiftTemplates = [\n    { name: 'Morning', start: '08:00', end: '11:00', type: 'Morning' },\n    { name: 'Afternoon', start: '12:30', end: '17:00', type: 'Afternoon' },\n    { name: 'Night', start: '17:30', end: '23:00', type: 'Night' },\n    { name: 'Full Day', start: '09:00', end: '17:00', type: 'Full Day' }\n  ];\n\n  const applyTemplate = (template: any) => {\n    console.log('Applying template:', template); // Debug log\n    form.setValue('startTime', template.start);\n    form.setValue('endTime', template.end);\n    form.setValue('shiftType', template.type);\n  };\n\n  const onSubmit = (data: any) => {\n    console.log('Form submitted with data:', data); // Debug log\n    console.log('Initial data for editing:', initialData); // Debug log\n    onSave({\n      ...data,\n      userId: data.employeeId\n    });\n  };\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          {date && (\n            <Label className=\"text-sm text-gray-500\">\n              Date: {format(new Date(date), 'EEEE, MMMM d, yyyy')}\n            </Label>\n          )}\n        </div>\n\n        {/* Preset Templates - Only show when not using a template */}\n        {!initialData?.isTemplate && (\n          <div>\n            <Label className=\"text-sm font-medium mb-2 block\">Quick Templates</Label>\n            <div className=\"grid grid-cols-2 gap-2\">\n              {shiftTemplates.map((template) => (\n                <Button\n                  key={template.name}\n                  type=\"button\"\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"text-xs\"\n                  onClick={() => applyTemplate(template)}\n                >\n                  {template.name}\n                  <span className=\"ml-1 text-gray-500\">\n                    {template.start}-{template.end}\n                  </span>\n                </Button>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Template Info - Show when using a template */}\n        {initialData?.isTemplate && (\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3\">\n            <div className=\"text-sm font-medium text-blue-900 capitalize\">\n              {initialData.shiftType} Shift\n            </div>\n            <div className=\"text-sm text-blue-700\">\n              {initialData.startTime} - {initialData.endTime}\n            </div>\n            <div className=\"text-xs text-blue-600 mt-1\">\n              Select an employee to assign this shift\n            </div>\n          </div>\n        )}\n\n        {/* Employee Selection */}\n        <FormField\n          control={form.control}\n          name=\"employeeId\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Employee</FormLabel>\n              <FormControl>\n                <Select value={field.value} onValueChange={field.onChange}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select an employee\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {employees.map((emp: any) => (\n                      <SelectItem key={emp.id} value={emp.id.toString()}>\n                        {emp.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        {/* Shift Type - Only show when not using a template */}\n        {!initialData?.isTemplate && (\n          <FormField\n            control={form.control}\n            name=\"shiftType\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Shift Type</FormLabel>\n                <FormControl>\n                  <Select value={field.value} onValueChange={field.onChange}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select shift type\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"Morning\">Morning</SelectItem>\n                      <SelectItem value=\"Evening\">Evening</SelectItem>\n                      <SelectItem value=\"Night\">Night</SelectItem>\n                      <SelectItem value=\"Double\">Double</SelectItem>\n                      <SelectItem value=\"Custom\">Custom</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        )}\n\n        {/* Time Fields - Only show when not using a template */}\n        {!initialData?.isTemplate && (\n          <div className=\"grid grid-cols-2 gap-4\">\n            <FormField\n              control={form.control}\n              name=\"startTime\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Start Time</FormLabel>\n                  <FormControl>\n                    <Input type=\"time\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"endTime\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>End Time</FormLabel>\n                  <FormControl>\n                    <Input type=\"time\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n        )}\n\n        <FormField\n          control={form.control}\n          name=\"location\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Location (Optional)</FormLabel>\n              <FormControl>\n                <Input placeholder=\"e.g. Store #1, Main Office\" {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"notes\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Notes (Optional)</FormLabel>\n              <FormControl>\n                <Input placeholder=\"Additional notes\" {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <DialogFooter>\n          <Button type=\"button\" variant=\"outline\" onClick={onCancel}>\n            Cancel\n          </Button>\n          <Button type=\"submit\" disabled={isLoading} data-testid=\"button-save-shift\">\n            {isLoading ? 'Saving...' : 'Save Shift'}\n          </Button>\n        </DialogFooter>\n      </form>\n    </Form>\n  );\n}","size_bytes":94549},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/PayBreakdown.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { ChevronDown, ChevronUp, DollarSign, Clock } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\n\ninterface Shift {\n  id: number;\n  date: string;\n  startTime: string;\n  endTime: string;\n  shiftType: string;\n}\n\ninterface PayBreakdownProps {\n  shift: Shift;\n}\n\ninterface BillingData {\n  shiftId: number;\n  totalAmount: number;\n  currency: string;\n  dayType: string;\n  shiftDuration: number;\n  tiers: Array<{\n    tierOrder: number;\n    hoursInTier: number;\n    hoursWorked: number;\n    ratePerHour: number;\n    amount: number;\n    currency: string;\n  }>;\n  breakdown: {\n    formatted: string;\n    details: string;\n  };\n}\n\nexport function PayBreakdown({ shift }: PayBreakdownProps) {\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  const { data: billingData, isLoading, error } = useQuery<BillingData>({\n    queryKey: [`/api/billing/shift/${shift.id}`],\n    enabled: !!shift.id,\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-2\">\n        <div className=\"flex items-center justify-between\">\n          <span className=\"text-sm font-medium text-slate-600\">Pay Breakdown</span>\n          <Skeleton className=\"h-6 w-20\" />\n        </div>\n        <Skeleton className=\"h-8 w-full\" />\n      </div>\n    );\n  }\n\n  if (error || !billingData) {\n    return (\n      <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-3\">\n        <div className=\"flex items-center gap-2\">\n          <DollarSign className=\"h-4 w-4 text-yellow-600\" />\n          <div className=\"text-sm text-yellow-800\">\n            <div className=\"font-medium\">Pay Calculation Unavailable</div>\n            <div className=\"text-xs\">Rate tiers may not be configured for this shift type</div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const formatCurrency = (amount: number, currency: string = 'USD') => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: currency,\n    }).format(amount);\n  };\n\n  const formatDayType = (dayType: string) => {\n    switch (dayType) {\n      case 'weekday': return 'Weekday';\n      case 'saturday': return 'Saturday';\n      case 'sunday': return 'Sunday';  \n      case 'holiday': return 'Holiday';\n      default: return dayType;\n    }\n  };\n\n  return (\n    <div className=\"space-y-3\">\n      <div className=\"flex items-center justify-between\">\n        <span className=\"text-sm font-medium text-slate-600\">Pay Breakdown</span>\n        <div className=\"text-lg font-semibold text-green-600\">\n          {formatCurrency(billingData.totalAmount || 0, billingData.currency || 'USD')}\n        </div>\n      </div>\n\n      {/* Summary Card */}\n      <div className=\"bg-green-50 border border-green-200 rounded-lg p-3\">\n        <div className=\"flex items-center gap-2 mb-2\">\n          <DollarSign className=\"h-4 w-4 text-green-600\" />\n          <div className=\"text-sm font-medium text-green-800\">Total Earnings</div>\n        </div>\n        <div className=\"text-xs text-green-700 space-y-1\">\n          <div> {(billingData.shiftDuration || 0).toFixed(1)} hours worked</div>\n          <div> {formatDayType(billingData.dayType || 'weekday')} rates applied</div>\n          <div> {(billingData.tiers || []).length} rate tier{(billingData.tiers || []).length !== 1 ? 's' : ''} used</div>\n        </div>\n      </div>\n\n      {/* Expandable Details */}\n      <Collapsible open={isExpanded} onOpenChange={setIsExpanded}>\n        <CollapsibleTrigger asChild>\n          <Button \n            variant=\"ghost\" \n            size=\"sm\" \n            className=\"w-full justify-between text-slate-600 hover:text-slate-900\"\n            data-testid=\"expand-pay-breakdown\"\n          >\n            <span className=\"text-sm\">View detailed breakdown</span>\n            {isExpanded ? (\n              <ChevronUp className=\"h-4 w-4\" />\n            ) : (\n              <ChevronDown className=\"h-4 w-4\" />\n            )}\n          </Button>\n        </CollapsibleTrigger>\n        \n        <CollapsibleContent className=\"space-y-3 mt-3\">\n          {/* Tier-by-tier breakdown */}\n          <div className=\"space-y-2\">\n            <div className=\"text-sm font-medium text-slate-700 mb-2\">Rate Tiers</div>\n            {(billingData.tiers || []).map((tier, index) => (\n              <div \n                key={tier.tierOrder} \n                className=\"bg-slate-50 rounded-lg p-3 border border-slate-200\"\n                data-testid={`pay-tier-${tier.tierOrder}`}\n              >\n                <div className=\"flex items-center justify-between mb-2\">\n                  <div className=\"text-sm font-medium text-slate-700\">\n                    Tier {tier.tierOrder}\n                  </div>\n                  <div className=\"text-sm font-semibold text-slate-900\">\n                    {formatCurrency(tier.amount || 0, tier.currency || 'USD')}\n                  </div>\n                </div>\n                <div className=\"text-xs text-slate-600 space-y-1\">\n                  <div className=\"flex items-center gap-1\">\n                    <Clock className=\"h-3 w-3\" />\n                    <span>\n                      {(tier.hoursWorked || 0).toFixed(1)} of {tier.hoursInTier || 0} hours at {formatCurrency(tier.ratePerHour || 0, tier.currency || 'USD')}/hour\n                    </span>\n                  </div>\n                  {(tier.hoursWorked || 0) < (tier.hoursInTier || 0) && (\n                    <div className=\"text-slate-500 text-xs\">\n                      ({((tier.hoursInTier || 0) - (tier.hoursWorked || 0)).toFixed(1)} hours remaining in this tier)\n                    </div>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n\n          {/* Calculation Details */}\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3\">\n            <div className=\"text-sm font-medium text-blue-800 mb-2\">Calculation Details</div>\n            <div className=\"text-xs text-blue-700 whitespace-pre-line\">\n              {billingData.breakdown?.details || 'Calculation details not available'}\n            </div>\n          </div>\n\n          {/* Total Summary */}\n          <div className=\"border-t border-slate-200 pt-3\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"text-sm font-medium text-slate-700\">Total Pay</div>\n              <div className=\"text-lg font-bold text-green-600\">\n                {formatCurrency(billingData.totalAmount || 0, billingData.currency || 'USD')}\n              </div>\n            </div>\n          </div>\n        </CollapsibleContent>\n      </Collapsible>\n    </div>\n  );\n}","size_bytes":6809},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/sidebar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  Clock, \n  BarChart3, \n  Calendar, \n  CalendarDays,\n  Plus, \n  FileText, \n  User \n} from \"lucide-react\";\n\nconst navItems = [\n  { path: \"/\", label: \"Dashboard\", icon: BarChart3 },\n  { path: \"/calendar\", label: \"Calendar\", icon: Calendar },\n  { path: \"/my-roster\", label: \"My Roster\", icon: CalendarDays },\n  { path: \"/add-shift\", label: \"Add Shift\", icon: Plus },\n  { path: \"/reports\", label: \"Reports\", icon: FileText },\n];\n\nexport function Sidebar() {\n  const [location] = useLocation();\n  const { user, logout } = useAuth();\n\n  return (\n    <aside className=\"w-64 bg-white shadow-sm border-r border-slate-200 hidden lg:block\">\n      <div className=\"p-6\">\n        <div className=\"flex items-center space-x-3\">\n          <Clock className=\"w-8 h-8 text-blue-600\" />\n          <h1 className=\"text-xl font-bold text-slate-900\">ShiftMate</h1>\n        </div>\n      </div>\n      \n      <nav className=\"px-6 pb-6\">\n        <ul className=\"space-y-2\">\n          {navItems.map((item) => {\n            const Icon = item.icon;\n            const isActive = location === item.path;\n            \n            return (\n              <li key={item.path}>\n                <Link href={item.path}>\n                  <button\n                    className={`w-full flex items-center space-x-3 px-4 py-4 rounded-lg text-base font-medium transition-colors text-left touch-target ${\n                      isActive\n                        ? \"bg-primary/10 text-primary border border-primary/20\"\n                        : \"text-slate-600 hover:bg-slate-50 hover:text-slate-900 active:bg-slate-100\"\n                    }`}\n                  >\n                    <Icon className=\"w-5 h-5\" />\n                    <span>{item.label}</span>\n                  </button>\n                </Link>\n              </li>\n            );\n          })}\n        </ul>\n        \n        <div className=\"mt-8 pt-6 border-t border-slate-200\">\n          <div className=\"flex items-center space-x-3 px-3 py-2 mb-4\">\n            <div className=\"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center\">\n              <User className=\"h-4 w-4 text-primary\" />\n            </div>\n            <div>\n              <p className=\"text-sm font-medium text-slate-900\">{user?.name}</p>\n              <p className=\"text-xs text-slate-500\">{user?.email}</p>\n            </div>\n          </div>\n          <Button \n            variant=\"outline\" \n            size=\"sm\" \n            onClick={() => logout()}\n            className=\"w-full\"\n          >\n            Sign Out\n          </Button>\n        </div>\n      </nav>\n    </aside>\n  );\n}\n","size_bytes":2734},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/pages/calendar.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useShifts } from \"@/hooks/use-shifts\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Clock, Plus, ChevronLeft, ChevronRight, CalendarIcon, User } from \"lucide-react\";\nimport { formatTime, calculateDuration } from \"@/lib/time-utils\";\nimport { Link } from \"wouter\";\nimport type { Shift } from \"@shared/schema\";\nimport { PayBreakdown } from \"@/components/PayBreakdown\";\n\n// Helper function to get start of week (Monday)\nconst getStartOfWeek = (date: Date): Date => {\n  const d = new Date(date);\n  const day = d.getDay();\n  const diff = d.getDate() - day + (day === 0 ? -6 : 1); // Adjust for Sunday\n  return new Date(d.setDate(diff));\n};\n\n// Helper function to get week date range\nconst getWeekRange = (startDate: Date): Date[] => {\n  const dates: Date[] = [];\n  const current = new Date(startDate);\n  \n  for (let i = 0; i < 7; i++) {\n    dates.push(new Date(current));\n    current.setDate(current.getDate() + 1);\n  }\n  \n  return dates;\n};\n\n// Helper function to get shift color based on type and source\nconst getShiftColor = (shiftType: string, isRosterShift: boolean = false): string => {\n  if (isRosterShift) {\n    // Roster shifts have light colors with dashed borders\n    const rosterColors = {\n      morning: 'bg-emerald-100 text-emerald-800 border-emerald-300',\n      afternoon: 'bg-blue-100 text-blue-800 border-blue-300',\n      evening: 'bg-blue-100 text-blue-800 border-blue-300',\n      night: 'bg-indigo-100 text-indigo-800 border-indigo-300',\n      default: 'bg-gray-100 text-gray-800 border-gray-300'\n    };\n    const colorKey = shiftType.toLowerCase() as keyof typeof rosterColors;\n    return rosterColors[colorKey] || rosterColors.default;\n  } else {\n    // Personal shifts have solid colors\n    const personalColors = {\n      morning: 'bg-emerald-500 text-white border-emerald-600',\n      afternoon: 'bg-blue-500 text-white border-blue-600',\n      evening: 'bg-blue-500 text-white border-blue-600',\n      night: 'bg-indigo-500 text-white border-indigo-600',\n      default: 'bg-gray-500 text-white border-gray-600'\n    };\n    const colorKey = shiftType.toLowerCase() as keyof typeof personalColors;\n    return personalColors[colorKey] || personalColors.default;\n  }\n};\n\n// Helper function to convert time string to minutes from midnight\nconst timeToMinutes = (timeStr: string): number => {\n  const [hours, minutes] = timeStr.split(':').map(Number);\n  return hours * 60 + minutes;\n};\n\n// Helper function to get position and height for shift based on time\nconst getShiftPosition = (startTime: string, endTime: string) => {\n  const startMinutes = timeToMinutes(startTime);\n  const endMinutes = timeToMinutes(endTime);\n  \n  // Each hour is 60px, starting from 6 AM (360 minutes)\n  const baseMinutes = 6 * 60; // 6 AM\n  const pixelsPerMinute = 1; // 60px per hour = 1px per minute\n  \n  const top = Math.max(0, (startMinutes - baseMinutes) * pixelsPerMinute);\n  const height = Math.max(20, (endMinutes - startMinutes) * pixelsPerMinute);\n  \n  return { top, height };\n};\n\n\nexport default function Calendar() {\n  const [currentWeekStart, setCurrentWeekStart] = useState(() => getStartOfWeek(new Date()));\n  const [selectedShift, setSelectedShift] = useState<Shift | null>(null);\n  \n  // Get week date range\n  const weekDates = useMemo(() => getWeekRange(currentWeekStart), [currentWeekStart]);\n  \n  // Get all shifts for the week (both personal and roster shifts)\n  const startDate = weekDates[0].toISOString().split('T')[0];\n  const endDate = weekDates[6].toISOString().split('T')[0];\n  \n  const { data: shifts = [], isLoading } = useShifts(startDate, endDate);\n\n  // Group shifts by date\n  const shiftsByDate = useMemo(() => {\n    const grouped: Record<string, Shift[]> = {};\n    shifts.forEach((shift: Shift) => {\n      if (!grouped[shift.date]) {\n        grouped[shift.date] = [];\n      }\n      grouped[shift.date].push(shift);\n    });\n    return grouped;\n  }, [shifts]);\n\n  // Calculate total hours for the week\n  const totalHours = useMemo(() => {\n    return shifts.reduce((total: number, shift: Shift) => {\n      return total + calculateDuration(shift.startTime, shift.endTime);\n    }, 0);\n  }, [shifts]);\n\n  const navigateWeeks = (direction: 'prev' | 'next') => {\n    const newDate = new Date(currentWeekStart);\n    newDate.setDate(newDate.getDate() + (direction === 'next' ? 7 : -7));\n    setCurrentWeekStart(newDate);\n  };\n\n  const goToCurrentWeek = () => {\n    setCurrentWeekStart(getStartOfWeek(new Date()));\n  };\n\n  const isCurrentWeek = () => {\n    const currentWeekStartDate = getStartOfWeek(new Date());\n    return currentWeekStart.toDateString() === currentWeekStartDate.toDateString();\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"p-4 lg:p-8\">\n        <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 h-96 flex items-center justify-center\">\n          <div className=\"text-slate-500\">Loading calendar...</div>\n        </div>\n      </div>\n    );\n  }\n\n  // Helper function to determine if a shift is a roster shift\n  // For simplicity, we'll treat all shifts as personal for now since we're showing all shifts\n  const isRosterShift = (shift: Shift): boolean => {\n    // In the future, this could check for a specific field that indicates roster vs personal\n    return false; // All shifts displayed as personal for now since this is the unified calendar\n  };\n\n  const formatWeekRange = (dates: Date[]) => {\n    const firstDate = dates[0];\n    const lastDate = dates[6];\n    const firstMonth = firstDate.toLocaleDateString('en-US', { month: 'short' });\n    const lastMonth = lastDate.toLocaleDateString('en-US', { month: 'short' });\n    const year = firstDate.getFullYear();\n    \n    if (firstMonth === lastMonth) {\n      return `${firstMonth} ${firstDate.getDate()}-${lastDate.getDate()}, ${year}`;\n    } else {\n      return `${firstMonth} ${firstDate.getDate()} - ${lastMonth} ${lastDate.getDate()}, ${year}`;\n    }\n  };\n\n  // Generate time slots from 6 AM to 11 PM\n  const timeSlots = [];\n  for (let hour = 6; hour <= 23; hour++) {\n    timeSlots.push({\n      hour,\n      time: `${hour.toString().padStart(2, '0')}:00`,\n      display: hour === 12 ? '12 PM' : hour > 12 ? `${hour - 12} PM` : `${hour} AM`\n    });\n  }\n\n  return (\n    <>\n      <div className=\"p-4 lg:p-8\">\n        <div className=\"space-y-6\">\n        {/* Header with Navigation */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-4\">\n            <div>\n              <h1 className=\"text-xl font-semibold text-slate-900\">Calendar</h1>\n              <p className=\"text-sm text-slate-600\">{formatWeekRange(weekDates)}</p>\n              <p className=\"text-xs text-slate-500 mt-1\">View all your shifts on the calendar</p>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => navigateWeeks('prev')}\n              >\n                <ChevronLeft className=\"h-4 w-4\" />\n              </Button>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => navigateWeeks('next')}\n              >\n                <ChevronRight className=\"h-4 w-4\" />\n              </Button>\n              {!isCurrentWeek() && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={goToCurrentWeek}\n                >\n                  Today\n                </Button>\n              )}\n            </div>\n          </div>\n          <div className=\"flex items-center space-x-4\">\n            <div className=\"text-sm text-slate-600\">\n              Total Hours: <span className=\"font-semibold\">{totalHours.toFixed(1)}h</span>\n            </div>\n            <Link href=\"/add-shift\">\n              <Button size=\"sm\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Shift\n              </Button>\n            </Link>\n          </div>\n        </div>\n\n        {/* Calendar Grid View */}\n        <Card>\n            <CardContent className=\"p-0\">\n              <div className=\"grid grid-cols-8 border-b border-slate-200\">\n                {/* Time column header */}\n                <div className=\"p-1 text-xs text-slate-500 font-medium border-r border-slate-200 w-16\">\n                  Time\n                </div>\n                {/* Day headers */}\n                {weekDates.map((date, index) => {\n                  const isToday = date.toISOString().split('T')[0] === new Date().toISOString().split('T')[0];\n                  return (\n                    <div\n                      key={index}\n                      className={`p-1 text-center border-r border-slate-200 last:border-r-0 ${\n                        isToday ? 'bg-blue-50' : ''\n                      }`}\n                    >\n                      <div className=\"text-xs text-slate-500 font-medium\">\n                        {date.toLocaleDateString('en-US', { weekday: 'short' })}\n                      </div>\n                      <div className={`text-xs font-semibold ${\n                        isToday ? 'text-blue-600' : 'text-slate-900'\n                      }`}>\n                        {date.getDate()}\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n\n              {/* Time grid */}\n              <div className=\"relative\">\n                {timeSlots.map((slot, timeIndex) => (\n                  <div key={slot.hour} className=\"grid grid-cols-8 border-b border-slate-100 last:border-b-0\">\n                    {/* Time label */}\n                    <div className=\"p-1 text-xs text-slate-500 font-medium border-r border-slate-200 bg-slate-50 w-16\">\n                      {slot.display}\n                    </div>\n                    {/* Day columns */}\n                    {weekDates.map((date, dayIndex) => {\n                      const dateStr = date.toISOString().split('T')[0];\n                      const dayShifts = shiftsByDate[dateStr] || [];\n                      const isToday = dateStr === new Date().toISOString().split('T')[0];\n                      \n                      return (\n                        <div\n                          key={dayIndex}\n                          className={`relative h-8 border-r border-slate-200 last:border-r-0 ${\n                            isToday ? 'bg-blue-50/30' : ''\n                          }`}\n                        >\n                          {/* Render shifts that overlap with this time slot */}\n                          {dayShifts.map(shift => {\n                            const shiftStartHour = parseInt(shift.startTime.split(':')[0]);\n                            const shiftEndHour = parseInt(shift.endTime.split(':')[0]);\n                            const shiftStartMinutes = parseInt(shift.startTime.split(':')[1]);\n                            const shiftEndMinutes = parseInt(shift.endTime.split(':')[1]);\n                            \n                            // Check if shift overlaps with this time slot\n                            const slotStart = slot.hour * 60;\n                            const slotEnd = (slot.hour + 1) * 60;\n                            const shiftStart = shiftStartHour * 60 + shiftStartMinutes;\n                            const shiftEnd = shiftEndHour * 60 + shiftEndMinutes;\n                            \n                            // Only show shift in the first time slot it appears\n                            if (shiftStartHour === slot.hour && shiftStart < shiftEnd) {\n                              const duration = calculateDuration(shift.startTime, shift.endTime);\n                              const heightInPixels = Math.max(12, duration * 32); // 32px per hour\n                              \n                              return (\n                                <div\n                                  key={shift.id}\n                                  data-testid={`desktop-shift-${shift.id}`}\n                                  className={`absolute left-1 right-1 rounded text-xs font-medium ${getShiftColor(shift.shiftType, isRosterShift(shift))} shadow-sm z-10 p-1 overflow-hidden cursor-pointer hover:opacity-80 transition-opacity ${isRosterShift(shift) ? 'border-2 border-dashed' : 'border-2 border-solid'}`}\n                                  style={{ \n                                    height: `${heightInPixels}px`,\n                                    top: `${(shiftStartMinutes / 60) * 32}px`\n                                  }}\n                                  onClick={() => setSelectedShift(shift)}\n                                >\n                                  <div className=\"flex items-center gap-1\">\n                                    <CalendarIcon className=\"h-3 w-3\" />\n                                    <div className=\"font-semibold truncate\">{shift.shiftType}</div>\n                                  </div>\n                                  <div className=\"text-xs opacity-90 truncate\">\n                                    {formatTime(shift.startTime)} - {formatTime(shift.endTime)}\n                                  </div>\n                                  <div className=\"text-xs font-bold\">\n                                    {duration.toFixed(1)}h\n                                  </div>\n                                </div>\n                              );\n                            }\n                            return null;\n                          })}\n                        </div>\n                      );\n                    })}\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Summary Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center\">\n                <Clock className=\"h-5 w-5 text-blue-600 mr-2\" />\n                <div>\n                  <div className=\"text-sm text-slate-600\">Total Hours</div>\n                  <div className=\"text-xl font-semibold\">{totalHours.toFixed(1)}h</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center\">\n                <div className=\"w-5 h-5 bg-emerald-500 rounded mr-2\"></div>\n                <div>\n                  <div className=\"text-sm text-slate-600\">Total Shifts</div>\n                  <div className=\"text-xl font-semibold\">{shifts.length}</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center\">\n                <div className=\"w-5 h-5 bg-blue-500 rounded mr-2\"></div>\n                <div>\n                  <div className=\"text-sm text-slate-600\">Avg per Day</div>\n                  <div className=\"text-xl font-semibold\">\n                    {shifts.length > 0 ? (totalHours / 7).toFixed(1) : 0}h\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      <Dialog open={!!selectedShift} onOpenChange={() => setSelectedShift(null)}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle>Shift Details</DialogTitle>\n          </DialogHeader>\n          {selectedShift && (\n            <div className=\"space-y-4\">\n              {/* Roster Shift Indicator */}\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-center gap-2\">\n                <CalendarIcon className=\"h-4 w-4 text-blue-600\" />\n                <div className=\"text-sm text-blue-800\">\n                  <div className=\"font-medium\">Roster Shift</div>\n                  <div className=\"text-xs\">This shift was assigned by your manager</div>\n                </div>\n              </div>\n              \n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium text-slate-600\">Date</label>\n                  <div className=\"text-sm text-slate-900\">\n                    {new Date(selectedShift.date).toLocaleDateString('en-US', { \n                      weekday: 'long', \n                      year: 'numeric', \n                      month: 'long', \n                      day: 'numeric' \n                    })}\n                  </div>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium text-slate-600\">Shift Type</label>\n                  <div className=\"text-sm text-slate-900\">{selectedShift.shiftType}</div>\n                </div>\n              </div>\n              \n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium text-slate-600\">Start Time</label>\n                  <div className=\"text-sm text-slate-900\">{formatTime(selectedShift.startTime)}</div>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium text-slate-600\">End Time</label>\n                  <div className=\"text-sm text-slate-900\">{formatTime(selectedShift.endTime)}</div>\n                </div>\n              </div>\n              \n              <div>\n                <label className=\"text-sm font-medium text-slate-600\">Duration</label>\n                <div className=\"text-sm text-slate-900\">\n                  {calculateDuration(selectedShift.startTime, selectedShift.endTime).toFixed(1)} hours\n                </div>\n              </div>\n              \n              {/* Pay Breakdown Section */}\n              <PayBreakdown shift={selectedShift} />\n              \n              {selectedShift.notes && (\n                <div>\n                  <label className=\"text-sm font-medium text-slate-600\">Notes</label>\n                  <div className=\"text-sm text-slate-900 bg-slate-50 p-3 rounded-lg mt-1\">\n                    {selectedShift.notes}\n                  </div>\n                </div>\n              )}\n              \n              {!selectedShift.notes && (\n                <div className=\"text-sm text-slate-500 italic\">\n                  No notes added for this shift.\n                </div>\n              )}\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n","size_bytes":18743},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"server/billing-engine.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport { Pool } from \"pg\";\nimport { rateTiers, publicHolidays, employeeRates } from \"@shared/schema\";\nimport { eq, and, or, gte, lte, isNull } from \"drizzle-orm\";\n\n// Use same database connection as storage.ts\nconst connectionString = process.env.DATABASE_URL;\nif (!connectionString) {\n  throw new Error(\"DATABASE_URL environment variable is required\");\n}\n\nconst match = connectionString.match(\n  /^postgresql:\\/\\/([^:]+):([^@]+)@([^:]+):(\\d+)\\/(.+)$/,\n);\nif (!match) {\n  throw new Error(\"Invalid DATABASE_URL format\");\n}\n\nconst [, username, password, host, port, database] = match;\n\nconst pool = new Pool({\n  user: username,\n  password: password,\n  host: host,\n  port: parseInt(port),\n  database: database,\n  ssl: {\n    rejectUnauthorized: false,\n  },\n});\n\nconst db = drizzle(pool);\n\nexport interface BillingTier {\n  tier: number;\n  rate: number; // rate per hour in cents\n  hours: number;\n  subtotal: number; // in cents\n}\n\nexport interface ShiftBilling {\n  shift_id: string | number;\n  total_hours: number;\n  total_amount: number; // in cents\n  date: string;\n  day_type: string;\n  shift_type: string;\n  start_time?: string;\n  end_time?: string;\n  billing: BillingTier[];\n}\n\n/**\n * Determine the base rate type for employee billing purposes\n * Supports: weekday, saturday, sunday, publicHoliday\n * Note: weeknight is handled separately via split billing\n */\nexport function getEmployeeRateType(date: string, holidays: string[]): string {\n  const shiftDate = new Date(date);\n  const dayOfWeek = shiftDate.getDay(); // 0 = Sunday, 6 = Saturday\n\n  // Check if it's a holiday first\n  if (holidays.includes(date)) {\n    return \"publicHoliday\";\n  }\n\n  // Check day of week\n  if (dayOfWeek === 0) {\n    return \"sunday\";\n  } else if (dayOfWeek === 6) {\n    return \"saturday\";\n  } else {\n    // Weekdays (Monday-Friday)\n    return \"weekday\";\n  }\n}\n\n/**\n * Calculate weeknight hours for a weekday shift\n * Returns hours (max 4) that fall between 21:00-23:59 on Monday-Friday\n */\nexport function calculateWeeknightHours(\n  startTime: string,\n  endTime: string,\n): number {\n  const [startHour, startMin] = startTime.split(\":\").map(Number);\n  const [endHour, endMin] = endTime.split(\":\").map(Number);\n\n  let startMinutes = startHour * 60 + startMin;\n  let endMinutes = endHour * 60 + endMin;\n\n  // Handle cross-day shifts\n  if (endMinutes <= startMinutes) {\n    endMinutes += 24 * 60;\n  }\n\n  // Weeknight window: 21:00 (1260 minutes) to 23:59 (1439 minutes)\n  const weeknightStart = 21 * 60; // 1260 minutes (9 PM)\n  const weeknightEnd = 23 * 60 + 59; // 1439 minutes (11:59 PM)\n\n  // Check if shift overlaps with weeknight window\n  if (endMinutes <= weeknightStart || startMinutes > weeknightEnd) {\n    // No overlap\n    return 0;\n  }\n\n  // Calculate overlap\n  const overlapStart = Math.max(startMinutes, weeknightStart);\n  const overlapEnd = Math.min(endMinutes, weeknightEnd);\n  const overlapMinutes = overlapEnd - overlapStart;\n\n  if (overlapMinutes <= 0) {\n    return 0;\n  }\n\n  // Convert to hours and cap at 2 hours\n  const overlapHours = overlapMinutes / 60;\n  return Math.min(overlapHours, 4);\n}\n\n/**\n * Get employee-specific rates\n */\nexport async function getEmployeeRates(\n  userId: number,\n  date: string,\n): Promise<{\n  weekdayRate: number;\n  weeknightRate: number;\n  saturdayRate: number;\n  sundayRate: number;\n  publicHolidayRate: number;\n} | null> {\n  const rates = await db\n    .select({\n      weekdayRate: employeeRates.weekdayRate,\n      weeknightRate: employeeRates.weeknightRate,\n      saturdayRate: employeeRates.saturdayRate,\n      sundayRate: employeeRates.sundayRate,\n      publicHolidayRate: employeeRates.publicHolidayRate,\n    })\n    .from(employeeRates)\n    .where(\n      and(\n        eq(employeeRates.userId, userId),\n        or(isNull(employeeRates.validFrom), lte(employeeRates.validFrom, date)),\n        or(isNull(employeeRates.validTo), gte(employeeRates.validTo, date)),\n      ),\n    )\n    .limit(1);\n\n  return rates.length > 0 ? rates[0] : null;\n}\n\n/**\n * Calculate shift duration in hours, handling cross-day shifts\n */\nexport function calculateShiftDuration(\n  startTime: string,\n  endTime: string,\n): number {\n  const [startHour, startMin] = startTime.split(\":\").map(Number);\n  const [endHour, endMin] = endTime.split(\":\").map(Number);\n\n  let startMinutes = startHour * 60 + startMin;\n  let endMinutes = endHour * 60 + endMin;\n\n  // Handle cross-day shifts (e.g., 22:00 to 06:00)\n  if (endMinutes <= startMinutes) {\n    endMinutes += 24 * 60; // Add 24 hours\n  }\n\n  const durationMinutes = endMinutes - startMinutes;\n  return durationMinutes / 60; // Convert to hours\n}\n\n/**\n * Get applicable rate tiers for a shift\n */\nexport async function getRateTiers(\n  companyId: number,\n  shiftType: string,\n  dayType: string,\n  shiftDate: string,\n): Promise<\n  Array<{\n    id: number;\n    tierOrder: number;\n    hoursInTier: string | null;\n    ratePerHour: number;\n  }>\n> {\n  const tiers = await db\n    .select({\n      id: rateTiers.id,\n      tierOrder: rateTiers.tierOrder,\n      hoursInTier: rateTiers.hoursInTier,\n      ratePerHour: rateTiers.ratePerHour,\n    })\n    .from(rateTiers)\n    .where(\n      and(\n        eq(rateTiers.companyId, companyId),\n        eq(rateTiers.shiftType, shiftType),\n        eq(rateTiers.dayType, dayType),\n        or(isNull(rateTiers.validFrom), gte(rateTiers.validFrom, shiftDate)),\n        or(isNull(rateTiers.validTo), lte(rateTiers.validTo, shiftDate)),\n      ),\n    )\n    .orderBy(rateTiers.tierOrder);\n\n  return tiers;\n}\n\n/**\n * Get public holidays as an array of date strings\n */\nexport async function getPublicHolidays(): Promise<string[]> {\n  const holidays = await db\n    .select({ date: publicHolidays.date })\n    .from(publicHolidays);\n\n  return holidays.map((h) => h.date);\n}\n\n/**\n * Calculate employee-based billing for a shift\n */\nexport async function calculateShiftBilling(\n  shiftId: string | number,\n  userId: number,\n  date: string,\n  startTime: string,\n  endTime: string,\n  shiftType: string,\n): Promise<ShiftBilling> {\n  // Calculate total hours\n  const totalHours = calculateShiftDuration(startTime, endTime);\n\n  // Get holidays\n  const holidays = await getPublicHolidays();\n\n  // Determine base rate type for employee billing\n  const rateType = getEmployeeRateType(date, holidays);\n\n  // Get employee rates\n  const employeeRates = await getEmployeeRates(userId, date);\n\n  // If no employee rates found, use fallback rate\n  if (!employeeRates) {\n    const fallbackRate = 2500; // $25.00 per hour in cents - fallback rate\n    return {\n      shift_id: shiftId,\n      total_hours: totalHours,\n      total_amount: Math.round(totalHours * fallbackRate),\n      date,\n      day_type: rateType,\n      shift_type: shiftType,\n      billing: [\n        {\n          tier: 1,\n          rate: fallbackRate,\n          hours: totalHours,\n          subtotal: Math.round(totalHours * fallbackRate),\n        },\n      ],\n    };\n  }\n\n  // Handle weekday shifts with potential weeknight hours\n  if (rateType === \"weekday\") {\n    const weeknightHours = calculateWeeknightHours(startTime, endTime);\n\n    if (weeknightHours > 0) {\n      // Split billing: weeknight hours + weekday hours\n      const weekdayHours = totalHours - weeknightHours;\n      const weeknightAmount = Math.round(\n        weeknightHours * employeeRates.weeknightRate,\n      );\n      const weekdayAmount = Math.round(\n        weekdayHours * employeeRates.weekdayRate,\n      );\n      const totalAmount = weeknightAmount + weekdayAmount;\n\n      return {\n        shift_id: shiftId,\n        total_hours: totalHours,\n        total_amount: totalAmount,\n        date,\n        day_type: \"weekday/weeknight\", // Indicates split billing\n        shift_type: shiftType,\n        start_time: startTime,\n        end_time: endTime,\n        billing: [\n          {\n            tier: 1,\n            rate: employeeRates.weekdayRate,\n            hours: weekdayHours,\n            subtotal: weekdayAmount,\n          },\n          {\n            tier: 2,\n            rate: employeeRates.weeknightRate,\n            hours: weeknightHours,\n            subtotal: weeknightAmount,\n          },\n        ],\n      };\n    }\n  }\n\n  // Get the appropriate rate based on rate type (non-weekday or weekday without weeknight hours)\n  let hourlyRate: number;\n  switch (rateType) {\n    case \"weekday\":\n      hourlyRate = employeeRates.weekdayRate;\n      break;\n    case \"saturday\":\n      hourlyRate = employeeRates.saturdayRate;\n      break;\n    case \"sunday\":\n      hourlyRate = employeeRates.sundayRate;\n      break;\n    case \"publicHoliday\":\n      hourlyRate = employeeRates.publicHolidayRate;\n      break;\n    default:\n      hourlyRate = employeeRates.weekdayRate; // fallback to weekday rate\n  }\n\n  // Calculate simple hourly billing\n  const totalAmount = Math.round(totalHours * hourlyRate);\n\n  return {\n    shift_id: shiftId,\n    total_hours: totalHours,\n    total_amount: totalAmount,\n    date,\n    day_type: rateType,\n    shift_type: shiftType,\n    start_time: startTime,\n    end_time: endTime,\n    billing: [\n      {\n        tier: 1,\n        rate: hourlyRate,\n        hours: totalHours,\n        subtotal: totalAmount,\n      },\n    ],\n  };\n}\n\n/**\n * Format currency amount from cents to display string\n */\nexport function formatCurrency(\n  amountInCents: number,\n  currency: string = \"AUD\",\n): string {\n  const amount = amountInCents / 100;\n  return new Intl.NumberFormat(\"en-AU\", {\n    style: \"currency\",\n    currency,\n  }).format(amount);\n}\n\n/**\n * Batch calculate billing for multiple shifts using employee rates\n */\nexport async function calculateMultipleShiftsBilling(\n  shifts: Array<{\n    id: string | number;\n    userId: number;\n    date: string;\n    startTime: string;\n    endTime: string;\n    shiftType: string;\n  }>,\n): Promise<ShiftBilling[]> {\n  const results = await Promise.all(\n    shifts.map((shift) =>\n      calculateShiftBilling(\n        shift.id,\n        shift.userId,\n        shift.date,\n        shift.startTime,\n        shift.endTime,\n        shift.shiftType,\n      ),\n    ),\n  );\n\n  return results;\n}\n","size_bytes":10062},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/hooks/use-shifts.ts":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { Shift, InsertShift } from \"@shared/schema\";\n\nexport function useShifts(startDate?: string, endDate?: string) {\n  const queryKey = startDate && endDate \n    ? [\"/api/shifts\", { startDate, endDate }]\n    : [\"/api/shifts\"];\n\n  return useQuery({\n    queryKey,\n    queryFn: async () => {\n      console.log('useShifts queryFn called for:', startDate && endDate ? `${startDate} to ${endDate}` : 'all shifts');\n      const url = startDate && endDate \n        ? `/api/shifts?startDate=${startDate}&endDate=${endDate}`\n        : \"/api/shifts\";\n      const response = await apiRequest('GET', url);\n      const data = await response.json();\n      console.log('useShifts data received:', data.length, 'shifts');\n      return data;\n    },\n  });\n}\n\n// Hook for personal shifts (created by the user themselves)\nexport function usePersonalShifts(startDate?: string, endDate?: string) {\n  const queryKey = startDate && endDate \n    ? [\"/api/personal-shifts\", { startDate, endDate }]\n    : [\"/api/personal-shifts\"];\n\n  return useQuery({\n    queryKey,\n    queryFn: async () => {\n      console.log('usePersonalShifts queryFn called for:', startDate && endDate ? `${startDate} to ${endDate}` : 'all personal shifts');\n      const url = startDate && endDate \n        ? `/api/personal-shifts?startDate=${startDate}&endDate=${endDate}`\n        : \"/api/personal-shifts\";\n      const response = await apiRequest('GET', url);\n      const data = await response.json();\n      console.log('usePersonalShifts data received:', data.length, 'personal shifts');\n      return data;\n    },\n  });\n}\n\n// Hook for roster shifts (assigned by managers)\nexport function useIndividualRosterShifts(startDate?: string, endDate?: string) {\n  const queryKey = startDate && endDate \n    ? [\"/api/roster-shifts\", { startDate, endDate }]\n    : [\"/api/roster-shifts\"];\n\n  return useQuery({\n    queryKey,\n    queryFn: async () => {\n      console.log('useIndividualRosterShifts queryFn called for date range:', startDate && endDate ? `${startDate} to ${endDate}` : 'all roster shifts');\n      const url = startDate && endDate \n        ? `/api/roster-shifts?startDate=${startDate}&endDate=${endDate}`\n        : \"/api/roster-shifts\";\n      const response = await apiRequest('GET', url);\n      const data = await response.json();\n      console.log('useIndividualRosterShifts data received:', data.length, 'roster shifts');\n      return data;\n    },\n  });\n}\n\nexport function useCreateShift() {\n  return useMutation({\n    mutationFn: async (shift: Omit<InsertShift, 'userId'>) => {\n      const response = await apiRequest(\"POST\", \"/api/shifts\", shift);\n      return response.json();\n    },\n    onSuccess: () => {\n      // Invalidate all shift-related queries\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/shifts\" \n      });\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/personal-shifts\" \n      });\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/roster-shifts\" \n      });\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/analytics/weekly-hours\" \n      });\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/analytics/daily-average\" \n      });\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/analytics/missing-entries\" \n      });\n    },\n  });\n}\n\nexport function useUpdateShift() {\n  return useMutation({\n    mutationFn: async ({ id, ...shift }: { id: number } & Partial<InsertShift>) => {\n      const response = await apiRequest(\"PUT\", `/api/shifts/${id}`, shift);\n      return response.json();\n    },\n    onSuccess: () => {\n      // Invalidate all shift-related queries\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/shifts\" \n      });\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/personal-shifts\" \n      });\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/roster-shifts\" \n      });\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/analytics/weekly-hours\" \n      });\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/analytics/daily-average\" \n      });\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/analytics/missing-entries\" \n      });\n    },\n  });\n}\n\nexport function useDeleteShift() {\n  return useMutation({\n    mutationFn: async (id: number) => {\n      const response = await apiRequest(\"DELETE\", `/api/shifts/${id}`);\n      return response.json();\n    },\n    onSuccess: () => {\n      // Invalidate all shift-related queries\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/shifts\" \n      });\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/personal-shifts\" \n      });\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/roster-shifts\" \n      });\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/analytics/weekly-hours\" \n      });\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/analytics/daily-average\" \n      });\n      queryClient.invalidateQueries({ predicate: (query) => \n        query.queryKey[0] === \"/api/analytics/missing-entries\" \n      });\n    },\n  });\n}\n\nexport function useWeeklyHours(startDate: string, endDate: string) {\n  return useQuery({\n    queryKey: [\"/api/analytics/weekly-hours\", { startDate, endDate }],\n    queryFn: async () => {\n      console.log('useWeeklyHours queryFn called for:', `${startDate} to ${endDate}`);\n      const response = await apiRequest('GET', `/api/analytics/weekly-hours?startDate=${startDate}&endDate=${endDate}`);\n      const data = await response.json();\n      console.log('useWeeklyHours data received:', data);\n      return data.hours as number;\n    },\n  });\n}\n\nexport function useDailyAverage(startDate: string, endDate: string) {\n  return useQuery({\n    queryKey: [\"/api/analytics/daily-average\", { startDate, endDate }],\n    queryFn: async () => {\n      const response = await apiRequest('GET', `/api/analytics/daily-average?startDate=${startDate}&endDate=${endDate}`);\n      const data = await response.json();\n      return data.average as number;\n    },\n  });\n}\n\nexport function useMissingEntries(startDate: string, endDate: string) {\n  return useQuery({\n    queryKey: [\"/api/analytics/missing-entries\", { startDate, endDate }],\n    queryFn: async () => {\n      const response = await apiRequest('GET', `/api/analytics/missing-entries?startDate=${startDate}&endDate=${endDate}`);\n      const data = await response.json();\n      return data.missingDates as string[];\n    },\n  });\n}\n","size_bytes":7149},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"shared/schema.ts":{"content":"import { pgTable, text, serial, integer, boolean, timestamp, date, time, varchar, jsonb, index, decimal } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table for persistent authentication\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// Companies/Organizations table\nexport const companies = pgTable(\"shiftmate_companies\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  email: text(\"email\").notNull().unique(),\n  ownerName: text(\"owner_name\").notNull(),\n  industry: text(\"industry\"), // retail, hospitality, healthcare, etc.\n  size: text(\"size\"), // small, medium, large\n  timezone: text(\"timezone\").default(\"UTC\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const users = pgTable(\"shiftmate_users\", {\n  id: serial(\"id\").primaryKey(),\n  email: text(\"email\").notNull().unique(),\n  name: text(\"name\").notNull(),\n  userType: text(\"user_type\").notNull().default(\"individual\"), // individual, business_owner, employee\n  companyId: integer(\"company_id\").references(() => companies.id),\n  role: text(\"role\"), // manager, supervisor, employee\n  hourlyRate: integer(\"hourly_rate\"), // in cents\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const shifts = pgTable(\"shiftmate_shifts\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  companyId: integer(\"company_id\").references(() => companies.id),\n  date: date(\"date\").notNull(),\n  startTime: time(\"start_time\").notNull(),\n  endTime: time(\"end_time\").notNull(),\n  shiftType: text(\"shift_type\").notNull(), // morning, evening, night, double, custom\n  notes: text(\"notes\"),\n  location: text(\"location\"), // shift location for roster planning\n  status: text(\"status\").default(\"completed\"), // completed, pending_approval, approved, rejected, scheduled\n  createdBy: integer(\"created_by\").references(() => users.id), // manager who assigned/created the shift\n  approvedBy: integer(\"approved_by\").references(() => users.id),\n  approvedAt: timestamp(\"approved_at\"),\n  isRecurring: boolean(\"is_recurring\").default(false),\n  recurringPattern: text(\"recurring_pattern\"), // daily, weekly, custom\n  recurringEndDate: date(\"recurring_end_date\"),\n  templateId: integer(\"template_id\"), // for future shift templates feature\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const notifications = pgTable(\"shiftmate_notifications\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  type: text(\"type\").notNull(), // missing_entries, long_shift\n  message: text(\"message\").notNull(),\n  isRead: boolean(\"is_read\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Refresh tokens for JWT authentication\nexport const refreshTokens = pgTable(\"shiftmate_refresh_tokens\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  tokenHash: text(\"token_hash\").notNull().unique(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  revokedAt: timestamp(\"revoked_at\"),\n});\n\n// Rate tiers for tiered billing system\nexport const rateTiers = pgTable(\"shiftmate_rate_tiers\", {\n  id: serial(\"id\").primaryKey(),\n  companyId: integer(\"company_id\").notNull().references(() => companies.id),\n  shiftType: text(\"shift_type\").notNull(), // 'Day', 'Night', 'Weekend', 'Holiday', 'Custom'\n  tierOrder: integer(\"tier_order\").notNull(), // 1, 2, 3, etc.\n  hoursInTier: decimal(\"hours_in_tier\", { precision: 5, scale: 2 }), // NULL for \"remaining hours\"\n  ratePerHour: integer(\"rate_per_hour\").notNull(), // in cents (e.g. 5000 = $50.00)\n  dayType: text(\"day_type\").notNull(), // 'weekday', 'saturday', 'sunday', 'holiday'\n  currency: text(\"currency\").default(\"AUD\"),\n  validFrom: date(\"valid_from\"),\n  validTo: date(\"valid_to\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Public holidays for holiday rate calculations\nexport const publicHolidays = pgTable(\"shiftmate_public_holidays\", {\n  id: serial(\"id\").primaryKey(),\n  date: date(\"date\").notNull().unique(),\n  description: text(\"description\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Employee-specific rates for the 5 rate types\nexport const employeeRates = pgTable(\"shiftmate_employee_rates\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  companyId: integer(\"company_id\").notNull().references(() => companies.id),\n  weekdayRate: integer(\"weekday_rate\").notNull(), // in cents (e.g. 2500 = $25.00)\n  weeknightRate: integer(\"weeknight_rate\").notNull(), // in cents\n  saturdayRate: integer(\"saturday_rate\").notNull(), // in cents\n  sundayRate: integer(\"sunday_rate\").notNull(), // in cents\n  publicHolidayRate: integer(\"public_holiday_rate\").notNull(), // in cents\n  currency: text(\"currency\").default(\"AUD\"),\n  validFrom: date(\"valid_from\"),\n  validTo: date(\"valid_to\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const insertCompanySchema = createInsertSchema(companies).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertShiftSchema = createInsertSchema(shifts).omit({\n  id: true,\n  createdAt: true,\n  approvedAt: true,\n});\n\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertRefreshTokenSchema = createInsertSchema(refreshTokens).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertRateTierSchema = createInsertSchema(rateTiers).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertPublicHolidaySchema = createInsertSchema(publicHolidays).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertEmployeeRateSchema = createInsertSchema(employeeRates).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertCompany = z.infer<typeof insertCompanySchema>;\nexport type Company = typeof companies.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type InsertShift = z.infer<typeof insertShiftSchema>;\nexport type Shift = typeof shifts.$inferSelect;\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\nexport type Notification = typeof notifications.$inferSelect;\nexport type InsertRefreshToken = z.infer<typeof insertRefreshTokenSchema>;\nexport type RefreshToken = typeof refreshTokens.$inferSelect;\nexport type InsertRateTier = z.infer<typeof insertRateTierSchema>;\nexport type RateTier = typeof rateTiers.$inferSelect;\nexport type InsertPublicHoliday = z.infer<typeof insertPublicHolidaySchema>;\nexport type PublicHoliday = typeof publicHolidays.$inferSelect;\nexport type InsertEmployeeRate = z.infer<typeof insertEmployeeRateSchema>;\nexport type EmployeeRate = typeof employeeRates.$inferSelect;\n","size_bytes":7455},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"node:path\";\n\nexport default defineConfig({\n  root: \"client\",\n  plugins: [react()],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(__dirname, \"client/src\"), //  corregido\n    },\n  },\n  server: {\n    host: \"0.0.0.0\",\n    port: 5173,\n    proxy: {\n      \"/api\": {\n        //  localhost no funciona en Replit  usar 0.0.0.0\n        target: \"http://0.0.0.0:3000\",\n        changeOrigin: true,\n      },\n    },\n    allowedHosts: [\n      \"14311159-0e7c-428a-a851-f6ec72431c0c-00-ozdj6xuq2oty.spock.replit.dev\",\n    ],\n  },\n});\n","size_bytes":628},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/EmployeeReportsManagement.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { FileText, Download, User, Calendar, Clock, DollarSign, TrendingUp, FileDown, FileSpreadsheet } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\n\ninterface Employee {\n  id: number;\n  name: string;\n  email: string;\n}\n\ninterface ShiftBilling {\n  shift_id: string | number;\n  total_hours: number;\n  total_amount: number;\n  date: string;\n  day_type: string;\n  shift_type: string;\n  billing: Array<{\n    tier: number;\n    rate: number;\n    hours: number;\n    subtotal: number;\n  }>;\n}\n\ninterface EmployeeReport {\n  employee: {\n    id: number;\n    name: string;\n    email: string;\n  };\n  period: {\n    startDate: string;\n    endDate: string;\n  };\n  shifts: ShiftBilling[];\n  summary: {\n    totalHours: number;\n    weekdayHours: number;\n    weeknightHours: number;\n    saturdayHours: number;\n    sundayHours: number;\n    publicHolidayHours: number;\n    totalAmount: number;\n    weekdayAmount: number;\n    weeknightAmount: number;\n    saturdayAmount: number;\n    sundayAmount: number;\n    publicHolidayAmount: number;\n  };\n}\n\ninterface EmployeeReportsManagementProps {\n  companyId: number;\n}\n\nexport function EmployeeReportsManagement({ companyId }: EmployeeReportsManagementProps) {\n  const { toast } = useToast();\n  const [selectedEmployeeId, setSelectedEmployeeId] = useState<string>(\"\");\n  const [startDate, setStartDate] = useState(\"\");\n  const [endDate, setEndDate] = useState(\"\");\n  const [reportData, setReportData] = useState<EmployeeReport | null>(null);\n  const [isGeneratingReport, setIsGeneratingReport] = useState(false);\n\n  // Fetch employees\n  const { data: employees = [], isLoading: employeesLoading } = useQuery<Employee[]>({\n    queryKey: ['/api/companies', companyId, 'employees'],\n    queryFn: async () => {\n      const response = await apiRequest('GET', `/api/companies/${companyId}/employees`);\n      return response.json();\n    },\n    enabled: !!companyId,\n  });\n\n  const handleGenerateReport = async () => {\n    if (!selectedEmployeeId || !startDate || !endDate) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please select an employee and date range\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setIsGeneratingReport(true);\n    try {\n      const response = await apiRequest('GET', \n        `/api/billing/employee-report?employeeId=${selectedEmployeeId}&startDate=${startDate}&endDate=${endDate}`\n      );\n      const data = await response.json();\n      \n      setReportData(data);\n      toast({\n        title: \"Report Generated\",\n        description: `Billing report created for ${data.employee.name}`,\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Failed to Generate Report\",\n        description: error.message || \"An error occurred\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsGeneratingReport(false);\n    }\n  };\n\n  const formatCurrency = (amountInCents: number): string => {\n    return new Intl.NumberFormat('en-AU', {\n      style: 'currency',\n      currency: 'AUD',\n    }).format(amountInCents / 100);\n  };\n\n  const formatDateRange = (start: string, end: string): string => {\n    const startFormatted = format(new Date(start), 'MMM dd, yyyy');\n    const endFormatted = format(new Date(end), 'MMM dd, yyyy');\n    return `${startFormatted} - ${endFormatted}`;\n  };\n\n  const getRateTypeBadgeColor = (rateType: string): string => {\n    switch (rateType) {\n      case 'weekday': return 'bg-blue-100 text-blue-800';\n      case 'weeknight': return 'bg-purple-100 text-purple-800';\n      case 'saturday': return 'bg-green-100 text-green-800';\n      case 'sunday': return 'bg-orange-100 text-orange-800';\n      case 'publicHoliday': return 'bg-red-100 text-red-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const formatRateType = (rateType: string): string => {\n    switch (rateType) {\n      case 'weekday': return 'Weekday';\n      case 'weeknight': return 'Weeknight';\n      case 'saturday': return 'Saturday';\n      case 'sunday': return 'Sunday';\n      case 'publicHoliday': return 'Public Holiday';\n      default: return rateType;\n    }\n  };\n\n  const exportToCSV = () => {\n    if (!reportData) return;\n\n    const headers = [\n      'Shift Date',\n      'Day Type', \n      'Shift Type',\n      'Hours Worked',\n      'Rate Calculations',\n      'Total Amount'\n    ];\n\n    const rows = reportData.shifts.map(shift => [\n      format(new Date(shift.date), 'yyyy-MM-dd'),\n      formatRateType(shift.day_type),\n      shift.shift_type,\n      shift.total_hours.toFixed(1),\n      shift.billing.map(tier => `${tier.hours.toFixed(1)}h  ${formatCurrency(tier.rate)}/h = ${formatCurrency(tier.subtotal)}`).join('; '),\n      formatCurrency(shift.total_amount)\n    ]);\n\n    // Add summary row\n    rows.push([]);\n    rows.push(['SUMMARY', '', '', '', '', '']);\n    rows.push(['Total Hours', '', '', reportData.summary.totalHours.toFixed(1), '', '']);\n    rows.push(['Total Amount', '', '', '', '', formatCurrency(reportData.summary.totalAmount)]);\n    \n    // Add rate type breakdown\n    rows.push([]);\n    rows.push(['RATE TYPE BREAKDOWN', '', '', '', '', '']);\n    if (reportData.summary.weekdayHours > 0) {\n      rows.push(['Weekday', '', '', reportData.summary.weekdayHours.toFixed(1), '', formatCurrency(reportData.summary.weekdayAmount)]);\n    }\n    if (reportData.summary.weeknightHours > 0) {\n      rows.push(['Weeknight', '', '', reportData.summary.weeknightHours.toFixed(1), '', formatCurrency(reportData.summary.weeknightAmount)]);\n    }\n    if (reportData.summary.saturdayHours > 0) {\n      rows.push(['Saturday', '', '', reportData.summary.saturdayHours.toFixed(1), '', formatCurrency(reportData.summary.saturdayAmount)]);\n    }\n    if (reportData.summary.sundayHours > 0) {\n      rows.push(['Sunday', '', '', reportData.summary.sundayHours.toFixed(1), '', formatCurrency(reportData.summary.sundayAmount)]);\n    }\n    if (reportData.summary.publicHolidayHours > 0) {\n      rows.push(['Public Holiday', '', '', reportData.summary.publicHolidayHours.toFixed(1), '', formatCurrency(reportData.summary.publicHolidayAmount)]);\n    }\n\n    const csvContent = [headers, ...rows]\n      .map(row => row.map(cell => `\"${cell}\"`).join(','))\n      .join('\\n');\n\n    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(blob);\n    link.download = `billing-report-${reportData.employee.name.replace(/\\s+/g, '-')}-${formatDateRange(reportData.period.startDate, reportData.period.endDate).replace(/\\s+/g, '-')}.csv`;\n    link.click();\n\n    toast({\n      title: \"CSV Export Complete\",\n      description: \"Report has been downloaded as CSV file\",\n    });\n  };\n\n  const exportToPDF = () => {\n    if (!reportData) return;\n\n    // Create a printable HTML version\n    const printWindow = window.open('', '_blank');\n    if (!printWindow) return;\n\n    const htmlContent = `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Invoice - ${reportData.employee.name}</title>\n        <style>\n          * { box-sizing: border-box; }\n          body { \n            font-family: 'Courier New', monospace; \n            margin: 0; \n            padding: 40px; \n            color: #000; \n            background: white;\n            font-size: 12px;\n            line-height: 1.4;\n          }\n          .invoice-container { \n            max-width: 800px; \n            margin: 0 auto; \n            background: white;\n            padding: 40px;\n            border: 2px solid #000;\n          }\n          .invoice-title { \n            text-align: center; \n            font-size: 28px; \n            font-weight: bold; \n            margin-bottom: 40px;\n            letter-spacing: 3px;\n          }\n          .billing-header { \n            display: grid; \n            grid-template-columns: 1fr 1fr; \n            gap: 40px; \n            margin-bottom: 40px; \n          }\n          .billing-to h3 { \n            font-weight: bold; \n            margin: 0 0 10px 0; \n            font-size: 14px;\n          }\n          .billing-to div { \n            margin-bottom: 5px; \n          }\n          .invoice-details { \n            text-align: right; \n          }\n          .invoice-details div { \n            margin-bottom: 5px; \n          }\n          .items-table { \n            width: 100%; \n            border-collapse: collapse; \n            margin: 40px 0; \n            border-top: 2px solid #000;\n            border-bottom: 2px solid #000;\n          }\n          .items-table th { \n            text-align: left; \n            padding: 15px 10px; \n            font-weight: bold; \n            border-bottom: 1px solid #000;\n          }\n          .items-table th:nth-child(2) { \n            text-align: right; \n            width: 120px; \n          }\n          .items-table th:nth-child(3) { \n            text-align: right; \n            width: 120px; \n          }\n          .items-table td { \n            padding: 20px 10px; \n            vertical-align: top; \n          }\n          .items-table td:nth-child(2) { \n            text-align: right; \n          }\n          .items-table td:nth-child(3) { \n            text-align: right; \n            font-weight: bold; \n          }\n          .item-description { \n            font-weight: bold; \n            margin-bottom: 8px; \n          }\n          .item-period { \n            color: #666; \n            font-size: 11px; \n          }\n          .totals-section { \n            margin: 40px 0; \n          }\n          .totals-row { \n            display: grid; \n            grid-template-columns: 1fr auto; \n            gap: 20px; \n            margin-bottom: 10px; \n            padding: 8px 0; \n          }\n          .totals-row:last-child { \n            border-top: 2px solid #000; \n            padding-top: 15px; \n            font-weight: bold; \n            font-size: 16px; \n          }\n          .payment-info { \n            margin-top: 50px; \n            padding-top: 30px; \n            border-top: 2px solid #000; \n          }\n          .payment-info h3 { \n            font-weight: bold; \n            margin: 0 0 20px 0; \n            font-size: 14px;\n          }\n          .payment-details { \n            display: grid; \n            grid-template-columns: 1fr 1fr; \n            gap: 40px; \n          }\n          .payment-left div, .payment-right div { \n            margin-bottom: 8px; \n          }\n          .payment-right { \n            text-align: right; \n          }\n          .employee-name { \n            font-weight: bold; \n          }\n          @media print {\n            body { padding: 20px; }\n            .no-print { display: none; }\n          }\n        </style>\n      </head>\n      <body>\n        <div class=\"invoice-container\">\n          <div class=\"invoice-title\">INVOICE</div>\n          \n          <div class=\"billing-header\">\n            <div class=\"billing-to\">\n              <h3>BILLED TO:</h3>\n              <div class=\"employee-name\">[OWNERS NAME]</div>\n              <div>[ADDRESS FROM OWNER]</div>\n            </div>\n            <div class=\"invoice-details\">\n              <div>Invoice No. ${reportData.employee.id.toString().padStart(3, '0')}</div>\n              <div>${format(new Date(), 'MMMM dd, yyyy').toUpperCase()}</div>\n            </div>\n          </div>\n          \n          <table class=\"items-table\">\n            <thead>\n              <tr>\n                <th>Item</th>\n                <th>Unit Price</th>\n                <th>Total</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr>\n                <td>\n                  <div class=\"item-description\">Support hours for ${reportData.employee.name} -</div>\n                  <div class=\"item-period\">${formatDateRange(reportData.period.startDate, reportData.period.endDate)}</div>\n                </td>\n                <td>\n                  ${reportData.summary.totalHours > 0 \n                    ? formatCurrency(Math.round(reportData.summary.totalAmount / reportData.summary.totalHours * 100))\n                    : formatCurrency(0)\n                  }/hr\n                </td>\n                <td>${formatCurrency(reportData.summary.totalAmount)}</td>\n              </tr>\n            </tbody>\n          </table>\n          \n          <div class=\"totals-section\">\n            <div class=\"totals-row\">\n              <div>Subtotal</div>\n              <div>${formatCurrency(reportData.summary.totalAmount)}</div>\n            </div>\n            <div class=\"totals-row\">\n              <div>GST (0%)</div>\n              <div>$0</div>\n            </div>\n            <div class=\"totals-row\">\n              <div>Total</div>\n              <div>${formatCurrency(reportData.summary.totalAmount)}</div>\n            </div>\n          </div>\n          \n          <div class=\"payment-info\">\n            <h3>PAYMENT INFORMATION</h3>\n            <div class=\"payment-details\">\n              <div class=\"payment-left\">\n                <div>Account Name: ${reportData.employee.name}</div>\n                <div>Account No: [EMPLOYEE NUMBER]</div>\n                <div>BSB: [EMPLOYEE BSB]</div>\n              </div>\n              <div class=\"payment-right\">\n                <div class=\"employee-name\">${reportData.employee.name}</div>\n                <div>[EMPLOYEE ADDRESS]</div>\n              </div>\n            </div>\n          </div>\n          \n          <div class=\"no-print\" style=\"margin-top: 40px; text-align: center;\">\n            <button onclick=\"window.print()\" style=\"padding: 10px 20px; margin-right: 10px; font-size: 14px;\">Print Invoice</button>\n            <button onclick=\"window.close()\" style=\"padding: 10px 20px; font-size: 14px;\">Close</button>\n          </div>\n        </div>\n      </body>\n      </html>\n    `;\n\n    printWindow.document.write(htmlContent);\n    printWindow.document.close();\n\n    // Auto-trigger print dialog\n    setTimeout(() => {\n      printWindow.print();\n      toast({\n        title: \"Professional Invoice Ready\",\n        description: \"Use your browser's print dialog to save as PDF\",\n      });\n    }, 500);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <FileText className=\"h-5 w-5\" />\n            Employee Billing Reports\n          </CardTitle>\n          <p className=\"text-sm text-muted-foreground\">\n            Generate detailed billing reports for individual employees across specific date ranges for invoicing purposes.\n          </p>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {/* Employee Selection */}\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"employee-select\">Employee</Label>\n              {employeesLoading ? (\n                <Skeleton className=\"h-10 w-full\" />\n              ) : (\n                <Select \n                  value={selectedEmployeeId} \n                  onValueChange={setSelectedEmployeeId}\n                  data-testid=\"employee-select\"\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select employee\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {employees.map((employee) => (\n                      <SelectItem key={employee.id} value={employee.id.toString()}>\n                        <div className=\"flex items-center gap-2\">\n                          <User className=\"h-4 w-4\" />\n                          {employee.name}\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              )}\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"start-date\">Start Date</Label>\n              <Input\n                id=\"start-date\"\n                type=\"date\"\n                value={startDate}\n                onChange={(e) => setStartDate(e.target.value)}\n                data-testid=\"input-start-date\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"end-date\">End Date</Label>\n              <Input\n                id=\"end-date\"\n                type=\"date\"\n                value={endDate}\n                onChange={(e) => setEndDate(e.target.value)}\n                data-testid=\"input-end-date\"\n              />\n            </div>\n          </div>\n\n          <Button \n            onClick={handleGenerateReport}\n            disabled={isGeneratingReport || !selectedEmployeeId || !startDate || !endDate}\n            className=\"w-full md:w-auto\"\n            data-testid=\"button-generate-report\"\n          >\n            {isGeneratingReport ? (\n              <>Generating Report...</>\n            ) : (\n              <>\n                <FileText className=\"h-4 w-4 mr-2\" />\n                Generate Report\n              </>\n            )}\n          </Button>\n        </CardContent>\n      </Card>\n\n      {/* Report Display */}\n      {reportData && (\n        <div className=\"space-y-6\">\n          {/* Report Header */}\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <User className=\"h-5 w-5\" />\n                    {reportData.employee.name}\n                  </CardTitle>\n                  <p className=\"text-sm text-muted-foreground\">{reportData.employee.email}</p>\n                </div>\n                <div className=\"text-right\">\n                  <p className=\"text-sm text-muted-foreground\">Period</p>\n                  <p className=\"font-medium\">{formatDateRange(reportData.period.startDate, reportData.period.endDate)}</p>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                <div className=\"text-center\">\n                  <div className=\"text-2xl font-bold text-blue-600\">{reportData.shifts.length}</div>\n                  <div className=\"text-sm text-muted-foreground\">Total Shifts</div>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"text-2xl font-bold text-green-600\">{reportData.summary.totalHours.toFixed(1)}</div>\n                  <div className=\"text-sm text-muted-foreground\">Total Hours</div>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"text-2xl font-bold text-purple-600\">{formatCurrency(reportData.summary.totalAmount)}</div>\n                  <div className=\"text-sm text-muted-foreground\">Total Amount</div>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"text-2xl font-bold text-orange-600\">\n                    {reportData.summary.totalHours > 0 ? formatCurrency(reportData.summary.totalAmount / reportData.summary.totalHours) : '$0.00'}\n                  </div>\n                  <div className=\"text-sm text-muted-foreground\">Avg Rate/Hour</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Rate Type Summary */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <TrendingUp className=\"h-5 w-5\" />\n                Rate Type Breakdown\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\n                {[\n                  { type: 'weekday', label: 'Weekday', hours: reportData.summary.weekdayHours, amount: reportData.summary.weekdayAmount },\n                  { type: 'weeknight', label: 'Weeknight', hours: reportData.summary.weeknightHours, amount: reportData.summary.weeknightAmount },\n                  { type: 'saturday', label: 'Saturday', hours: reportData.summary.saturdayHours, amount: reportData.summary.saturdayAmount },\n                  { type: 'sunday', label: 'Sunday', hours: reportData.summary.sundayHours, amount: reportData.summary.sundayAmount },\n                  { type: 'publicHoliday', label: 'Public Holiday', hours: reportData.summary.publicHolidayHours, amount: reportData.summary.publicHolidayAmount },\n                ].map(({ type, label, hours, amount }) => (\n                  hours > 0 && (\n                    <div key={type} className=\"text-center p-4 bg-gray-50 rounded-lg\">\n                      <Badge className={`mb-2 ${getRateTypeBadgeColor(type)}`}>\n                        {label}\n                      </Badge>\n                      <div className=\"text-lg font-semibold\">{hours.toFixed(1)}h</div>\n                      <div className=\"text-sm font-medium text-green-600\">{formatCurrency(amount)}</div>\n                    </div>\n                  )\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Preview Table */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <FileText className=\"h-5 w-5\" />\n                Invoice Preview\n              </CardTitle>\n              <p className=\"text-sm text-muted-foreground\">\n                Summary of daily hours, rates, and totals before generating the detailed invoice.\n              </p>\n            </CardHeader>\n            <CardContent>\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full border-collapse border border-gray-200 rounded-lg\">\n                  <thead>\n                    <tr className=\"bg-gray-50\">\n                      <th className=\"border border-gray-200 px-4 py-3 text-left font-semibold\">Date</th>\n                      <th className=\"border border-gray-200 px-4 py-3 text-center font-semibold\">Time</th>\n                      <th className=\"border border-gray-200 px-4 py-3 text-center font-semibold\">Hours</th>\n                      <th className=\"border border-gray-200 px-4 py-3 text-center font-semibold\">Rate Type</th>\n                      <th className=\"border border-gray-200 px-4 py-3 text-center font-semibold\">Rates</th>\n                      <th className=\"border border-gray-200 px-4 py-3 text-right font-semibold\">Daily Total</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {(() => {\n                      // Group shifts by date\n                      const dailySummary = reportData.shifts.reduce((acc, shift) => {\n                        const date = shift.date;\n                        if (!acc[date]) {\n                          acc[date] = {\n                            date,\n                            totalHours: 0,\n                            totalAmount: 0,\n                            rateTypes: new Set<string>(),\n                            rates: new Map<string, number>(),\n                            times: [],\n                            shifts: []\n                          };\n                        }\n                        acc[date].totalHours += shift.total_hours;\n                        acc[date].totalAmount += shift.total_amount;\n                        acc[date].rateTypes.add(shift.day_type);\n                        \n                        // Extract rate from billing data\n                        if (shift.billing && shift.billing.length > 0) {\n                          shift.billing.forEach(billing => {\n                            acc[date].rates.set(shift.day_type, billing.rate);\n                          });\n                        }\n                        \n                        // Add time range for this shift\n                        if ((shift as any).start_time && (shift as any).end_time) {\n                          acc[date].times.push(`${(shift as any).start_time} - ${(shift as any).end_time}`);\n                        }\n                        \n                        acc[date].shifts.push(shift);\n                        return acc;\n                      }, {} as Record<string, any>);\n\n                      return Object.values(dailySummary).map((day: any) => (\n                        <tr key={day.date} className=\"hover:bg-gray-50\">\n                          <td className=\"border border-gray-200 px-4 py-3\">\n                            <div className=\"font-medium\">\n                              {format(new Date(day.date), 'EEEE, MMM dd, yyyy')}\n                            </div>\n                          </td>\n                          <td className=\"border border-gray-200 px-4 py-3 text-center\">\n                            <div className=\"flex flex-col gap-1\">\n                              {day.times.map((timeRange: string, index: number) => (\n                                <div key={index} className=\"text-sm font-mono text-gray-700\">\n                                  {timeRange}\n                                </div>\n                              ))}\n                            </div>\n                          </td>\n                          <td className=\"border border-gray-200 px-4 py-3 text-center\">\n                            <span className=\"font-semibold text-blue-600\">\n                              {day.totalHours.toFixed(1)}h\n                            </span>\n                          </td>\n                          <td className=\"border border-gray-200 px-4 py-3 text-center\">\n                            <div className=\"flex flex-wrap gap-1 justify-center\">\n                              {Array.from(day.rateTypes as Set<string>).map((rateType: string) => (\n                                <Badge \n                                  key={rateType} \n                                  className={`${getRateTypeBadgeColor(rateType)} text-xs`}\n                                >\n                                  {formatRateType(rateType)}\n                                </Badge>\n                              ))}\n                            </div>\n                          </td>\n                          <td className=\"border border-gray-200 px-4 py-3 text-center\">\n                            <div className=\"flex flex-col gap-1\">\n                              {Array.from(day.rates as Map<string, number>).map(([rateType, rate]) => (\n                                <div key={rateType} className=\"text-sm\">\n                                  <span className=\"font-medium text-gray-700\">\n                                    {formatCurrency(rate)}/hr\n                                  </span>\n                                  <span className=\"text-xs text-gray-500 ml-1\">\n                                    ({formatRateType(rateType)})\n                                  </span>\n                                </div>\n                              ))}\n                            </div>\n                          </td>\n                          <td className=\"border border-gray-200 px-4 py-3 text-right\">\n                            <span className=\"font-bold text-green-600 text-lg\">\n                              {formatCurrency(day.totalAmount)}\n                            </span>\n                          </td>\n                        </tr>\n                      ));\n                    })()}\n                  </tbody>\n                  <tfoot>\n                    <tr className=\"bg-green-50 border-t-2 border-green-200\">\n                      <td className=\"border border-gray-200 px-4 py-3 font-bold\">TOTAL</td>\n                      <td className=\"border border-gray-200 px-4 py-3 text-center\">\n                        <span className=\"text-sm text-gray-600\">All Times</span>\n                      </td>\n                      <td className=\"border border-gray-200 px-4 py-3 text-center font-bold text-blue-600\">\n                        {reportData.summary.totalHours.toFixed(1)}h\n                      </td>\n                      <td className=\"border border-gray-200 px-4 py-3 text-center\">\n                        <span className=\"text-sm text-gray-600\">All Types</span>\n                      </td>\n                      <td className=\"border border-gray-200 px-4 py-3 text-center\">\n                        <span className=\"text-sm text-gray-600\">Various</span>\n                      </td>\n                      <td className=\"border border-gray-200 px-4 py-3 text-right font-bold text-green-600 text-xl\">\n                        {formatCurrency(reportData.summary.totalAmount)}\n                      </td>\n                    </tr>\n                  </tfoot>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Professional Invoice */}\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"flex items-center gap-2\">\n                  <FileText className=\"h-5 w-5\" />\n                  Professional Invoice\n                </CardTitle>\n                <div className=\"flex gap-2\">\n                  <Button \n                    variant=\"outline\" \n                    className=\"flex items-center gap-2\"\n                    onClick={exportToCSV}\n                    data-testid=\"button-export-csv\"\n                  >\n                    <FileSpreadsheet className=\"h-4 w-4\" />\n                    Export CSV\n                  </Button>\n                  <Button \n                    variant=\"outline\" \n                    className=\"flex items-center gap-2\"\n                    onClick={exportToPDF}\n                    data-testid=\"button-export-pdf\"\n                  >\n                    <FileDown className=\"h-4 w-4\" />\n                    Print Invoice\n                  </Button>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"bg-white p-8 border border-gray-200 rounded-lg font-mono text-sm space-y-6\">\n                {/* Invoice Header */}\n                <div className=\"text-center text-2xl font-bold mb-8\">\n                  INVOICE\n                </div>\n                \n                {/* Billing Information */}\n                <div className=\"grid grid-cols-2 gap-8 mb-8\">\n                  <div>\n                    <div className=\"font-bold mb-2\">BILLED TO:</div>\n                    <div className=\"space-y-1\">\n                      <div className=\"font-semibold\">[OWNERS NAME]</div>\n                      <div>[ADDRESS FROM OWNER]</div>\n                    </div>\n                  </div>\n                  <div className=\"text-right space-y-1\">\n                    <div>Invoice No. {reportData.employee.id.toString().padStart(3, '0')}</div>\n                    <div>{format(new Date(), 'MMMM dd, yyyy').toUpperCase()}</div>\n                  </div>\n                </div>\n                \n                {/* Invoice Items */}\n                <div className=\"border-t border-b border-gray-300 py-4\">\n                  <table className=\"w-full\">\n                    <thead>\n                      <tr className=\"border-b border-gray-200\">\n                        <th className=\"text-left py-2\">Item</th>\n                        <th className=\"text-right py-2 w-32\">Unit Price</th>\n                        <th className=\"text-right py-2 w-32\">Total</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      <tr>\n                        <td className=\"py-4 pr-4\">\n                          <div>Support hours for {reportData.employee.name} -</div>\n                          <div className=\"text-gray-600 mt-1\">\n                            {formatDateRange(reportData.period.startDate, reportData.period.endDate)}\n                          </div>\n                        </td>\n                        <td className=\"text-right py-4\">\n                          {reportData.summary.totalHours > 0 \n                            ? formatCurrency(Math.round(reportData.summary.totalAmount / reportData.summary.totalHours))\n                            : formatCurrency(0)\n                          }/hr\n                        </td>\n                        <td className=\"text-right py-4 font-semibold\">\n                          {formatCurrency(reportData.summary.totalAmount)}\n                        </td>\n                      </tr>\n                    </tbody>\n                  </table>\n                </div>\n                \n                {/* Totals Section */}\n                <div className=\"space-y-3\">\n                  <div className=\"flex justify-between\">\n                    <span>Subtotal</span>\n                    <span className=\"font-semibold\">{formatCurrency(reportData.summary.totalAmount)}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>GST (0%)</span>\n                    <span className=\"font-semibold\">$0</span>\n                  </div>\n                  <div className=\"border-t border-gray-300 pt-3\">\n                    <div className=\"flex justify-between text-lg font-bold\">\n                      <span>Total</span>\n                      <span>{formatCurrency(reportData.summary.totalAmount)}</span>\n                    </div>\n                  </div>\n                </div>\n                \n                {/* Payment Information */}\n                <div className=\"mt-8 pt-6 border-t border-gray-300\">\n                  <div className=\"font-bold mb-4\">PAYMENT INFORMATION</div>\n                  <div className=\"grid grid-cols-2 gap-8\">\n                    <div className=\"space-y-1\">\n                      <div>Account Name: {reportData.employee.name}</div>\n                      <div>Account No: [EMPLOYEE NUMBER]</div>\n                      <div>BSB: [EMPLOYEE BSB]</div>\n                    </div>\n                    <div className=\"text-right space-y-1\">\n                      <div className=\"font-semibold\">{reportData.employee.name}</div>\n                      <div>[EMPLOYEE ADDRESS]</div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":34783},"client/src/lib/time-utils.ts":{"content":"export function generateTimeOptions(): { value: string; label: string }[] {\n  const options: { value: string; label: string }[] = [];\n  \n  for (let hour = 0; hour < 24; hour++) {\n    for (let minute = 0; minute < 60; minute += 15) {\n      const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;\n      const date = new Date(`2000-01-01T${timeString}`);\n      const label = date.toLocaleTimeString('en-US', { \n        hour: 'numeric', \n        minute: '2-digit',\n        hour12: true \n      });\n      options.push({ value: timeString, label });\n    }\n  }\n  \n  return options;\n}\n\nexport function formatTime(timeString: string): string {\n  const date = new Date(`2000-01-01T${timeString}`);\n  return date.toLocaleTimeString('en-US', { \n    hour: 'numeric', \n    minute: '2-digit',\n    hour12: true \n  });\n}\n\nexport function calculateDuration(startTime: string, endTime: string): number {\n  const start = new Date(`2000-01-01T${startTime}`);\n  const end = new Date(`2000-01-01T${endTime}`);\n  \n  // Handle overnight shifts\n  if (end < start) {\n    end.setDate(end.getDate() + 1);\n  }\n  \n  return (end.getTime() - start.getTime()) / (1000 * 60 * 60);\n}\n\nexport function getWeekDates(date: Date): { start: string; end: string } {\n  const start = new Date(date);\n  const day = start.getDay();\n  // Convert Sunday (0) to 7 for easier Monday-based calculation\n  const mondayBasedDay = day === 0 ? 7 : day;\n  const diff = start.getDate() - (mondayBasedDay - 1);\n  \n  start.setDate(diff);\n  const end = new Date(start);\n  end.setDate(start.getDate() + 6);\n  \n  return {\n    start: start.toISOString().split('T')[0],\n    end: end.toISOString().split('T')[0]\n  };\n}\n\nexport function getLast7Days(date: Date): { start: string; end: string } {\n  const end = new Date(date);\n  const start = new Date(date);\n  start.setDate(end.getDate() - 6); // Go back 6 days to include today as the 7th day\n  \n  return {\n    start: start.toISOString().split('T')[0],\n    end: end.toISOString().split('T')[0]\n  };\n}\n\nexport function formatDateRange(startDate: string, endDate: string): string {\n  const start = new Date(startDate);\n  const end = new Date(endDate);\n  \n  const options: Intl.DateTimeFormatOptions = { \n    month: 'short', \n    day: 'numeric' \n  };\n  \n  if (start.getFullYear() !== end.getFullYear()) {\n    options.year = 'numeric';\n  }\n  \n  return `${start.toLocaleDateString('en-US', options)} - ${end.toLocaleDateString('en-US', options)}, ${end.getFullYear()}`;\n}\n\nexport function formatDuration(minutes: number): string {\n  const hours = Math.floor(minutes / 60);\n  const mins = minutes % 60;\n  \n  if (hours === 0) {\n    return `${mins}m`;\n  } else if (mins === 0) {\n    return `${hours}h`;\n  } else {\n    return `${hours}h ${mins}m`;\n  }\n}\n\nexport function getDateRange() {\n  const endDate = new Date();\n  const startDate = new Date();\n  startDate.setDate(endDate.getDate() - 6); // Last 7 days (including today)\n  \n  return {\n    startDate: startDate.toISOString().split('T')[0],\n    endDate: endDate.toISOString().split('T')[0]\n  };\n}\n","size_bytes":3065},"client/src/hooks/use-business.ts":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\n// Company hooks\nexport function useCompanyEmployees(companyId: number) {\n  return useQuery({\n    queryKey: [\"/api/companies\", companyId, \"employees\"],\n    queryFn: async () => {\n      console.log('useCompanyEmployees queryFn called for company:', companyId);\n      const response = await apiRequest('GET', `/api/companies/${companyId}/employees`);\n      const data = await response.json();\n      console.log('useCompanyEmployees data received:', data.length, 'employees');\n      return data;\n    },\n    enabled: !!companyId,\n  });\n}\n\nexport function useCompanyShifts(companyId: number, startDate?: string, endDate?: string) {\n  const params = new URLSearchParams();\n  if (startDate) params.set('startDate', startDate);\n  if (endDate) params.set('endDate', endDate);\n  const queryString = params.toString();\n  \n  return useQuery({\n    queryKey: [\"/api/companies\", companyId, \"shifts\", { startDate, endDate }],\n    queryFn: async () => {\n      console.log('useCompanyShifts queryFn called for company:', companyId, startDate ? `${startDate} to ${endDate}` : 'all shifts');\n      const response = await apiRequest('GET', `/api/companies/${companyId}/shifts${queryString ? `?${queryString}` : ''}`);\n      const data = await response.json();\n      console.log('useCompanyShifts data received:', data.length, 'shifts');\n      return data;\n    },\n    enabled: !!companyId,\n  });\n}\n\nexport function usePendingShifts(companyId: number) {\n  return useQuery({\n    queryKey: [\"/api/companies\", companyId, \"pending-shifts\"],\n    queryFn: async () => {\n      console.log('usePendingShifts queryFn called for company:', companyId);\n      const response = await apiRequest('GET', `/api/companies/${companyId}/pending-shifts`);\n      const data = await response.json();\n      console.log('usePendingShifts data received:', data.length, 'pending shifts');\n      return data;\n    },\n    enabled: !!companyId,\n  });\n}\n\nexport function useCompanyWeeklyHours(companyId: number, startDate: string, endDate: string) {\n  return useQuery({\n    queryKey: [\"/api/companies\", companyId, \"analytics\", \"weekly-hours\", { startDate, endDate }],\n    queryFn: async () => {\n      console.log('useCompanyWeeklyHours queryFn called for company:', companyId, `${startDate} to ${endDate}`);\n      const params = new URLSearchParams({ startDate, endDate });\n      const response = await apiRequest('GET', `/api/companies/${companyId}/analytics/weekly-hours?${params}`);\n      const data = await response.json();\n      console.log('useCompanyWeeklyHours data received:', data);\n      return data;\n    },\n    enabled: !!companyId && !!startDate && !!endDate,\n  });\n}\n\n// Company mutations\nexport function useCreateCompany() {\n  return useMutation({\n    mutationFn: async (companyData: any) => {\n      const response = await apiRequest(\"POST\", \"/api/companies\", companyData);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\"] });\n    },\n  });\n}\n\nexport function useApproveShift() {\n  return useMutation({\n    mutationFn: async ({ shiftId, approvedBy }: { shiftId: number; approvedBy: number }) => {\n      const response = await fetch(`/api/shifts/${shiftId}/approve`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ approvedBy }),\n      });\n      if (!response.ok) throw new Error(\"Failed to approve shift\");\n      return response.json();\n    },\n    onSuccess: () => {\n      // Invalidate relevant queries\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/shifts\"] });\n    },\n  });\n}\n\n// Roster Management Hooks\nexport function useRosterShifts(startDate?: string, endDate?: string) {\n  const params = new URLSearchParams();\n  if (startDate) params.set('startDate', startDate);\n  if (endDate) params.set('endDate', endDate);\n  const queryString = params.toString();\n  \n  return useQuery({\n    queryKey: [\"/api/roster\", { startDate, endDate }],\n    queryFn: async () => {\n      console.log('useRosterShifts queryFn called for date range:', startDate ? `${startDate} to ${endDate}` : 'all shifts');\n      const response = await apiRequest('GET', `/api/roster${queryString ? `?${queryString}` : ''}`);\n      const data = await response.json();\n      console.log('useRosterShifts data received:', data.length, 'shifts');\n      return data;\n    },\n  });\n}\n\nexport function useCreateRosterShift() {\n  return useMutation({\n    mutationFn: async (shiftData: any) => {\n      console.log('Creating roster shift:', shiftData);\n      const response = await apiRequest(\"POST\", \"/api/roster/shifts\", shiftData);\n      return response.json();\n    },\n    onSuccess: () => {\n      // Invalidate roster queries\n      queryClient.invalidateQueries({ queryKey: [\"/api/roster\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\"] });\n    },\n  });\n}\n\nexport function useUpdateRosterShift() {\n  return useMutation({\n    mutationFn: async ({ shiftId, shiftData }: { shiftId: number; shiftData: any }) => {\n      console.log('Updating roster shift:', shiftId, shiftData);\n      const response = await apiRequest(\"PUT\", `/api/roster/shifts/${shiftId}`, shiftData);\n      return response.json();\n    },\n    onSuccess: () => {\n      // Invalidate roster queries\n      queryClient.invalidateQueries({ queryKey: [\"/api/roster\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\"] });\n    },\n  });\n}\n\nexport function useDeleteRosterShift() {\n  return useMutation({\n    mutationFn: async (shiftId: number) => {\n      console.log('Deleting roster shift:', shiftId);\n      const response = await apiRequest(\"DELETE\", `/api/roster/shifts/${shiftId}`);\n      return response.json();\n    },\n    onSuccess: () => {\n      // Invalidate roster queries\n      queryClient.invalidateQueries({ queryKey: [\"/api/roster\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\"] });\n    },\n  });\n}","size_bytes":6105},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/BillingManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { \n  DollarSign, \n  Plus, \n  Edit2, \n  Trash2, \n  Calendar,\n  Calculator,\n  Clock,\n  TrendingUp,\n  Building2\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\n\ninterface RateTier {\n  id: number;\n  companyId: number;\n  shiftType: string;\n  tierOrder: number;\n  hoursInTier: number;\n  ratePerHour: number;\n  dayType: string;\n  currency: string;\n  validFrom: string;\n  validTo: string;\n}\n\ninterface PublicHoliday {\n  id: number;\n  date: string;\n  description: string;\n}\n\ninterface BillingManagementProps {\n  companyId: number;\n}\n\nexport function BillingManagement({ companyId }: BillingManagementProps) {\n  const { toast } = useToast();\n  const [showRateTierDialog, setShowRateTierDialog] = useState(false);\n  const [showHolidayDialog, setShowHolidayDialog] = useState(false);\n  const [editingRateTier, setEditingRateTier] = useState<RateTier | null>(null);\n  \n  // Calculator state\n  const [calculatorShiftType, setCalculatorShiftType] = useState(\"morning\");\n  const [calculatorDate, setCalculatorDate] = useState(\"\");\n  const [calculatorHours, setCalculatorHours] = useState(8);\n  const [calculatorResult, setCalculatorResult] = useState<any>(null);\n\n  // Fetch rate tiers\n  const { data: rateTiers = [], isLoading: rateLoading, refetch: refetchRates } = useQuery<RateTier[]>({\n    queryKey: ['/api/rate-tiers'],\n  });\n\n  // Fetch holidays\n  const { data: holidays = [], isLoading: holidaysLoading, refetch: refetchHolidays } = useQuery<PublicHoliday[]>({\n    queryKey: ['/api/public-holidays'],\n  });\n\n  // Mutations\n  const createRateTierMutation = useMutation({\n    mutationFn: (data: Partial<RateTier>) => apiRequest('POST', '/api/rate-tiers', data),\n    onSuccess: () => {\n      toast({ title: \"Rate tier created successfully\" });\n      setShowRateTierDialog(false);\n      setEditingRateTier(null);\n      refetchRates();\n    },\n    onError: () => {\n      toast({ title: \"Failed to create rate tier\", variant: \"destructive\" });\n    },\n  });\n\n  const createHolidayMutation = useMutation({\n    mutationFn: (data: Partial<PublicHoliday>) => apiRequest('POST', '/api/public-holidays', data),\n    onSuccess: () => {\n      toast({ title: \"Holiday added successfully\" });\n      setShowHolidayDialog(false);\n      refetchHolidays();\n    },\n    onError: () => {\n      toast({ title: \"Failed to add holiday\", variant: \"destructive\" });\n    },\n  });\n\n  // Group rate tiers by shift type and day type\n  const groupedRates = rateTiers.reduce((acc, tier) => {\n    const key = `${tier.shiftType}-${tier.dayType}`;\n    if (!acc[key]) {\n      acc[key] = [];\n    }\n    acc[key].push(tier);\n    return acc;\n  }, {} as Record<string, RateTier[]>);\n\n  // Calculate preview using backend billing engine\n  const calculatePreview = async () => {\n    if (!calculatorDate || !calculatorHours) {\n      toast({ title: \"Please fill in all calculator fields\", variant: \"destructive\" });\n      return;\n    }\n\n    try {\n      // Calculate start and end times based on hours\n      const startHour = 9; // Default start at 9 AM\n      const endHour = startHour + calculatorHours;\n      const endTime = endHour >= 24 \n        ? `${(endHour - 24).toString().padStart(2, '0')}:00`\n        : `${endHour.toString().padStart(2, '0')}:00`;\n      \n      const previewData = {\n        shiftType: calculatorShiftType,\n        date: calculatorDate,\n        startTime: \"09:00\",\n        endTime: endTime,\n        hoursWorked: calculatorHours\n      };\n\n      const response = await apiRequest('POST', '/api/billing/preview', previewData);\n\n      if (response.ok) {\n        const result = await response.json();\n        setCalculatorResult(result);\n      } else {\n        const errorData = await response.json();\n        toast({ \n          title: \"Failed to calculate preview\", \n          description: errorData.message || \"Unknown error\",\n          variant: \"destructive\" \n        });\n      }\n    } catch (error) {\n      console.error('Preview calculation error:', error);\n      toast({ title: \"Failed to calculate preview\", variant: \"destructive\" });\n    }\n  };\n\n  const getDayType = (dateString: string): string => {\n    const date = new Date(dateString);\n    const dayOfWeek = date.getDay();\n    \n    // Check if it's a holiday\n    if (holidays.some(h => h.date === dateString)) {\n      return 'holiday';\n    }\n    \n    if (dayOfWeek === 0) return 'sunday';\n    if (dayOfWeek === 6) return 'saturday';\n    return 'weekday';\n  };\n\n  const formatCurrency = (amount: number, currency: string = 'USD') => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: currency,\n    }).format(amount);\n  };\n\n  const getShiftTypeLabel = (shiftType: string) => {\n    const labels: Record<string, string> = {\n      morning: 'Morning',\n      afternoon: 'Afternoon', \n      evening: 'Evening',\n      night: 'Night',\n      double: 'Double',\n      custom: 'Custom'\n    };\n    return labels[shiftType] || shiftType;\n  };\n\n  const getDayTypeLabel = (dayType: string) => {\n    const labels: Record<string, string> = {\n      weekday: 'Weekday',\n      saturday: 'Saturday',\n      sunday: 'Sunday',\n      holiday: 'Holiday'\n    };\n    return labels[dayType] || dayType;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-slate-900\">Billing Management</h2>\n          <p className=\"text-slate-600\">Configure rate tiers, holidays, and payment structures</p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Building2 className=\"h-5 w-5 text-slate-500\" />\n          <span className=\"text-sm text-slate-600\">Company ID: {companyId}</span>\n        </div>\n      </div>\n\n      <Tabs defaultValue=\"rates\" className=\"space-y-6\">\n        <TabsList className=\"grid w-full grid-cols-4\">\n          <TabsTrigger value=\"rates\">Rate Tiers</TabsTrigger>\n          <TabsTrigger value=\"holidays\">Holidays</TabsTrigger>\n          <TabsTrigger value=\"calculator\">Calculator</TabsTrigger>\n          <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n        </TabsList>\n\n        {/* Rate Tiers Tab */}\n        <TabsContent value=\"rates\" className=\"space-y-6\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-lg font-semibold\">Rate Tier Configuration</h3>\n            <Dialog open={showRateTierDialog} onOpenChange={setShowRateTierDialog}>\n              <DialogTrigger asChild>\n                <Button data-testid=\"add-rate-tier\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Rate Tier\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"sm:max-w-[500px]\">\n                <DialogHeader>\n                  <DialogTitle>\n                    {editingRateTier ? 'Edit Rate Tier' : 'Add New Rate Tier'}\n                  </DialogTitle>\n                </DialogHeader>\n                <RateTierForm \n                  initialData={editingRateTier}\n                  onSubmit={(data) => createRateTierMutation.mutate(data)}\n                  isLoading={createRateTierMutation.isPending}\n                />\n              </DialogContent>\n            </Dialog>\n          </div>\n\n          {rateLoading ? (\n            <div className=\"space-y-4\">\n              {[1, 2, 3].map(i => (\n                <Skeleton key={i} className=\"h-24 w-full\" />\n              ))}\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {Object.entries(groupedRates).map(([key, tiers]) => {\n                const [shiftType, dayType] = key.split('-');\n                return (\n                  <Card key={key} data-testid={`rate-group-${key}`}>\n                    <CardHeader>\n                      <CardTitle className=\"flex items-center gap-2\">\n                        <DollarSign className=\"h-5 w-5\" />\n                        {getShiftTypeLabel(shiftType)} - {getDayTypeLabel(dayType)}\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-2\">\n                        {tiers.sort((a, b) => a.tierOrder - b.tierOrder).map((tier) => (\n                          <div \n                            key={tier.id} \n                            className=\"flex items-center justify-between p-3 border rounded-lg\"\n                            data-testid={`rate-tier-${tier.id}`}\n                          >\n                            <div className=\"flex items-center gap-4\">\n                              <div className=\"text-sm font-medium\">Tier {tier.tierOrder}</div>\n                              <div className=\"text-sm text-slate-600\">\n                                {tier.hoursInTier} hours at {formatCurrency(tier.ratePerHour)}/hour\n                              </div>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => {\n                                  setEditingRateTier(tier);\n                                  setShowRateTierDialog(true);\n                                }}\n                                data-testid={`edit-tier-${tier.id}`}\n                              >\n                                <Edit2 className=\"h-4 w-4\" />\n                              </Button>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n              \n              {rateTiers.length === 0 && (\n                <Card>\n                  <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                    <DollarSign className=\"h-12 w-12 text-slate-400 mb-4\" />\n                    <h3 className=\"text-lg font-semibold text-slate-600 mb-2\">No Rate Tiers Configured</h3>\n                    <p className=\"text-slate-500 text-center mb-4\">\n                      Set up tiered payment rates for different shift types and day types\n                    </p>\n                    <Button \n                      onClick={() => setShowRateTierDialog(true)}\n                      data-testid=\"create-first-rate-tier\"\n                    >\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      Create Your First Rate Tier\n                    </Button>\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n          )}\n        </TabsContent>\n\n        {/* Holidays Tab */}\n        <TabsContent value=\"holidays\" className=\"space-y-6\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-lg font-semibold\">Public Holidays</h3>\n            <Dialog open={showHolidayDialog} onOpenChange={setShowHolidayDialog}>\n              <DialogTrigger asChild>\n                <Button data-testid=\"add-holiday\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Holiday\n                </Button>\n              </DialogTrigger>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Add Public Holiday</DialogTitle>\n                </DialogHeader>\n                <HolidayForm \n                  onSubmit={(data) => createHolidayMutation.mutate(data)}\n                  isLoading={createHolidayMutation.isPending}\n                />\n              </DialogContent>\n            </Dialog>\n          </div>\n\n          {holidaysLoading ? (\n            <div className=\"space-y-4\">\n              {[1, 2].map(i => (\n                <Skeleton key={i} className=\"h-16 w-full\" />\n              ))}\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {holidays.map((holiday) => (\n                <Card key={holiday.id} data-testid={`holiday-${holiday.id}`}>\n                  <CardContent className=\"flex items-center justify-between p-4\">\n                    <div className=\"flex items-center gap-3\">\n                      <Calendar className=\"h-5 w-5 text-blue-600\" />\n                      <div>\n                        <div className=\"font-medium\">{holiday.description}</div>\n                        <div className=\"text-sm text-slate-600\">\n                          {new Date(holiday.date).toLocaleDateString('en-US', {\n                            weekday: 'long',\n                            year: 'numeric',\n                            month: 'long',\n                            day: 'numeric'\n                          })}\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n              \n              {holidays.length === 0 && (\n                <Card>\n                  <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                    <Calendar className=\"h-12 w-12 text-slate-400 mb-4\" />\n                    <h3 className=\"text-lg font-semibold text-slate-600 mb-2\">No Holidays Configured</h3>\n                    <p className=\"text-slate-500 text-center mb-4\">\n                      Add public holidays to apply special holiday rates\n                    </p>\n                    <Button \n                      onClick={() => setShowHolidayDialog(true)}\n                      data-testid=\"create-first-holiday\"\n                    >\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      Add Your First Holiday\n                    </Button>\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n          )}\n        </TabsContent>\n\n        {/* Calculator Tab */}\n        <TabsContent value=\"calculator\" className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Calculator className=\"h-5 w-5\" />\n                Pay Calculator\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div>\n                  <Label htmlFor=\"calc-shift-type\">Shift Type</Label>\n                  <Select value={calculatorShiftType} onValueChange={setCalculatorShiftType}>\n                    <SelectTrigger data-testid=\"calc-shift-type\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"morning\">Morning</SelectItem>\n                      <SelectItem value=\"afternoon\">Afternoon</SelectItem>\n                      <SelectItem value=\"evening\">Evening</SelectItem>\n                      <SelectItem value=\"night\">Night</SelectItem>\n                      <SelectItem value=\"double\">Double</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                \n                <div>\n                  <Label htmlFor=\"calc-date\">Date</Label>\n                  <Input\n                    id=\"calc-date\"\n                    type=\"date\"\n                    value={calculatorDate}\n                    onChange={(e) => setCalculatorDate(e.target.value)}\n                    data-testid=\"calc-date\"\n                  />\n                </div>\n                \n                <div>\n                  <Label htmlFor=\"calc-hours\">Hours Worked</Label>\n                  <Input\n                    id=\"calc-hours\"\n                    type=\"number\"\n                    step=\"0.25\"\n                    min=\"0\"\n                    max=\"24\"\n                    value={calculatorHours}\n                    onChange={(e) => setCalculatorHours(parseFloat(e.target.value))}\n                    data-testid=\"calc-hours\"\n                  />\n                </div>\n              </div>\n              \n              <Button \n                onClick={calculatePreview} \n                className=\"w-full\"\n                data-testid=\"calculate-pay\"\n              >\n                <Calculator className=\"h-4 w-4 mr-2\" />\n                Calculate Pay\n              </Button>\n\n              {calculatorResult && (\n                <Card className=\"mt-4\">\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center justify-between mb-4\">\n                      <h4 className=\"font-semibold\">Calculation Result</h4>\n                      <div className=\"text-2xl font-bold text-green-600\">\n                        {formatCurrency(calculatorResult.totalAmount, calculatorResult.currency)}\n                      </div>\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <div className=\"text-sm text-slate-600\">\n                        <strong>Shift Details:</strong> {calculatorHours} hours on {getDayTypeLabel(calculatorResult.dayType)}\n                      </div>\n                      \n                      {calculatorResult.tiers?.map((tier: any, index: number) => (\n                        <div key={index} className=\"text-sm bg-slate-50 p-2 rounded\">\n                          Tier {tier.tierOrder}: {tier.hoursWorked} hours  {formatCurrency(tier.ratePerHour)} = {formatCurrency(tier.amount)}\n                        </div>\n                      ))}\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Overview Tab */}\n        <TabsContent value=\"overview\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center\">\n                  <DollarSign className=\"h-8 w-8 text-green-600 mr-3\" />\n                  <div>\n                    <div className=\"text-2xl font-bold\">{rateTiers.length}</div>\n                    <p className=\"text-xs text-slate-600\">Rate Tiers</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center\">\n                  <Calendar className=\"h-8 w-8 text-blue-600 mr-3\" />\n                  <div>\n                    <div className=\"text-2xl font-bold\">{holidays.length}</div>\n                    <p className=\"text-xs text-slate-600\">Holidays</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center\">\n                  <Clock className=\"h-8 w-8 text-purple-600 mr-3\" />\n                  <div>\n                    <div className=\"text-2xl font-bold\">\n                      {Object.keys(groupedRates).length}\n                    </div>\n                    <p className=\"text-xs text-slate-600\">Rate Groups</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center\">\n                  <TrendingUp className=\"h-8 w-8 text-orange-600 mr-3\" />\n                  <div>\n                    <div className=\"text-2xl font-bold\">\n                      {rateTiers.length > 0 ? formatCurrency(Math.max(...rateTiers.map(r => r.ratePerHour))) : formatCurrency(0)}\n                    </div>\n                    <p className=\"text-xs text-slate-600\">Highest Rate</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Rate Configuration Summary</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {Object.entries(groupedRates).map(([key, tiers]) => {\n                  const [shiftType, dayType] = key.split('-');\n                  const totalTiers = tiers.length;\n                  const rateRange = tiers.length > 0 ? {\n                    min: Math.min(...tiers.map(t => t.ratePerHour)),\n                    max: Math.max(...tiers.map(t => t.ratePerHour))\n                  } : { min: 0, max: 0 };\n                  \n                  return (\n                    <div key={key} className=\"flex items-center justify-between p-3 border rounded-lg\">\n                      <div>\n                        <div className=\"font-medium\">\n                          {getShiftTypeLabel(shiftType)} - {getDayTypeLabel(dayType)}\n                        </div>\n                        <div className=\"text-sm text-slate-600\">\n                          {totalTiers} tier{totalTiers !== 1 ? 's' : ''} configured\n                        </div>\n                      </div>\n                      <div className=\"text-right\">\n                        <div className=\"font-medium\">\n                          {formatCurrency(rateRange.min)} - {formatCurrency(rateRange.max)}\n                        </div>\n                        <div className=\"text-sm text-slate-600\">Rate range</div>\n                      </div>\n                    </div>\n                  );\n                })}\n                \n                {Object.keys(groupedRates).length === 0 && (\n                  <div className=\"text-center py-8 text-slate-500\">\n                    No rate configurations found. Add rate tiers to get started.\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n\n// Rate Tier Form Component\nfunction RateTierForm({ \n  initialData, \n  onSubmit, \n  isLoading \n}: { \n  initialData?: RateTier | null;\n  onSubmit: (data: any) => void;\n  isLoading: boolean;\n}) {\n  const [formData, setFormData] = useState({\n    shiftType: initialData?.shiftType || 'morning',\n    tierOrder: initialData?.tierOrder || 1,\n    hoursInTier: initialData?.hoursInTier || 4,\n    ratePerHour: initialData?.ratePerHour || 25,\n    dayType: initialData?.dayType || 'weekday',\n    currency: initialData?.currency || 'USD',\n    validFrom: initialData?.validFrom || '2024-01-01',\n    validTo: initialData?.validTo || '2025-12-31'\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onSubmit(formData);\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div>\n          <Label htmlFor=\"shift-type\">Shift Type</Label>\n          <Select value={formData.shiftType} onValueChange={(value) => setFormData({...formData, shiftType: value})}>\n            <SelectTrigger data-testid=\"rate-shift-type\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"morning\">Morning</SelectItem>\n              <SelectItem value=\"afternoon\">Afternoon</SelectItem>\n              <SelectItem value=\"evening\">Evening</SelectItem>\n              <SelectItem value=\"night\">Night</SelectItem>\n              <SelectItem value=\"double\">Double</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n        \n        <div>\n          <Label htmlFor=\"day-type\">Day Type</Label>\n          <Select value={formData.dayType} onValueChange={(value) => setFormData({...formData, dayType: value})}>\n            <SelectTrigger data-testid=\"rate-day-type\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"weekday\">Weekday</SelectItem>\n              <SelectItem value=\"saturday\">Saturday</SelectItem>\n              <SelectItem value=\"sunday\">Sunday</SelectItem>\n              <SelectItem value=\"holiday\">Holiday</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div>\n          <Label htmlFor=\"tier-order\">Tier Order</Label>\n          <Input\n            id=\"tier-order\"\n            type=\"number\"\n            min=\"1\"\n            value={formData.tierOrder}\n            onChange={(e) => setFormData({...formData, tierOrder: parseInt(e.target.value)})}\n            data-testid=\"rate-tier-order\"\n          />\n        </div>\n        \n        <div>\n          <Label htmlFor=\"hours-in-tier\">Hours in Tier</Label>\n          <Input\n            id=\"hours-in-tier\"\n            type=\"number\"\n            step=\"0.25\"\n            min=\"0.25\"\n            value={formData.hoursInTier}\n            onChange={(e) => setFormData({...formData, hoursInTier: parseFloat(e.target.value)})}\n            data-testid=\"rate-hours-in-tier\"\n          />\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div>\n          <Label htmlFor=\"rate-per-hour\">Rate per Hour</Label>\n          <Input\n            id=\"rate-per-hour\"\n            type=\"number\"\n            step=\"0.01\"\n            min=\"0\"\n            value={formData.ratePerHour}\n            onChange={(e) => setFormData({...formData, ratePerHour: parseFloat(e.target.value)})}\n            data-testid=\"rate-per-hour\"\n          />\n        </div>\n        \n        <div>\n          <Label htmlFor=\"currency\">Currency</Label>\n          <Select value={formData.currency} onValueChange={(value) => setFormData({...formData, currency: value})}>\n            <SelectTrigger data-testid=\"rate-currency\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"USD\">USD</SelectItem>\n              <SelectItem value=\"EUR\">EUR</SelectItem>\n              <SelectItem value=\"GBP\">GBP</SelectItem>\n              <SelectItem value=\"CAD\">CAD</SelectItem>\n              <SelectItem value=\"AUD\">AUD</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div>\n          <Label htmlFor=\"valid-from\">Valid From</Label>\n          <Input\n            id=\"valid-from\"\n            type=\"date\"\n            value={formData.validFrom}\n            onChange={(e) => setFormData({...formData, validFrom: e.target.value})}\n            data-testid=\"rate-valid-from\"\n          />\n        </div>\n        \n        <div>\n          <Label htmlFor=\"valid-to\">Valid To</Label>\n          <Input\n            id=\"valid-to\"\n            type=\"date\"\n            value={formData.validTo}\n            onChange={(e) => setFormData({...formData, validTo: e.target.value})}\n            data-testid=\"rate-valid-to\"\n          />\n        </div>\n      </div>\n\n      <DialogFooter>\n        <Button type=\"submit\" disabled={isLoading} data-testid=\"save-rate-tier\">\n          {isLoading ? \"Saving...\" : \"Save Rate Tier\"}\n        </Button>\n      </DialogFooter>\n    </form>\n  );\n}\n\n// Holiday Form Component\nfunction HolidayForm({ \n  onSubmit, \n  isLoading \n}: { \n  onSubmit: (data: any) => void;\n  isLoading: boolean;\n}) {\n  const [formData, setFormData] = useState({\n    date: '',\n    description: ''\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onSubmit(formData);\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\n      <div>\n        <Label htmlFor=\"holiday-date\">Date</Label>\n        <Input\n          id=\"holiday-date\"\n          type=\"date\"\n          value={formData.date}\n          onChange={(e) => setFormData({...formData, date: e.target.value})}\n          required\n          data-testid=\"holiday-date\"\n        />\n      </div>\n      \n      <div>\n        <Label htmlFor=\"holiday-description\">Description</Label>\n        <Input\n          id=\"holiday-description\"\n          value={formData.description}\n          onChange={(e) => setFormData({...formData, description: e.target.value})}\n          placeholder=\"e.g., New Year's Day\"\n          required\n          data-testid=\"holiday-description\"\n        />\n      </div>\n\n      <DialogFooter>\n        <Button type=\"submit\" disabled={isLoading} data-testid=\"save-holiday\">\n          {isLoading ? \"Saving...\" : \"Add Holiday\"}\n        </Button>\n      </DialogFooter>\n    </form>\n  );\n}","size_bytes":29066},"design_guidelines.md":{"content":"# ShiftMate Login Page - Design Guidelines\n\n## Design Approach\n**Reference-Based**: Google Calendar-inspired with Material Design principles - clean, efficient, and professional. Focus on clarity and trust-building for authentication.\n\n## Layout Architecture\n\n**Split-Screen Design** (Desktop):\n- Left panel (40% width): Brand identity zone with subtle blue gradient background\n- Right panel (60% width): White authentication area with centered login container (max-width: 480px)\n- Mobile: Stack vertically, brand section collapses to compact header\n\n**Vertical Structure**:\n- Brand logo + tagline (top of right panel or left panel)\n- Primary heading: \"Welcome to ShiftMate\"\n- Subheading: \"Manage your team's shifts with ease\"\n- Google OAuth button (prominent)\n- Visual divider with \"OR\" text\n- Email/name login form\n- Footer links (Help, Privacy, Terms)\n\n## Typography System\n\n**Font Stack**: Inter (Google Fonts) for clean, professional readability\n- Page Heading: 32px/40px, Semi-bold (font-semibold)\n- Subheading: 16px/24px, Regular, 60% opacity\n- Button Text: 15px/20px, Medium (font-medium)\n- Form Labels: 14px/20px, Medium\n- Input Text: 15px/22px, Regular\n- Footer Links: 13px/20px, Regular\n\n## Spacing Framework\n\n**Core Units**: Tailwind scale of 4, 6, 8, 12, 16, 24\n- Form field vertical spacing: 16 (mb-4)\n- Section separation: 24 (mb-6)\n- Container padding: 32-48 (p-8 to p-12)\n- Button height: 44px (h-11) for touch-friendly targets\n- Input height: 48px (h-12)\n\n## Component Specifications\n\n### Google OAuth Button\n- Full width within container\n- White background with subtle border (1px, gray-300)\n- Google \"G\" icon (20px) on left with 12px spacing\n- Text: \"Continue with Google\"\n- Drop shadow: subtle elevation (shadow-sm)\n- Height: 48px with rounded corners (rounded-lg)\n\n### Visual Divider\n- Horizontal line with centered text overlay\n- Line: 1px gray-300, spans container width\n- \"OR\" text: small caps, gray-500, white background padding\n- Vertical spacing: 24px above and below\n\n### Email/Name Login Form\n- Name input field (full width)\n- Email input field (full width)\n- Both fields: 48px height, rounded-md, gray-300 border\n- Focus state: blue border highlight (2px border width)\n- Label position: above input with 6px spacing\n- Primary CTA: \"Continue with Email\" button (blue background, white text, full width, 48px height)\n\n### Left Panel Brand Section\n- Gradient background: Blue tones (light to medium saturation)\n- Centered content vertically and horizontally\n- Large ShiftMate logo/icon (64-80px)\n- Brand tagline below logo\n- Optional: Subtle geometric pattern or shift calendar visualization\n\n### Trust Indicators\n- Below login form: \"Trusted by 5,000+ teams\" with small icon\n- Subtle security badge or SSL indicator near footer\n\n### Footer Navigation\n- Horizontal link list: Help Center  Privacy Policy  Terms of Service\n- Positioned at bottom with 24px margin\n- Text size: 13px, gray-600 color\n- Links separated by bullet points\n\n## Interaction Patterns\n\n**Button States** (all buttons):\n- Default: Solid background with subtle shadow\n- Hover: Slight brightness increase (105%)\n- Active: Pressed effect (scale 98%)\n- Google button hover: Light gray background tint\n\n**Input Field States**:\n- Default: Gray border, white background\n- Focus: Blue border (2px), subtle blue glow\n- Error: Red border with error message below (text-sm, red-600)\n- Filled: Maintain focus border color until blur\n\n## Images Section\n\n**Left Panel Background**: \n- Subtle abstract geometric pattern suggesting calendar grids or shift schedules\n- Low opacity (10-15%) blue-tinted overlay\n- Alternatively: Illustrated scene of team collaboration or calendar interface\n- Image should reinforce productivity and organization themes\n- If photo: Professional office/team environment with blue color grading\n\n**No large hero image** - This is a focused login page prioritizing conversion over storytelling.\n\n## Accessibility Requirements\n\n- All inputs include visible labels (no placeholder-only patterns)\n- Form validation messages appear below inputs with appropriate ARIA attributes\n- Focus indicators are prominent (2px blue outline)\n- Color contrast meets WCAG AA standards (4.5:1 minimum)\n- Touch targets minimum 44x44px for mobile\n- Keyboard navigation flows logically: Logo  Google button  Name  Email  Submit\n\n## Responsive Behavior\n\n**Desktop (1024px+)**: Split-screen layout as described\n**Tablet (768-1023px)**: Reduce left panel to 35%, adjust container padding\n**Mobile (<768px)**: \n- Stack layout with compressed brand header (logo + name only)\n- Full-width container with 16px horizontal padding\n- Maintain all spacing ratios but scale down container max-width\n- Footer links stack vertically with 8px spacing","size_bytes":4740},"AUTH_TESTING.md":{"content":"# JWT Authentication Testing Guide\n\nThis document provides testing instructions for the JWT authentication system implemented in ShiftMate.\n\n## System Overview\n\nShiftMate uses a dual-token JWT authentication system:\n- **Access Token**: Short-lived (15 minutes), included in Authorization header\n- **Refresh Token**: Long-lived (30 days), stored as httpOnly cookie\n\n## Token Storage & Security\n\n### Backend\n- Refresh tokens are stored in the `refreshTokens` database table\n- Tokens are hashed using SHA-256 before storage (never stored in plaintext)\n- Revoked tokens have a `revokedAt` timestamp instead of being deleted\n- Expired tokens are periodically cleaned up\n\n### Frontend\n- Access token stored in memory + localStorage for persistence\n- Refresh token stored as httpOnly + secure cookie (not accessible to JavaScript)\n- Automatic token refresh on 401 errors with request retry\n- Tokens cleared on logout\n\n## Authentication Flow\n\n### 1. Google OAuth Login\nUser clicks \"Sign in with Google\" button which redirects to:\n```\nGET /api/auth/google?intent=login\n```\n\n### 2. OAuth Callback\nAfter successful Google authentication, user is redirected to:\n```\nGET /api/auth/google/callback?code=<auth_code>\n```\n\nBackend processes the OAuth callback and redirects to:\n```\n/?token=<access_token>\n```\n\nThe refresh token is set as an httpOnly cookie.\n\n### 3. Token Extraction\nFrontend (App.tsx) extracts token from URL parameter and:\n- Stores access token in memory and localStorage\n- Removes token from URL\n- Invalidates auth query to trigger user data fetch\n\n### 4. Authenticated Requests\nAll API requests include the access token:\n```\nAuthorization: Bearer <access_token>\n```\n\n### 5. Token Refresh\nWhen access token expires (401 error):\n- Frontend automatically calls `/api/auth/refresh`\n- Refresh token sent via httpOnly cookie\n- New access token returned and stored\n- Original request retried with new token\n\n### 6. Logout\nUser clicks logout button:\n- Frontend calls `/api/auth/logout`\n- Refresh token revoked in database\n- Cookies cleared\n- Frontend redirects to login\n\n## Manual Testing with cURL\n\n### Test 1: Check Authentication Status (Before Login)\n```bash\ncurl -X GET http://localhost:5000/api/auth/me \\\n  -H \"Content-Type: application/json\" \\\n  -c cookies.txt\n```\n\nExpected Response (401):\n```json\n{\n  \"message\": \"Not authenticated\"\n}\n```\n\n### Test 2: Simulate OAuth Login (For Testing Only)\n**Note**: Real login requires browser-based Google OAuth flow. This simulates the post-OAuth state.\n\nFirst, login via the browser using Google OAuth, then extract the access token from the URL.\n\n### Test 3: Check Current User (With Access Token)\n```bash\ncurl -X GET http://localhost:5000/api/auth/me \\\n  -H \"Authorization: Bearer YOUR_ACCESS_TOKEN_HERE\" \\\n  -H \"Content-Type: application/json\"\n```\n\nExpected Response (200):\n```json\n{\n  \"user\": {\n    \"id\": 1,\n    \"email\": \"user@example.com\",\n    \"name\": \"John Doe\",\n    \"userType\": \"individual\",\n    \"companyId\": null,\n    \"createdAt\": \"2025-10-29T12:00:00.000Z\"\n  }\n}\n```\n\n### Test 4: Refresh Access Token\n```bash\ncurl -X POST http://localhost:5000/api/auth/refresh \\\n  -H \"Content-Type: application/json\" \\\n  -b cookies.txt \\\n  -c cookies.txt\n```\n\nExpected Response (200):\n```json\n{\n  \"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n}\n```\n\n### Test 5: Access Protected Route (Shifts)\n```bash\ncurl -X GET http://localhost:5000/api/shifts \\\n  -H \"Authorization: Bearer YOUR_ACCESS_TOKEN_HERE\" \\\n  -H \"Content-Type: application/json\"\n```\n\nExpected Response (200):\n```json\n[\n  {\n    \"id\": 1,\n    \"userId\": 1,\n    \"date\": \"2025-10-29\",\n    \"startTime\": \"09:00\",\n    \"endTime\": \"17:00\",\n    \"shiftType\": \"weekday\",\n    ...\n  }\n]\n```\n\n### Test 6: Logout\n```bash\ncurl -X POST http://localhost:5000/api/auth/logout \\\n  -H \"Authorization: Bearer YOUR_ACCESS_TOKEN_HERE\" \\\n  -H \"Content-Type: application/json\" \\\n  -b cookies.txt\n```\n\nExpected Response (200):\n```json\n{\n  \"message\": \"Logged out successfully\"\n}\n```\n\n### Test 7: Verify Token Revocation\nAfter logout, try to refresh:\n```bash\ncurl -X POST http://localhost:5000/api/auth/refresh \\\n  -H \"Content-Type: application/json\" \\\n  -b cookies.txt\n```\n\nExpected Response (401):\n```json\n{\n  \"message\": \"Invalid or expired refresh token\"\n}\n```\n\n## Testing Scenarios\n\n### Scenario 1: Complete Login Flow (Browser Required)\n1. Open browser and navigate to `/login-new`\n2. Click \"Sign in with Google\"\n3. Complete Google OAuth flow\n4. Verify redirect to `/?token=<access_token>`\n5. Token should be extracted and stored automatically\n6. Dashboard should load with user data\n\n### Scenario 2: Token Expiration & Auto-Refresh\n1. Login and capture access token\n2. Wait 15 minutes for access token to expire\n3. Make any API request (e.g., view shifts)\n4. Frontend should automatically refresh token\n5. Request should succeed with new token\n\n### Scenario 3: Session Persistence\n1. Login via Google OAuth\n2. Close browser tab\n3. Reopen application\n4. Should remain logged in (access token in localStorage)\n5. If access token expired, auto-refresh should occur\n\n### Scenario 4: Multi-Device Logout\n1. Login from Device A and Device B\n2. Logout from Device A\n3. Device A's refresh token revoked\n4. Device B should still work (separate refresh token)\n\n### Scenario 5: Protected Route Access\n1. Login and get access token\n2. Test all protected routes:\n   - GET /api/shifts\n   - POST /api/shifts\n   - GET /api/companies\n   - GET /api/billing/rates\n   - POST /api/billing/rates\n3. All should return data with valid token\n\n## Error Scenarios\n\n### Missing Authorization Header\n```bash\ncurl -X GET http://localhost:5000/api/shifts \\\n  -H \"Content-Type: application/json\"\n```\nExpected: 401 Unauthorized (falls back to session auth if available)\n\n### Invalid Access Token\n```bash\ncurl -X GET http://localhost:5000/api/auth/me \\\n  -H \"Authorization: Bearer invalid_token_here\" \\\n  -H \"Content-Type: application/json\"\n```\nExpected: 401 Unauthorized with error message\n\n### Expired Access Token\nAccess token expires after 15 minutes. Frontend automatically refreshes.\nBackend returns 401, frontend calls /api/auth/refresh, retries request.\n\n### Revoked Refresh Token\n```bash\n# After logout, refresh token is revoked\ncurl -X POST http://localhost:5000/api/auth/refresh \\\n  -b cookies.txt\n```\nExpected: 401 Unauthorized\n\n## Database Verification\n\n### Check Refresh Tokens\n```sql\nSELECT id, \"userId\", \n       LEFT(\"tokenHash\", 20) || '...' as token_preview,\n       \"expiresAt\", \"createdAt\", \"revokedAt\"\nFROM \"refreshTokens\"\nORDER BY \"createdAt\" DESC;\n```\n\n### Check Active Tokens\n```sql\nSELECT COUNT(*) as active_tokens\nFROM \"refreshTokens\"\nWHERE \"expiresAt\" > NOW() \n  AND \"revokedAt\" IS NULL;\n```\n\n### Check Revoked Tokens\n```sql\nSELECT COUNT(*) as revoked_tokens\nFROM \"refreshTokens\"\nWHERE \"revokedAt\" IS NOT NULL;\n```\n\n## Frontend Testing Checklist\n\n- [ ] Login with Google OAuth completes successfully\n- [ ] Access token extracted from URL and stored\n- [ ] Dashboard loads with user data\n- [ ] Navigation between pages works\n- [ ] Shift data loads correctly\n- [ ] Token refresh happens automatically on 401\n- [ ] Logout clears tokens and redirects to login\n- [ ] Refresh page maintains authentication\n- [ ] Close/reopen tab maintains authentication\n- [ ] Access token in localStorage persists\n\n## Backend Testing Checklist\n\n- [ ] Google OAuth callback generates tokens\n- [ ] Access token is valid JWT with correct payload\n- [ ] Refresh token stored as hash in database\n- [ ] /api/auth/me returns user data with valid token\n- [ ] /api/auth/refresh issues new access token\n- [ ] /api/auth/logout revokes refresh token\n- [ ] Protected routes require valid JWT\n- [ ] Expired tokens return 401\n- [ ] Revoked tokens cannot be used\n- [ ] Cleanup job removes expired tokens\n\n## Troubleshooting\n\n### Token Not Stored After Login\n- Check browser console for errors\n- Verify token parameter in URL after OAuth redirect\n- Check localStorage for access token\n\n### 401 Errors on Every Request\n- Verify Authorization header includes \"Bearer \" prefix\n- Check access token is valid (not expired)\n- Verify token format is correct JWT\n\n### Refresh Token Not Working\n- Check httpOnly cookie is set\n- Verify cookie domain matches application domain\n- Check refresh token not expired or revoked\n- Verify browser sends cookies with credentials: 'include'\n\n### Auto-Refresh Not Working\n- Check queryClient interceptor is configured\n- Verify 401 errors trigger refresh attempt\n- Check refresh endpoint returns new token\n- Verify retry logic in apiRequest function\n\n## Security Notes\n\n1. **Token Hashing**: Refresh tokens are hashed before storage using SHA-256\n2. **HttpOnly Cookies**: Refresh tokens not accessible to JavaScript (XSS protection)\n3. **Secure Flag**: Cookies sent only over HTTPS in production\n4. **SameSite**: Cookie attribute prevents CSRF attacks\n5. **Token Rotation**: New refresh token issued on each refresh (optional)\n6. **Expiration**: Short-lived access tokens minimize exposure window\n7. **Revocation**: Logout immediately revokes refresh token\n\n## Required Environment Variables\n\n**CRITICAL**: The application will not start without these environment variables set:\n\n### JWT_SECRET (Required)\n- **Purpose**: Secret key for signing and verifying JWT access tokens\n- **Security**: MUST be a strong, random, cryptographically secure secret\n- **Generation**: Use a secure random generator (minimum 64 characters recommended)\n- **Example generation**:\n  ```bash\n  # Generate a secure random secret\n  node -e \"console.log(require('crypto').randomBytes(64).toString('hex'))\"\n  ```\n- **Setting in Replit**:\n  1. Go to \"Secrets\" in the Replit sidebar (Tools  Secrets)\n  2. Add new secret: Key = `JWT_SECRET`, Value = your generated secret\n  3. Restart the application\n\n**Warning**: Without JWT_SECRET set, the application will throw a startup error and refuse to run. This is intentional for security - no hardcoded fallback is allowed.\n\n## Production Considerations\n\n1. Set secure environment variables:\n   - `JWT_SECRET`: Strong random secret for signing tokens (REQUIRED - see above)\n   - Optional: Separate secret for refresh tokens if implementing token rotation\n\n2. Enable HTTPS:\n   - Secure flag on cookies only works over HTTPS\n   - Use Replit deployment for automatic HTTPS\n\n3. Monitor token usage:\n   - Track failed refresh attempts\n   - Alert on unusual token patterns\n   - Cleanup expired tokens regularly\n\n4. Rate limiting:\n   - Limit refresh token requests per IP\n   - Prevent brute force attacks\n\n5. Token rotation (optional):\n   - Issue new refresh token on each refresh\n   - Revoke old refresh token\n   - Implement token family tracking\n","size_bytes":10622},"server/auth/jwt-utils.ts":{"content":"import jwt from 'jsonwebtoken';\nimport crypto from 'crypto';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'shiftmate-jwt-secret-change-in-production';\nconst ACCESS_TOKEN_EXPIRY = '15m'; // 15 minutes\nconst REFRESH_TOKEN_EXPIRY = '30d'; // 30 days\n\nexport interface JWTPayload {\n  userId: number;\n  email: string;\n  name: string;\n  userType: string;\n  companyId?: number | null;\n}\n\nexport interface TokenPair {\n  accessToken: string;\n  refreshToken: string;\n  refreshTokenExpiry: Date;\n}\n\n/**\n * Generate access token (15 minutes expiry)\n */\nexport function generateAccessToken(payload: JWTPayload): string {\n  return jwt.sign(payload, JWT_SECRET, {\n    expiresIn: ACCESS_TOKEN_EXPIRY,\n    issuer: 'shiftmate',\n    audience: 'shiftmate-api',\n  });\n}\n\n/**\n * Generate refresh token (30 days expiry)\n */\nexport function generateRefreshToken(): string {\n  return crypto.randomBytes(64).toString('hex');\n}\n\n/**\n * Generate both access and refresh tokens\n */\nexport function generateTokenPair(payload: JWTPayload): TokenPair {\n  const accessToken = generateAccessToken(payload);\n  const refreshToken = generateRefreshToken();\n  \n  // Calculate refresh token expiry (30 days from now)\n  const refreshTokenExpiry = new Date();\n  refreshTokenExpiry.setDate(refreshTokenExpiry.getDate() + 30);\n\n  return {\n    accessToken,\n    refreshToken,\n    refreshTokenExpiry,\n  };\n}\n\n/**\n * Verify and decode access token\n */\nexport function verifyAccessToken(token: string): JWTPayload {\n  try {\n    const decoded = jwt.verify(token, JWT_SECRET, {\n      issuer: 'shiftmate',\n      audience: 'shiftmate-api',\n    }) as JWTPayload;\n    \n    return decoded;\n  } catch (error) {\n    if (error instanceof jwt.TokenExpiredError) {\n      throw new Error('Token expired');\n    } else if (error instanceof jwt.JsonWebTokenError) {\n      throw new Error('Invalid token');\n    }\n    throw error;\n  }\n}\n\n/**\n * Hash refresh token for secure storage\n */\nexport function hashToken(token: string): string {\n  return crypto\n    .createHash('sha256')\n    .update(token)\n    .digest('hex');\n}\n\n/**\n * Verify refresh token hash matches\n */\nexport function verifyRefreshTokenHash(token: string, hash: string): boolean {\n  const tokenHash = hashToken(token);\n  return crypto.timingSafeEqual(\n    Buffer.from(tokenHash),\n    Buffer.from(hash)\n  );\n}\n","size_bytes":2309}},"version":2}